<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spring XD Guide</title>
<style>
@import url(http://fonts.googleapis.com/css?family=Varela+Round|Open+Sans:400italic,700italic,400,700);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css);
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #385dbd; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #095557; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #042829; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Varela Round", Arial, sans-serif; font-weight: normal; font-style: normal; color: #152347; text-rendering: optimizeLegibility; margin-top: 0.8em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #385dbd; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dcd2c9; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: bold; color: #691816; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #211306; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #655241; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #655241; }

blockquote, blockquote p { line-height: 1.6; color: #846b55; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #e4e7ef; }
table thead, table tfoot { background: rgba(105, 60, 22, 0.25); font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #211306; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #211306; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f4f5f8; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: inherit; padding: 0; white-space: nowrap; background-color: inherit; border: 0 solid #dddddd; -webkit-border-radius: 6px; border-radius: 6px; text-shadow: none; }

pre, pre > code { line-height: 1.4; color: black; font-family: monospace, serif; font-weight: normal; }

.keyseq { color: #774417; }

kbd:not(.keyseq) { display: inline-block; color: #211306; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #541312; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #693c16; font-weight: normal; border-bottom: 1px solid #dcd2c9;}
#header span { color: #846b55; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#revdate {
	display: block;
	margin-top: 2.5em;
}

#toc { border-bottom: 1px solid #e6dfd8; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }

#toctitle { color: #385dbd; }

@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #e6dfd8; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #e6dfd8; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 6px; border-radius: 6px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }

#content #toctitle { font-weight: bold; font-family: "Open Sans", Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }

#footer { max-width: 100%; background-color: #23160c; padding: 1.25em; }

#footer-text { color: #deecf9; line-height: 1.44; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 1px solid #e6dfd8; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #152347; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #0f1933; }

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dcd2c9; color: #846b55; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #f3e0ce; margin-bottom: 1.25em; padding: 1.25em; background: #fdfaf7; -webkit-border-radius: 6px; border-radius: 6px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #385dbd; margin-top: 0; line-height: 1.6; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre:not([class]), .listingblock pre:not([class]) { background: url('../images/golo/pre-bg.png?1370460826'); }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px; border-style: solid; border-color: rgba(21, 35, 71, 0.1); -webkit-border-radius: 6px; border-radius: 6px; padding: 0.8em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.72em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.81em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.9em; } }

.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 0.8em; }

.listingblock > .content { position: relative; }

.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }

.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }

table.pyhltable { border: 0; margin-bottom: 0; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dcd2c9; }

.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }

.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #655241; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 6px; border-radius: 6px; border-top: 1px solid #e4e7ef; border-bottom: 1px solid #e4e7ef; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }

th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }

th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }

tbody tr th { display: table-cell; line-height: 1.6; background: rgba(105, 60, 22, 0.25); }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #211306; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.qanda > ol > li > p > em:only-child { color: #063f40; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #095557; color: #064042; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: #211306; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

body { background: url('../images/golo/body-bg.png?1370460826') #fdfaf7 repeat; }

#toc.toc2 ul ul { padding-left: 1.75em; }

#toctitle { color: #152347; }

#header h1 { font-weight: bold; position: relative; left: -0.0625em; }
#header h1 span.lo { color: #dc9424; }

#content h2, #content h3, #content #toctitle, #content .sidebarblock > .content > .title, #content h4, #content h5, #content #toctitle { font-weight: normal; position: relative; left: -0.0625em; }
#content h2 { font-weight: bold; }

.literalblock .content pre.highlight, .listingblock .content pre.highlight { background: url('../images/golo/pre-bg.png?1370460826'); }

.admonitionblock > table td.content { border-color: #e6dfd8; }

table.tableblock.grid-all { -webkit-border-radius: 0; border-radius: 0; }

#footer { background-color: #23160c; }
</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring XD Guide</h1>
<span id="author" class="author">Mark Fisher</span><br><span id="author2" class="author">Mark Pollack</span><br><span id="author3" class="author">David Turanski</span><br><span id="author4" class="author">Gunnar Hillert</span><br><span id="author5" class="author">Eric Bottard</span><br><span id="author6" class="author">Patrick Peralta, Gary Russell</span><br><span id="author7" class="author">Ilayaperumal Gopinathan</span><br><span id="author8" class="author">Jennifer Hickey</span><br><span id="author9" class="author">Michael Minella</span><br><span id="author10" class="author">Luke Taylor</span><br><span id="author11" class="author">Thomas Risberg</span><br><span id="author12" class="author">Glenn Renfro</span><br><span id="author13" class="author">Janne Valkealahti</span><br><span id="author14" class="author">Thomas Darimont</span><br><span id="author15" class="author">Dave Syer</span><br><span id="author16" class="author">Jon Brisbin</span><br><span id="author17" class="author">Andy Clement</span><br>
<span id="revdate">1.0.0.RELEASE</span>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_reference_guide">Reference Guide</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_overview">Overview</a></li>
</ul>
</li>
<li><a href="#getting-started">Getting Started</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_requirements">Requirements</a></li>
<li><a href="#_download_spring_xd">Download Spring XD</a></li>
<li><a href="#_install_spring_xd">Install Spring XD</a></li>
<li><a href="#_start_the_runtime_and_the_xd_shell">Start the Runtime and the XD Shell</a></li>
<li><a href="#_create_a_stream">Create a Stream</a></li>
<li><a href="#_explore_spring_xd">Explore Spring XD</a></li>
<li><a href="#_osx_homebrew_installation">OSX Homebrew installation</a></li>
<li><a href="#_redhat_centos_installation">RedHat/CentOS Installation</a></li>
<li><a href="#running-distributed-mode">Running in Distributed Mode</a></li>
<li><a href="#running-on-YARN">Running on YARN</a></li>
</ul>
</li>
<li><a href="#application-configuration">Application Configuration</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_3">Introduction</a></li>
<li><a href="#_server_configuration">Server Configuration</a></li>
<li><a href="#_module_configuration">Module Configuration</a></li>
</ul>
</li>
<li><a href="#dsl-guide">DSL Guide</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_4">Introduction</a></li>
<li><a href="#_pipes_and_filters">Pipes and filters</a></li>
<li><a href="#_module_parameters">Module parameters</a></li>
<li><a href="#named-channels">Named channels</a></li>
<li><a href="#_labels">Labels</a></li>
<li><a href="#dsl-quotes-escaping">Single quotes, Double quotes, Escaping</a></li>
</ul>
</li>
<li><a href="#interactive-shell">Interactive Shell</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_5">Introduction</a></li>
</ul>
</li>
<li><a href="#adminui">Admin UI</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_6">Introduction</a></li>
<li><a href="#_streams">Streams</a></li>
<li><a href="#_jobs">Jobs</a></li>
</ul>
</li>
<li><a href="#architecture">Architecture</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_7">Introduction</a></li>
<li><a href="#_jobs_2">Jobs</a></li>
<li><a href="#_taps">Taps</a></li>
</ul>
</li>
<li><a href="#_distributed_runtime">Distributed Runtime</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_8">Introduction</a></li>
<li><a href="#_configuring_spring_xd_for_high_availabilty_ha">Configuring Spring XD for High Availabilty(HA)</a></li>
<li><a href="#_zookeeper_overview">ZooKeeper Overview</a></li>
<li><a href="#_the_admin_server_internals">The Admin Server Internals</a></li>
<li><a href="#_module_deployment">Module Deployment</a></li>
</ul>
</li>
<li><a href="#batch">Batch Jobs</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_9">Introduction</a></li>
<li><a href="#_workflow">Workflow</a></li>
<li><a href="#_features">Features</a></li>
<li><a href="#_the_lifecycle_of_a_job_in_spring_xd">The Lifecycle of a Job in Spring XD</a></li>
<li><a href="#_deployment_manifest_support_for_job">Deployment manifest support for job</a></li>
<li><a href="#_launching_a_job">Launching a job</a></li>
<li><a href="#_retrieve_job_notifications">Retrieve job notifications</a></li>
<li><a href="#_removing_batch_jobs">Removing Batch Jobs</a></li>
<li><a href="#_pre_packaged_batch_jobs">Pre-Packaged Batch Jobs</a></li>
</ul>
</li>
<li><a href="#streams">Streams</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_10">Introduction</a></li>
<li><a href="#_creating_a_simple_stream">Creating a Simple Stream</a></li>
<li><a href="#_deleting_a_stream">Deleting a Stream</a></li>
<li><a href="#_deploying_and_undeploying_streams">Deploying and Undeploying Streams</a></li>
<li><a href="#_other_source_and_sink_types">Other Source and Sink Types</a></li>
<li><a href="#_simple_stream_processing">Simple Stream Processing</a></li>
<li><a href="#_dsl_syntax">DSL Syntax</a></li>
<li><a href="#_advanced_features">Advanced Features</a></li>
</ul>
</li>
<li><a href="#modules">Modules</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_11">Introduction</a></li>
<li><a href="#_creating_a_module">Creating a Module</a></li>
<li><a href="#_registering_a_module">Registering a Module</a></li>
<li><a href="#composing-modules">Composing Modules</a></li>
<li><a href="#module_info">Getting Information about Modules</a></li>
<li><a href="#module_values">How module options are resolved</a></li>
</ul>
</li>
<li><a href="#sources">Sources</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_12">Introduction</a></li>
<li><a href="#http">HTTP</a></li>
<li><a href="#tail">Tail</a></li>
<li><a href="#file">File</a></li>
<li><a href="#mail_source">Mail</a></li>
<li><a href="#twitter-search">Twitter Search</a></li>
<li><a href="#twitter-stream">Twitter Stream</a></li>
<li><a href="#gemfire-source">GemFire Source</a></li>
<li><a href="#gemfire-continuous-query">GemFire Continuous Query</a></li>
<li><a href="#syslog">Syslog</a></li>
<li><a href="#tcp">TCP</a></li>
<li><a href="#tcp-client">TCP Client</a></li>
<li><a href="#reactor-ip">Reactor IP</a></li>
<li><a href="#rabbit">RabbitMQ</a></li>
<li><a href="#jms">JMS</a></li>
<li><a href="#time">Time</a></li>
<li><a href="#mqtt">MQTT</a></li>
<li><a href="#stdout">Stdout Capture</a></li>
</ul>
</li>
<li><a href="#processors">Processors</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_13">Introduction</a></li>
<li><a href="#filter">Filter</a></li>
<li><a href="#transform">Transform</a></li>
<li><a href="#script">Script</a></li>
<li><a href="#splitter">Splitter</a></li>
<li><a href="#aggregator">Aggregator</a></li>
<li><a href="#http-client">HTTP Client</a></li>
<li><a href="#json-to-tuple">JSON to Tuple</a></li>
<li><a href="#object-to-json">Object to JSON</a></li>
</ul>
</li>
<li><a href="#sinks">Sinks</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_14">Introduction</a></li>
<li><a href="#log">Log</a></li>
<li><a href="#file-sink">File Sink</a></li>
<li><a href="#hadoop-hdfs">Hadoop (HDFS)</a></li>
<li><a href="#hdfs-dataset-avroparquet">HDFS Dataset (Avro/Parquet)</a></li>
<li><a href="#jdbc">JDBC</a></li>
<li><a href="#tcp-sink">TCP Sink</a></li>
<li><a href="#mongo">Mongo</a></li>
<li><a href="#mail">Mail</a></li>
<li><a href="#rabbitmq">RabbitMQ</a></li>
<li><a href="#gemfire-server">GemFire Server</a></li>
<li><a href="#splunk-server">Splunk Server</a></li>
<li><a href="#mqtt-sink">MQTT Sink</a></li>
<li><a href="#dynamic-router">Dynamic Router</a></li>
</ul>
</li>
<li><a href="#taps">Taps</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_15">Introduction</a></li>
<li><a href="#_tap_lifecycle">Tap Lifecycle</a></li>
</ul>
</li>
<li><a href="#analytics">Analytics</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_16">Introduction</a></li>
<li><a href="#_predictive_analytics">Predictive analytics</a></li>
<li><a href="#_analytical_models">Analytical Models</a></li>
<li><a href="#_counters_and_gauges">Counters and Gauges</a></li>
</ul>
</li>
<li><a href="#tuples">Tuples</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_17">Introduction</a></li>
</ul>
</li>
<li><a href="#type-conversion">Type Conversion</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_18">Introduction</a></li>
<li><a href="#mime-types">MIME types</a></li>
<li><a href="#stream-definition-examples">Stream Definition Examples</a></li>
<li><a href="#_pojo_to_json">POJO to JSON</a></li>
<li><a href="#mime-types-and-java-types">MIME types and Java types</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-modules-and-extensions">Developing Modules and Extensions</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#creating-a-source-module">Creating a Source Module</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_19">Introduction</a></li>
<li><a href="#_create_the_module_application_context_file">Create the module Application Context file</a></li>
<li><a href="#_test_the_module_locally">Test the module locally</a></li>
<li><a href="#install-module-source">Installing the module</a></li>
<li><a href="#_test_the_deployed_module">Test the deployed module</a></li>
<li><a href="#install-module-source-subdir">Installing the module in a sub-directory</a></li>
</ul>
</li>
<li><a href="#creating-a-processor-module">Creating a Processor Module</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_20">Introduction</a></li>
<li><a href="#_write_the_transformer_code">Write the Transformer Code</a></li>
<li><a href="#_create_the_module_application_context_file_2">Create the module Application Context File</a></li>
<li><a href="#_install_the_module">Install the Module</a></li>
<li><a href="#_test_the_deployed_module_2">Test the deployed module</a></li>
<li><a href="#_installing_the_module_in_a_sub_directory">Installing the module in a sub-directory</a></li>
</ul>
</li>
<li><a href="#creating-a-sink-module">Creating a Sink Module</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_21">Introduction</a></li>
<li><a href="#_create_the_module_application_context_file_3">Create the module Application Context file</a></li>
<li><a href="#_make_the_module_configurable_2">Make the module configurable</a></li>
<li><a href="#_test_the_module_locally_2">Test the module locally</a></li>
<li><a href="#install-module-sink">Install the module</a></li>
<li><a href="#_test_the_deployed_module_3">Test the deployed module</a></li>
<li><a href="#_installing_the_module_in_a_sub_directory_2">Installing the module in a sub-directory</a></li>
</ul>
</li>
<li><a href="#creating-a-job-module">Creating a Job Module</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_22">Introduction</a></li>
<li><a href="#_developing_your_job">Developing your Job</a></li>
<li><a href="#_creating_a_simple_job">Creating a Simple Job</a></li>
<li><a href="#_creating_a_read_write_processing_job">Creating a read-write processing Job</a></li>
<li><a href="#_orchestrating_hadoop_jobs">Orchestrating Hadoop Jobs</a></li>
<li><a href="#_installing_the_module_in_a_sub_directory_3">Installing the module in a sub-directory</a></li>
</ul>
</li>
<li><a href="#module-options-metadata">Providing Module Options Metadata</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_23">Introduction</a></li>
<li><a href="#_using_the_simple_approach">Using the "Simple" approach</a></li>
<li><a href="#_using_the_pojo_approach">Using the "POJO" approach</a></li>
<li><a href="#options_metadata_style">Metadata style remarks</a></li>
</ul>
</li>
<li><a href="#extending-xd">Extending Spring XD</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_24">Introduction</a></li>
<li><a href="#XD-Spring-Application-Contexts">Spring XD Application Contexts</a></li>
<li><a href="#Plugin-Architecture">Plugin Architecture</a></li>
<li><a href="#How-to-Add-a-Spring-Bean-to-the-XD-Container">How to Add a Spring bean to the XD Container</a></li>
<li><a href="#Providing-a-New-Type-Converter">Providing A new Type Converter</a></li>
<li><a href="#Adding-a-New-Data-Transport">Adding a New Data Transport</a></li>
</ul>
</li>
<li><a href="#samples">Samples</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_syslog_ingestion_into_hdfs">Syslog ingestion into HDFS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration-guidelines">Configuration Guidelines</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#_overview_2">Overview</a></li>
<li><a href="#deployment">Deployment</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_25">Introduction</a></li>
<li><a href="#deployment-manifest">Deployment Manifest</a></li>
<li><a href="#deployment-states">Deployment States</a></li>
<li><a href="#container-attributes">Container Attributes</a></li>
<li><a href="#_stream_deployment_examples">Stream Deployment Examples</a></li>
<li><a href="#partitioned-stream-deployment-examples">Partitioned Stream Deployment Examples</a></li>
<li><a href="#direct-binding-deployment-examples">Direct Binding Deployment Examples</a></li>
</ul>
</li>
<li><a href="#messagebus">Message Bus Configuration</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_26">Introduction</a></li>
<li><a href="#_rabbit_message_bus_high_availability_ha_configuration">Rabbit Message Bus High Availability (HA) Configuration</a></li>
<li><a href="#_error_handling_message_delivery_failures">Error Handling (Message Delivery Failures)</a></li>
<li><a href="#rabbitssl">Rabbit Message Bus Secure Sockets Layer (SSL)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_administration">Administration</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#monitoring-management">Monitoring and Management</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_monitoring_xd_admin_container_and_single_node_servers">Monitoring XD Admin, Container and Single-node servers</a></li>
<li><a href="#_to_disable_boot_endpoints_over_http">To disable boot endpoints over HTTP</a></li>
<li><a href="#_management_over_jmx">Management over JMX</a></li>
<li><a href="#_to_disable_management_over_jmx">To disable management over JMX</a></li>
<li><a href="#_monitoring_deployed_modules_in_xd_container">Monitoring deployed modules in XD container</a></li>
<li><a href="#_using_jolokia_to_access_jmx_over_http">Using Jolokia to access JMX over http</a></li>
</ul>
</li>
<li><a href="#REST-API">REST API</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_27">Introduction</a></li>
<li><a href="#_xd_resources">XD Resources</a></li>
<li><a href="#stream-definitions">Stream Definitions</a></li>
<li><a href="#stream-deployments">Stream Deployments</a></li>
<li><a href="#job-definitions">Job Definitions</a></li>
<li><a href="#job-deployments">Job Deployments</a></li>
<li><a href="#batch-jobs">Batch Job Configurations</a></li>
<li><a href="#batch-executions">Batch Job Executions</a></li>
<li><a href="#job-instances">Batch Job Instances</a></li>
<li><a href="#module-definitions">Module Definitions</a></li>
<li><a href="#runtime-modules">Runtime Modules</a></li>
<li><a href="#runtime-containers">Runtime Containers</a></li>
<li><a href="#counters">Counters</a></li>
<li><a href="#field-value-counters">Field Value Counters</a></li>
<li><a href="#aggregate-counters">Aggregate Counters</a></li>
<li><a href="#gauges">Gauges</a></li>
<li><a href="#rich-gauges">Rich Gauges</a></li>
<li><a href="#completions">Tab Completions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_appendices">Appendices</a></li>
<li>
<ul class="sectlevel1">
<li><a href="#installing-hadoop">Appendix A: Installing Hadoop</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_installing_hadoop">Installing Hadoop</a></li>
<li><a href="#_running_hadoop">Running Hadoop</a></li>
</ul>
</li>
<li><a href="#building-spring-xd">Appendix B: Building Spring XD</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_instructions">Instructions</a></li>
<li><a href="#_ide_support">IDE support</a></li>
<li><a href="#_running_script_tests">Running script tests</a></li>
</ul>
</li>
<li><a href="#_using_mqtt_modules">Appendix C: Using MQTT Modules</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_introduction_28">Introduction</a></li>
</ul>
</li>
<li><a href="#shell-command-reference">Appendix D: XD Shell Command Reference</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_configuration_commands">Configuration Commands</a></li>
<li><a href="#_runtime_commands">Runtime Commands</a></li>
<li><a href="#_stream_commands">Stream Commands</a></li>
<li><a href="#_job_commands">Job Commands</a></li>
<li><a href="#_module_commands">Module Commands</a></li>
<li><a href="#_metrics_commands">Metrics Commands</a></li>
<li><a href="#_http_commands">Http Commands</a></li>
<li><a href="#_hadoop_configuration_commands">Hadoop Configuration Commands</a></li>
<li><a href="#_hadoop_filesystem_commands">Hadoop FileSystem Commands</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_reference_guide" class="sect0">Reference Guide</h1>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">Overview</h3>
<div class="paragraph">
<p>Spring XD is a unified, distributed, and extensible service for data ingestion, real time analytics, batch processing, and data export. The Spring XD project is an open source <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2 License</a> licenced project whose goal is to tackle big data complexity.  Much of the complexity in building real-world big data applications is related to integrating many disparate systems into one cohesive solution across a range of use-cases.
 Common use-cases encountered in creating a comprehensive big data solution are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>High throughput distributed data ingestion from a variety of input sources into big data store such as HDFS or Splunk</p>
</li>
<li>
<p>Real-time analytics at ingestion time, e.g. gathering metrics and counting values.</p>
</li>
<li>
<p>Workflow management via batch jobs.  The jobs combine interactions with standard enterprise systems (e.g. RDBMS) as well as Hadoop operations (e.g. MapReduce, HDFS, Pig, Hive or Cascading).</p>
</li>
<li>
<p>High throughput data export, e.g. from HDFS to a RDBMS or NoSQL database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Spring XD project aims to provide a one stop shop solution for these use-cases.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div class="paragraph">
<p>To get started, make sure your system has as a minimum  <a href="http://www.oracle.com/technetwork/java/javase/downloads/"><strong>Java JDK 6</strong></a> or newer installed. <strong>Java JDK 7</strong> is recommended.</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_spring_xd">Download Spring XD</h3>
<div class="paragraph">
<p>To download the current release, you can download the distribution <a href="http://repo.spring.io/release/org/springframework/xd/spring-xd/1.0.0.RELEASE/spring-xd-1.0.0.RELEASE-dist.zip"><strong>spring-xd-1.0.0.RELEASE-dist.zip</strong></a> and <a href="http://repo.spring.io/release/org/springframework/xd/spring-xd/1.0.0.RELEASE/spring-xd-1.0.0.RELEASE-docs.zip">its accompanying documentation</a>.</p>
</div>
<div class="paragraph">
<p>If you want to try out the latest build of Spring XD, You can download the snapshot distribution from <a href="http://repo.spring.io/libs-snapshot/org/springframework/xd/spring-xd/1.0.1.BUILD-SNAPSHOT">the spring snapshots repository</a>. You can also <a href="#building-spring-xd">build the project from source</a> if you wish. The wiki content should also be kept up to date with the current snapshot so if you are reading this on the github website, things may have changed since the last stable release.</p>
</div>
<div class="paragraph">
<p>Unzip the distribution which will unpack to a single installation directory. All the commands below are executed from this directory, so change into it before proceeding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cd spring-xd-1.0.0.RELEASE</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_spring_xd">Install Spring XD</h3>
<div class="paragraph">
<p>Spring XD can be run in two different modes. There&#8217;s a single-node runtime option for testing and development, and there&#8217;s a distributed runtime which supports distribution of processing tasks across multiple nodes. This document will get you up and running quickly with a single-node runtime. See <a href="#running-distributed-mode">Running Distributed Mode</a> for details on setting up a distributed runtime.</p>
</div>
<div class="paragraph">
<p>You can also install Spring XD using <a href="#osx-homebrew-installation">homebrew</a> on OSX and <a href="#redhatcentos-installation">yum</a> on RedHat/CentOS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_start_the_runtime_and_the_xd_shell">Start the Runtime and the XD Shell</h3>
<div class="paragraph">
<p>The single node option is the easiest to get started with. It runs everything you need in a single process. To start it, you just need to <code>cd</code> to the <code>xd</code> directory and run the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd/bin&gt;$ ./xd-singlenode</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a separate terminal, <code>cd</code> into the <code>shell</code> directory and start the XD shell, which you can use to issue commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>shell/bin>$ ./xd-shell
 _____                           __   _______
/  ___|          (-)             \ \ / /  _  \
\ `--. _ __  _ __ _ _ __   __ _   \ V /| | | |
 `--. \ '_ \| '__| | '_ \ / _` |  / ^ \| | | |
/\__/ / |_) | |  | | | | | (_| | / / \ \ |/ /
\____/| .__/|_|  |_|_| |_|\__, | \/   \/___/
      | |                  __/ |
      |_|                 |___/
eXtreme Data
1.0.0.RELEASE | Admin Server Target: http://localhost:9393
Welcome to the Spring XD shell. For assistance hit TAB or type "help".
xd:></code></pre>
</div>
</div>
<div class="paragraph">
<p>The shell is a more user-friendly front end to the REST API which Spring XD exposes to clients. The URL of the currently targeted Spring XD server is shown at startup.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the server could not be reached, the prompt will read</p>
</div>
<div class="listingblock">
<div class="content">
<pre>server-unknown:&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can then use the <code>admin config server &lt;url&gt;</code> to attempt to reconnect to the admin REST endpoint once you&#8217;ve figured out what went wrong:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>admin config server http://localhost:9393</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should now be able to start using Spring XD.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Spring XD uses ZooKeeper internally which typically runs as an external process. XD singlenode runs with an embedded ZooKeeper server and assigns a random available port. This keeps things very simple. However if you already have a ZooKeeper ensemble set up and want to connect to it, you can edit <code>xd/config/servers.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Zookeeper properties
# client connect string: host1:port1,host2:port2,...,hostN:portN
zk:
  client:
     connect: localhost:2181</pre>
</div>
</div>
<div class="paragraph">
<p>Also, sometimes it is useful in troubleshooting to connect the ZooKeeper CLI to the embedded server. The assigned server port is listed in the console log, but you can also set the port directly by setting the property <code>zk.embedded.server.port</code> in <code>servers.yml</code> or set <code>JAVA_OPTS</code> before starting xd-singlenode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$export JAVA_OPTS=-Dzk.embedded.server.port=&lt;port&gt;</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_stream">Create a Stream</h3>
<div class="paragraph">
<p>In Spring XD, a basic stream defines the ingestion of event driven data from a source to a sink that passes through any number of processors. You can create a new stream by issuing a <code>stream create</code> command from the XD shell.  Stream definitions are built from a simple DSL. For example, execute:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name ticktock --definition "time | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This defines a stream named <code>ticktock</code> based off the DSL expression <code>time | log</code>.  The DSL uses the "pipe" symbol <code>|</code>, to connect a source to a sink. The stream server finds the <code>time</code> and <code>log</code> definitions in the modules directory and uses them to setup the stream.  In this simple example, the time source simply sends the current time as a message each second, and the log sink outputs it using the logging framework at the WARN logging level.  Since the <code>--deploy</code> flag was provided, this stream will be deployed immediately. In the console where you started the server, you will see log output similar to that listed below</p>
</div>
<div class="literalblock">
<div class="content">
<pre>13:09:53,812  INFO http-bio-8080-exec-1 module.SimpleModule:109 - started module: Module [name=log, type=sink]
13:09:53,813  INFO http-bio-8080-exec-1 module.ModuleDeployer:111 - launched sink module: ticktock:log:1
13:09:53,911  INFO http-bio-8080-exec-1 module.SimpleModule:109 - started module: Module [name=time, type=source]
13:09:53,912  INFO http-bio-8080-exec-1 module.ModuleDeployer:111 - launched source module: ticktock:time:0
13:09:53,945  WARN task-scheduler-1 logger.ticktock:141 - 2013-06-11 13:09:53
13:09:54,948  WARN task-scheduler-1 logger.ticktock:141 - 2013-06-11 13:09:54
13:09:55,949  WARN task-scheduler-2 logger.ticktock:141 - 2013-06-11 13:09:55</pre>
</div>
</div>
<div class="paragraph">
<p>To stop the stream, and remove the definition completely, you can use the <code>stream destroy</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream destroy --name ticktock</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to stop and restart the stream instead, using the <code>undeploy</code> and <code>deploy</code> commands. The shell supports command completion so you can hit the <code>tab</code> key to see which commands and options are available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_explore_spring_xd">Explore Spring XD</h3>
<div class="paragraph">
<p>Learn about the modules available in Spring XD in the <a href="#sources">Sources</a>, <a href="#processors">Processors</a>, and <a href="#sinks">Sinks</a> sections of the documentation.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t see what you&#8217;re looking for? Create a custom module: <a href="#creating-a-source-module">source</a>, <a href="#creating-a-processor-module">processor</a> or <a href="#creating-a-sink-module">sink</a> (and then consider <a href="https://github.com/SpringSource/spring-xd/wiki/Contribute">contributing</a> it back to Spring XD).</p>
</div>
<div class="paragraph">
<p>Want to add some analytics to your stream? Check out the <a href="#taps">Taps</a> and <a href="#analytics">Analytics</a> sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="_osx_homebrew_installation">OSX Homebrew installation</h3>
<div class="paragraph">
<p>If you are on a Mac and using <a href="http://brew.sh/">homebrew</a>, all you need to do to install <em>Spring XD</em> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ brew tap pivotal/tap
$ brew install springxd</code></pre>
</div>
</div>
<div class="paragraph">
<p>Homebrew will install <code>springxd</code> to <code>/usr/local/bin</code>. Now you can jump straight into using <strong>Spring XD</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ xd-singlenode</code></pre>
</div>
</div>
<div class="paragraph">
<p>Brew install also allows you to run <em>Spring XD</em> in distributed mode on you OSx. See <a href="#running-distributed-mode">Running Distributed Mode</a> for details on setting up a distributed runtime.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redhat_centos_installation">RedHat/CentOS Installation</h3>
<div class="paragraph">
<p>If you are using RHEL or CentOS you can install <em>Spring XD</em> using our yum repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">wget -q -O - http://packages.gopivotal.com/pub/rpm/rhel5/app-suite/app-suite-installer | sh
yum install spring-xd</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">wget -q -O - http://packages.gopivotal.com/pub/rpm/rhel6/app-suite/app-suite-installer | sh
yum install spring-xd</code></pre>
</div>
</div>
<div class="paragraph">
<p>This installs <em>Spring XD</em> and init.d services for managing Admin Server and Container runtimes. Before you can run Admin Server and Container you will need to install and start distributed components. See <a href="#running-distributed-mode">Running Distributed Mode</a> for details on setting up a distributed runtime. After distributed component are configured, Admin Server and Container can be started as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">service spring-xd-admin start
service spring-xd-container start</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure arguments to spring-xd-admin and spring-xd-container scripts by setting them in /etc/sysconfig/spring-xd. For example to run spring-xd-container with transport=RabbitMQ update this property in /etc/sysconfig/spring-xd:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">TRANSPORT=rabbit</code></pre>
</div>
</div>
<div class="paragraph">
<p>To stop <em>Spring XD</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">service spring-xd-admin stop
service spring-xd-container stop</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-distributed-mode">Running in Distributed Mode</h3>
<div class="sect3">
<h4 id="_introduction">Introduction</h4>
<div class="paragraph">
<p>The Spring XD distributed runtime (DIRT) supports distribution of processing tasks across multiple nodes. See <a href="#getting-started">Getting Started</a> for information on running Spring XD as a single node.</p>
</div>
<div class="paragraph">
<p>The XD distributed runtime architecture consists of the following distributed components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Admin - Manages Stream and Job deployments and other end user operations and provides REST services to access runtime state, system metrics, and analytics</p>
</li>
<li>
<p>Container - Hosts deployed Modules (stream processing tasks) and batch jobs</p>
</li>
<li>
<p>ZooKeeper - Provides all runtime information for the XD cluster. Tracks running containers, in which containers modules and jobs are deployed, stream definitions, deployment manifests, and the like, see <a href="XD-Distributed-Runtime">XD Distributed Runtime</a> for an overview on how XD uses ZooKeeper.</p>
</li>
<li>
<p>Spring Batch Job Repository Database - An RDBMS is required for jobs. The XD distribution comes with HSQLDB, but this is not appropriate for a production installation. XD supports any JDBC compliant database.</p>
</li>
<li>
<p>A Message Broker - Used for data transport. XD data transport is designed to be pluggable. Currently XD supports Rabbit MQ and Redis for messaging during stream and job processing. A production installation must configure one of these transport options. Rabbit MQ is recommended as it is considered the more reliable of the two. In either case, a separate server must be running to provide the messaging middleware.</p>
</li>
<li>
<p>Analytics Repository - XD currently uses Redis to store the counters and gauges provided <a href="#analytics">Analytics</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, XD  provides a Command Line Interface (CLI), XD Shell as well as a web application, XD-UI to interact with the XD runtime.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/distributed-runtime-overview.png" alt="Spring XD Distributed Runtime" width="500">
</div>
</div>
<div class="sect4">
<h5 id="_xd_commandline_options">XD CommandLine Options</h5>
<div class="paragraph">
<p>The XD distribution provides shell scripts to start its runtime components under the <em>xd</em> directory of the XD installation:</p>
</div>
<div class="paragraph">
<p>Whether you are running _xd-admin, xd-container or even xd-singlenode you can always get help by typing the command followed by --help.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd/bin/xd-admin --help

 _____                           __   _______
/  ___|          (-)             \ \ / /  _  \
\ `--. _ __  _ __ _ _ __   __ _   \ V /| | | |
 `--. \ '_ \| '__| | '_ \ / _` |  / ^ \| | | |
/\__/ / |_) | |  | | | | | (_| | / / \ \ |/ /
\____/| .__/|_|  |_|_| |_|\__, | \/   \/___/
      | |                  __/ |
      |_|                 |___/
1.0.0.RELEASE             eXtreme Data


Started : AdminServerApplication
Documentation: https://github.com/spring-projects/spring-xd/wiki

Usage:
 --analytics [redis]   : How to persist analytics such as counters and gauges
 --help (-?, -h)       : Show this help screen
 --httpPort &lt;httpPort&gt; : Http port for the REST API server
 --mgmtPort &lt;mgmtPort&gt; : The port for the management server</pre>
</div>
</div>
<div class="sect5">
<h6 id="_xd_admin_command_line_args">xd-admin command line args:</h6>
<div class="ulist">
<ul>
<li>
<p><strong>analytics</strong> - The data store that will be used to store the analytics data. The default is <strong>redis</strong></p>
</li>
<li>
<p><strong>help</strong> - Displays help for the command args.  Help information may be accessed with a -? or -h.</p>
</li>
<li>
<p><strong>httpPort</strong> - The http port for the REST API server.  Defaults to 9393.</p>
</li>
<li>
<p><strong>mgmtPort</strong> - The port for the management server.  Defaults to the admin server port.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, note that it is recommended to use fixed http port for XDAdmin(s). This makes it easy to know the admin server addresses the REST clients (shell, webUI) can point to. If a random port is chosen (with server.port or $PORT set to 0), then one needs to go through the log and find which port admin server&#8217;s tomcat starts at.</p>
</div>
</div>
<div class="sect5">
<h6 id="_xd_container_command_line_args">xd-container command line args:</h6>
<div class="ulist">
<ul>
<li>
<p><strong>analytics</strong> - How to persist analytics such as counters and gauges. The default is <strong>redis</strong></p>
</li>
<li>
<p><strong>groups</strong> - The assigned group membership for this container as a comma delimited list</p>
</li>
<li>
<p><strong>hadoopDistro</strong> - The Hadoop distribution to be used for HDFS access.  HDFS is not available if not set.</p>
</li>
<li>
<p><strong>help</strong> - Displays help for the command args.  Help information may be accessed with a -? or -h.</p>
</li>
<li>
<p><strong>mgmtPort</strong> - The port for the management server.  Defaults to the container server port.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_a_rdbms">Setting up a RDBMS</h4>
<div class="paragraph">
<p>The distributed runtime requires an RDBMS. The XD distrubution comes with an HSQLDB in memory database for testing purposes, but an alternate is expected. To start HSQLDB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cd hsqldb/bin
$ ./hsqldb-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure XD to connect to a different RDBMS, have a look at <code>xd/config/servers.yml</code> in the <code>spring:datasource</code> section for details. Note that <code>spring.batch.initializer.enabled</code> is set to true by default which will initialize the Spring Batch schema if it is not already set up. However, if those tables have already been created, they will be unaffected.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_zookeeper">Setting up ZooKeeper</h4>
<div class="paragraph">
<p>Currently XD does not ship with ZooKeeper. At the time of this writing, the compliant  version is 3.4.6 and you can download it from <a href="http://zookeeper.apache.org/releases.html">here</a>. Please refer to the <a href="http://zookeeper.apache.org/doc/trunk/zookeeperStarted.html">ZooKeeper Getting Started Guide</a> for more information. A ZooKeeper ensemble consisting of at least three members is recommended for production installations, but a single server is all that is needed to have XD up and running.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_redis">Setting up Redis</h4>
<div class="paragraph">
<p><strong>Redis</strong> is the default transport when running in distributed mode.</p>
</div>
<div class="sect4">
<h5 id="_installing_redis">Installing Redis</h5>
<div class="paragraph">
<p>If you already have a running instance of <strong>Redis</strong> it can be used for Spring XD. By default Spring XD will try to use a <em>Redis</em> instance running on <strong>localhost</strong> using <strong>port 6379</strong>. You can change that in the <code>servers.yml</code> file residing in the <code>config/</code> directory.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t have a pre-existing installation of <em>Redis</em>, you can use the <em>Spring XD</em> provided instance (For Linux and Mac) which is included in the .zip download.  If you are installing using brew or rpm you should install Redis using those installers or download the source tarball and compile Redis yourself.  If you used the .zip download then inside the <em>Spring XD</em> installation directory (spring-xd) do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cd redis/bin
$ ./install-redis</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will compile the <em>Redis</em> source tar and add the <em>Redis</em> executables under redis/bin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redis-check-dump</p>
</li>
<li>
<p>redis-sentinel</p>
</li>
<li>
<p>redis-benchmark</p>
</li>
<li>
<p>redis-cli</p>
</li>
<li>
<p>redis-server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You are now ready to start <em>Redis</em> by executing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ ./redis-server</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For further information on installing <em>Redis</em> in general, please checkout the <a href="http://redis.io/topics/quickstart">Redis Quick Start</a> guide. If you are using <em>Mac OS</em>, you can also install <em>Redis</em> via <a href="http://mxcl.github.io/homebrew/">Homebrew</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_troubleshooting">Troubleshooting</h5>
<div class="sect5">
<h6 id="_redis_on_windows">Redis on Windows</h6>
<div class="paragraph">
<p>Presently, <em>Spring XD</em> does not ship <em>Windows</em> binaries for <em>Redis</em> (See <a href="https://jira.springsource.org/browse/XD-151">XD-151</a>). However, <em>Microsoft</em> <a href="http://blogs.msdn.com/b/interoperability/archive/2013/04/22/redis-on-windows-stable-and-reliable.aspx">is actively working</a> on supporting <em>Redis</em> on <em>Windows</em>. You can download <em>Windows</em> <em>Redis</em> binaries from:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/MSOpenTech/redis/tree/2.6/bin/release">https://github.com/MSOpenTech/redis/tree/2.6/bin/release</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_redis_is_not_running">Redis is not running</h6>
<div class="paragraph">
<p>If you try to run <em>Spring XD</em> and Redis is NOT running, you will see the following exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>11:26:37,830 ERROR main launcher.RedisContainerLauncher:85 - Unable to connect to Redis on localhost:6379; nested exception is com.lambdaworks.redis.RedisException: Unable to connect
Redis does not seem to be running. Did you install and start Redis? Please see the Getting Started section of the guide for instructions.</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_starting_redis">Starting Redis</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ redis-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[35142] 01 May 14:36:28.939 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
[35142] 01 May 14:36:28.940 * Max number of open files set to 10032
                _._
           _.-``__ ''-._
      _.-``    `.  `_.  ''-._           Redis 2.6.12 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ ''-._
 (    '      ,       .-`  | `,    )     Running in stand alone mode
 |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379
 |    `-._   `._    /     _.-'    |     PID: 35142
  `-._    `-._  `-./  _.-'    _.-'
 |`-._`-._    `-.__.-'    _.-'_.-'|
 |    `-._`-._        _.-'_.-'    |           http://redis.io
  `-._    `-._`-.__.-'_.-'    _.-'
 |`-._`-._    `-.__.-'    _.-'_.-'|
 |    `-._`-._        _.-'_.-'    |
  `-._    `-._`-.__.-'_.-'    _.-'
      `-._    `-.__.-'    _.-'
          `-._        _.-'
              `-.__.-'

[35142] 01 May 14:36:28.941 # Server started, Redis version 2.6.12
[35142] 01 May 14:36:28.941 * The server is now ready to accept connections on port 6379</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_rabbitmq">Using RabbitMQ</h4>
<div class="sect4">
<h5 id="_installing_rabbitmq">Installing RabbitMQ</h5>
<div class="paragraph">
<p>If you already have a running instance of <em>RabbitMQ</em> it can be used for Spring XD. By default Spring XD will try to use a <em>Rabbit</em> instance running on <strong>localhost</strong> using <strong>port 5672</strong>. The default account credentials of <strong>guest/guest</strong> are assumed. You can change that in the <code>servers.yml</code> file residing in the <code>config/</code> directory.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t have a <em>RabbitMQ</em> installation already, head over to <a href="http://www.rabbitmq.com">http://www.rabbitmq.com</a> and follow the instructions. Packages are provided for Windows, Mac and various flavor of unix/linux.</p>
</div>
</div>
<div class="sect4">
<h5 id="_launching_rabbitmq">Launching RabbitMQ</h5>
<div class="paragraph">
<p>Start the <strong>RabbitMQ</strong> broker by running the rabbitmq-server script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ rabbitmq-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see something similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
              RabbitMQ 3.3.0. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See http://www.rabbitmq.com/
  ##  ##
  ##########  Logs: /usr/local/var/log/rabbitmq/rabbit@localhost.log
  ######  ##        /usr/local/var/log/rabbitmq/rabbit@localhost-sasl.log
  ##########
              Starting broker... completed with 10 plugins.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_starting_spring_xd_in_distributed_mode">Starting Spring XD in Distributed Mode</h4>
<div class="paragraph">
<p>Spring XD consists of two servers</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XDAdmin - controls deployment of modules into containers</p>
</li>
<li>
<p>XDContainer - executes modules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can start the <code>xd-container</code> and <code>xd-admin</code> servers individually as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd/bin&gt;$ ./xd-admin
xd/bin&gt;$ ./xd-container</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_choosing_a_transport">Choosing a Transport</h5>
<div class="paragraph">
<p>Spring XD uses data transport for sending data from the output of one module to the input of the next module. In general, this requires remote transport between container nodes.  The Admin server also uses the data bus to launch batch jobs by sending a message to the job&#8217;s launch channel. Since the same transport must be shared by the Admin and all Containers, the transport configuration is centrally configured in xd/config/servers.yml.
The default transport is redis. Open servers.yml with a text editor and you will see the transport configuration near the top. To change the transport, you can uncomment this section and change the transport to <code>rabbit</code> or any other supported transport. Any changes to the transport configuration must be replicated to every XD node in the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
XD singlenode also supports a --transport command line argument, useful for testing streams under alternate transports.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>#xd:
#  transport: redis</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you have multiple XD instances running share a single RabbitMQ server for transport, you may encounter issues if each system contains streams of the same name.  We recommend using a different RabbitMQ virtual host for each system. Update the <code>spring.rabbitmq.virtual_host</code> property in <code>$XD_HOME/config/servers.yml</code> to point XD at the correct virtual host.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_choosing_an_analytics_provider">Choosing an Analytics provider</h5>
<div class="paragraph">
<p>By default, the xd-container will store Analytics data in redis. At the time of writing, this is the only supported option (when running in distributed mode). Use the --analytics option to specify another backing store for Analytics data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd/bin&gt;$ ./xd-container --analytics redis</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_options">Other Options</h5>
<div class="paragraph">
<p>There are additional configuration options available for these scripts:</p>
</div>
<div class="paragraph">
<p>To specify the location of the Spring XD install other than the default configured in the script</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">export XD_HOME=&lt;Specific XD install directory&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify the http port of the XDAdmin server,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd/bin&gt;$ ./xd-admin --httpPort &lt;httpPort&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XDContainer nodes by default start up with server.port 0 (which means they will scan for an available HTTP port). You can disable the HTTP endpoints for the XDContainer by setting server.port=-1. Note that in this case HTTP source support will not work in a PaaS environment because typically it would require XD to bind to a specific port. Both the XDAdmin and XDContainer processes bind to server.port $PORT (i.e. an environment variable if one is available, as is typical in a PaaS).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-hadoop">Using Hadoop</h4>
<div class="paragraph">
<p>Spring XD supports the following Hadoop distributions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hadoop22 - Apache Hadoop 2.2.0 (default)</p>
</li>
<li>
<p>hadoop24 - Apache Hadoop 2.4.1</p>
</li>
<li>
<p>phd1 - Pivotal HD 1.1</p>
</li>
<li>
<p>phd20 - Pivotal HD 2.0</p>
</li>
<li>
<p>cdh5 - Cloudera CDH 5.0.0</p>
</li>
<li>
<p>hdp21 - Hortonworks Data Platform 2.1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To specify the distribution libraries to use for Hadoop client connections, use the option<br>
<code>--hadoopDistro</code> for the <code>xd-container</code> and <code>xd-shell</code> commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd/bin&gt;$ ./xd-shell --hadoopDistro &lt;distribution&gt;
xd/bin&gt;$ ./xd-admin
xd/bin&gt;$ ./xd-container --hadoopDistro &lt;distribution&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pass in the <code>--help</code> option to see other configuration properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="_xd_shell_in_distributed_mode">XD-Shell in Distributed Mode</h4>
<div class="paragraph">
<p>If you wish to use a XD-Shell that is on a different machine than where you deployed your admin server.</p>
</div>
<div class="paragraph">
<p>1) Open your shell</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">shell/bin&gt;$ ./xd-shell</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) From the xd shell use the "admin config server" command i.e.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">admin config server &lt;yourhost&gt;:9393</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-on-YARN">Running on YARN</h3>
<div class="sect3">
<h4 id="_introduction_2">Introduction</h4>
<div class="paragraph">
<p>The Spring XD distributed runtime (DIRT) supports distribution of processing tasks across multiple nodes. See <a href="Running-Distributed-Mode">Running Distributed Mode</a> for information on running Spring XD in distributed mode. One option is to run these nodes on a Hadoop YARN cluster rather than on VMs or physical servers managed by you.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_do_you_need">What do you need?</h4>
<div class="paragraph">
<p>To begin with, you need to have access to a Hadoop cluster running a version based on Apache Hadoop 2.2.0 or later. This includes <a href="http://www.us.apache.org/dist/hadoop/common/hadoop-2.2.0/">Apache Hadoop 2.2.0</a>, <a href="http://www.gopivotal.com/big-data/pivotal-hd">Pivotal HD 2.0</a>, <a href="http://hortonworks.com/hdp/">Hortonworks HDP 2.1</a> and <a href="http://www.cloudera.com/content/cloudera/en/products-and-services/cloudera-express.html">Cloudera CDH5</a>.</p>
</div>
<div class="paragraph">
<p>You need a supported transport, see <a href="Running-Distributed-Mode">Running Distributed Mode</a> for installation of Redis or Rabbit MQ. Spring XD on YARN currently uses Redis as the default data transport.</p>
</div>
<div class="paragraph">
<p>You also need Zookeeper running. If your Hadoop cluster doesn&#8217;t have Zookeeper installed you need to install and run it specifically for Spring XD. See the <a href="#setting-up-zookeeper">Setting up ZooKeeper</a> section of the "Running Distributed Mode" chapter.</p>
</div>
<div class="paragraph">
<p>Lastly, you need an RDBMs to support batch jobs and JDBC operations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_download_spring_xd_on_yarn_binaries">Download Spring XD on YARN binaries</h4>
<div class="paragraph">
<p>In addition to the regular <code>spring-xd-&lt;version&gt;-dist.zip</code> files we also distribute a zip file that includes all you need to deploy on YARN. The name of this zip file is <code>spring-xd-&lt;version&gt;-yarn.zip</code>. You can <a href="http://repo.spring.io/release/org/springframework/xd/spring-xd/1.0.0.RELEASE/spring-xd-1.0.0.RELEASE-yarn.zip">download zip for the current release</a> or <a href="http://repo.spring.io/libs-snapshot/org/springframework/xd/spring-xd/1.0.1.BUILD-SNAPSHOT/spring-xd-1.0.1.BUILD-SNAPSHOT-yarn.zip">download snapshot build</a>. Unzip the downloaded file and you should see a <code>spring-xd-&lt;version&gt;-yarn</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configure_your_deployment">Configure your deployment</h4>
<div class="paragraph">
<p>Configuration options are contained in a <code>config/servers.yml</code> file in the Spring XD YARN install directory. You need to configure the hadoop settings, the transport choice plus redis/rabbit settings, the zookeeper settings and the JDBC datasource properties.</p>
</div>
<div class="paragraph">
<p>Depending on the distribution used you might need to change the <code>siteYarnAppClasspath</code> and <code>siteMapreduceAppClasspath</code>. We have provided basic settings for the supported distros, you just need to uncomment the ones for the distro you use.</p>
</div>
<div class="paragraph">
<p>These are the settings used for Hadoop 2.2.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">spring:
    yarn:
        siteYarnAppClasspath: "$HADOOP_CONF_DIR,$HADOOP_COMMON_HOME/share/hadoop/common/*,$HADOOP_COMMON_HOME/share/hadoop/common/lib/*,$HADOOP_HDFS_HOME/share/hadoop/hdfs/*,$HADOOP_HDFS_HOME/share/hadoop/hdfs/lib/*,$HADOOP_YARN_HOME/share/hadoop/yarn/*,$HADOOP_YARN_HOME/share/hadoop/yarn/lib/*"
        siteMapreduceAppClasspath: "$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*,$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*"
</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_xd_options">XD options</h5>
<div class="paragraph">
<p>For Spring XD you need to define how many admin servers and containers you need. You also need to define the HDFS location (spring.yarn.applicationDir) where the Spring XD binary and config files will be stored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">spring:
    xd:
        adminServers: 1
        containers: 3
    yarn:
        applicationDir: /xd/app/</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_hadoop_settings">Hadoop settings</h5>
<div class="paragraph">
<p>You need to specify the host where the YARN Resource Manager is running as well as the HDFS URL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml"># Hadoop properties
spring:
  hadoop:
    fsUri: hdfs://localhost:8020
    resourceManagerHost: localhost</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zookeeper_settings">Zookeeper settings</h5>
<div class="paragraph">
<p>You should specify the Zookeeper connection settings</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">---
#Zookeeper properties
# client connect string: host1:port1,host2:port2,...,hostN:portN
zk:
  client:
     connect: localhost:2181</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_transport_options">Transport options</h5>
<div class="paragraph">
<p>You should choose either redis (default) or rabbit as the transport and include the host and port in the properties for the choice you made.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml"># Transport used
transport: redis</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">---
# Redis properties
spring:
  redis:
   port: 6379
   host: localhost</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jdbc_datasource_properties">JDBC datasource properties</h5>
<div class="paragraph">
<p>You should specify the JDBC connection properties based on the RDBMs that you use for the batch jobs and JDBC sink</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">---
#Config for use with MySQL - uncomment and edit with relevant values for your environment
spring:
  datasource:
    url: jdbc:mysql://yourDBhost:3306/yourDB
    username: yourUsername
    password: yourPassword
    driverClassName: com.mysql.jdbc.Driver</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_module_configurations">Customizing module configurations</h4>
<div class="paragraph">
<p>The configurations for all modules can be customized by modifying the file
<code>modules.yml</code> in the <code>config</code> directory and then adding it to the <code>modules-config.zip</code>
archive in the same directory.</p>
</div>
<div class="paragraph">
<p>You can run the following command from the <code>config</code> directory to achieve this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jar -uf modules-config.zip modules.yml</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_custom_modules">Adding custom modules</h4>
<div class="paragraph">
<p>There is an empty archive file named <code>custom-modules.zip</code>. You can replace this with your own ZIP archive with the same name and it will be uploaded as part of the deployment to YARN. Place custom module definitions in a <code>modules</code> directory inside this new ZIP archive. Module definitions must follow the Spring XD module semantics.</p>
</div>
</div>
<div class="sect3">
<h4 id="_push_and_start_the_jobs">Push and start the jobs</h4>
<div class="paragraph">
<p>Change current directory to be the directory that was unzipped (spring-xd-&lt;version&gt;-yarn).</p>
</div>
<div class="sect4">
<h5 id="_push_the_spring_xd_application_binaries_and_config_to_hdfs">Push the Spring XD application binaries and config to HDFS</h5>
<div class="paragraph">
<p>Run the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">./bin/xd-yarn push</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_submit_the_spring_xd_admin_server">Submit the Spring XD admin server</h5>
<div class="paragraph">
<p>Run the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">./bin/xd-yarn start admin</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_submit_the_spring_xd_container">Submit the Spring XD container</h5>
<div class="paragraph">
<p>Run the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">./bin/xd-yarn start container</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_check_the_status_of_the_app">Check the status of the app</h5>
<div class="paragraph">
<p>You can use the regular <code>yarn</code> command to check the status. Simply run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">yarn application -list</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see two applications running named xd-admin and xd-container.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="application-configuration">Application Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3">Introduction</h3>
<div class="paragraph">
<p>There are two main parts of Spring XD that can be configured, servers and modules.</p>
</div>
<div class="paragraph">
<p>The servers (<code>xd-singlenode</code>, <code>xd-admin</code>, <code>xd-container</code>) are <a href="http://projects.spring.io/spring-boot/">Spring Boot</a> applications and are configured as described in the <a href="http://docs.spring.io/spring-boot/docs/1.0.1.RELEASE/reference/htmlsingle/">Spring Boot Reference documentation</a>.  In the most simple case this means editing values in the YAML based configuration file <code>servers.yml</code>.  The values in this configuration file will overwrite the values in the default <a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/resources/application.yml">application.yml</a> file that is embedded in the XD jar.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The use of YAML is an alternative to using property files. YAML is a superset of JSON, and as such is a very convenient format for specifying hierarchical configuration data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For modules, each module has its own configuration file located in its own directory, for example <code>source/http/http.properties</code>.  Shared configuration values for modules can be placed in a common <code>modules.yml</code> file.</p>
</div>
<div class="paragraph">
<p>For both server and module configuration, you can have environment specific settings through the use of application profiles and the ability to override values in files by setting OS environment variables.</p>
</div>
<div class="paragraph">
<p>In this section we will walk though how to configure servers and modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="_server_configuration">Server Configuration</h3>
<div class="paragraph">
<p>The startup scripts for <code>xd-singlenode</code>, <code>xd-admin</code>, and <code>xd-container</code> will by default look for the file <code>$XD_HOME\config\servers.yml</code> as a source of externalized configuration information.</p>
</div>
<div class="paragraph">
<p>The location and name of this resourse can be changed by using the environment variables <code>XD_CONFIG_LOCATION</code> and <code>XD_CONFIG_NAME</code>.  The start up script takes the value of these environment variables to set the Spring Boot properties <code>spring.config.location</code> and <code>spring.config.name</code>.  Note, that for <code>XD_CONFIG_LOCATION</code> you can reference any <a href="http://docs.spring.io/spring/docs/4.0.3.RELEASE/spring-framework-reference/htmlsingle/#resources">Spring Resource</a> implementation, most commonly denoted using the prefixes <code>classpath:</code>, <code>file:</code> and <code>http:</code>.</p>
</div>
<div class="paragraph">
<p>It is common to keep your server configuration separate form the installation directory of XD itself.  To do this, here is an example environment variable setting</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">export XD_CONFIG_LOCATION=file:/xd/config/
export XD_CONFIG_NAME=region1-servers</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: the file path separator ("/") at the end of XD_CONFIG_LOCATION is <strong>necessary</strong>.</p>
</div>
<div class="sect3">
<h4 id="_profile_support">Profile support</h4>
<div class="paragraph">
<p>Profiles provide a way to segregate parts of your application configuration and change their availability and/or values based on the environment.  This lets you have different configuration settings for <code>qa</code> and <code>prod</code> environments and to easily switch between them.</p>
</div>
<div class="paragraph">
<p>To activate a profile, set the OS environment variable <code>SPRING_PROFILES_ACTIVE</code> to a comma delimited list of profile names.  The server looks to load profile specific variants of the <code>servers.yml</code> file based on the naming convention <code>servers-{profile}.yml</code>.  For example, if <code>SPRING_PROFILES_ACTIVE=prod</code> the following files would be searched for in the following order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>XD_CONFIG_LOCATION/servers-prod.yml</code></p>
</li>
<li>
<p><code>XD_CONFIG_LOCATION/servers.yml</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You may also put multiple profile specific configuration in a single <code>servers.yml</code> file by using the key <code>spring.profiles</code> in different sections of the configuration file.  See <a href="http://docs.spring.io/spring-boot/docs/1.0.1.RELEASE/reference/htmlsingle/#boot-features-external-config-multi-profile-yaml">Multi-profile YAML documents</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_database_configuration">Database Configuration</h4>
<div class="paragraph">
<p>Spring XD saves the state of the batch job workflows in a relational database.  When running <code>xd-singlenode</code> a embedded HSQLDB database is run.  When running in distributed mode a standalone HSQLDB instance can be used, the startup script <code>hsqldb-server</code> is in is provided the installation directory under the folder <em>hsqldb/bin</em>.  It is recommended to use HSQLDB only for development and learning.</p>
</div>
<div class="paragraph">
<p>When deploying in a production environment, you will need to select another database.  Spring XD is actively tested on MySql (Version: 5.1.23) and Postgres (Version 9.2-1002).  All batch workflow tables are automatically created, if they do not exist, for HSQLDB, MySQL and Postgres.  The JDBC driver jars for the HSQLDB, MySql, and Postgres are already on the XD classpath.</p>
</div>
<div class="paragraph">
<p>The provided configuration file <code>servers.yml</code> located in <code>$XD_HOME\config</code> has commented out configuration for some commonly used databases.  You can use these as a basis to support your database environment. XD also utilizes the Tomcat jdbc connection pool and these settings can be configured in the <code>servers.yml</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Until full schema support is added for Oracle, Sybase and other database, you will need to put a .jar file in the <code>xd/lib</code> directory that contains the equivalent functionality as these <a href="https://github.com/spring-projects/spring-xd/tree/master/spring-xd-batch/src/main/resources/org/springframework/xd/batch/schema">DDL scripts</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There was a schema change in version 1.0 RC1.  Use or adapt the the <a href="https://gist.github.com/ilayaperumalg/3f379eb7f4527f6f6da4">sample migration class</a> to update your schema.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_hsqldb">HSQLDB</h5>
<div class="paragraph">
<p>When in distributed mode and you want to use HSQLDB, you need to change the value of <code>spring.datasource</code> properties.  As an example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">hsql:
 server:
   host: localhost
   port: 9102
   dbname: xdjob
spring:
   datasource:
   url: jdbc:hsqldb:hsql://${hsql.server.host:localhost}:${hsql.server.port:9101}/${hsql.server.dbname:xdjob}
   username: sa
   password:
   driverClassName: org.hsqldb.jdbc.JDBCDriver</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties under <code>hsql.server</code> are substituted in the <code>spring.datasource.url</code> property value.  This lets you create short variants of existing Spring Boot properties.  Using this style, you can override the value of these configuration variables by setting an OS environment variable, such as <code>xd_server_host</code>.  Alternatively, you can not use any placeholders and set <code>spring.datasource.url</code> directly to known values.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mysql">MySQL</h5>
<div class="paragraph">
<p>When in distributed mode and you want to use MySQL, you need to change the value of <code>spring.datasource.*</code> properties.  As an example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">spring:
 datasource:
 url: jdbc:mysql://yourDBhost:3306/yourDB
 username: yourUsername
 password: yourPassword
 driverClassName: com.mysql.jdbc.Driver</code></pre>
</div>
</div>
<div class="paragraph">
<p>To override these settings set an OS environment variable such as <code>spring_datasource_url</code> to the value you require.</p>
</div>
</div>
<div class="sect4">
<h5 id="_postgresql">PostgreSQL</h5>
<div class="paragraph">
<p>When in distributed mode and you want to use PostgreSQL, you need to change the value of <code>spring.datasource.*</code> properties.  As an example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">spring:
  datasource:
    url: jdbc:postgresql://yourDBhost:5432/yourDB
    username: yourUsername
    password: yourPassword
    driverClassName: org.postgresql.Driver</code></pre>
</div>
</div>
<div class="paragraph">
<p>To override these settings set an OS environment variable such as <code>spring_datasource_url</code> to the value you require.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_redis">Redis</h4>
<div class="paragraph">
<p>If you want to use Redis for analytics or data transport you should set the host and port of the Redis server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">spring:
  redis:
   port: 6379
   host: localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>To override these settings set an OS environment variable such as <code>spring_redis_port</code> to the value you require.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rabbitmq">RabbitMQ</h4>
<div id="rabbitConfig" class="paragraph">
<p>If you want to use RabbitMQ as a data transport use the following configuration setting</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">spring:
  rabbitmq:
   addresses: localhost:5672
   username: guest
   password: guest
   virtual_host: /
   useSSL: false
   sslProperties:</code></pre>
</div>
</div>
<div class="paragraph">
<p>To override these settings set an OS environment variable such as <code>spring_rabbitmq_host</code> to the value you require.</p>
</div>
<div class="paragraph">
<p>See <a href="#rabbitssl">Message Bus</a> regarding SSL configuration.</p>
</div>
<div id="rabbitBusProps" class="paragraph">
<p>In addition, the following default settings for the rabbit message bus can be modified in <code>servers.yml</code>&#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">  messagebus:
    rabbit:
      default:
        ackMode:                   AUTO  <b>(1)</b>
        backOffInitialInterval:    1000  <b>(2)</b>
        backOffMaxInterval:        10000 <b>(3)</b>
        backOffMultiplier:         2.0   <b>(4)</b>
        concurrency:               1     <b>(5)</b>
        maxAttempts:               3     <b>(6)</b>
        maxConcurrency:            1     <b>(7)</b>
        prefix:                    xdbus. <b>(8)</b>
        prefetch:                  1     <b>(9)</b>
        replyHeaderPatterns:       STANDARD_REPLY_HEADERS,*   <b>(10)</b>
        requestHeaderPatterns:     STANDARD_REQUEST_HEADERS,* <b>(11)</b>
        requeue:                   true  <b>(12)</b>
        transacted:                false <b>(13)</b>
        txSize:                    1     <b>(14)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>AUTO (container acks), NONE (broker acks), MANUAL (consumer acks). Upper case only. Note: MANUAL requires specialized code in the consuming module and is unlikely to be used in an XD application. For more information, see <a href="http://docs.spring.io/spring-integration/reference/html/amqp.html#amqp-inbound-ack">http://docs.spring.io/spring-integration/reference/html/amqp.html#amqp-inbound-ack</a></p>
</li>
<li>
<p>The time in milliseconds before retrying a failed message delivery</p>
</li>
<li>
<p>The maximum time (ms) to wait between retries</p>
</li>
<li>
<p>The back off multiplier (previous interval x multiplier = next interval)</p>
</li>
<li>
<p>The minimum number of consumer threads receiving messages for a module</p>
</li>
<li>
<p>The maximum number of delivery attempts</p>
</li>
<li>
<p>The maximum number of consumer threads receiving messages for a module</p>
</li>
<li>
<p>A prefix applied to all queues, exchanges so that policies (HA etc) can be applied</p>
</li>
<li>
<p>The number of messages to prefetch for each consumer</p>
</li>
<li>
<p>Determines which request headers will be transported</p>
</li>
<li>
<p>Determines which reply headers will be transported</p>
</li>
<li>
<p>Whether rejected messages will be requeued by default</p>
</li>
<li>
<p>Whether the channel is to be transacted</p>
</li>
<li>
<p>The number of messages to process between acks (when ack mode is AUTO).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_admin_server_http_port">Admin Server HTTP Port</h4>
<div class="paragraph">
<p>The default HTTP port of the <code>xd-admin</code> server is 9393.  To change the value use the following configuration setting</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">server:
  port: 9876</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_management_port">Management Port</h4>
<div class="paragraph">
<p>The XD servers provide general <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#production-ready-endpoints">health</a> and JMX exported <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#production-ready-jolokia">management</a> endpoints via Jolokia.</p>
</div>
<div class="paragraph">
<p>By default the management and health endpoints are available on port 9393.  To change the value of the port use the following configuration setting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">management:
  port: 9876</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also disable http management endpoints by setting the port value to -1.</p>
</div>
<div class="paragraph">
<p>By default JMX MBeans are exported.  You can disable JMX by setting <code>spring.jmx.enabled=false</code>.</p>
</div>
<div class="paragraph">
<p>The section on <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#production-ready-monitoring">Monitoring and management over HTTP</a> provides details on how to configure these endpoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="_local_transport">Local transport</h4>
<div class="paragraph">
<p>Local transport uses a <a href="http://docs.spring.io/spring-integration/docs/latest-ga/api/org/springframework/integration/channel/QueueChannel.html">QueueChannel</a> to pass data between modules.  There are a few properties you can configure on the QueueChannel</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>xd.local.transport.named.queueSize</code> - The capacity of the queue, the default value is <code>Integer.MAX_VALUE</code></p>
</li>
<li>
<p><code>xd.local.transport.named.polling</code> - Messages that are buffered in a QueueChannel need to be polled to be consumed.  This property controls the fixed rate at which polling occurs.  The default value is 1000 ms.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_configuration">Module Configuration</h3>
<div class="paragraph">
<p>Modules are configured by placing property files in a nested directory structure based on their type and name.  The root of the nested directory structure is by default <code>XD_HOME/config/modules</code>.  This location can be customized by setting the OS environment variable <code>XD_MODULE_CONFIG_LOCATION</code>, similar to how the environment variable <code>XD_CONFIG_LOCATION</code> is used for configuring the server. If <code>XD_MODULE_CONFIG_LOCATION</code> is set explicitly, then it is <strong>necessary</strong> to add the file path separator ("/") at the end of the path.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If <code>XD_MODULE_CONFIG_LOCATION</code> is set to use explicit location, make sure to copy entire directory structure from the default module config location <code>xd/config/modules</code> into the new module config location. The <code>XD_MODULE_CONFIG_LOCATION</code> can reference any <a href="http://docs.spring.io/spring/docs/4.0.3.RELEASE/spring-framework-reference/htmlsingle/#resources">Spring Resource</a> implementation, most commonly denoted using the prefixes <code>classpath:</code>, <code>file:</code> and <code>http:</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example, if you wanted to configure the twittersearch module, you would create a file</p>
</div>
<div class="listingblock">
<div class="content">
<pre>XD_MODULE_CONFIG_LOCATION\source\twittersearch\twittersearch.properties</pre>
</div>
</div>
<div class="paragraph">
<p>and the contents of that file would be property names such as <code>consumerKey</code> and <code>consumerSecret</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You <strong>do not</strong> need to prefix these property names with a <code>source.twittersearch</code> prefix.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can override the values in the module property file in various ways.  The following sources of properties are considered in the following order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Properties specified in the stream or job <code>DSL</code> definition</p>
</li>
<li>
<p>Java System Properties (e.g. source.http.port=9454)</p>
</li>
<li>
<p>OS environment variables. (e.g. source_http_port=9454)</p>
</li>
<li>
<p><code>XD_MODULE_CONFIG_LOCATION\&lt;type&gt;\&lt;name&gt;\&lt;name&gt;.properties</code> (including profile variants)</p>
</li>
<li>
<p>Default values specified in module metadata (if available).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Values in <code>XD_MODULE_CONFIG_LOCATION\&lt;type&gt;\&lt;name&gt;\&lt;name&gt;.properties</code> can be property placeholder references to keys defined in another resource location.  By default the resource is the file <code>XD_MODULE_CONFIG_LOCATION\modules.yml</code>.  You can customize the name of the resource by using setting the OS environment variable <code>XD_MODULE_CONFIG_NAME</code> before running a server startup script.</p>
</div>
<div class="paragraph">
<p>The <code>modules.yml</code> file can be used to specify the values of keys that should be shared across different modules.  For example, it is common to use the same twitter developer credentials in both the twittersearch and twitterstream modules.  To avoid repeating the same credentials in two property files, you can use the following setup.</p>
</div>
<div class="paragraph">
<p><code>modules.yml</code> contains</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">sharedConsumerKey: alsdjfqwopieur
sharedConsumerSecret: pqwieouralsdjkqwpo
sharedAccessToken: llixzchvpiawued
sharedAccessTokenSecret: ewoqirudhdsldke</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>XD_MODULE_CONFIG_LOCATION\source\twitterstream\twitterstream.properties</code> contains</p>
</div>
<div class="listingblock">
<div class="content">
<pre>consumerKey=${sharedConsumerKey}
consumerSecret=${sharedConsumerSecret}
accessToken=${sharedAccessToken}
accessTokenSecret=${sharedAccessTokenSecret}</pre>
</div>
</div>
<div class="paragraph">
<p>and <code>XD_MODULE_CONFIG_LOCATION\source\twittersearch\twittersearch.properties</code> contains</p>
</div>
<div class="listingblock">
<div class="content">
<pre>consumerKey=${sharedConsumerKey}
consumerSecret=${sharedConsumerSecret}</pre>
</div>
</div>
<div class="sect3">
<h4 id="_profiles">Profiles</h4>
<div class="paragraph">
<p>When resolving property file names, the server will look to load profile specific variants based on the naming convention <code>&lt;name&gt;-{profile}.properties</code>.  For example, if given the OS environment variable <code>spring_profiles_active=default,qa</code> the following configuration file names for the twittersearch module would be searched in this order</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>XD_MODULE_CONFIG_LOCATION\source\twittersearch\twittersearch.properties</code></p>
</li>
<li>
<p><code>XD_MODULE_CONFIG_LOCATION\source\twittersearch\twittersearch-default.properties</code></p>
</li>
<li>
<p><code>XD_MODULE_CONFIG_LOCATION\source\twittersearch\twittersearch-qa.properties</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Also, the shared module configuration file is refernced using profile variants, so given the OS environment variable <code>spring_profiles_active=default,qa</code> the following shared module configuration files would be searched for in this order</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>XD_MODULE_CONFIG_LOCATION\modules.yml</code></p>
</li>
<li>
<p><code>XD_MODULE_CONFIG_LOCATION\modules-default.yml</code></p>
</li>
<li>
<p><code>XD_MODULE_CONFIG_LOCATION\modules-qa.yml</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_batch_jobs_or_modules_accessing_jdbc">Batch Jobs or modules accessing JDBC</h4>
<div class="paragraph">
<p>Another common case is access to a relational database from a job or the JDBC Sink module.</p>
</div>
<div class="paragraph">
<p>As an example, to provide the properties for the batch job <code>jdbchdfs</code> the file <code>XD_MODULE_CONFIG_LOCATION\job\jdbchdfs\jdbchdfs.properites</code> should contain</p>
</div>
<div class="listingblock">
<div class="content">
<pre>driverClass=org.hsqldb.jdbc.JDBCDriver
url=jdbc:hsqldb:mem:xd
username=sa
password=</pre>
</div>
</div>
<div class="paragraph">
<p>A property file with the same keys, but likely different values would be located in <code>XD_MODULE_CONFIG_LOCATION\sink\jdbc\jdbc.properites</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dsl-guide">DSL Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_4">Introduction</h3>
<div class="paragraph">
<p>Spring XD provides a DSL for defining a stream.  Over time the DSL is likely to evolve significantly as it gains the ability to define more and more sophisticated streams as well as the steps of a batch job.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pipes_and_filters">Pipes and filters</h3>
<div class="paragraph">
<p>A simple linear stream consists of a sequence of modules.  Typically an Input Source, (optional) Processing Steps, and an Output Sink.  As a simple example consider the collection of data from an HTTP Source writing to a File Sink. Using the DSL the stream description is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http | file</pre>
</div>
</div>
<div class="paragraph">
<p>A stream that involves some processing:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http | filter | transform | file</pre>
</div>
</div>
<div class="paragraph">
<p>The modules in a stream definition are connected together using the pipe symbol <code>|</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_module_parameters">Module parameters</h3>
<div class="paragraph">
<p>Each module may take parameters. The parameters supported by a module are defined by the module implementation. As an example the <code>http</code> source module exposes <code>port</code> setting which allows the data ingestion port to be changed from the default value.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http --port=1337</pre>
</div>
</div>
<div class="paragraph">
<p>It is only necessary to quote parameter values if they contain spaces or the <code>|</code> character. Here the transform processor module is being passed a SpEL expression that will be applied to any data it encounters:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>transform --expression='new StringBuilder(payload).reverse()'</pre>
</div>
</div>
<div class="paragraph">
<p>If the parameter value needs to embed a single quote, use two single quotes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// Query is: Select * from /Customers where name='Smith'
scan --query='Select * from /Customers where name=''Smith'''</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="named-channels">Named channels</h3>
<div class="paragraph">
<p>Instead of a source or sink it is possible to use a named channel. Normally the modules in a stream are connected
by anonymous internal channels (represented by the pipes), but by using explicitly named channels it becomes
possible to construct more sophisticated flows. In keeping with the unix theme, sourcing/sinking data from/to a particular channel uses the <code>&gt;</code> character. A named channel is specified by using a channel type, followed by a <code>:</code> followed by a name. The channel types available are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>queue - this type of channel has point-to-point (p2p) semantics</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>topic - this type of channel has pub/sub semantics</pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example that shows how you can use a named channel to share a data pipeline driven by different input sources.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>queue:foo &gt; file</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>http &gt; queue:foo</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>time &gt; queue:foo</pre>
</div>
</div>
<div class="paragraph">
<p>Now if you post data to the http source, you will see that data intermingled with the time value in the file.</p>
</div>
<div class="paragraph">
<p>The opposite case, the fanout of a message to multiple streams, is planned for a future release. However, <a href="#taps">taps</a> are a specialization of named channels that do allow publishing data to multiple sinks. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tap:stream:mystream &gt; file</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>tap:stream:mystream &gt; log</pre>
</div>
</div>
<div class="paragraph">
<p>Once data is received on <code>mystream</code>, it will be written to both file and log.</p>
</div>
<div class="paragraph">
<p>Support for routing messages to different streams based on message content is also planned for a future release.</p>
</div>
</div>
<div class="sect2">
<h3 id="_labels">Labels</h3>
<div class="paragraph">
<p>Labels provide a means to alias or group modules.  Labels are simply a name followed by a <code>:</code>
When used as an alias a label can provide a more descriptive name for a
particular configuration of a module and possibly something easier to refer to in other streams.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mystream = http | obfuscator: transform --expression=payload.replaceAll('password','*') | file</pre>
</div>
</div>
<div class="paragraph">
<p>Labels are especially useful for disambiguating when multiple modules of the same name are used:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>mystream = http | uppercaser: transform --expression=payload.toUpperCase() | exclaimer: transform --expression=payload+'!' | file</pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="#example---using-a-label">this section</a> of the Taps chapter to see how labels facilitate the creation of taps in these cases where a stream contains ambiguous modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="dsl-quotes-escaping">Single quotes, Double quotes, Escaping</h3>
<div class="paragraph">
<p>Spring XD is a complex runtime that involves a lot of systems when you look at the complete picture. There is a <strong>Spring Shell based client</strong> that talks to the admin that is responsible for <strong>parsing</strong>. In turn, modules may themselves rely on embedded languages (like the <strong>Spring Expression Language</strong>) to accomplish their behavior.</p>
</div>
<div class="paragraph">
<p>Those three components (shell, XD parser and SpEL) have rules about how they handle quotes and how syntax escaping works, and when stacked with each other, confusion may arise. This section explains the rules that apply and provides examples to the most common situations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">It&#8217;s not always that complicated</div>
<div class="paragraph">
<p>This section focuses on the most complicated cases, when all 3 layers are involved. Of course, if you don&#8217;t use the XD shell (for example if you&#8217;re using the REST API directly) or if module option values are not SpEL expressions, then escaping rules can be much simpler</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_spring_shell">Spring Shell</h4>
<div class="paragraph">
<p>Arguably, the most complex component when it comes to quotes is the shell. The rules can be laid out quite simply, though:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a shell command is made of keys (<code>--foo</code>) and corresponding values. There is a special, key-less mapping though, see below</p>
</li>
<li>
<p>a value can not normally contain spaces, as space is the default delimiter for commands</p>
</li>
<li>
<p>spaces can be added though, by surrounding the value with quotes (either single [<code>'</code>] or double [<code>"</code>] quotes)</p>
</li>
<li>
<p>if surrounded with quotes, a value can embed a literal quote of the same kind by prefixing it with a backslash (<code>\</code>)</p>
</li>
<li>
<p>Other escapes are available, such as <code>\t</code>, <code>\n</code>, <code>\r</code>, <code>\f</code> and unicode escapes of the form <code>\uxxxx</code></p>
</li>
<li>
<p>Lastly, the key-less mapping is handled in a special way in the sense that if does not need quoting to contain spaces</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the XD shell supports the <code>!</code> command to execute native shell commands. The <code>!</code> accepts a single, key-less argument. This is why the following works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;! rm foo</pre>
</div>
</div>
<div class="paragraph">
<p>The argument here is the whole <code>rm foo</code> string, which is passed as is to the underlying shell.</p>
</div>
<div class="paragraph">
<p>As another example, the following commands are strictly equivalent, and the argument value is <code>foo</code> (without the quotes):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream destroy foo
xd:&gt;stream destroy --name foo
xd:&gt;stream destroy "foo"
xd:&gt;stream destroy --name "foo"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xd_syntax">XD Syntax</h4>
<div class="paragraph">
<p>At the XD parser level (that is, inside the body of a stream or job definition) the rules are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>option values are normally parsed until the first space character</p>
</li>
<li>
<p>they can be made of literal strings though, surrounded by single or double quotes</p>
</li>
<li>
<p>To embed such a quote, use two consecutive quotes of the desired kind</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As such, the values of the <code>--expression</code> option to the filter module are semantically equivalent in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter --expression=payload&gt;5
filter --expression="payload&gt;5"
filter --expression='payload&gt;5'
filter --expression='payload &gt; 5'</pre>
</div>
</div>
<div class="paragraph">
<p>Arguably, the last one is more readable. It is made possible thanks to the surrounding quotes. The actual expression is <code>payload &gt; 5</code> (without quotes).</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s imagine we want to test against string messages. If we&#8217;d like to compare the payload to the SpEL literal string, <code>"foo"</code>, this is how we could do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>filter --expression=payload=='foo'           <b>(1)</b>
filter --expression='payload == ''foo'''     <b>(2)</b>
filter --expression='payload == "foo"'       <b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This works because there are no spaces. Not very legible though</p>
</li>
<li>
<p>This uses single quotes to protect the whole argument, hence actual single quotes need to be doubled</p>
</li>
<li>
<p>But SpEL recognizes String literals with either single or double quotes, so this last method is arguably the best</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Please note that the examples above are to be considered outside of the Spring XD shell. When entered inside the shell, chances are that the whole stream definition will itself be inside double quotes, which would need escaping. The whole example then becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create foo --definition "http | filter --expression=payload='foo' | log"
xd:&gt;stream create foo --definition "htpp | filter --expression='payload == ''foo''' | log"
xd:&gt;stream create foo --definition "http | filter --expression='payload == \"foo\"' | log"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spel_syntax_and_spel_literals">SpEL syntax and SpEL literals</h4>
<div class="paragraph">
<p>The last piece of the puzzle is about SpEL expressions. Many modules accept options that are to be interpreted as SpEL expressions, and as seen above, String literals are handled in a special way there too. Basically,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>literals can be enclosed in either single or double quotes</p>
</li>
<li>
<p>quotes need to be doubled to embed a literal quote. Single quotes inside double quotes need no special treatment, and <em>vice versa</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a last example, assume you want to use the <a href="#transform">transform</a> module. That module accepts an <code>expression</code> option which is a SpEL expression. It is to be evaluated against the incoming message, with a default of <code>payload</code> (which forwards the message payload untouched).</p>
</div>
<div class="paragraph">
<p>It is important to understand that the following are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>transform --expression=payload
transform --expression='payload'</pre>
</div>
</div>
<div class="paragraph">
<p>but very different from the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>transform --expression="'payload'"
transform --expression='''payload'''</pre>
</div>
</div>
<div class="paragraph">
<p>and other variations.</p>
</div>
<div class="paragraph">
<p>The first series will simply evaluate to the message payload, while the latter examples will evaluate to the actual literal string <code>payload</code> (again, without quotes).</p>
</div>
</div>
<div class="sect3">
<h4 id="_putting_it_all_together">Putting it all together</h4>
<div class="paragraph">
<p>As a last, complete example, let&#8217;s review how one could force the transformation of all messages to the string literal <code>hello world</code>, by creating a stream in the context of the XD shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>stream create foo --definition "http | transform --expression='''hello world''' | log" <b>(1)</b>
stream create foo --definition "http | transform --expression='\"hello world\"' | log" <b>(2)</b>
stream create foo --definition "http | transform --expression=\"'hello world'\" | log" <b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This uses single quotes around the string (at the XD parser level), but they need to be doubled because we&#8217;re inside a string literal (very first single quote after the equals sign)</p>
</li>
<li>
<p>use single and double quotes respectively to encompass the whole string at the XD parser level. Hence, the other kind of quote can be used inside the string. The whole thing is inside the <code>--definition</code> argument to the shell though, which uses double quotes. So double quotes are escaped (at the shell level)</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interactive-shell">Interactive Shell</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_5">Introduction</h3>
<div class="paragraph">
<p>Spring XD includes an interactive shell that you can use create, deploy, destroy and query streams and jobs.  There are also commands to help with common tasks such as interacting with HDFS, the UNIX shell, and sending HTTP requests.  In this section we will introduce the main commands and features of the shell.</p>
</div>
<div class="sect3">
<h4 id="_using_the_shell">Using the Shell</h4>
<div class="paragraph">
<p>When you start the shell you can type <em>help</em> to show all the commands that are available.  Note, that since the XD shell is based on <a href="https://github.com/spring-projects/spring-shell">Spring Shell</a> you can contribute you own commands into the shell.  The general groups of commands are related to the management of</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Modules</p>
</li>
<li>
<p>Streams</p>
</li>
<li>
<p>Jobs</p>
</li>
<li>
<p>Analytics (Counters, Aggregate Counters, Gauges, etc.)</p>
</li>
<li>
<p>HDFS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example to see what modules are available issue the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;module list</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The list of all Spring XD specific commands can be found in the <a href="#shell-command-reference">Shell Reference</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The shell also provides extensive command completion capabilities.  For example, if you type <em>mod</em> and hit TAB, you will be presented with all the matching commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;module
module compose    module delete     module display    module info
module list</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Tab completion works for module options as well as for the DSL used within the <code>--definition</code> option for stream and module commands.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The command <code>module list</code> shows all the modules available</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;module list
      Source              Processor           Sink                     Job
  ------------------  ------------------  -----------------------  ----------------
      gemfire-cq          aggregator          counter                  hdfsjdbc
      post                http-client         log                      jdbchdfs
      twitterstream       splitter            field-value-counter      hdfsmongodb
      http                filter              rich-gauge               filejdbc
      reactor-syslog      json-to-tuple       mqtt                     ftphdfs
      reactor-ip          transform           file                     filepollhdfs
      jms                 bridge              splunk
      tcp-client          object-to-json      mail
      mqtt                script              tcp
      file                                    hdfs
      twittersearch                           gauge
      gemfire                                 jdbc
      mail                                    gemfire-server
      trigger                                 throughput-sampler
      tcp                                     gemfire-json-server
      tail                                    router
      syslog-tcp                              aggregate-counter
      syslog-udp                              rabbit
      rabbit                                  hdfs-dataset
      time</code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose we want to create a stream that uses the <code>http</code> source and <code>file</code> sink.  How do we know what options are available to use?  There are two ways to find out.  The first is to use the command <code>module info</code>.  Pressing <code>TAB</code> after typiing <code>moudle info</code> will complete the command with the <code>--name</code> option and then present all the modules prefixed by their type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;module info --name
job:filejdbc                job:filepollhdfs            job:ftphdfs
job:hdfsjdbc                job:hdfsmongodb             job:jdbchdfs
processor:aggregator        processor:bridge            processor:filter
processor:http-client       processor:json-to-tuple     processor:object-to-json
processor:script            processor:splitter          processor:transform
sink:aggregate-counter      sink:counter                sink:field-value-counter
sink:file                   sink:gauge                  sink:gemfire-json-server
sink:gemfire-server         sink:hdfs                   sink:hdfs-dataset
sink:jdbc                   sink:log                    sink:mail
sink:mqtt                   sink:rabbit                 sink:rich-gauge
sink:router                 sink:splunk                 sink:tcp
sink:throughput-sampler     source:file                 source:gemfire
source:gemfire-cq           source:http                 source:jms
source:mail                 source:mqtt                 source:post
source:rabbit               source:reactor-ip           source:reactor-syslog
source:syslog-tcp           source:syslog-udp           source:tail
source:tcp                  source:tcp-client           source:time
source:trigger              source:twittersearch        source:twitterstream
xd:&gt;module info --name</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>module info</code> command for the http source shows the option names, a brief description, and default values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;module info --name source:http
Information about source module 'http':

  Option Name  Description                                       Default  Type
  -----------  ------------------------------------------------  -------  --------
  port         the port to listen to                             9000     int
  outputType   how this module should emit messages it produces  &lt;none&gt;   MimeType</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>file</code> sink the options are</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;module info --name sink:file
Information about sink module 'file':

  Option Name  Description                                                        Default            Type
  -----------  -----------------------------------------------------------------  -----------------  --------
  binary       if false, will append a newline character at the end of each line  false              boolean
  charset      the charset to use when writing a String payload                   UTF-8              String
  dir          the directory in which files will be created                       /tmp/xd/output/    String
  mode         what to do if the file already exists                              APPEND             Mode
  name         filename pattern to use                                            ${xd.stream.name}  String
  suffix       filename extension to use                                          &lt;none&gt;             String
  inputType    how this module should interpret messages it consumes              &lt;none&gt;             MimeType</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the default value <code>${xd.stream.name}</code> will be resolved to the name of the stream that contains the module.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tab_completion_for_job_and_stream_dsl_definitions">Tab completion for Job and Stream DSL definitions</h4>
<div class="paragraph">
<p>When creating a stream defintion tab completion after <code>--definition</code> will enable you to see all the options that are available for a given module as well as a list of candidate modules for the subsequent module in the stream.  For example, hitting <code>TAB</code> after <code>http</code> as shown below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;stream create --name test --definition "http
http --outputType=           http --port=                 http | aggregate-counter     http | aggregator
http | bridge                http | counter               http | field-value-counter   http | file
http | filter                http | gauge                 http | gemfire-json-server   http | gemfire-server
http | hdfs                  http | hdfs-dataset          http | http-client           http | jdbc
http | json-to-tuple         http | log                   http | mail                  http | mqtt
http | object-to-json        http | rabbit                http | rich-gauge            http | router
http | script                http | splitter              http | splunk                http | tcp
http | throughput-sampler    http | transform</code></pre>
</div>
</div>
<div class="paragraph">
<p>shows the options <code>outputType</code> and <code>port</code> in addition to any processors and sinks.  Hitting <code>TAB</code> after entering <code>--</code> after the http module will provide a list of only the http options</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xd:&gt;stream create --name test --definition "http --
http --outputType=   http --port=</code></pre>
</div>
</div>
<div class="paragraph">
<p>Entering the port number and also the pipel <code>|</code> symbol and hitting tab will show completions for candidate processor and sink modules.  The same process of tab completion for module options applies to each module in the chain.</p>
</div>
</div>
<div class="sect3">
<h4 id="_executing_a_script">Executing a script</h4>
<div class="paragraph">
<p>You can execute a script by either passing in the <code>--cmdfile</code> argument when starting the shell or by executing the <code>script</code> command inside the shell.  When using scripts it is common to add comments using either <code>//</code> or <code>;</code> characters at the start of the line for one line comments or use <code>/*</code> and <code>*/</code> for multiline comments</p>
</div>
</div>
<div class="sect3">
<h4 id="_single_quotes_double_quotes_escaping">Single quotes, Double quotes, Escaping</h4>
<div class="paragraph">
<p>There are often three layers of parsing when passing entering commands to the shell.  The shell parses the command to recognize <code>--</code> options, inside the body of a stream/job definition the values are parsed until the first space character, and inside some command options SpEL is used (e.g. router).  Understanding the interaction between these layers can cause some confusion. The DSL Guide section <a href="#dsl-quotes-escaping">on quotes and escaping</a> will help you if you run into any issues.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adminui">Admin UI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_6">Introduction</h3>
<div class="paragraph">
<p>Spring XD provides a browser-based GUI which currently has 2 sections allowing you to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>perform Batch Job related tasks</p>
</li>
<li>
<p>deploy/undeploy Stream Definitions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon starting Spring XD, the Admin UI is available at:</p>
</div>
<div class="paragraph">
<p>"http://&lt;adminHost&gt;:&lt;adminPort&gt;/admin-ui" (for example: <a href="http://localhost:9393/admin-ui)">http://localhost:9393/admin-ui)</a></p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: Default admin server port is 9393</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-about.png" alt="The Spring XD Admin UI" width="500">
</div>
<div class="title">Figure 1. The Spring XD Admin UI</div>
</div>
</div>
<div class="sect2">
<h3 id="_streams">Streams</h3>
<div class="paragraph">
<p>The <em>Streams</em> section of the admin UI provides the <em>Definitions</em> tab that provides a listing of Stream definitions. There you have the option to <strong>deploy</strong> or <strong>undeploy</strong> those streams. Additionally you can remove the definition by clicking on <strong>destroy</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-streams-list-definitions.png" alt="List of Stream Definitions" width="500">
</div>
<div class="title">Figure 2. List of Stream Definitions</div>
</div>
</div>
<div class="sect2">
<h3 id="_jobs">Jobs</h3>
<div class="paragraph">
<p>The <em>Jobs</em> section of the admin UI currently has four tabs specific for <strong>Batch Jobs</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Modules</p>
</li>
<li>
<p>Definitions</p>
</li>
<li>
<p>Deployments</p>
</li>
<li>
<p>Executions</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_modules">Modules</h4>
<div class="paragraph">
<p><em>Modules</em> encapsulate a unit of work into a reusable component. Within the XD runtime environment Modules allow users to create definitions for <em>Streams</em> as well as <em>Batch Jobs</em>. Consequently, the <em>Modules</em> tab within the <em>Jobs</em> section allows users to create <em>Batch Job</em> definitions. In order to learn more about <em>Modules</em>, please see the chapter on <a href="#modules">Modules</a>.</p>
</div>
<div class="sect4">
<h5 id="_list_available_batch_job_modules">List available batch job modules</h5>
<div class="paragraph">
<p>This page lists the available batch job modules.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-list-modules.png" alt="List Job Modules" width="500">
</div>
<div class="title">Figure 3. List Job Modules</div>
</div>
<div class="paragraph">
<p>On this screen you can perform the following actions:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:80%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="images/images/spring-xd-admin-ui-jobs-view-module-details-button.png" alt="View Details" width="42" height="36" title="View Details"></span></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">View details such as the job module options and the module XML configuration file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="images/images/spring-xd-admin-ui-jobs-create-definition-button.png" alt="Create Definition" width="42" height="36" title="Create Definition"></span></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Create a Job Definition from the respective Module.</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect4">
<h5 id="_create_a_job_definition_from_a_selected_job_module">Create a Job Definition from a selected Job Module</h5>
<div class="paragraph">
<p>On this screen you can create a new Job Definition. As a minimum you must provide a name for the new definition. Optionally you can select wether the new definition shall be automatically deployed. Depending on the selected module, you will also have the option to specify various parameters that are used during the deployment of the definition.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-create-job-definition.png" alt="Create a Job Definition" width="500">
</div>
<div class="title">Figure 4. Create a Job Definition</div>
</div>
</div>
<div class="sect4">
<h5 id="_view_job_module_details">View Job Module Details</h5>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-view-module-details.png" alt="View Job Module Details" width="500">
</div>
<div class="title">Figure 5. View Job Module Details</div>
</div>
<div class="paragraph">
<p>On this page you can view the details of a selected job module. The pages lists the available options (properties) of the modules as well as the actual XML application context file associated with the module.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_job_definitions">List job definitions</h4>
<div class="paragraph">
<p>This page lists the XD batch job definitions and provides actions to <strong>deploy</strong>, <strong>un-deploy</strong> or <strong>destroy</strong> those jobs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-definitions.png" alt="List Job Definitions" width="500">
</div>
<div class="title">Figure 6. List Job Definitions</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_job_deployments">List job deployments</h4>
<div class="paragraph">
<p>This page lists all the deployed jobs and provides option to <strong>launch</strong> or <strong>schedule</strong> the deployed job.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-deployments.png" alt="List Job Deployments" width="500">
</div>
<div class="title">Figure 7. List Job Deployments</div>
</div>
<div class="sect4">
<h5 id="_launching_a_batch_job">Launching a batch Job</h5>
<div class="paragraph">
<p>Once the job is deployed, they can be launched through the Admin UI as well. Navigate to the <strong>Deployments</strong> tab. Select the job you want to launch and press <code>Launch</code>. The following modal dialog should appear:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-launch-job.png" alt="Launch a Batch Job with parameters" width="500">
</div>
<div class="title">Figure 8. Launch a Batch Job with parameters</div>
</div>
<div class="paragraph">
<p>Using this screen, you can define one or more job parameters. Job parameters can be typed and the following data types are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String (The default)</p>
</li>
<li>
<p>Date (The default date format is: <em>yyyy/MM/dd</em>)</p>
</li>
<li>
<p>Long</p>
</li>
<li>
<p>Double</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_schedule_batch_job_execution">Schedule Batch Job Execution</h5>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-schedule-job.png" alt="Schedule a Batch Job" width="500">
</div>
<div class="title">Figure 9. Schedule a Batch Job</div>
</div>
<div class="paragraph">
<p>When clicking on <strong>Schedule</strong>, you have the option to run the job:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using a fixed delay interval (specified in seconds)</p>
</li>
<li>
<p>on a specific data/time</p>
</li>
<li>
<p>using a valid CRON expression</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_job_deployment_details">Job Deployment Details</h4>
<div class="paragraph">
<p>On this screen, you can view additional deployment details. Besides viewing the stream definition, the available Module Metadata is shown as well, e.g. on which Container the definition has been deployed to.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-deployment-details.png" alt="Job Deployment Details" width="500">
</div>
<div class="title">Figure 10. Job Deployment Details</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_job_executions">List job executions</h4>
<div class="paragraph">
<p>This page lists the batch job executions and provides option to <strong>restart</strong> specific job executions, provided the batch job is restartable and stopped/failed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-executions.png" alt="List Job Executions" width="500">
</div>
<div class="title">Figure 11. List Job Executions</div>
</div>
<div class="paragraph">
<p>Furthermore, you have the option to view the Job execution details.</p>
</div>
<div class="sect4">
<h5 id="_job_execution_details">Job execution details</h5>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-job-execution-details.png" alt="Job Execution Details" width="500">
</div>
<div class="title">Figure 12. Job Execution Details</div>
</div>
<div class="paragraph">
<p>The same screen also contains a list of the executed steps:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-job-execution-details-steps.png" alt="Job Execution Details - Steps" width="500">
</div>
<div class="title">Figure 13. Job Execution Details - Steps</div>
</div>
<div class="paragraph">
<p>From there you can drill deeper into the <em>Step Execution Details</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_step_execution_details">Step execution details</h5>
<div class="paragraph">
<p>On the top of the page, you will see progress indicator the respective step, with the option to refresh the indicator. Furthermore, a link is provided to view the <em>step execution history</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-step-execution-details.png" alt="Step Execution Details" width="500">
</div>
<div class="title">Figure 14. Step Execution Details</div>
</div>
<div class="paragraph">
<p>The Step Execution details screen provides a complete list of all Step Execution Context key/value pairs. For example, the <em>Spring for Apache Hadoop</em> steps provides exhaustive detail information.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-step-execution-context.png" alt="Step Execution Context" width="500">
</div>
<div class="title">Figure 15. Step Execution Context</div>
</div>
<div class="paragraph">
<p>This includes a link back to the <em>Job History UI</em> of the Hadoop Cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-step-execution-context-hadoop-link.png" alt="Job History UI" width="500">
</div>
<div class="title">Figure 16. Job History UI</div>
</div>
</div>
<div class="sect4">
<h5 id="_step_execution_history">Step execution history</h5>
<div class="imageblock">
<div class="content">
<img src="images/images/spring-xd-admin-ui-jobs-step-execution-history.png" alt="Step Execution History" width="500">
</div>
<div class="title">Figure 17. Step Execution History</div>
</div>
<div class="paragraph">
<p>On this screen, you can view various metrics associated with the selected step such as <strong>duration</strong>, <strong>read counts</strong>, <strong>write counts</strong> etc.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture">Architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_7">Introduction</h3>
<div class="paragraph">
<p>Spring XD is a unified, distributed, and extensible service for data ingestion, real time analytics, batch processing, and data export.  The foundations of XD’s architecture are based on the over 100+ man years of work that have gone into the Spring Batch, Integration and Data projects. Building upon these projects, Spring XD provides servers and a configuration DSL that you can immediately use to start processing data.  You do not need to build an application yourself from a collection of jars to start using Spring XD.</p>
</div>
<div class="paragraph">
<p>Spring XD has two modes of operation - single and multi-node. The first is a single process that is responsible for all processing and administration. This mode helps you get started easily and simplifies the development and testing of your application. The second is a distributed mode, where processing tasks can be spread across a cluster of machines and an administrative server reacts to user commands and runtime events managed within a shared runtime state to coordinate processing tasks executing on the cluster.</p>
</div>
<div class="sect3">
<h4 id="_runtime_architecture">Runtime Architecture</h4>
<div class="paragraph">
<p>The key components in Spring XD are the XD Admin and XD Container Servers. Using a high-level DSL, you post the description of the required processing tasks to the Admin server over HTTP. The Admin server then maps the processing tasks into processing modules. A module is a unit of execution and is implemented as a Spring ApplicationContext. A distributed runtime is provided that will assign modules to execute across multiple XD Container servers. A single XD Container server can run multiple modules. When using the single node runtime, all modules are run in a single XD Container and the XD Admin server is run in the same process.</p>
</div>
<div class="sect4">
<h5 id="_dirt_runtime">DIRT Runtime</h5>
<div class="paragraph">
<p>A distributed runtime, called Distributed Integration Runtime, aka DIRT, will distribute the processing tasks across multiple XD Container instances.  The XD Admin server breaks up a processing task into individual module definitions and assigns each module to a container instance using ZooKeeper (see <a href="#xd-distributed-runtime">XD Distributed Runtime</a>).  Each container listens for module definitions to which it has been assigned and deploys the module, creating a Spring ApplicationContext to run it.</p>
</div>
<div class="paragraph">
<p>Modules share data by passing messages using a configured messaging middleware (Rabbit, Redis, or Local for single node). To reduce the number of hops across messaging middleware between them, multiple modules may be composed into larger deployment units that act as a single module. To learn more about that feature, refer to the <a href="#composing-modules">Composing Modules</a> section.</p>
</div>
<div id="simple-distributed-runtime" class="imageblock">
<div class="content">
<img src="images/images/distributed-node.png" alt="distributed node" width="500">
</div>
<div class="title">Figure 18. The XD Admin Server sending module definitions to each XD Container</div>
</div>
<div class="paragraph">
<p>How the processing task is broken down into modules is discussed in the section <a href="#container-server-arch">Container Server Architecture</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_support_for_other_distributed_runtimes">Support for other distributed runtimes</h5>
<div class="paragraph">
<p>In the 1.0 release, You can run Spring XD natively, in which case you are responsible for starting up the XD Admin and XD Container instances. Alternately you can run Spring XD on Hadoop&#8217;s YARN, see <a href="Running-on-YARN">Running XD on YARN</a>. Pivotal Cloud Foundry support is planned for a future release. If you are feeling a adventurous, you can also take a look at our scripts for <a href="https://github.com/spring-projects/spring-xd-ec2">deploying Spring XD to EC2</a>.  These are used as part of our <a href="https://build.spring.io/browse/XD-ATEC2">system integration tests</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="single-node-runtime">Single Node Runtime</h4>
<div class="paragraph">
<p>A single node runtime is provided that runs the Admin and Container servers, ZooKeeper, and HSQLDB in the same process. the single node runtime is primarily intended for testing and development purposes but it may also appropriate to use in small production use-cases.  The communication to the XD Admin server is over HTTP and the XD Admin server communicates to an in-process XD Container using an embedded ZooKeeper server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/local-mode.png" alt="local mode" width="500">
</div>
<div class="title">Figure 19. Single Node Runtime</div>
</div>
</div>
<div class="sect3">
<h4 id="admin-server-arch">Admin Server Architecture</h4>
<div class="paragraph">
<p>The Admin Server uses an embedded servlet container and exposes REST endpoints for creating, deploying, undeploying, and destroying streams and jobs, querying runtime state, analytics, and the like. The Admin Server is implemented using Spring&#8217;s MVC framework and the <a href="https://github.com/SpringSource/spring-hateoas">Spring HATEOAS</a> library to create REST representations that follow the <a href="http://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a> principle. The Admin Server and Container Servers monitor and update runtime state using ZooKeeper (see <a href="#xd-distributed-runtime">XD Distributed Runtime</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="container-server-arch">Container Server Architecture</h4>
<div class="paragraph">
<p>The key components of data processing in Spring XD are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Streams</p>
</li>
<li>
<p>Jobs</p>
</li>
<li>
<p>Taps</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Streams define how event driven data is collected, processed, and stored or forwarded. For example, a stream might collect syslog data, filter, and store it in HDFS.</p>
</div>
<div class="paragraph">
<p>Jobs define how coarse grained and time consuming batch processing steps are orchestrated, for example a job could be be defined to coordinate performing HDFS operations and the subsequent execution of multiple MapReduce processing tasks.</p>
</div>
<div class="paragraph">
<p>Taps are used to process data in a non-invasive way as data is being processed by a Stream or a Job.  Much like wiretaps used on telephones, a Tap on a Stream lets you consume data at any point along the Stream’s processing pipeline. The behavior of the original stream is unaffected by the presence of the Tap.</p>
</div>
<div id="taps-jobs-streams" class="imageblock">
<div class="content">
<img src="images/images/tap-jobs-streams.png" alt="tap jobs streams" width="500">
</div>
<div class="title">Figure 20. Taps, Jobs, and Streams</div>
</div>
</div>
<div class="sect3">
<h4 id="architecture_streams">Streams</h4>
<div class="paragraph">
<p>The programming model for processing event streams in Spring XD is based on the well known <a href="http://www.eaipatterns.com/">Enterprise Integration Patterns</a> as implemented by components in the <a href="http://www.springsource.org/spring-integration">Spring Integration</a> project.  The programming model was designed so that it is easy to test components.</p>
</div>
<div class="paragraph">
<p>A Stream consist of the following types of modules:
* An Input source
* Processing steps
* An Output sink</p>
</div>
<div class="paragraph">
<p>An Input source produces messages from an external source. XD supports a variety of sources, e.g. syslog, tcp, http. The output from a module is a Spring Message containing a payload of data and a collection of key-value headers. Messages flow through message channels from the source, through optional processing steps, to the output sink. The output sink delivers the message to an external resource. For example, it is common to write the message to a file system, such as HDFS, but you may also configure the sink to forward the message over tcp, http, or another type of middleware, or route the message to another stream.</p>
</div>
<div class="paragraph">
<p>A stream that consists of a input source and a output sink is shown below</p>
</div>
<div id="source-sinkl" class="imageblock">
<div class="content">
<img src="images/images/SourceSinkMessageChannel.png" alt="SourceSinkMessageChannel" width="500">
</div>
<div class="title">Figure 21. Foundational components of the Stream processing model</div>
</div>
<div class="paragraph">
<p>A stream that incorporates processing steps is shown below</p>
</div>
<div id="source-sink" class="imageblock">
<div class="content">
<img src="images/images/MultipleProcessingSteps.png" alt="MultipleProcessingSteps" width="500">
</div>
<div class="title">Figure 22. Stream processing with multiple steps</div>
</div>
<div class="paragraph">
<p>For simple linear processing streams, an analogy can be made with the UNIX pipes and filters model. Filters represent any component that produces, processes or consumes events. This corresponds to the modules (source, processing steps, and sink) in a stream. Pipes represent the way data is transported between the Filters. This corresponds to the Message Channel that moves data through a stream.</p>
</div>
<div class="paragraph">
<p>A simple stream definition using UNIX pipes and filters syntax that takes data sent via a HTTP post and writes it to a file (with no processing done in between) can be expressed as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http | file</pre>
</div>
</div>
<div class="paragraph">
<p>The pipe symbol represents a message channel that passes data from the HTTP source to the File sink. The message channel implementation can either be backed with a local in-memory transport, Redis queues, or RabbitMQ.  The message channel abstraction and the XD architecture are designed to support a pluggable data transport. Future releases will support other transports such as JMS.</p>
</div>
<div class="paragraph">
<p>Note that the UNIX pipes and filter syntax is the basis for the DSL that Spring XD uses to describe simple linear flows. Non-linear processing is partially supported using named channels which can be combined with a router sink to effectively split a single stream into multiple streams (see <a href="#router_sink">Dynamic Router Sink</a>). Additional capabilities for non-linear processing are planned for future releases.</p>
</div>
<div class="paragraph">
<p>The programming model for processing steps in a stream originates from the Spring Integration project and is included in the core Spring Framework as of version 4. The central concept is one of a Message Handler class, which relies on simple coding conventions to Map incoming messages to processing methods.  For example, using an http source you can process the body of an HTTP POST request using the following class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public class SimpleProcessor {

  public String process(String payload) {
    return payload.toUpperCase();
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The payload of the incoming Message is passed as a string to the method <code>process</code>.  The contents of the payload is the body of the http request as we are using a http source.  The non-void return value is used as the payload of the Message passed to the next step.  These programming conventions make it very easy to test your Processor component in isolation.  There are several processing components provided in Spring XD that do not require you to write any code, such as a filter and transformer that use the Spring Expression Language or Groovy. For example, adding a processing step, such as a transformer, in a stream processing definition can be as simple as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http | transformer --expression=payload.toUpperCase() | file</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on processing modules, refer to the <a href="#processors">Processors</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stream_deployment">Stream Deployment</h4>
<div class="paragraph">
<p>The Container Server listens for module deployment events initiated from the Admin Server via ZooKeeper. When the container node handles a module deployment event, it connects the module&#8217;s input and output channels to the data bus used to transport messages during stream processing.  In a single node configuration, the data bus uses in-memory direct channels. In a distributed configuration, the data bus communications are backed by the configured transport middleware. Redis and Rabbit are both provided with the Spring XD distribution, but other transports are envisioned for future releases.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/anatomyOfAStreamSingleNode.jpg" alt="anatomyOfAStreamSingleNode" width="500">
</div>
<div class="title">Figure 23. A Stream Deployed in a single node server</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/anatomyOfAStreamV3.jpg" alt="anatomyOfAStreamV3" width="500">
</div>
<div class="title">Figure 24. A Stream Deployed in a distributed runtime</div>
</div>
<div class="paragraph">
<p>In the <code>http | file</code> example, the Admin assigns each module to a separate Container instance, provided there are at least two Containers available. The <code>file</code> module is deployed to one container and the <code>http</code> module to another.  The definition of a module is stored in a Module Registry. A module definition consists of a Spring XML configuration file, some classes used to validate and handle options defined by the module, and dependent jars.  The module definition contains variable placeholders, corresponding to DSL parameters (called <em>options</em>) that allow you to customize the behavior of the module. For example, setting the http listening port would be done by passing in the option <code>--port</code>, e.g. <code>http --port=8090 | file</code>, which is in turn used to substitute a placeholder value in the module definition.</p>
</div>
<div class="paragraph">
<p>The Module Registry is backed by the filesystem and corresponds to the directory <code>&lt;xd-install-directory&gt;/modules</code>.  When a module deployment is handled by the Container, the module definition is loaded from the registry and a new Spring ApplicationContext is created in the Container process to run the module. Dependent classes are loaded via the Module Classloader which first looks at jars in the modules /lib directory before delegating to the parent classloader.</p>
</div>
<div class="paragraph">
<p>Using the DIRT runtime, the http | file example would map onto the following runtime architecture</p>
</div>
<div id="http-to-file" class="imageblock">
<div class="content">
<img src="images/images/http2file.png" alt="http2file" width="500">
</div>
<div class="title">Figure 25. Distributed HTTP to File Stream</div>
</div>
<div class="paragraph">
<p>Data produced by the HTTP module is sent over a Redis Queue and is consumed by the File module. If there was a filter processing module in the steam definition, e.g <code>http | filter | file</code> that would map onto the following DIRT runtime architecture.</p>
</div>
<div id="http-to-filter-to-file" class="imageblock">
<div class="content">
<img src="images/images/http2filter2file.png" alt="http2filter2file" width="500">
</div>
<div class="title">Figure 26. Distributed HTTP to Filter to File Stream</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jobs_2">Jobs</h3>
<div class="paragraph">
<p>The creation and execution of Batch jobs builds upon the functionality available in the Spring Batch and Spring for Apache Hadoop projects.  See the <a href="#batch">Batch Jobs</a> section for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_taps">Taps</h3>
<div class="paragraph">
<p>Taps provide a non-invasive way to consume the data that is being processed by either a Stream or a Job, much like a real time telephone wire tap lets you eavesdrop on telephone conversations. Taps are recommended as way to collect metrics and perform analytics on a Stream of data. See the section <a href="#taps">Taps</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_distributed_runtime">Distributed Runtime</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_8">Introduction</h3>
<div class="paragraph">
<p>This document describes what&#8217;s happening "under the hood" of the Spring XD Distributed Runtime (DIRT) and in particular, how the runtime architecture achieves high availability and failover in a clustered production environment. See <a href="Running-Distributed-Mode">Running in Distributed Mode</a> for more information on installing and running Spring XD in distributed mode.</p>
</div>
<div class="paragraph">
<p>This discussion focuses on Spring XD&#8217;s core runtime components and the role of <a href="http://zookeeper.apache.org">ZooKeeper</a> in managing the state of the Spring XD cluster and enabling automatic recovery from failures.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_spring_xd_for_high_availabilty_ha">Configuring Spring XD for High Availabilty(HA)</h3>
<div class="paragraph">
<p>A production Spring XD environment is typically distributed among multiple hosts in a clustered environment. Spring XD scales horizontally when you add container instances. In the simplest case, all containers are replicas, that is each instance is running on an identically configured host and modules are deployed to any available container in a round-robin fashion. However, this simplifying assumption does not address real production scenarios in which more control is requred in order to optimize resource utilization. To this end, Spring XD supports a flexible algorithm which allows you to match module deployments to specific container configurations. The container matching algorithm will be covered in more detail later, but for now, let&#8217;s assume the simple case. Running multiple containers not only enables horizontal scalability, but enables  failure recovery. If a container becomes unavailable due to an unrecoverable connection loss, any modules currently deployed to that container will be deployed automatically to the other available instances.</p>
</div>
<div class="paragraph">
<p>Spring XD requires that a single active Admin server handle interactions with the containers, such as stream deployment requests, as these types of operations must be processed serially in the order received. Without a backup, the Admin server becomes single point of failure. Therefore, two (or more for the risk averse) Admin servers are recommended for a production environment. Note that every Admin server can handle all requests via <a href="REST-API">REST</a> endpoints but only one instance, the "Leader", will actually perform requests that update the runtime state. If the Leader goes down, another available Admin server will assume the leader role. <a href="http://curator.apache.org/curator-recipes/leader-election.html">Leader Election</a> is an example of a common feature for distributed systems provided by the <a href="http://curator.apache.org">Curator Framework</a> which sits on top of ZooKeeper.</p>
</div>
<div class="paragraph">
<p>An HA Spring XD installation also requires that external servers - ZooKeeper, messaging middleware, and data stores needed for <a href="Running-Distributed-Mode">running Spring XD in distributed mode</a> must be configured for HA as well. Please consult the product documentation for specific recommendations regarding each of these external components. Also see <a href="MessageBus">Message Bus Configuration</a> for tips on configuring the MessageBus for HA, error handling, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zookeeper_overview">ZooKeeper Overview</h3>
<div class="paragraph">
<p>In the previous section, we claimed that if a container goes down, Spring XD will redeploy any modules deployed on that instance to another available container. We also claimed that if the Admin Leader goes down, another Admin server will assume that role. <a href="http://zookeeper.apache.org">ZooKeeper</a> is what makes this all possible. ZooKeeper is a widely used Apache project designed primarily for distributed system management and coordination. This section will cover some basic concepts necessary to understand its role in Spring XD. See <a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/Index">The ZooKeeper Wiki</a> for a more complete overview.</p>
</div>
<div class="paragraph">
<p>ZooKeeper is based on a simple hierarchical data structure, formally a tree, and conceptually and semantically similar to a file directory structure. As such, data is stored in <em>nodes</em>. A node is referenced via a <em>path</em>, for example, <em>/xd/streams/mystream</em>. Each node can store additional data, serialized as a byte array. In Spring XD, all data is a java.util.Map serialized as JSON. The following figure shows the Spring XD schema:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/zk_xd_schema.png" alt="ZooKeeper XD Schema" width="500">
</div>
</div>
<div class="paragraph">
<p>A ZooKeeper node is either <em>ephemeral</em> or <em>persistent</em>.  An ephemeral node exists only as long as the session that created it remains active. A persistent node is, well, persistent. Ephemeral nodes are appropriate for registering Container instances. When an Spring XD container starts up it creates an ephemeral node, <em>/xd/containers/&lt;container-id&gt;</em>,  using an internally generated container id. When the container&#8217;s session is closed due to a connection loss, for example, the container process terminates, its node is removed. The ephemeral container node also holds metadata such as its hostname and IP address, runtime metrics, and user defined container attributes. Persistent nodes maintain state needed for normal operation and recovery. This includes data such as stream definitions, job definitions, deployment manifests, module deployments, and deployment state for streams and jobs.</p>
</div>
<div class="paragraph">
<p>Obviously ZooKeeper is a critical piece of the Spring XD runtime and must itself be HA. ZooKeeper itself supports a distributed architecture, called an <em>ensemble</em>. The details are beyond the scope of this document but for the sake of this discussion it is worth mentioning that there should be at least three ZooKeeper server instances running (an odd number is always recommended) on dedicated hosts. The Container and Admin nodes are clients to the ZooKeeper ensemble and must connect to ZooKeeper at startup. Spring XD components are configured with a <em>zk.client.connect</em> property which may designate a single &lt;host&gt;:&lt;port&gt; or a comma separated list. The ZooKeeper client will attempt to connect to each server in order until it succeeds. If it is unable to connect, it will keep trying. If a connection is lost, the ZooKeeper client will attempt to reconnect to one of the servers. The ZooKeeper cluster guarantees consistent replication of data across the ensemble. Specifically, ZooKeeper guarantees:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sequential Consistency - Updates from a client will be applied in the order that they were sent.</p>
</li>
<li>
<p>Atomicity - Updates either succeed or fail. No partial results.</p>
</li>
<li>
<p>Single System Image - A client will see the same view of the service regardless of the server that it connects to.</p>
</li>
<li>
<p>Reliability - Once an update has been applied, it will persist from that time forward until a client overwrites the update.</p>
</li>
<li>
<p>Timeliness - The clients view of the system is guaranteed to be up-to-date within a certain time bound.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ZooKeeper maintains data primarily in memory backed by a disk cache. Updates are logged to disk for recoverability, and writes are serialized to disk before they are applied to the in-memory database.</p>
</div>
<div class="paragraph">
<p>In addition to performing basic CRUD operations on nodes, A ZooKeeper client can register a callback on a node to respond to any events or state changes to that node or any of its children. Such node operations and callbacks are the mechanism that control the Spring XD runtime.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/xd-cluster.png" alt="Spring XD and ZK Ensemble" width="500">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_admin_server_internals">The Admin Server Internals</h3>
<div class="paragraph">
<p>Assuming more than one Admin instance is running, Each instance requests leadership at start up. If there is already a designated leader, the instance will watch the <em>xd/admin</em> node to be notified if the Leader goes away. The instance designated as the "Leader", using the Leader Selector recipe provided by <a href="http://curator.apache.org">Curator</a>, a ZooKeeper client library that implements some common patterns. Curator also provides some Listener callback interfaces that the client can register on a node. The AdminServer creates the top level nodes, depicted in the figure above:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/xd/admins</strong> - children are ephemeral nodes for each available Admin instance and used for Leader Selector</p>
</li>
<li>
<p><strong>/xd/containers</strong> - children are ephemeral nodes containing runtime attributes including hostname,process id, ip address, and user defined attributes for each container instance.</p>
</li>
<li>
<p><strong>/xd/streams</strong> - children are persistent nodes containing the definition (DSL) for each stream.</p>
</li>
<li>
<p><strong>/xd/jobs</strong> - children are persistent nodes containing the definition (DSL) for each job.</p>
</li>
<li>
<p><strong>/xd/taps</strong> - children are persistent nodes describing each deployed tap.</p>
</li>
<li>
<p><strong>/xd/deployments/streams</strong> - children are nodes containing stream deployment status (leaf nodes are ephemeral).</p>
</li>
<li>
<p><strong>/xd/deployments/jobs</strong> - children are nodes containing job deployment status (leaf nodes are ephemeral).</p>
</li>
<li>
<p><strong>/xd/deployments/modules/requested</strong> - stores module deployment requests including deployment criteria.</p>
</li>
<li>
<p><strong>/xd/deployments/modules/allocated</strong> - stores information describing currently deployed modules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The admin leader creates a DeploymentSupervisor which registers listeners on <em>/xd/deployments/modules/requested</em> to handle module deployment requests related to stream and job deployments, and <em>xd/containers/</em> to be notified when containers are added and removed from the cluster. Note that any Admin instance can handle user requests. For example, if you enter the following commands via XD shell,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd&gt;stream create ticktock --definition "time | log"</pre>
</div>
</div>
<div class="paragraph">
<p>This command will invoke a REST service on its connected Admin instance to create a new node /xd/streams/ticktock</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd&gt;stream deploy ticktock</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the deployment is successful, This will result in the creation of several nodes used to manage deployed resources, for example, <em>/xd/deployments/streams/ticktock</em>. The details are discussed in the <a href="#example-1">example below</a>.</p>
</div>
<div class="paragraph">
<p>If the Admin instance connected to the shell is not the Leader, it will perform no further action. The Leader&#8217;s DeploymentSupervisor will attempt to deploy each module in the stream definition, in accordance with the deployment manifest, to an available container, and update the runtime state.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/xd-admin-internals.png" alt="XD Admin Internals" width="500">
</div>
</div>
<div class="sect3">
<h4 id="example-1">Example</h4>
<div class="paragraph">
<p>Let&#8217;s walk through the simple example above. If you don&#8217;t have a Spring XD cluster set up, this example can be easily executed running Spring XD in a single node configuration. The single node application includes an embedded ZooKeeper server by default and allocates a random unused port. The embedded ZooKeeper connect string is reported in the console log for the single node application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
13:04:27,016  INFO main util.XdConfigLoggingInitializer - Transport: local
13:04:27,016  INFO main util.XdConfigLoggingInitializer - Hadoop Distro: hadoop22
13:04:27,019  INFO main util.XdConfigLoggingInitializer - Hadoop version detected from classpath: 2.2.0
13:04:27,019  INFO main util.XdConfigLoggingInitializer - Zookeeper at: localhost:31316
...</pre>
</div>
</div>
<div class="paragraph">
<p>For our purposes, we will use the ZooKeeper CLI tool to inspect the contents of ZooKeeper nodes reflecting the current state of Spring XD. First, we need to know the port to connect the CLI tool to the embedded server. For convenience, we will assign the ZooKeeper port (5555 in this example) when starting the single node application. From the XD install directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$export JAVA_OPTS="-Dzk.embedded.server.port=5555"
$xd/bin/xd-singlenode</pre>
</div>
</div>
<div class="paragraph">
<p>In another terminal session, start the ZooKeeper CLI included with ZooKeeper to connect to the embedded server and inspect the contents of the nodes (NOTE: tab completion works) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$zkCli.sh -server localhost:5555</pre>
</div>
</div>
<div class="paragraph">
<p>After some console output, you should see a prompt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WatchedEvent state:SyncConnected type:None path:null
[zk: localhost:5555(CONNECTED) 0]</pre>
</div>
</div>
<div class="paragraph">
<p>navigate using the <em>ls</em> command. This will reflect the schema shown in the figure above, the unique container ID will be different for you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[zk: localhost:5555(CONNECTED) 0] ls /xd
[deployments, containers, admins, taps, streams, jobs]
[zk: localhost:5555(CONNECTED) 1] ls /xd/streams
[]
[zk: localhost:5555(CONNECTED) 2] ls /xd/deployments
[jobs, streams, modules]
[zk: localhost:5555(CONNECTED) 3] ls /xd/deployments/streams
[]
[zk: localhost:5555(CONNECTED) 4] ls /xd/deployments/modules
[requested, allocated]
[zk: localhost:5555(CONNECTED) 5] ls /xd/deployments/modules/allocated
[2ebbbc9b-63ac-4da4-aa32-e39d69eb546b]
[zk: localhost:5555(CONNECTED) 6] ls /xd/deployments/modules/2ebbbc9b-63ac-4da4-aa32-e39d69eb546b
[]
[zk: localhost:5555(CONNECTED) 7] ls /xd/containers
[2ebbbc9b-63ac-4da4-aa32-e39d69eb546b]
[zk: localhost:5555(CONNECTED) 8]</pre>
</div>
</div>
<div class="paragraph">
<p>The above reflects the initial state of Spring XD with a running admin and container instance. Nothing is deployed yet and there are no existing stream or job definitions. Note that <em>xd/deployments/modules/allocated</em> has a persistent child corresponding to the id of the container at <em>xd/containers</em>. If you are running in a distributed configuration and connected to one of the ZooKeeper servers in the same ensemble that Spring XD is connected to, you might see multiple nodes under <em>/xd/containers</em>, and <em>xd/admins</em>. Because the external ensemble persists the state of the Spring XD cluster, you will also see any deployments that existed when the Spring XD cluster was shut down.</p>
</div>
<div class="paragraph">
<p>Start the XD Shell in a new terminal session and create a stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ shell/bin/xd-shell
 _____                           __   _______
/  ___|          (-)             \ \ / /  _  \
\ `--. _ __  _ __ _ _ __   __ _   \ V /| | | |
 `--. \ '_ \| '__| | '_ \ / _` |  / ^ \| | | |
/\__/ / |_) | |  | | | | | (_| | / / \ \ |/ /
\____/| .__/|_|  |_|_| |_|\__, | \/   \/___/
      | |                  __/ |
      |_|                 |___/
eXtreme Data
1.0.0.RELEASE | Admin Server Target: http://localhost:9393
Welcome to the Spring XD shell. For assistance hit TAB or type "help".
xd:>stream create ticktock --definition "time | log"
Created new stream 'ticktock'
xd:></code></pre>
</div>
</div>
<div class="paragraph">
<p>Back to the ZK CLI session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[zk: localhost:5555(CONNECTED) 8] ls /xd/streams
[ticktock]
[zk: localhost:5555(CONNECTED) 9] get /xd/streams/ticktock
{"definition":"time | log"}
cZxid = 0x31
ctime = Mon Jul 14 10:32:33 EDT 2014
mZxid = 0x31
mtime = Mon Jul 14 10:32:33 EDT 2014
pZxid = 0x31
cversion = 0
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 27
numChildren = 0
[zk: localhost:5555(CONNECTED) 10]</pre>
</div>
</div>
<div class="paragraph">
<p>using the <em>get</em> command on the new stream node, we can see the stream definition represented as JSON, along with some standard ZooKeeper metadata.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<em>ephemeralOwner = 0x0</em>, indicating this is not an ephemeral node. At this point, nothing else should have changed from the initial state.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, Using the Spring XD shell, let&#8217;s deploy the stream,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd&gt;stream deploy ticktock
Deployed stream 'ticktock'</pre>
</div>
</div>
<div class="paragraph">
<p>and verify with ZooKeeper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[zk: localhost:5555(CONNECTED) 10] ls /xd/deployments/streams
[ticktock]
[zk: localhost:2181(CONNECTED) 11] ls /xd/streams/deployments/ticktock
[modules, status]
[[zk: localhost:2181(CONNECTED) 12] get /xd/deployments/streams/ticktock/status
{"state":"deployed"}
....
zk: localhost:2181(CONNECTED) 13] ls /xd/deployments/streams/ticktock/modules
[source.time.1.2ebbbc9b-63ac-4da4-aa32-e39d69eb546b, sink.log.1.2ebbbc9b-63ac-4da4-aa32-e39d69eb546b]</pre>
</div>
</div>
<div class="paragraph">
<p>Note the deployment state shown for the stream&#8217;s status node is <em>deployed</em>, meaning the deployment request was satisfied. Deployment states are discussed in more detail <a href="#deployment-states">here</a>.</p>
</div>
<div class="paragraph">
<p>Spring XD decomposes stream deployment requests to individual module deployment requests. Hence, we see that each module in the stream is associated with a container instance. The container instance in this case is the same since there is only one instance in the single node configuration. In a distributed configuration with more than one instance, the stream source and sink will each be deployed to a separate container. The node name itself is of the form <em>&lt;module_type&gt;.&lt;module_name&gt;.&lt;module_sequence_number&gt;.&lt;container_id&gt;</em>, where the sequence number identifies a deployed instance of a module if multiple instances of that module are requested.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[zk: localhost:2181(CONNECTED) 14] ls /xd/deployments/modules/allocated/2ebbbc9b-63ac-4da4-aa32-e39d69eb546b/ticktock.source.time.1
[metadata, status]</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>metadata</em> and <em>status</em> nodes are ephemeral nodes which store details about the deployed module. This information is provided to XD shell queries. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;runtime modules
  Module                  Container Id                          Options                                          Deployment Properties
  ----------------------  ------------------------------------  -----------------------------------------------  ---------------------
  ticktock.sink.log.1     2ebbbc9b-63ac-4da4-aa32-e39d69eb546b  {name=ticktock, expression=payload, level=INFO}  {count=1, sequence=1}
  ticktock.source.time.1  2ebbbc9b-63ac-4da4-aa32-e39d69eb546b  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}       {count=1, sequence=1}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_deployment">Module Deployment</h3>
<div class="paragraph">
<p>This section describes how the Spring XD runtime manages deployment internally. For more details on how to deploy streams and jobs see <a href="Deployment">Deployment</a>.</p>
</div>
<div class="paragraph">
<p>To process a stream deployment request, the <em>StreamDeploymentListener</em> invokes its <em>ContainerMatcher</em> to select a container instance for each module and records the module&#8217;s deployment properties under <em>/xd/deployments/modules/requested/</em>. If a match is found, the StreamDeploymentListener creates a node for the module under <em>/xd/deployments/modules/allocated/&lt;container_id&gt;</em>. The Container includes a <em>DeploymentListener</em> that monitors the container node for new modules to deploy. If the deployment is successful, the Container writes the ephemeral nodes <em>status</em> and <em>metadata</em> under the new module node.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/module-deployment.png" alt="Module Deployment" width="500">
</div>
</div>
<div class="paragraph">
<p>When a container departs, the ephemeral nodes are deleted so its modules are now undeployed. The <em>ContainerListener</em> responds to the deleted nodes and attempts to redeploy any affected modules to another instance.</p>
</div>
<div class="sect3">
<h4 id="_example_automatic_redeployment">Example: Automatic Redeployment</h4>
<div class="paragraph">
<p>For this example we start two container instances and deploy and simple stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;runtime containers
  Container Id                          Host            IP Address   PID    Groups  Custom Attributes
  ------------------------------------  --------------  -----------  -----  ------  -----------------
  0ddf80b9-1e80-44b8-8c12-ecc5c8c32e11  ultrafox.local  192.168.1.6  19222
  6cac85f8-4c52-4861-a225-cdad3675f6c9  ultrafox.local  192.168.1.6  19244

xd:&gt;stream create ticktock --definition "time | log"
Created new stream 'ticktock'
xd:&gt;stream deploy ticktock
Deployed stream 'ticktock'
xd:&gt;runtime modules
  Module                  Container Id                          Options                                          Deployment Properties
  ----------------------  ------------------------------------  -----------------------------------------------  ---------------------
  ticktock.sink.log.1     0ddf80b9-1e80-44b8-8c12-ecc5c8c32e11  {name=ticktock, expression=payload, level=INFO}  {count=1, sequence=1}
  ticktock.source.time.1  6cac85f8-4c52-4861-a225-cdad3675f6c9  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}       {count=1, sequence=1}
</pre>
</div>
</div>
<div class="paragraph">
<p>Now we will kill one of the container processes and observe that the affect module has been redeployed to the remaining container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;runtime containers
  Container Id                          Host            IP Address   PID    Groups  Custom Attributes
  ------------------------------------  --------------  -----------  -----  ------  -----------------
  6cac85f8-4c52-4861-a225-cdad3675f6c9  ultrafox.local  192.168.1.6  19244

xd:&gt;runtime modules
  Module                  Container Id                          Options                                          Deployment Properties
  ----------------------  ------------------------------------  -----------------------------------------------  ---------------------
  ticktock.sink.log.1     6cac85f8-4c52-4861-a225-cdad3675f6c9  {name=ticktock, expression=payload, level=INFO}  {count=1, sequence=1}
  ticktock.source.time.1  6cac85f8-4c52-4861-a225-cdad3675f6c9  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}       {count=1, sequence=1}</pre>
</div>
</div>
<div class="paragraph">
<p>Now if we kill the remaining container, we see warnings in the xd-admin log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>14:36:07,593  WARN DeploymentSupervisorCacheListener-0 server.DepartingContainerModuleRedeployer - No containers available for redeployment of log for stream ticktock
14:36:07,599  WARN DeploymentSupervisorCacheListener-0 server.DepartingContainerModuleRedeployer - No containers available for redeployment of time for stream ticktock</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch">Batch Jobs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_9">Introduction</h3>
<div class="paragraph">
<p>One of the features that XD offers is the ability to launch and monitor batch jobs based on <a href="http://www.springsource.org/spring-batch">Spring Batch</a>.  The Spring Batch project was started in 2007 as a collaboration between SpringSource and Accenture to provide a comprehensive framework to support the development of robust batch applications.  Batch jobs have their own set of best practices and domain concepts which have been incorporated into Spring Batch building upon Accenture&#8217;s consulting business.  Since then Spring Batch has been used in thousands of enterprise applications and is the basis for the recent JSR standardization of batch processing, <a href="https://jcp.org/en/jsr/detail?id=352">JSR-352</a>.</p>
</div>
<div class="paragraph">
<p>Spring XD builds upon Spring Batch to simplify creating batch workflow solutions that span traditional use-cases such as moving data between flat files and relational databases as well as Hadoop use-cases where analysis logic is broken up into several steps that run on a Hadoop cluster.  Steps specific to Hadoop in a workflow can be MapReduce jobs, executing Hive/Pig scripts or HDFS operations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_workflow">Workflow</h3>
<div class="paragraph">
<p>The concept of a workflow translates to a Job, not to be confused with a MapReduce job. A Job is a directed graph, each node of the graph is a processing Step. Steps can be executed sequentially or in parallel, depending on the configuration. Jobs can be started, stopped, and restarted. Restarting
jobs is possible since the progress of executed steps in a Job is persisted in a database via a JobRepository.  The following figures shows the basic components of a workflow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/batch-overview.png" alt="The Spring XD Workflow overview" width="500">
</div>
</div>
<div class="paragraph">
<p>A Job that has steps specific to Hadoop is shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/batch-hadoop-overview.png" alt="Steps in a workflow that execute Hadoop HDFS operations and run Pig" width="200">
</div>
</div>
<div class="paragraph">
<p>A JobLauncher is responsible for starting a job and is often triggered via a scheduler.  Other options to launch a job are through Spring XD&#8217;s RESTful administration API, the XD web application, or in response to an external event from and XD stream definition, <em>e.g.</em> file polling using the file source.</p>
</div>
</div>
<div class="sect2">
<h3 id="_features">Features</h3>
<div class="paragraph">
<p>Spring XD allows you to create and launch jobs.  The launching of a job can be triggered using a cron expression or in reaction to data on a stream. When jobs are executing, they are also a souce of event data that can be subscribed to by a stream.  There are several type of events sent during a job&#8217;s execution, the most common being the status of the job and the steps taken within the job.  This bi-direction communication between stream processing and batch processing allows for more complex chains of processing to be developed.</p>
</div>
<div class="paragraph">
<p>As a starting point, jobs for the following cases are provided to use out of the box</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Poll a Directory and import CSV files to HDFS</p>
</li>
<li>
<p>Import CSV files to JDBC</p>
</li>
<li>
<p>HDFS to JDBC Export</p>
</li>
<li>
<p>JDBC to HDFS Import</p>
</li>
<li>
<p>HDFS to MongoDB Export</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are described in the section below.</p>
</div>
<div class="paragraph">
<p>This purpose of this section is to show you how to create, schedule and monitor a job.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_lifecycle_of_a_job_in_spring_xd">The Lifecycle of a Job in Spring XD</h3>
<div class="paragraph">
<p>Before we dive deeper into the details of creating batch jobs with Spring XD, we need to understand the typical lifecycle for batch jobs in the context of <em>Spring XD</em>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register a Job Module</p>
</li>
<li>
<p>Create a Job Definition</p>
</li>
<li>
<p>Deploy a Job</p>
</li>
<li>
<p>Launch a Job</p>
</li>
<li>
<p>Job Execution</p>
</li>
<li>
<p>Un-deploy a Job</p>
</li>
<li>
<p>Destroy a Job Definition</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_register_a_job_module">Register a Job Module</h4>
<div class="paragraph">
<p>Register a <strong>Job Module</strong> with the <em>Module Registry</em> by putting XML and/or jar files into the <code>$XD_HOME/modules/jobs</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_job_definition">Create a Job Definition</h4>
<div class="paragraph">
<p>Create a <strong>Job Definition</strong> from a <em>Job Module</em> by providing a definition name as well as properties that apply to all <em>Job Instances</em>. At this point the job is not deployed, yet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploy_the_job">Deploy the Job</h4>
<div class="paragraph">
<p>Deploy the <strong>Job Definition</strong> to one or more <em>Spring XD</em> containers. This will initialize the <em>Job Definitions</em> on those containers. The jobs are now "live" and a job can be created by sending a message to a job queue that contains optional runtime <strong><a href="http://docs.spring.io/spring-batch/trunk/reference/html/domain.html#domainJobParameters">Job Parameters</a></strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_launch_a_job">Launch a Job</h4>
<div class="paragraph">
<p>Launch a job by sending a message to the job queue with <strong><a href="http://docs.spring.io/spring-batch/trunk/reference/html/domain.html#domainJobParameters">Job Parameters</a></strong>. A <strong><a href="http://docs.spring.io/spring-batch/trunk/reference/html/domain.html#domainJobInstance">Job Instance</a></strong> is created, representing a specific run of the job. A <strong>Job Instance</strong> is the <strong>Job Definition</strong> plus the runtime <strong>Job Parameters</strong>. You can query for the <strong>Job Instances</strong> associated with a given job name.</p>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution">Job Execution</h4>
<div class="paragraph">
<p>The job is executed creating a <strong><a href="http://docs.spring.io/spring-batch/trunk/reference/html/domain.html#domainJobExecution">Job Execution</a></strong> object that captures the success or failure of the job. You can query for <strong>Job Executions</strong> associated with a given job name.</p>
</div>
</div>
<div class="sect3">
<h4 id="_un_deploy_a_job">Un-deploy a Job</h4>
<div class="paragraph">
<p>This removes the job from the <em>Spring XD</em> container(s) preventing the launching of any new <em>Job Instances</em>. For reporting purposes, you will still be able to view historic <em>Job Executions</em> associated with the the job.</p>
</div>
</div>
<div class="sect3">
<h4 id="_destroy_a_job_definition">Destroy a Job Definition</h4>
<div class="paragraph">
<p>Destroying a <strong>Job Definition</strong> will not only un-deploy any still deployed <em>Job Definitions</em> but will also remove the <em>Job Definition</em> itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="job_options">Creating Jobs - Additional Options</h4>
<div class="paragraph">
<p>When creating jobs, the following options are available to all job definitions:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">dateFormat</dt>
<dd>
<p>The optional date format for job parameters <strong>(default: <code>yyyy-MM-dd</code>)</strong></p>
</dd>
<dt class="hdlist1">numberFormat</dt>
<dd>
<p>Defines the number format when parsing numeric parameters <strong>(default: <code>NumberFormat.getInstance(Locale.US)</code>)</strong></p>
</dd>
<dt class="hdlist1">makeUnique</dt>
<dd>
<p>Shall job parameters be made unique? <strong>(default: <code>true</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Also, similar to the <code>stream create</code> command, the <code>job create</code> command has an optional <code>--deploy</code> option to create the job definition and deploy it. <code>--deploy</code> option is false by default.</p>
</div>
<div class="paragraph">
<p>Below is an example of some of these options combined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>job create myjob --definition "fooJob --makeUnique=false"</pre>
</div>
</div>
<div class="paragraph">
<p>Remember that you can always find out about available options for a job by using the <a href="#module_info"><code>module info</code></a> command.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_manifest_support_for_job">Deployment manifest support for job</h3>
<div class="paragraph">
<p>When deploying batch job you can provide a <a href="#deployment-manifest">deployment manifest</a>.  Deployment manifest properties for jobs are the same as for streams, you can declare</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The number of job modules to deploy</p>
</li>
<li>
<p>The criteria expression to use for matching the job to available containers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>job create myjob --definition "fooJob --makeUnique=false"

job deploy myjob --properties "module.fooJob.count=3,module.fooJob.criteria=groups.contains('hdfs-containers-group')"</pre>
</div>
</div>
<div class="paragraph">
<p>The above deployment manifest would deploy 3 number of <code>fooJob</code> modules into containers whose group name matches "hdfs-containers-group".</p>
</div>
<div class="paragraph">
<p>When a batch job is launched/scheduled, the job module that picks up the job launching request message executes the batch job.  To support partitioning of the job across multiple containers, the job definition needs to define how the job will be partitioned.  The type of partitioning depends on the type of the job, for example a job reading from JDBC would partition the data in a table by dividing up the number of rows and a job reading files form a directory would partition on the number of files available.</p>
</div>
<div class="paragraph">
<p>The FTP to HDFS and FILE to JDBC jobs support for partitioning.  To add partitioning support for your own jobs you should import <a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/resources/META-INF/spring-xd/batch/singlestep-partition-support.xml">singlestep-partition-support.xml</a> in your job definition.  This provides the infrastructure so that the job module that processes the launch request can communicate as the master with the other job modules that have been deployed.  You will also need to provide an implementation of the <a href="http://docs.spring.io/spring-batch/apidocs/org/springframework/batch/core/partition/support/Partitioner.html">Partitioner</a> interface.</p>
</div>
<div class="paragraph">
<p>For more information on the deployment manifest, please refer <a href="https://github.com/spring-projects/spring-xd/wiki/XD-Distributed-Runtime#deployment-manifest">here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_launching_a_job">Launching a job</h3>
<div class="paragraph">
<p>XD uses triggers as well as regular event flow to launch the batch jobs.  So in this section we will cover how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Launch the Batch Job Ad-hoc</p>
</li>
<li>
<p>Launch the Batch Job using a named Cron-Trigger</p>
</li>
<li>
<p>Launch the Batch Job as sink.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ad_hoc">Ad-hoc</h4>
<div class="paragraph">
<p>To launch a job one time, use the launch option of the job command.  So going back to our example above, we&#8217;ve created a job module instance named helloSpringXD.  Launching that Job Module Instance would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job launch helloSpringXD</pre>
</div>
</div>
<div class="paragraph">
<p>In the logging output of the XDContainer you should see the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre>16:45:40,127  INFO http-bio-9393-exec-1 job.JobPlugin:98 - Configuring module with the following properties: {numberFormat=, dateFormat=, makeUnique=true, xd.job.name=myjob}
16:45:40,185  INFO http-bio-9393-exec-1 module.SimpleModule:140 - initialized module: SimpleModule [name=job, type=job, group=myjob, index=0 @3a9ecb9d]
16:45:40,198  INFO http-bio-9393-exec-1 module.SimpleModule:161 - started module: SimpleModule [name=job, type=job, group=myjob, index=0 @3a9ecb9d]
16:45:40,199  INFO http-bio-9393-exec-1 module.ModuleDeployer:161 - deployed SimpleModule [name=job, type=job, group=myjob, index=0 @3a9ecb9d]
Hello Spring XD!</pre>
</div>
</div>
<div class="paragraph">
<p>To re-launch the job just execute the launch command.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job launch helloSpringXD</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_launch_the_batch_using_cron_trigger">Launch the Batch using Cron-Trigger</h4>
<div class="paragraph">
<p>To launch a batch job based on a cron scheduler is done by creating a stream using the trigger source.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream create --name cronStream --definition "trigger --cron='0/5 * * * * *'  &gt; queue:job:myCronJob" --deploy
</pre>
</div>
</div>
<div class="paragraph">
<p>A batch job can receive parameters from a source (in this case a trigger) or process. A trigger uses the --payload expression to declare its payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream create --name cronStream --definition "trigger --cron='0/5 * * * * *'  --payload={\"param1\":\"Kenny\"} &gt; queue:job:myCronJob" --deploy</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The payload content must be in a JSON-based map representation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To pause/stop future scheduled jobs from running for this stream, the stream must be undeployed for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream undeploy --name cronStream</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_launch_the_batch_using_a_fixed_delay_trigger">Launch the Batch using a Fixed-Delay-Trigger</h4>
<div class="paragraph">
<p>A fixed-delay-trigger is used to launch a Job on a regular interval.  Using the --fixedDelay parameter you can set up the number of seconds between executions.  In the example below we are running myXDJob every 10 seconds and passing it a payload containing a single attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream create --name fdStream --definition "trigger --payload={\"param1\":\"fixedDelayKenny\"} --fixedDelay=5 &gt; queue:job:myXDJob" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>To pause/stop future scheduled jobs from running for this stream, you must undeploy the stream for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream undeploy --name cronStream</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_launch_job_as_a_part_of_event_flow">Launch job as a part of event flow</h4>
<div class="paragraph">
<p>A batch job is always used as a sink, with that being said it can receive messages from sources (other than triggers) and processors. In the case below we see that the user has created an http source (http source receives http posts and passes the payload of the http message to the next module in the stream) that will pass the http payload to the "myHttpJob".</p>
</div>
<div class="listingblock">
<div class="content">
<pre> stream create --name jobStream --definition "http &gt; queue:job:myHttpJob" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>To test the stream you can execute a http post, like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9000 --data "{\"param1\":\"fixedDelayKenny\"}"</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retrieve_job_notifications">Retrieve job notifications</h3>
<div class="paragraph">
<p>Spring XD offers the facilities to capture the notifications that are sent from the job as it is executing.
When a batch job is deployed, by default it registers the following listeners along with pub/sub channels that these listeners send messages to.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Job Execution Listener</p>
</li>
<li>
<p>Chunk Listener</p>
</li>
<li>
<p>Item Listener</p>
</li>
<li>
<p>Step Execution Listener</p>
</li>
<li>
<p>Skip Listener</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Along with the pub/sub channels for each of these listeners, there will also be a pub/sub channel that the aggregated events from all these listeners are published to.</p>
</div>
<div class="paragraph">
<p>In the following example, we setup a Batch Job called <em>myHttpJob</em>. Afterwards we create a stream that will tap into the pub/sub channels that were implicitly generated when the <em>myHttpJob</em> job was deployed.</p>
</div>
<div class="sect3">
<h4 id="_to_receive_aggregated_events">To receive aggregated events</h4>
<div class="paragraph">
<p>The stream receives aggregated event messages from all the default batch job listeners and sends those messages to the log.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd&gt;job create --name myHttpJob --definition "httpJob" --deploy
xd&gt;stream create --name aggregatedEvents --definition "tap:job:myHttpJob &gt;log" --deploy
xd&gt;job launch myHttpJob</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The syntax for the tap that receives the aggregated events is: <code>tap:job:&lt;job-name&gt;</code></p>
</div>
<div class="paragraph">
<p>In the logging output of the container you should see something like the following when the job completes (with the aggregated events</p>
</div>
<div class="listingblock">
<div class="content">
<pre>09:55:53,532  WARN SimpleAsyncTaskExecutor-1 logger.aggregatedEvents:150 - JobExecution: id=2, version=1, startTime=Sat Apr 12 09:55:53 PDT 2014, endTime=null, lastUpdated=Sat Apr 12 09:55:53 PDT 2014, status=STARTED, exitStatus=exitCode=UNKNOWN;exitDescription=, job=[JobInstance: id=2, version=0, Job=[myHttpJob]], jobParameters=[{random=0.07002785662707867}]
09:55:53,554  WARN SimpleAsyncTaskExecutor-1 logger.aggregatedEvents:150 - StepExecution: id=2, version=1, name=step1, status=STARTED, exitStatus=EXECUTING, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=0, rollbackCount=0, exitDescription=
09:55:53,561  WARN SimpleAsyncTaskExecutor-1 logger.aggregatedEvents:150 - XdChunkContextInfo [complete=false, stepExecution=StepExecution: id=2, version=1, name=step1, status=STARTED, exitStatus=EXECUTING, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=0, rollbackCount=0, exitDescription=, attributes={}]
09:55:53,567  WARN SimpleAsyncTaskExecutor-1 logger.aggregatedEvents:150 - XdChunkContextInfo [complete=false, stepExecution=StepExecution: id=2, version=2, name=step1, status=STARTED, exitStatus=EXECUTING, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0, exitDescription=, attributes={}]
09:55:53,573  WARN SimpleAsyncTaskExecutor-1 logger.aggregatedEvents:150 - StepExecution: id=2, version=2, name=step1, status=COMPLETED, exitStatus=COMPLETED, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0, exitDescription=
09:55:53,580  WARN SimpleAsyncTaskExecutor-1 logger.aggregatedEvents:150 - JobExecution: id=2, version=1, startTime=Sat Apr 12 09:55:53 PDT 2014, endTime=Sat Apr 12 09:55:53 PDT 2014, lastUpdated=Sat Apr 12 09:55:53 PDT 2014, status=COMPLETED, exitStatus=exitCode=COMPLETED;exitDescription=, job=[JobInstance: id=2, version=0, Job=[myHttpJob]], jobParameters=[{random=0.07002785662707867}]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_to_receive_job_execution_events">To receive job execution events</h4>
<div class="listingblock">
<div class="content">
<pre>xd&gt;job create --name myHttpJob --definition "httpJob" --deploy
xd&gt;stream create --name jobExecutionEvents --definition "tap:job:myHttpJob.job &gt;log" --deploy
xd&gt;job launch myHttpJob</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The syntax for the tap that receives the job execution events is: <code>tap:job:&lt;job-name&gt;.job</code></p>
</div>
<div class="paragraph">
<p>In the logging output of the container you should see something like the following when the job completes</p>
</div>
<div class="listingblock">
<div class="content">
<pre>10:06:41,579  WARN SimpleAsyncTaskExecutor-1 logger.jobExecutionEvents:150 - JobExecution: id=3, version=1, startTime=Sat Apr 12 10:06:41 PDT 2014, endTime=null, lastUpdated=Sat Apr 12 10:06:41 PDT 2014, status=STARTED, exitStatus=exitCode=UNKNOWN;exitDescription=, job=[JobInstance: id=3, version=0, Job=[myHttpJob]], jobParameters=[{random=0.3774227747555795}]
10:06:41,626  INFO SimpleAsyncTaskExecutor-1 support.SimpleJobLauncher:136 - Job: [FlowJob: [name=myHttpJob]] completed with the following parameters: [{random=0.3774227747555795}] and the following status: [COMPLETED]
10:06:41,626  WARN SimpleAsyncTaskExecutor-1 logger.jobExecutionEvents:150 - JobExecution: id=3, version=1, startTime=Sat Apr 12 10:06:41 PDT 2014, endTime=Sat Apr 12 10:06:41 PDT 2014, lastUpdated=Sat Apr 12 10:06:41 PDT 2014, status=COMPLETED, exitStatus=exitCode=COMPLETED;exitDescription=, job=[JobInstance: id=3, version=0, Job=[myHttpJob]], jobParameters=[{random=0.3774227747555795}]
</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_to_receive_step_execution_events">To receive step execution events</h4>
<div class="listingblock">
<div class="content">
<pre>xd&gt;job create --name myHttpJob --definition "httpJob" --deploy
xd&gt;stream create --name stepExecutionEvents --definition "tap:job:myHttpJob.step &gt;log" --deploy
xd&gt;job launch myHttpJob</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The syntax for the tap that receives the step execution events is: <code>tap:job:&lt;job-name&gt;.step</code></p>
</div>
<div class="paragraph">
<p>In the logging output of the container you should see something like the following when the job completes</p>
</div>
<div class="listingblock">
<div class="content">
<pre>
10:13:16,072  WARN SimpleAsyncTaskExecutor-1 logger.stepExecutionEvents:150 - StepExecution: id=6, version=1, name=step1, status=STARTED, exitStatus=EXECUTING, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=0, rollbackCount=0, exitDescription=
10:13:16,092  WARN SimpleAsyncTaskExecutor-1 logger.stepExecutionEvents:150 - StepExecution: id=6, version=2, name=step1, status=COMPLETED, exitStatus=COMPLETED, readCount=0, filterCount=0, writeCount=0 readSkipCount=0, writeSkipCount=0, processSkipCount=0, commitCount=1, rollbackCount=0, exitDescription=
</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_to_receive_item_skip_and_chunk_events">To receive item, skip and chunk events</h4>
<div class="listingblock">
<div class="content">
<pre>xd&gt;job create --name myHttpJob --definition "httpJob" --deploy

xd&gt;stream create --name itemEvents --definition "tap:job:myHttpJob.item &gt;log" --deploy
xd&gt;stream create --name skipEvents --definition "tap:job:myHttpJob.skip &gt;log" --deploy
xd&gt;stream create --name chunkEvents --definition "tap:job:myHttpJob.chunk &gt;log" --deploy

xd&gt;job launch myHttpJob
</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> The syntax for the tap that receives the item events: <code>tap:job:&lt;job-name&gt;.item</code>,for skip events: <code>tap:job:&lt;job-name&gt;.skip</code> and for chunk events: <code>tap:job:&lt;job-name&gt;.chunk</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_to_disable_the_default_listeners">To disable the default listeners</h4>
<div class="listingblock">
<div class="content">
<pre>xd&gt;job create --name myHttpJob --definition "httpJob --listeners=disable" --deploy</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_to_select_specific_listeners">To select specific listeners</h4>
<div class="paragraph">
<p>To select specific listeners, specify comma separated list in <code>--listeners</code> option.
Following example illustrates the selection of job and step execution listeners only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd&gt;job create --name myHttpJob --definition "httpJob --listeners=job,step" --deploy
</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong>
List of options are: job, step, item, chunk and skip
The aggregated channel is registered if at least one of these default listeners are enabled.</p>
</div>
<div class="paragraph">
<p>For a complete example, please see the <a href="https://github.com/spring-projects/spring-xd-samples/tree/master/batch-notifications">Batch Notifications Sample</a> which is part of the <a href="https://github.com/spring-projects/spring-xd-samples">Spring XD Samples</a> repository.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_removing_batch_jobs">Removing Batch Jobs</h3>
<div class="paragraph">
<p>Batch Jobs can be deleted by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job destroy helloSpringXD</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, one can just undeploy the job, keeping its definition for a future redeployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job undeploy helloSpringXD</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pre_packaged_batch_jobs">Pre-Packaged Batch Jobs</h3>
<div class="paragraph">
<p>Spring XD comes with several batch import and export modules. You can run them out of the box or use them as a basis for building your own custom modules.</p>
</div>
<div class="sect3">
<h4 id="_note_hdfs_configuration">Note HDFS Configuration</h4>
<div class="paragraph">
<p>To use the hdfs based jobs below, XD needs to have append enabled for hdfs.
Update the hdfs-site.xml with the following settings:</p>
</div>
<div class="sect4">
<h5 id="_for_hadoop_1_x">For Hadoop 1.x</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">    &lt;property&gt;
      &lt;name&gt;dfs.support.broken.append&lt;/name&gt;
      &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_for_hadoop_2_x">For Hadoop 2.x</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">    &lt;property&gt;
        &lt;name&gt;dfs.support.append&lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_poll_a_directory_and_import_csv_files_to_hdfs_code_filepollhdfs_code">Poll a Directory and Import CSV Files to HDFS (<code>filepollhdfs</code>)</h4>
<div class="paragraph">
<p>This module is designed to be driven by a stream polling a directory. It imports data from CSV files and requires that you supply a list of named columns for the data using the <code>names</code> parameter. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job create myjob --definition "filepollhdfs --names=forename,surname,address" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>You would then use a stream with a file source to scan a directory for files and drive the job. A separate file will be started for each job found:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream create csvStream --definition "file --ref=true --dir=/mycsvdir --pattern=*.csv &gt; queue:job:myjob" --deploy
</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>filepollhdfs</strong> job has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">deleteFiles</dt>
<dd>
<p>whether to delete files after successful import <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">directory</dt>
<dd>
<p>the directory to write the file(s) to in HDFS <strong>(String, default: <code>/xd/&lt;job name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">fileExtension</dt>
<dd>
<p>the file extension to use <strong>(String, default: <code>csv</code>)</strong></p>
</dd>
<dt class="hdlist1">fileName</dt>
<dd>
<p>the filename to use in HDFS <strong>(String, default: <code>&lt;job name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">fsUri</dt>
<dd>
<p>the URI to use to access the Hadoop FileSystem <strong>(String, default: <code>${spring.hadoop.fsUri}</code>)</strong></p>
</dd>
<dt class="hdlist1">names</dt>
<dd>
<p>the field names in the CSV file <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">restartable</dt>
<dd>
<p>whether the job should be restartable or not in case of failure <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">rollover</dt>
<dd>
<p>the number of bytes to write before creating a new file in HDFS <strong>(int, default: <code>1000000</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_import_csv_files_to_jdbc_code_filejdbc_code">Import CSV Files to JDBC (<code>filejdbc</code>)</h4>
<div class="paragraph">
<p>A module which loads CSV files into a JDBC table using a single batch job. By default it uses the internal HSQL DB which is used by Spring Batch. Refer to <a href="#module_values">how module options are resolved</a> for further details on how to change defaults (one can of course always use <code>--foo=bar</code> notation in the job definition to achieve the same effect).</p>
</div>
<div class="paragraph">
<p>The <strong>filejdbc</strong> job has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">abandonWhenPercentageFull</dt>
<dd>
<p>connections that have timed out wont get closed and reported up unless the number of connections in use are above the percentage <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">alternateUsernameAllowed</dt>
<dd>
<p>uses an alternate user name if connection fails <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">connectionProperties</dt>
<dd>
<p>connection properties that will be sent to our JDBC driver when establishing new connections <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">deleteFiles</dt>
<dd>
<p>whether to delete files after successful import <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">delimiter</dt>
<dd>
<p>the delimiter for the delimited file <strong>(String, default: <code>,</code>)</strong></p>
</dd>
<dt class="hdlist1">driverClassName</dt>
<dd>
<p>the JDBC driver to use <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">fairQueue</dt>
<dd>
<p>set to true if you wish that calls to getConnection should be treated fairly in a true FIFO fashion <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">fsUri</dt>
<dd>
<p>the URI to use to access the Hadoop FileSystem <strong>(String, default: <code>${spring.hadoop.fsUri}</code>)</strong></p>
</dd>
<dt class="hdlist1">initSQL</dt>
<dd>
<p>custom query to be run when a connection is first created <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">initialSize</dt>
<dd>
<p>initial number of connections that are created when the pool is started <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">initializeDatabase</dt>
<dd>
<p>whether the database initialization script should be run <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">initializerScript</dt>
<dd>
<p>the name of the SQL script (in /config) to run if <em>initializeDatabase</em> is set <strong>(String, default: <code>init_batch_import.sql</code>)</strong></p>
</dd>
<dt class="hdlist1">jdbcInterceptors</dt>
<dd>
<p>semicolon separated list of classnames extending org.apache.tomcat.jdbc.pool.JdbcInterceptor <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">jmxEnabled</dt>
<dd>
<p>register the pool with JMX or not <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">logAbandoned</dt>
<dd>
<p>flag to log stack traces for application code which abandoned a Connection <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">maxActive</dt>
<dd>
<p>maximum number of active connections that can be allocated from this pool at the same time <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxAge</dt>
<dd>
<p>time in milliseconds to keep this connection <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">maxIdle</dt>
<dd>
<p>maximum number of connections that should be kept in the pool at all times <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxWait</dt>
<dd>
<p>maximum number of milliseconds that the pool will wait for a connection <strong>(int, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">minEvictableIdleTimeMillis</dt>
<dd>
<p>minimum amount of time an object may sit idle in the pool before it is eligible for eviction <strong>(int, default: <code>60000</code>)</strong></p>
</dd>
<dt class="hdlist1">minIdle</dt>
<dd>
<p>minimum number of established connections that should be kept in the pool at all times <strong>(int, default: <code>10</code>)</strong></p>
</dd>
<dt class="hdlist1">names</dt>
<dd>
<p>the field names in the CSV file <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the JDBC password <strong>(Password, no default)</strong></p>
</dd>
<dt class="hdlist1">removeAbandoned</dt>
<dd>
<p>flag to remove abandoned connections if they exceed the removeAbandonedTimout <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">removeAbandonedTimeout</dt>
<dd>
<p>timeout in seconds before an abandoned connection can be removed <strong>(int, default: <code>60</code>)</strong></p>
</dd>
<dt class="hdlist1">resources</dt>
<dd>
<p>the list of paths to import (Spring resources) <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">restartable</dt>
<dd>
<p>whether the job should be restartable or not in case of failure <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">suspectTimeout</dt>
<dd>
<p>this simply logs the warning after timeout, connection remains <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">tableName</dt>
<dd>
<p>the database table to which the data will be written <strong>(String, default: <code>&lt;job name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">testOnBorrow</dt>
<dd>
<p>indication of whether objects will be validated before being borrowed from the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testOnReturn</dt>
<dd>
<p>indication of whether objects will be validated before being returned to the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testWhileIdle</dt>
<dd>
<p>indication of whether objects will be validated by the idle object evictor <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">timeBetweenEvictionRunsMillis</dt>
<dd>
<p>number of milliseconds to sleep between runs of the idle connection validation/cleaner thread <strong>(int, default: <code>5000</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>the JDBC URL for the database <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">useEquals</dt>
<dd>
<p>true if you wish the ProxyConnection class to use String.equals <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the JDBC username <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validationInterval</dt>
<dd>
<p>avoid excess validation, only run validation at most at this frequency - time in milliseconds <strong>(long, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">validationQuery</dt>
<dd>
<p>sql query that will be used to validate connections from this pool <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validatorClassName</dt>
<dd>
<p>name of a class which implements the org.apache.tomcat.jdbc.pool.Validator <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The job should be defined with the <code>resources</code> parameter defining the files which should be loaded. It also requires a <code>names</code> parameter (for the CSV field names) and these should match the database column names into which the data should be stored. You can either pre-create the database table or the module will create it for you if you use <code>--initializeDatabase=true</code> when the job is created. The table initialization is configured in a similar way to the JDBC sink and uses the same parameters. The default table name is the job name and can be customized by setting the <code>tableName</code> parameter. As an example, if you run the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job create myjob --definition "filejdbc --resources=file:///mycsvdir/*.csv --names=forename,surname,address --tableName=people --initializeDatabase=true" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>it will create the table "people" in the database with three varchar columns called "forename", "surname" and "address". When you launch the job it will load the files matching the resources pattern and write the data to this table. As with the <code>filepollhdfs</code> job, this module also supports the <code>deleteFiles</code> parameter which will remove the files defined by the <code>resources</code> parameter on successful completion of the job.</p>
</div>
<div class="paragraph">
<p>Launch the job using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job launch myjob</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The connection pool settings for xd are located in servers.yml (i.e. <code>spring.datasource.*</code> )
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hdfs_to_jdbc_export_code_hdfsjdbc_code">HDFS to JDBC Export (<code>hdfsjdbc</code>)</h4>
<div class="paragraph">
<p>This module functions very similarly to the <code>filejdbc</code> one except that the resources you specify should actually be in HDFS, rather than the OS filesystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job create myjob --definition "hdfsjdbc --resources=/xd/data/*.csv --names=forename,surname,address --tableName=people --initializeDatabase=true" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Launch the job using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job launch myjob</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>hdfsjdbc</strong> job has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">abandonWhenPercentageFull</dt>
<dd>
<p>connections that have timed out wont get closed and reported up unless the number of connections in use are above the percentage <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">alternateUsernameAllowed</dt>
<dd>
<p>uses an alternate user name if connection fails <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">connectionProperties</dt>
<dd>
<p>connection properties that will be sent to our JDBC driver when establishing new connections <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">delimiter</dt>
<dd>
<p>the delimiter for the delimited file <strong>(String, default: <code>,</code>)</strong></p>
</dd>
<dt class="hdlist1">driverClassName</dt>
<dd>
<p>the JDBC driver to use <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">fairQueue</dt>
<dd>
<p>set to true if you wish that calls to getConnection should be treated fairly in a true FIFO fashion <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">fsUri</dt>
<dd>
<p>the URI to use to access the Hadoop FileSystem <strong>(String, default: <code>${spring.hadoop.fsUri}</code>)</strong></p>
</dd>
<dt class="hdlist1">initSQL</dt>
<dd>
<p>custom query to be run when a connection is first created <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">initialSize</dt>
<dd>
<p>initial number of connections that are created when the pool is started <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">initializeDatabase</dt>
<dd>
<p>whether the database initialization script should be run <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">initializerScript</dt>
<dd>
<p>the name of the SQL script (in /config) to run if <em>initializeDatabase</em> is set <strong>(String, default: <code>init_batch_import.sql</code>)</strong></p>
</dd>
<dt class="hdlist1">jdbcInterceptors</dt>
<dd>
<p>semicolon separated list of classnames extending org.apache.tomcat.jdbc.pool.JdbcInterceptor <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">jmxEnabled</dt>
<dd>
<p>register the pool with JMX or not <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">logAbandoned</dt>
<dd>
<p>flag to log stack traces for application code which abandoned a Connection <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">maxActive</dt>
<dd>
<p>maximum number of active connections that can be allocated from this pool at the same time <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxAge</dt>
<dd>
<p>time in milliseconds to keep this connection <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">maxIdle</dt>
<dd>
<p>maximum number of connections that should be kept in the pool at all times <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxWait</dt>
<dd>
<p>maximum number of milliseconds that the pool will wait for a connection <strong>(int, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">minEvictableIdleTimeMillis</dt>
<dd>
<p>minimum amount of time an object may sit idle in the pool before it is eligible for eviction <strong>(int, default: <code>60000</code>)</strong></p>
</dd>
<dt class="hdlist1">minIdle</dt>
<dd>
<p>minimum number of established connections that should be kept in the pool at all times <strong>(int, default: <code>10</code>)</strong></p>
</dd>
<dt class="hdlist1">names</dt>
<dd>
<p>the field names in the CSV file <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the JDBC password <strong>(Password, no default)</strong></p>
</dd>
<dt class="hdlist1">removeAbandoned</dt>
<dd>
<p>flag to remove abandoned connections if they exceed the removeAbandonedTimout <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">removeAbandonedTimeout</dt>
<dd>
<p>timeout in seconds before an abandoned connection can be removed <strong>(int, default: <code>60</code>)</strong></p>
</dd>
<dt class="hdlist1">resources</dt>
<dd>
<p>the list of paths to import (Spring resources) <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">restartable</dt>
<dd>
<p>whether the job should be restartable or not in case of failure <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">suspectTimeout</dt>
<dd>
<p>this simply logs the warning after timeout, connection remains <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">tableName</dt>
<dd>
<p>the database table to which the data will be written <strong>(String, default: <code>&lt;job name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">testOnBorrow</dt>
<dd>
<p>indication of whether objects will be validated before being borrowed from the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testOnReturn</dt>
<dd>
<p>indication of whether objects will be validated before being returned to the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testWhileIdle</dt>
<dd>
<p>indication of whether objects will be validated by the idle object evictor <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">timeBetweenEvictionRunsMillis</dt>
<dd>
<p>number of milliseconds to sleep between runs of the idle connection validation/cleaner thread <strong>(int, default: <code>5000</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>the JDBC URL for the database <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">useEquals</dt>
<dd>
<p>true if you wish the ProxyConnection class to use String.equals <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the JDBC username <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validationInterval</dt>
<dd>
<p>avoid excess validation, only run validation at most at this frequency - time in milliseconds <strong>(long, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">validationQuery</dt>
<dd>
<p>sql query that will be used to validate connections from this pool <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validatorClassName</dt>
<dd>
<p>name of a class which implements the org.apache.tomcat.jdbc.pool.Validator <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The connection pool settings for xd are located in servers.yml (i.e. <code>spring.datasource.*</code> )
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_jdbc_to_hdfs_import_code_jdbchdfs_code">JDBC to HDFS Import (<code>jdbchdfs</code>)</h4>
<div class="paragraph">
<p>Performs the reverse of the previous module. The database configuration is the same as for <code>filejdbc</code> but without the initialization options since you need to already have the data to import into HDFS. When creating the job, you must either supply the select statement by setting the <code>sql</code> parameter, or you can supply both <code>tableName</code> and <code>columns</code> options (which will be used to build the SQL statement).</p>
</div>
<div class="paragraph">
<p>To import data from the database table <code>some_table</code>, you could use</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job create myjob --definition "jdbchdfs --sql='select col1,col2,col3 from some_table'" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>You can customize how the data is written to HDFS by supplying the options <code>directory</code> (defaults to <code>/xd/(job name)</code>), <code>fileName</code> (defaults to job name), <code>rollover</code> (in bytes, default 1000000) and <code>fileExtension</code> (defaults to <em>csv</em>).</p>
</div>
<div class="paragraph">
<p>Launch the job using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job launch myjob</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>jdbchdfs</strong> job has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">abandonWhenPercentageFull</dt>
<dd>
<p>connections that have timed out wont get closed and reported up unless the number of connections in use are above the percentage <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">alternateUsernameAllowed</dt>
<dd>
<p>uses an alternate user name if connection fails <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">columns</dt>
<dd>
<p>the column names to read from the supplied table <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">connectionProperties</dt>
<dd>
<p>connection properties that will be sent to our JDBC driver when establishing new connections <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">delimiter</dt>
<dd>
<p>the delimiter for the delimited file <strong>(String, default: <code>,</code>)</strong></p>
</dd>
<dt class="hdlist1">directory</dt>
<dd>
<p>the directory to write the file(s) to in HDFS <strong>(String, default: <code>/xd/&lt;job name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">driverClassName</dt>
<dd>
<p>the JDBC driver to use <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">fairQueue</dt>
<dd>
<p>set to true if you wish that calls to getConnection should be treated fairly in a true FIFO fashion <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">fileExtension</dt>
<dd>
<p>the file extension to use <strong>(String, default: <code>csv</code>)</strong></p>
</dd>
<dt class="hdlist1">fileName</dt>
<dd>
<p>the filename to use in HDFS <strong>(String, default: <code>&lt;job name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">fsUri</dt>
<dd>
<p>the URI to use to access the Hadoop FileSystem <strong>(String, default: <code>${spring.hadoop.fsUri}</code>)</strong></p>
</dd>
<dt class="hdlist1">initSQL</dt>
<dd>
<p>custom query to be run when a connection is first created <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">initialSize</dt>
<dd>
<p>initial number of connections that are created when the pool is started <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">jdbcInterceptors</dt>
<dd>
<p>semicolon separated list of classnames extending org.apache.tomcat.jdbc.pool.JdbcInterceptor <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">jmxEnabled</dt>
<dd>
<p>register the pool with JMX or not <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">logAbandoned</dt>
<dd>
<p>flag to log stack traces for application code which abandoned a Connection <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">maxActive</dt>
<dd>
<p>maximum number of active connections that can be allocated from this pool at the same time <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxAge</dt>
<dd>
<p>time in milliseconds to keep this connection <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">maxIdle</dt>
<dd>
<p>maximum number of connections that should be kept in the pool at all times <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxWait</dt>
<dd>
<p>maximum number of milliseconds that the pool will wait for a connection <strong>(int, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">minEvictableIdleTimeMillis</dt>
<dd>
<p>minimum amount of time an object may sit idle in the pool before it is eligible for eviction <strong>(int, default: <code>60000</code>)</strong></p>
</dd>
<dt class="hdlist1">minIdle</dt>
<dd>
<p>minimum number of established connections that should be kept in the pool at all times <strong>(int, default: <code>10</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the JDBC password <strong>(Password, no default)</strong></p>
</dd>
<dt class="hdlist1">removeAbandoned</dt>
<dd>
<p>flag to remove abandoned connections if they exceed the removeAbandonedTimout <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">removeAbandonedTimeout</dt>
<dd>
<p>timeout in seconds before an abandoned connection can be removed <strong>(int, default: <code>60</code>)</strong></p>
</dd>
<dt class="hdlist1">restartable</dt>
<dd>
<p>whether the job should be restartable or not in case of failure <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">rollover</dt>
<dd>
<p>the number of bytes to write before creating a new file in HDFS <strong>(int, default: <code>1000000</code>)</strong></p>
</dd>
<dt class="hdlist1">sql</dt>
<dd>
<p>the SQL to use to extract data <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">suspectTimeout</dt>
<dd>
<p>this simply logs the warning after timeout, connection remains <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">tableName</dt>
<dd>
<p>the table to read data from <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">testOnBorrow</dt>
<dd>
<p>indication of whether objects will be validated before being borrowed from the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testOnReturn</dt>
<dd>
<p>indication of whether objects will be validated before being returned to the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testWhileIdle</dt>
<dd>
<p>indication of whether objects will be validated by the idle object evictor <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">timeBetweenEvictionRunsMillis</dt>
<dd>
<p>number of milliseconds to sleep between runs of the idle connection validation/cleaner thread <strong>(int, default: <code>5000</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>the JDBC URL for the database <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">useEquals</dt>
<dd>
<p>true if you wish the ProxyConnection class to use String.equals <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the JDBC username <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validationInterval</dt>
<dd>
<p>avoid excess validation, only run validation at most at this frequency - time in milliseconds <strong>(long, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">validationQuery</dt>
<dd>
<p>sql query that will be used to validate connections from this pool <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validatorClassName</dt>
<dd>
<p>name of a class which implements the org.apache.tomcat.jdbc.pool.Validator <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The connection pool settings for xd are located in servers.yml (i.e. <code>spring.datasource.*</code> )
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hdfs_to_mongodb_export_code_hdfsmongodb_code">HDFS to MongoDB Export (<code>hdfsmongodb</code>)</h4>
<div class="paragraph">
<p>Exports CSV data from HDFS and stores it in a MongoDB collection which defaults to the job name. This can be overridden with the <code>collectionName</code> parameter. Once again, the field names should be defined by supplying the <code>names</code> parameter. The data is converted internally to a Spring XD <code>Tuple</code> and the collection items will have an <code>id</code> matching the tuple&#8217;s UUID. You can override this by setting the <code>idField</code> parameter to one of the field names if desired.</p>
</div>
<div class="paragraph">
<p>An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job create myjob --definition "hdfsmongodb --resources=/data/*.log --names=employeeId,forename,surname,address --idField=employeeId --collectionName=people" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>hdfsmongodb</strong> job has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectionName</dt>
<dd>
<p>the MongoDB collection to store <strong>(String, default: <code>&lt;job name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">databaseName</dt>
<dd>
<p>the MongoDB database name <strong>(String, default: <code>xd</code>)</strong></p>
</dd>
<dt class="hdlist1">delimiter</dt>
<dd>
<p>the delimiter for the delimited file <strong>(String, default: <code>,</code>)</strong></p>
</dd>
<dt class="hdlist1">fsUri</dt>
<dd>
<p>the URI to use to access the Hadoop FileSystem <strong>(String, default: <code>${spring.hadoop.fsUri}</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>the MongoDB host <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">idField</dt>
<dd>
<p>the name of the field to use as the identity in MongoDB <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">names</dt>
<dd>
<p>the field names in the CSV file <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the MongoDB port <strong>(int, default: <code>27017</code>)</strong></p>
</dd>
<dt class="hdlist1">resources</dt>
<dd>
<p>the list of paths to import (Spring resources) <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">restartable</dt>
<dd>
<p>whether the job should be restartable or not in case of failure <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_ftp_to_hdfs_export_code_ftphdfs_code">FTP to HDFS Export (<code>ftphdfs</code>)</h4>
<div class="paragraph">
<p>Copies files from FTP directory into HDFS. Job is partitioned in a way that each
separate file copy is executed on its own partitioned step.</p>
</div>
<div class="paragraph">
<p>An example which copies files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>job create --name ftphdfsjob --definition "ftphdfs --host=ftp.example.com --port=21" --deploy
job launch --name ftphdfsjob --params {"remoteDirectory":"/pub/files","hdfsDirectory":"/ftp"}</pre>
</div>
</div>
<div class="paragraph">
<p>Full path is preserved so that above command would result files in HDFS shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/ftp/pub/files
/ftp/pub/files/file1.txt
/ftp/pub/files/file2.txt</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>ftphdfs</strong> job has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">fsUri</dt>
<dd>
<p>the URI to use to access the Hadoop FileSystem <strong>(String, default: <code>${spring.hadoop.fsUri}</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>the host name for the FTP server <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">partitionResultsTimeout</dt>
<dd>
<p>time (ms) that the partition handler will wait for results <strong>(long, default: <code>300000</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password for the FTP connection <strong>(Password, no default)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port for the FTP server <strong>(int, default: <code>21</code>)</strong></p>
</dd>
<dt class="hdlist1">restartable</dt>
<dd>
<p>whether the job should be restartable or not in case of failure <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username for the FTP connection <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="streams">Streams</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_10">Introduction</h3>
<div class="paragraph">
<p>In Spring XD, a basic stream defines the ingestion of event driven data from a <em>source</em> to a <em>sink</em> that passes through any number of <em>processors</em>.  Stream processing is performed inside the XD Containers and the deployment of stream definitions to containers is done via the XD Admin Server.  The <a href="#getting-started">Getting Started</a> section shows you how to start these servers and how to start and use the Spring XD shell</p>
</div>
<div class="paragraph">
<p>Sources, sinks and processors are predefined configurations of a <em>module</em>.  Module definitions are found in the <code>xd/modules</code> directory.  <span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span>.  Modules definitions are standard Spring configuration files that use existing Spring classes, such as <a href="http://static.springsource.org/spring-integration/reference/htmlsingle/#spring-integration-adapters">Input/Output adapters</a> and <a href="http://static.springsource.org/spring-integration/reference/htmlsingle/#transformer">Transformers</a> from Spring Integration that support general <a href="http://www.eaipatterns.com/">Enterprise Integration Patterns</a>.</p>
</div>
<div class="paragraph">
<p>A high level DSL is used to create stream definitions. The DSL to define a stream that has an http source and a file sink (with no processors) is shown below</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http | file</pre>
</div>
</div>
<div class="paragraph">
<p>The DSL mimics a UNIX pipes and filters syntax. Default values for ports and filenames are used in this example but can be overriden using <code>--</code> options, such as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http --port=8091 | file --dir=/tmp/httpdata/</pre>
</div>
</div>
<div class="paragraph">
<p>To create these stream definitions you make an HTTP POST request to the XD Admin Server.  More details can be found in the sections below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_simple_stream">Creating a Simple Stream</h3>
<div class="paragraph">
<p>The XD Admin server <span class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</span> exposes a full RESTful API for managing the lifecycle of stream definitions, but the easiest way to use the XD shell. Start the shell as described in the <a href="#getting-started">Getting Started</a> section</p>
</div>
<div class="paragraph">
<p>New streams are created by posting stream definitions.  The definitions are built from a simple DSL. For example, let&#8217;s walk through what happens if we execute the following shell command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --definition "time | log" --name ticktock</pre>
</div>
</div>
<div class="paragraph">
<p>This defines a stream named <code>ticktock</code> based off the DSL expression <code>time | log</code>.  The DSL uses the "pipe" symbol <code>|</code>, to connect a source to a sink.</p>
</div>
<div class="paragraph">
<p>Then to deploy the stream execute the following shell command (or alternatively add the <code>--deploy</code> flag when creating the stream so that this step is not needed):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream deploy --name ticktock</pre>
</div>
</div>
<div class="paragraph">
<p>The stream server finds the <code>time</code> and <code>log</code> definitions in the modules directory and uses them to setup the stream.  In this simple example, the time source simply sends the current time as a message each second, and the log sink outputs it using the logging framework.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>processing module 'Module [name=log, type=sink]' from group 'ticktock' with index: 1
processing module 'Module [name=time, type=source]' from group 'ticktock' with index: 0
17:26:18,774  WARN ThreadPoolTaskScheduler-1 logger.ticktock:141 - Thu May 23 17:26:18 EDT 2013</pre>
</div>
</div>
<div class="paragraph">
<p>If you would like to have multiple instances of a module in the stream, you can include a property with the deploy command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream deploy --name ticktock --properties "module.time.count=3"</pre>
</div>
</div>
<div class="paragraph">
<p>You can also include a <a href="http://docs.spring.io/spring/docs/4.0.x/spring-framework-reference/htmlsingle/#expressions">SpEL Expression</a> as a <code>criteria</code> property for any module. That will be evaluated against the attributes of each currently available Container. Instances of the module will only be deployed to Containers for which the expression evaluates to true.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream deploy --name ticktock --properties "module.time.count=3,module.log.criteria=groups.contains('x')"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deleting_a_stream">Deleting a Stream</h3>
<div class="paragraph">
<p>You can delete a stream by issuing the <code>stream destroy</code> command from the shell:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream destroy --name ticktock</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_and_undeploying_streams">Deploying and Undeploying Streams</h3>
<div class="paragraph">
<p>Often you will want to stop a stream, but retain the name and definition for future use. In that case you can <code>undeploy</code> the stream by name and issue the <code>deploy</code> command at a later time to restart it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream undeploy --name ticktock
xd:&gt; stream deploy --name ticktock</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_other_source_and_sink_types">Other Source and Sink Types</h3>
<div class="paragraph">
<p>Let&#8217;s try something a bit more complicated and swap out the <code>time</code> source for something else. Another supported source type is <code>http</code>, which accepts data for ingestion over HTTP POSTs. Note that the <code>http</code> source accepts data on a different port (default 9000) from the Admin Server (default 8080).</p>
</div>
<div class="paragraph">
<p>To create a stream using an <code>http</code> source, but still using the same <code>log</code> sink, we would change the original command above to</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --definition "http | log" --name myhttpstream --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>which will produce the following output from the server</p>
</div>
<div class="literalblock">
<div class="content">
<pre>processing module 'Module [name=log, type=sink]' from group 'myhttpstream' with index: 1
processing module 'Module [name=http, type=source]' from group 'myhttpstream' with index: 0</pre>
</div>
</div>
<div class="paragraph">
<p>Note that we don&#8217;t see any other output this time until we actually post some data (using shell command)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9000 --data "hello"
xd:&gt; http post --target http://localhost:9000 --data "goodbye"</pre>
</div>
</div>
<div class="paragraph">
<p>and the stream will then funnel the data from the http source to the output log implemented by the log sink</p>
</div>
<div class="literalblock">
<div class="content">
<pre>15:08:01,676  WARN ThreadPoolTaskScheduler-1 logger.myhttpstream:141 - hello
15:08:12,520  WARN ThreadPoolTaskScheduler-1 logger.myhttpstream:141 - goodbye</pre>
</div>
</div>
<div class="paragraph">
<p>Of course, we could also change the sink implementation. You could pipe the output to a file (<code>file</code>), to hadoop (<code>hdfs</code>) or to any of the other sink modules which are provided. You can also define your own <a href="#modules">modules</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_simple_stream_processing">Simple Stream Processing</h3>
<div class="paragraph">
<p>As an example of a simple processing step, we can transform the payload of the HTTP posted data to upper case using the stream definitions</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http | transform --expression=payload.toUpperCase() | log</pre>
</div>
</div>
<div class="paragraph">
<p>To create this stream enter the following command in the shell</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --definition "http | transform --expression=payload.toUpperCase() | log" --name myprocstrem --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Posting some data (using shell command)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9000 --data "hello"</pre>
</div>
</div>
<div class="paragraph">
<p>Will result in an uppercased <em>hello</em> in the log</p>
</div>
<div class="literalblock">
<div class="content">
<pre>15:18:21,345  WARN ThreadPoolTaskScheduler-1 logger.myprocstream:141 - HELLO</pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="#processors">Processors</a> section for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dsl_syntax">DSL Syntax</h3>
<div class="paragraph">
<p>In the examples above, we connected a source to a sink using the pipe symbol <code>|</code>. You can also pass parameters to the source and sink configurations. The parameter names will depend on the individual module implementations, but as an example, the <code>http</code> source module exposes a <code>port</code> setting which allows you to change the data ingestion port from the default value. To create the stream using port 8000, we would use</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --definition "http --port=8000 | log" --name myhttpstream</pre>
</div>
</div>
<div class="paragraph">
<p>If you know a bit about Spring configuration files, you can inspect the module definition to see which properties it exposes. Alternatively, you can read more in the <a href="#sources">source</a> and <a href="#sinks">sink</a> documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_features">Advanced Features</h3>
<div class="paragraph">
<p>In the examples above, simple module definitions are used to construct each stream. However, modules may be grouped together in order to avoid duplication and/or reduce the amount of chattiness over the messaging middleware. To learn more about that feature, refer to the <a href="#composing-modules">Composing Modules</a> section.</p>
</div>
<div class="paragraph">
<p>If directed graphs are needed instead of the simple linear streams described above, two features are relevant. First, named channels may be used as a way to combine multiple flows upstream and/or downstream from the channel. The behavior of that channel may either be queue-based or topic-based depending on what prefix is used ("queue:myqueue" or "topic:mytopic", respectively). To learn more, refer to the <a href="#named-channels">Named Channels</a> section. Second, you may need to determine the output channel of a stream based on some information that is only known at runtime. To learn about such content-based routing, refer to the <a href="#router_sink">Dynamic Router</a> section.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modules">Modules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_11">Introduction</h3>
<div class="paragraph">
<p>Spring XD supports data ingestion by allowing users to define <a href="#streams">streams</a>. Streams are composed of <em>modules</em> which encapsulate a unit of work into a reusable component.</p>
</div>
<div class="paragraph">
<p>Modules are categorized by type, typically representing the role or function of the module. Current Spring XD module types include <code>source</code>, <code>sink</code>, <code>processor</code>, and <code>job</code>. The type indicates how the modules may be composed in a stream, or used to deploy a batch job. Specifically, a source polls an external resource, or is triggered by an event and only provides an output. The first module in a stream must be a source. A processor performs some type of transformation or business logic on the message and requires both an input and output. A sink provides only an input and outputs data to an external resource to terminate the stream. A job module implements a Spring Batch job.</p>
</div>
<div class="paragraph">
<p>Spring XD comes with a number of modules useful for assembling streams which perform common input and/or output operations using files, HDFS, http, twitter, syslog, GemFire, and more. Users can easily assemble these modules into streams to build complex big data applications declaratively, without having to know the underlying Spring products on which Spring XD is built.</p>
</div>
<div class="paragraph">
<p>However, if you are interested in extending Spring XD with your own modules, some knowledge of Spring, Spring Integration, and Spring Batch is essential. The remainder of this document assumes the reader has some familiarity with these topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_module">Creating a Module</h3>
<div class="paragraph">
<p>This section provides details on how to write and register custom modules. For a quick start, dive into the examples of creating <a href="#creating-a-source-module">source</a>, <a href="#creating-a-processor-module">processor</a>, and <a href="#creating-a-sink-module">sink</a> modules.</p>
</div>
<div class="paragraph">
<p>A <a href="https://github.com/SpringSource/spring-xd/blob/master/spring-xd-module/src/main/java/org/springframework/xd/module/ModuleDefinition.java">ModuleDefinition</a> has the following required attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name - the name of the component, normally a single word representing the purpose of the module. Examples are <em>file</em>, <em>http</em>, <em>syslog</em>.</p>
</li>
<li>
<p>type - the module type, current XD module types include <em>source</em>, <em>sink</em>, and <em>processor</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_modules_and_spring">Modules and Spring</h4>
<div class="paragraph">
<p>At the core, a module is any component that may be implemented using a Spring application context. In this respect, the concept may be extended for purposes other than data ingestion. The types mentioned above (source, processor,sink) are specific to Spring XD and constructing streams. But other module types are envisioned.</p>
</div>
<div class="paragraph">
<p>A module is typically configured using property placeholders which are bound to the module&#8217;s options. Options may be required or optional where optional properties define a default value in <a href="ModuleOptionsMetadata">Module Options Metadata</a>. Module options metadata may be provided in a properties file or a Java class.</p>
</div>
<div class="paragraph">
<p>For example, here is part of the Spring configuration for the <em>twittersearch</em> source that runs a query against Twitter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;beans&gt;

  &lt;bean class="org.springframework.integration.x.twitter.TwitterSearchChannelAdapter"&gt;
    &lt;constructor-arg ref="twitterTemplate"/&gt;
    &lt;property name="readTimeout" value="${readTimeout}"/&gt;
    &lt;property name="connectTimeout" value="${connectTimeout}"/&gt;
    &lt;property name="autoStartup" value="false"/&gt;
    &lt;property name="outputChannel" ref="output"/&gt;
    &lt;property name="query" value="${query}" /&gt;
    &lt;property name="language" value="${language}" /&gt;
    &lt;property name="geocode" value="${geocode}" /&gt;
    &lt;property name="resultType" value="${resultType}"/&gt;
    &lt;property name="includeEntities" value="${includeEntities}"/&gt;
  &lt;/bean&gt;

  &lt;bean id="twitterTemplate" class="org.springframework.social.twitter.api.impl.TwitterTemplate"&gt;
    &lt;constructor-arg value="${consumerKey}"/&gt;
    &lt;constructor-arg value="${consumerSecret}"/&gt;
  &lt;/bean&gt;

  &lt;int:channel id="output"/&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the property placeholders such as <em>query</em>, <em>language</em>, <em>consumerKey</em> and <em>consumerSecret</em>. Spring XD will substitute values for all of these properties as configured for each module instance. The options for this module are defined in <a href="https://github.com/spring-projects/spring-xd/blob/master/extensions/spring-xd-extension-twitter/src/main/java/org/springframework/integration/x/twitter/TwitterSearchOptionsMetadata.java">TwitterSearchOptionsMetadata.java</a></p>
</div>
<div class="paragraph">
<p>For example, we can create two different streams, each using the <em>twittersearch</em> source with a different configuration.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tweettest --definition "twittersearch --query='java' | file"</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tweettest2 --definition "twittersearch --query='spring' --language=en --consumerKey='mykey' --consumerSecret='mysecret' | file"</pre>
</div>
</div>
<div class="paragraph">
<p>In addition to options, modules may reference Spring beans such that each module instance may inject a different implementation of a bean. The ability to deploy the same module definition with different configurations is only possible because each module is created in its own application context. This results in some very useful features, such as the ability to use standard bean ids such as <em>input</em> and <em>output</em> and simple property names without having to worry about naming collisions. Overall, this allows modules to adhere to the KISS principle.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stream_modules">Stream Modules</h4>
<div class="paragraph">
<p>Sources, Processors, and Sinks are built using <a href="http://spring.io/spring-integration">Spring Integration</a> and are typically perform one small task so that they may be easily reused. In Spring Integration terms,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>source</em> is a valid message flow that contains a direct channel named <em>output</em> which is fed by an inbound adapter, either configured with a poller, or triggered by an event.</p>
</li>
<li>
<p>A <em>processor</em> is a valid message flow that contains a direct channel named <em>input</em> and a subscribable channel named <em>output</em> (direct or publish subscribe). It typically performs some type of transformation on the message, using the message contents to create a new message.</p>
</li>
<li>
<p>A <em>sink</em> is a valid message flow that contains a direct channel named <em>input</em> and an outbound adapter, or service activator used to provide the message to an external resource, HDFS for example.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, take a look at the <a href="https://github.com/spring-projects/spring-xd/blob/master/modules/source/file/config/file.xml">file source</a> which simply polls a directory using a file inbound adapter and <a href="https://github.com/spring-projects/spring-xd/blob/master/modules/sink/file/config/file.xml">file sink</a> which appends an incoming message payload to a file using a file outbound adapter. On the surface, there is nothing special about these components. They are plain old Spring XML bean definition files.</p>
</div>
<div class="paragraph">
<p>Upon closer inspection, you will notice that modules adhere to some important conventions. For one thing, the file name is the module name. Also note the input and output channels are always named  <em>input</em> and <em>output</em>, in keeping with the KISS principle (let us know if you come up with some simpler names). These names are required to bind these channels to the messaging transport.</p>
</div>
<div class="paragraph">
<p>Also observe the use of property placeholders with sensible defaults where possible.  For example, the file source requires a directory. An appropriate strategy is to define a common root path for XD input files (At the time of this writing it is /tmp/xd/input/. This is subject to change, but illustrates the point). A stream definition using the file source may specify the the directory name by providing a value for the <em>dir</em> option. If not provided, it will default to the stream name, which is contained in the <code>xd.stream.name</code> property provided to the module by the Spring XD runtime, see <a href="https://github.com/spring-projects/spring-xd/blob/master/modules/source/file/config/file.properties">file source metadata</a>. By convention, XD defined properties are prefixed with <em>xd</em>. This can be seen when using the <code>module info</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;module info --name source:file
Information about source module 'file':

  Option Name        Description                                                                  Default                          Type
  -----------------  ---------------------------------------------------------------------------  -------------------------------  --------
  dir                the absolute path to the directory to monitor for files                      /tmp/xd/input/${xd.stream.name}  String
  pattern            a filter expression (Ant style) to accept only files that match the pattern  *                                String
  preventDuplicates  whether to prevent the same file from being processed twice                  true                             boolean
  ref                set to true to output the File object itself                                 false                            boolean
  fixedDelay         the fixed delay polling interval specified in seconds                        5                                int
  outputType         how this module should emit messages it produces                             &lt;none&gt;                           MimeType</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_placeholders_available_to_all_modules">Placeholders available to all modules</h4>
<div class="paragraph">
<p>Below is the list of all available <code>${xd.xxx}</code> keys that module authors may use in their declaration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Using placeholders in stream definitions</div>
<div class="paragraph">
<p>One can also use the <code>${xd.xxx}</code> notation directly inside the DSL definition of a stream or a job. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create foo --definition "http | filter --expression=\"'${xd.stream.name}'\" | log"</pre>
</div>
</div>
<div class="paragraph">
<p>will only let messages that read "foo" pass through.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Placeholder</th>
<th class="tableblock halign-left valign-top">Context</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.stream.name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the stream the module lives in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.job.name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the job the module lives in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.module.name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams, jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the technical name of the module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.module.type}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams, jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the type of the module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.module.index}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the 0-based position of the module inside the stream</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.container.id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams, jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the generated unique id of the container the module is deployed in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.container.host}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams, jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the hostname of the container the module is deployed in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.container.pid}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams, jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the process id of the container the module is deployed in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.container.ip}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams, jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the IP address of the container the module is deployed in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${xd.container.&lt;foo&gt;}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">streams, jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the value of the custom attribute <code>&lt;foo&gt;</code> for the container</p></td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sect2">
<h3 id="_registering_a_module">Registering a Module</h3>
<div class="paragraph">
<p>Spring XD provides a strategy interface <a href="https://github.com/SpringSource/spring-xd/blob/master/spring-xd-dirt/src/main/java/org/springframework/xd/dirt/module/ModuleRegistry.java">ModuleRegistry</a> which it uses to find a module of a given name and type. Currently XD provides RedisModuleRegistry and FileModuleRegistry, The ModuleRegistry is a required component for the Spring XD runtime. By default the Spring XD is configured with the FileModuleRegistry which looks for modules in <code>${xd.home:..}/modules</code>. Where <code>xd.home</code> is set by the environment variable <code>XD_HOME</code> or passed as a Java System property to the container launcher, . So out of the box, the modules are contained in the xd/modules directory where Spring XD is installed. The modules directory organizes module types in sub-directories. So you will see something like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>modules/processor
modules/sink
modules/source</pre>
</div>
</div>
<div class="paragraph">
<p>To register a module simply drop your module files (XML configuration, options metadata, and any dependent jars that are not already on the Spring XD classpath) into the xd/modules directory.</p>
</div>
<div class="sect3">
<h4 id="_modules_with_isolated_classpath">Modules with isolated classpath</h4>
<div class="paragraph">
<p>In addition to the simple format described above, where you would have a <code>foo</code> source module implemented as a <code>modules/source/foo.xml</code> file, there is also support for modules that have specific library dependencies.</p>
</div>
<div class="paragraph">
<p>This is accomplished by creating a <em>folder</em> named after your module name and moving the xml file to a <code>config</code> subdirectory. As an example, the <code>foo.xml</code> file would then reside in</p>
</div>
<div class="literalblock">
<div class="content">
<pre>modules/source/foo/config/foo.xml</pre>
</div>
</div>
<div class="paragraph">
<p>Additional jar files can then be added to a sibling <code>lib</code> directory, like so:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>modules/source/foo/
                   config/
                          foo.xml
                   lib/
                       commons-foo.jar
                       foo-ext.jar</pre>
</div>
</div>
<div class="paragraph">
<p>Classes will first be loaded from any of the aforementioned jar files and, only if they&#8217;re not found will they be loaded from the parent, global ClassLoader that Spring XD normally uses. Still, there are a couple of caveats that one should be aware of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Refrain from putting into the <code>lib/</code> folder jar files that are also part of Spring XD, or you&#8217;ll likely end up with ClassCastExceptions</p>
</li>
<li>
<p>Any class that is directly or indirectly referenced from the payload type of your messages (<em>i.e.</em> the types that transit from module to module) must not belong to a particular module <code>lib/</code> folder but should rather be loaded by the global Spring XD classloader (installed into xd/lib).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="composing-modules">Composing Modules</h3>
<div class="paragraph">
<p>As described above, a stream is defined as a sequence of modules, minimally a source module followed by a sink module. One or more processor modules may be added in between the source and sink, but they are not mandatory. Sometimes streams share a common processing chain. For example, consider the following two streams:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream1 = http | filter --expression=payload.contains('foo') | file
stream2 = file | filter --expression=payload.contains('foo') | file</pre>
</div>
</div>
<div class="paragraph">
<p>Other than the source module, the definitions of these two streams are the same. Composite Modules are a good way to avoid this type of duplication. In addition, Composite modules are co-located in a single container and may communicate directly in memory.</p>
</div>
<div class="paragraph">
<p>Each module within a stream represents a unit of deployment. Therefore, in each of the streams defined above, there would be 3 such units (the source, the processor, and the sink). In a singlenode runtime, it doesn&#8217;t make much of a difference since the communication between modules uses a bridge between in-memory channels. When deploying a stream to a distributed runtime environment, however, the communication between each module typically occurs over messaging middleware, as modules are distributed evenly among the available containers. At times a stream will perform better if adjacent modules are co-located and can avoid middleware "hops". In such cases, you may wrap multiple modules together so that they act as a single "black box." In other words, if "foo | bar" are composed together as a new module named "baz", the input and/or output to "baz" will still go over the middleware, but foo and bar will be co-located and communicate via a local memory.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at an example. Returning to the two similar streams above, the filter processor and file sink may be combined into a single module using the <code>module compose</code> shell command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; module compose foo --definition "filter --expression=payload.contains('foo') | file"</pre>
</div>
</div>
<div class="paragraph">
<p>Then, to verify the new module composition was successful, check if it exists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;module list
      Source              Processor           Sink                     Job
  ------------------  ------------------  -----------------------  ----------------
      file                aggregator          aggregate-counter        filejdbc
      gemfire             http-client         counter                  ftphdfs

                                   (....)

      trigger                                 splunk
      twittersearch                           tcp
      twitterstream                           throughput-sampler
      time                                (c) foo</pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the composed module shows up in the list of <strong>sink</strong> modules. That is because logically it acts as a sink: It provides an input channel (which is bridged to the filter processor&#8217;s input channel), but it provides no output channel (since the file sink has no output). Also notice that the module has a small <code>(c)</code> prefixed to it, to indicate that it is a composed module.</p>
</div>
<div class="paragraph">
<p>If a module were composed of two processors, it would be classified as a processor:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; module compose myprocessor --definition "splitter | filter --expression=payload.contains('foo')"</pre>
</div>
</div>
<div class="paragraph">
<p>If a module were composed of a source and a processor, it would be classified as a source:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; module compose mysource --definition "http | filter --expression=payload.contains('foo')"</pre>
</div>
</div>
<div class="paragraph">
<p>Based on the logical type of the composed module, it may be used in a stream as if it were a simple module instance. For example, to redefine the two streams from the first problem case above, now that the "foo" sink module has been composed, you would issue the following shell commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create httpfoo --definition "http | foo" --deploy
xd:&gt; stream create filefoo --definition "file --outputType=text/plain | foo"  --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>To test the "httpfoo" stream, try the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --data hi
xd:&gt; http post --data hifoo</pre>
</div>
</div>
<div class="paragraph">
<p>The first message should have been ignored due to the filter, but the second one should exist in the file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; ! cat /tmp/xd/output/httpfoo.out
command is:cat /tmp/xd/output/httpfoo.out
hifoo</pre>
</div>
</div>
<div class="paragraph">
<p>To test the "filefoo" stream, echo "foo" to a file in the /tmp/xd/input/filefoo directory, then verify:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; ! cat /tmp/xd/output/filefoo.out
command is:cat /tmp/xd/output/filefoo.out
foo</pre>
</div>
</div>
<div class="paragraph">
<p>When you no longer need a composed module, you may delete it with the "module delete" command in the shell. However, if that composed module is currently being used by one or more streams, the deletion will fail as shown below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; module delete --name sink:foo
16:51:37,349  WARN Spring Shell client.RestTemplate:566 - DELETE request for "http://localhost:9393/modules/sink/foo" resulted in 500 (Internal Server Error); invoking error handler
Command failed org.springframework.xd.rest.client.impl.SpringXDException: Cannot delete module sink:foo because it is used by [stream:filefoo, stream:httpfoo]</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the failure message shows which stream(s) depend upon the composed module you are trying to delete.</p>
</div>
<div class="paragraph">
<p>If you destroy both of those streams and try again, it will work:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream destroy --name filefoo
Destroyed stream 'filefoo'
xd:&gt; stream destroy --name httpfoo
Destroyed stream 'httpfoo'
xd:&gt; module delete --name sink:foo
Successfully destroyed module 'foo' with type sink</pre>
</div>
</div>
<div class="paragraph">
<p>When creating a module, if you duplicate the name of an existing module for the same type, you will receive an error.  In the example below the user tried to compose a tcp module, however one already exists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;module compose tcp --definition "filter --expression=payload.contains('foo') | file"
14:52:27,781  WARN Spring Shell client.RestTemplate:566 - POST request for "http://ec2-50-16-24-31.compute-1.amazonaws.com:9393/modules" resulted in 409 (Conflict); invoking error handler
Command failed org.springframework.xd.rest.client.impl.SpringXDException: There is already a module named 'tcp' with type 'sink'</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, you can create a module for a given type even though a module of that name exists but as a different type.  For example: I can create a sink module named filter, even though a filter module exists already as a processor.</p>
</div>
<div class="paragraph">
<p>Finally, it&#8217;s worth mentioning that in some cases duplication may be avoided by reusing an actual stream rather than a composed module. This is possible when named channels are used in the source and/or sink position of a stream definition. For example, the same overall functionality as provided by the two streams above could also be achieved as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create foofilteredfile --definition "queue:foo &gt; filter --expression=payload.contains('foo') | file"
xd:&gt; stream create httpfoo --definition "http &gt; queue:foo"
xd:&gt; stream create filefoo --definition "file &gt; queue:foo"</pre>
</div>
</div>
<div class="paragraph">
<p>This approach is more appropriate for use-cases where individual streams on either side of the named channel may need to be deployed or undeployed independently. Whereas the queue typed channel will load-balance across multiple downstream consumers, the "topic:" prefix may be used if broadcast behavior is needed instead. For more information about named channels, refer to the <a href="#named-channels">Named Channels</a> section.</p>
</div>
</div>
<div class="sect2">
<h3 id="module_info">Getting Information about Modules</h3>
<div class="paragraph">
<p>To view the available modules use the the <code>module list</code> command.  Modules appearing with a <code>(c)</code> marker are composed modules.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;module list
      Source              Processor           Sink                     Job
  ------------------  ------------------  -----------------------  ----------------
      file                aggregator          aggregate-counter        filejdbc
      gemfire             analytic-pmml       counter                  ftphdfs
      gemfire-cq          http-client         field-value-counter      hdfsjdbc
      http                bridge              file                     hdfsmongodb
      jms                 filter              gauge                    jdbchdfs
      mail                json-to-tuple       gemfire-json-server      filepollhdfs
      mqtt                object-to-json      gemfire-server
      post                script              jdbc
      reactor-syslog      splitter            mail
      reactor-tcp         transform           mqtt
      syslog-tcp      (c) myfilter            rich-gauge
      syslog-udp                              splunk
      tail                                    tcp
      tcp                                     throughput-sampler
      tcp-client                              avro
      trigger                                 hdfs
      twittersearch                           log
      twitterstream                           rabbit
      rabbit                                  router
      time</pre>
</div>
</div>
<div class="paragraph">
<p>To get information about a particular module (such as what options it accepts), use the <code>module info --&lt;module type&gt;:&lt;module name&gt;</code> command. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;module info --name source:file
Information about source module 'file':

  Option Name        Description                                                                  Default  Type
  -----------------  ---------------------------------------------------------------------------  -------  ---------
  dir                the absolute path to the directory to monitor for files                      &lt;none&gt;   String
  pattern            a filter expression (Ant style) to accept only files that match the pattern  *        String
  outputType         how this module should emit messages it produces                             &lt;none&gt;   MimeType
  preventDuplicates  whether to prevent the same file from being processed twice                  true     boolean
  ref                set to true to output the File object itself                                 false    boolean
  fixedDelay         the fixed delay polling interval specified in seconds                        5        int
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="module_values">How module options are resolved</h3>
<div class="paragraph">
<p>As we&#8217;ve seen so far, a module is a re-usable piece of Spring Integration (or Spring Batch) software that can be dynamically configured thru the use of <strong>module options</strong>.</p>
</div>
<div class="paragraph">
<p>A module option is any value that the module author has deemed worthy of configuration at deployment time. Preferably, the module author will have provided <a href="#introduction">metadata</a> to describe the available options. This section explains how default values are computed for each module option.</p>
</div>
<div class="paragraph">
<p>In a nutshell, actual values are drawn from the following 3 sources, from most precedent to least precedent:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>actual values in the stream definition (<em>e.g.</em> <code>--foo=bar</code>)</p>
</li>
<li>
<p>platform-wide defaults (appearing <em>e.g.</em> in .yml and .properties files, see below)</p>
</li>
<li>
<p>defaults the module author chose (see <a href="#introduction">metadata</a>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Going into more detail, the mid layer above (platform-wide defaults) will resolve like so, assuming option <code>&lt;optionname&gt;</code> of module <code>&lt;modulename&gt;</code> (which is of type <code>&lt;moduletype&gt;</code>):</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>a <strong>system property</strong> named <code>&lt;moduletype&gt;.&lt;modulename&gt;.&lt;optionname&gt;</code></p>
</li>
<li>
<p>an <strong>environment variable</strong> named <code>&lt;moduletype&gt;.&lt;modulename&gt;.&lt;optionname&gt;</code> (or <code>&lt;MODULETYPE&gt;_&lt;MODULENAME&gt;_&lt;OPTIONNAME&gt;</code>)</p>
</li>
<li>
<p>a key named <code>&lt;optionname&gt;</code> in the <strong>properties</strong> file <code>&lt;root&gt;/&lt;moduletype&gt;/&lt;modulename&gt;/&lt;modulename&gt;.properties</code></p>
</li>
<li>
<p>a key named <code>&lt;moduletype&gt;.&lt;modulename&gt;.&lt;optionname&gt;</code> in the <strong>YaML</strong> file <code>&lt;root&gt;/&lt;module-config&gt;.yml</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;root&gt;</code></dt>
<dd>
<p>is the value of the <code>xd.module.config.location</code> system property (driven by the <code>XD_MODULE_CONFIG_LOCATION</code> env var when using the canonical Spring XD shell scripts). Defaults to <code>${xd.config.home}/modules/</code></p>
</dd>
<dt class="hdlist1"><code>&lt;module-config&gt;</code></dt>
<dd>
<p>is the value of the <code>xd.module.config.name</code> system property (driven by the <code>XD_MODULE_CONFIG_NAME</code> env var). Defaults to <code>xd-module-config</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note that YaML is particularly well suited for hierarchical configuration, so for example, instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre>source.file.dir: foo
source.file.pattern: *.txt

source.http.port: 1234</pre>
</div>
</div>
<div class="paragraph">
<p>one can write</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">source:
  file:
    dir: foo
    pattern: *.txt
  http:
    port: 1234</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that options in the <code>.properties</code> files can reference values that appear in the <code>modules.yml</code> file (this makes sharing common configuration easy). Also, the values that are used to configure the server runtimes (in <code>servers.yml</code>) are visible to <code>modules.yml</code> and <code>.properties</code> file (but the inverse is <em>not</em> true).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sources">Sources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_12">Introduction</h3>
<div class="paragraph">
<p>In this section we will show some variations on input sources.  As a prerequisite start the XD Container
as instructed in the <a href="#getting-started">Getting Started</a> page.</p>
</div>
<div class="paragraph">
<p>The Sources covered are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#http">HTTP</a></p>
</li>
<li>
<p><a href="#tail">Tail</a></p>
</li>
<li>
<p><a href="#file">File</a></p>
</li>
<li>
<p><a href="#mail_source">Mail</a></p>
</li>
<li>
<p><a href="#twitter-search">Twitter Search</a></p>
</li>
<li>
<p><a href="#twitter-stream">Twitter Stream</a></p>
</li>
<li>
<p><a href="#gemfire-source">Gemfire</a></p>
</li>
<li>
<p><a href="#gemfire-continuous-query">Gemfire CQ</a></p>
</li>
<li>
<p><a href="#syslog">Syslog</a></p>
</li>
<li>
<p><a href="#tcp">TCP</a></p>
</li>
<li>
<p><a href="#tcp-client">TCP Client</a></p>
</li>
<li>
<p><a href="#reactor-ip">Reactor IP</a></p>
</li>
<li>
<p><a href="#jms">JMS</a></p>
</li>
<li>
<p><a href="#rabbit">RabbitMQ</a></p>
</li>
<li>
<p><a href="#time">Time</a></p>
</li>
<li>
<p><a href="#mqtt">MQTT</a></p>
</li>
<li>
<p><a href="#stdout">Stdout Capture</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Future releases will provide support for other currently available Spring Integration Adapters.  For information on how to adapt an existing Spring Integration Adapter for use in Spring XD see the section <a href="#creating-a-source-module">Creating a Source Module</a>.</p>
</div>
<div class="paragraph">
<p>The following sections show a mix of Spring XD shell and plain Unix shell commands, so if you are trying them out, you should open two separate terminal prompts, one running the XD shell and one to enter the standard commands for sending HTTP data, creating directories, reading files and so on.</p>
</div>
</div>
<div class="sect2">
<h3 id="http">HTTP</h3>
<div class="paragraph">
<p>To create a stream definition in the server using the XD shell</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name httptest --definition "http | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Post some data to the http server on the default port of 9000</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9000 --data "hello world"</pre>
</div>
</div>
<div class="paragraph">
<p>See if the data ended up in the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/httptest</code></pre>
</div>
</div>
<div class="paragraph">
<p>To send binary data, set the <code>Content-Type</code> header to <code>application/octet-string</code></p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ curl --data-binary @foo.zip -H'Content-Type: application-octet-string' http://localhost:9000</pre>
</div>
</div>
<div class="sect3">
<h4 id="_http_with_options">HTTP with options</h4>
<div class="paragraph">
<p>The <strong>http</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">https</dt>
<dd>
<p>true for https:// <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port to listen to <strong>(int, default: <code>9000</code>)</strong></p>
</dd>
<dt class="hdlist1">sslPropertiesLocation</dt>
<dd>
<p>location (resource) of properties containing the location of the pkcs12 keyStore and pass phrase <strong>(String, default: <code>classpath:httpSSL.properties</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here is an example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name httptest9020 --definition "http --port=9020 | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Post some data to the new port</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9020 --data "hello world"</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/httptest9020
hello world</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When using <code>https</code>, you need to provide a properties file that references a pkcs12 key store (containing the server certificate(s)) and its passphrase. Setting <code>--https=true</code> enables https:// and the module looks for the SSL properties in resource <code>classpath:httpSSL.properties</code>. This location can be overridden with the <code>--sslPropertiesLocation</code> property. For example:
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name https9021 --definition "http --port=9021 --https=true --sslPropertiesLocation=file:/secret/ssl.properties | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /secret/ssl.properties
keyStore=file:/secret/httpSource.p12
keyStore.passPhrase=secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since this properties file contains sensitive information, it will typically be secured by the operating system with the XD container process having read access.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tail">Tail</h3>
<div class="paragraph">
<p>Make sure the default input directory exists</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ mkdir -p /tmp/xd/input</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create an empty file to tail (this is not needed on some platforms such as Linux)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ touch /tmp/xd/input/tailtest</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a stream definition using the XD shell</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tailtest --definition "tail | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Send some text into the file being monitored</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo blah &gt;&gt; /tmp/xd/input/tailtest</code></pre>
</div>
</div>
<div class="paragraph">
<p>See if the data ended up in the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tailtest</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_tail_with_options">Tail with options</h4>
<div class="paragraph">
<p>The <strong>tail</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">delay</dt>
<dd>
<p>how often (ms) to poll for new lines (forces use of the Apache Tailer, requires nativeOptions='') <strong>(long, no default)</strong></p>
</dd>
<dt class="hdlist1">fileDelay</dt>
<dd>
<p>on platforms that don&#8217;t wait for a missing file to appear, how often (ms) to look for the file <strong>(long, default: <code>5000</code>)</strong></p>
</dd>
<dt class="hdlist1">fromEnd</dt>
<dd>
<p>whether to tail from the end (true) or from the start (false) of the file (forces use of the Apache Tailer, requires nativeOptions='') <strong>(boolean, no default)</strong></p>
</dd>
<dt class="hdlist1">lines</dt>
<dd>
<p>the number of lines prior to the end of an existing file to tail; does not apply if <em>nativeOptions</em> is provided <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>the absolute path of the file to tail <strong>(String, default: <code>/tmp/xd/input/&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">nativeOptions</dt>
<dd>
<p>options for a native tail command; do not set and use <em>end</em>, <em>delay</em>, and/or <em>reOpen</em> to use the Apache Tailer <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">reOpen</dt>
<dd>
<p>whether to reopen the file each time it is polled (forces use of the Apache Tailer, requires nativeOptions='') <strong>(boolean, no default)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here is an example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tailtest --definition "tail --name=/tmp/foo | file --name=bar" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo blah &gt;&gt; /tmp/foo

$ cat /tmp/xd/output/bar</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tail_status_events">Tail Status Events</h4>
<div class="paragraph">
<p>Some platforms, such as linux, send status messages to <code>stderr</code>. The tail module sends these events to a logging adapter, at WARN level; for example&#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[message=tail: cannot open `/tmp/xd/input/tailtest' for reading: No such file or directory, file=/tmp/xd/input/tailtest]
[message=tail: `/tmp/xd/input/tailtest' has become accessible, file=/tmp/xd/input/tailtest]</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="file">File</h3>
<div class="paragraph">
<p>The file source provides the contents of a File as a byte array by default but may be configured to provide the file reference itself.</p>
</div>
<div class="paragraph">
<p>To log the contents of a file create a stream definition using the XD shell</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name filetest --definition "file | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>The file source by default will look into a directory named after the stream, in this case /tmp/xd/input/filetest</p>
</div>
<div class="paragraph">
<p>Note the above will log the raw bytes. For text files, it is normally desirable to output the contents as plain text. To do this, set the <em>outputType</em> parameter:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name filetest --definition "file --outputType=text/plain | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>For more details on the use of the <em>outputType</em> parameter see <a href="#type-conversion">Type Conversion</a></p>
</div>
<div class="paragraph">
<p>Copy a file into the directory <code>/tmp/xd/input/filetest</code> and observe its contents being logged in the XD Container.</p>
</div>
<div class="sect3">
<h4 id="_file_with_options">File with options</h4>
<div class="paragraph">
<p>The <strong>file</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">dir</dt>
<dd>
<p>the absolute path to the directory to monitor for files <strong>(String, default: <code>/tmp/xd/input/&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">fixedDelay</dt>
<dd>
<p>the fixed delay polling interval specified in seconds <strong>(int, default: <code>5</code>)</strong></p>
</dd>
<dt class="hdlist1">pattern</dt>
<dd>
<p>a filter expression (Ant style) to accept only files that match the pattern <strong>(String, default: <code>*</code>)</strong></p>
</dd>
<dt class="hdlist1">preventDuplicates</dt>
<dd>
<p>whether to prevent the same file from being processed twice <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">ref</dt>
<dd>
<p>set to true to output the File object itself <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>ref</code> option is useful in some cases in which the file contents are large and it would be more efficient to send the file path.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mail_source">Mail</h3>
<div class="paragraph">
<p>Spring XD provides a source module for receiving emails, named <code>mail</code>. Depending on the protocol used, in can work by polling or receive mails as they become available.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see an example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name mailstream --definition "mail --host=imap.gmail.com --username=your.user@gmail.com --password=secret | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Then send an email to yourself and you should see it appear inside a file at <code>/tmp/xd/output/mailstream</code></p>
</div>
<div class="paragraph">
<p>The full list of options for the <code>mail</code> source is below:</p>
</div>
<div class="paragraph">
<p>The <strong>mail</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">charset</dt>
<dd>
<p>the charset used to transform the body of the incoming emails to Strings <strong>(String, default: <code>UTF-8</code>)</strong></p>
</dd>
<dt class="hdlist1">delete</dt>
<dd>
<p>whether to delete the emails once they’ve been fetched <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">expression</dt>
<dd>
<p>a SpEL expression which filters which mail messages will be processed (non polling imap only) <strong>(String, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">fixedDelay</dt>
<dd>
<p>the polling interval used for looking up messages (s) <strong>(int, default: <code>60</code>)</strong></p>
</dd>
<dt class="hdlist1">folder</dt>
<dd>
<p>the folder to take emails from <strong>(String, default: <code>INBOX</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>the hostname of the mail server <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">markAsRead</dt>
<dd>
<p>whether to mark emails as read once they’ve been fetched <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password to use to connect to the mail server  <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port of the mail server <strong>(int, default: <code>25</code>)</strong></p>
</dd>
<dt class="hdlist1">protocol</dt>
<dd>
<p>the protocol to use to retrieve messages <strong>(MailProtocol, default: <code>imap</code>, possible values: <code>imap,imaps,pop3,pop3s</code>)</strong></p>
</dd>
<dt class="hdlist1">usePolling</dt>
<dd>
<p>whether to use polling or not (no polling works with imap(s) only) <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username to use to connect to the mail server <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Of special attention are the <code>markAsRead</code> and <code>delete</code> options, which by default will <strong>delete</strong> the emails once they are consumed. It is hard to come up with a sensible default option for this (please refer to the Spring Integration documentation section on mail handling for a discussion about this), so just be aware that the default for XD is to delete incoming messages.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="twitter-search">Twitter Search</h3>
<div class="paragraph">
<p>The twittersearch source runs a continuous query against Twitter.</p>
</div>
<div class="paragraph">
<p>The <strong>twittersearch</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">connectTimeout</dt>
<dd>
<p>the connection timeout for making a connection to Twitter (ms) <strong>(int, default: <code>5000</code>)</strong></p>
</dd>
<dt class="hdlist1">consumerKey</dt>
<dd>
<p>a consumer key issued by twitter <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">consumerSecret</dt>
<dd>
<p>consumer secret corresponding to the consumer key <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">geocode</dt>
<dd>
<p>geo-location given as latitude,longitude,radius. e.g., <em>37.781157,-122.398720,1mi</em> <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">includeEntities</dt>
<dd>
<p>whether to include entities such as urls, media and hashtags <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">language</dt>
<dd>
<p>language code e.g. <em>en</em> <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">query</dt>
<dd>
<p>the query string <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">readTimeout</dt>
<dd>
<p>the read timeout for the underlying URLConnection to the twitter stream (ms) <strong>(int, default: <code>9000</code>)</strong></p>
</dd>
<dt class="hdlist1">resultType</dt>
<dd>
<p>result type: recent, popular, or mixed <strong>(ResultType, default: <code>mixed</code>, possible values: <code>mixed,recent,popular</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For information on how to construct a query, see the <a href="https://dev.twitter.com/docs/api/1.1/get/search/tweets">Search API v1.1</a>.</p>
</div>
<div class="paragraph">
<p>To get a <code>consumerKey</code> and <code>consumerSecret</code> you need to register a twitter application. If you don&#8217;t already have one set up, you can create an app at the <a href="https://dev.twitter.com/apps">Twitter Developers</a> site to get these credentials.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For both <code>twittersearch</code> and <code>twitterstream</code> you can put these keys in a module properties file instead of supplying them in the stream definition. If both sources share the same credentials, it is easiest to configure the required credentials in <code>config/modules/modules.yml</code>. Alternately, each module has its own properties file. For twittersearch, the file would be <code>config/modules/source/twittersearch/twittersearch.properties</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create and deploy a stream definition in the server using the XD shell:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name springone2gx --definition "twittersearch --query='#springone2gx' | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Let the twittersearch run for a little while and then check to see if some data ended up in the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/springone2gx</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Both <code>twittersearch</code> and <code>twitterstream</code> emit JSON in the <a href="https://dev.twitter.com/docs/platform-objects/tweets">native Twitter format</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="twitter-stream">Twitter Stream</h3>
<div class="paragraph">
<p>This source ingests data from Twitter&#8217;s <a href="https://dev.twitter.com/docs/streaming-apis/streams/public">streaming API v1.1</a>. It uses the <a href="https://dev.twitter.com/docs/streaming-apis/streams/public">sample and filter</a> stream endpoints rather than the full "firehose" which needs special access. The endpoint used will depend on the parameters you supply in the stream definition (some are specific to the filter endpoint).</p>
</div>
<div class="paragraph">
<p>You need to supply all keys and secrets (both consumer and accessToken) to authenticate for this source, so it is easiest if you just add these to  <code>XD_HOME/config/modules/modules.yml</code> or <code>XD_HOME/config/modules/source/twitterstream/twitterstream.properties</code> file.</p>
</div>
<div class="paragraph">
<p>Stream creation is then straightforward:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tweets --definition "twitterstream | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>twitterstream</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">accessToken</dt>
<dd>
<p>a valid OAuth access token <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">accessTokenSecret</dt>
<dd>
<p>an OAuth secret corresponding to the access token <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">connectTimeout</dt>
<dd>
<p>the connection timeout for making a connection to Twitter (ms) <strong>(int, default: <code>5000</code>)</strong></p>
</dd>
<dt class="hdlist1">consumerKey</dt>
<dd>
<p>a consumer key issued by twitter <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">consumerSecret</dt>
<dd>
<p>consumer secret corresponding to the consumer key <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">delimited</dt>
<dd>
<p>set to true to get length delimiters in the stream data <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">discardDeletes</dt>
<dd>
<p>set to discard <em>delete</em> events <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">filterLevel</dt>
<dd>
<p>controls which tweets make it through to the stream: none,low,or medium <strong>(FilterLevel, default: <code>none</code>, possible values: <code>none,low,medium</code>)</strong></p>
</dd>
<dt class="hdlist1">follow</dt>
<dd>
<p>comma delimited set of user ids whose tweets should be included in the stream <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">language</dt>
<dd>
<p>language code e.g. <em>en</em> <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">locations</dt>
<dd>
<p>comma delimited set of latitude/longitude pairs to include in the stream <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">readTimeout</dt>
<dd>
<p>the read timeout for the underlying URLConnection to the twitter stream (ms) <strong>(int, default: <code>9000</code>)</strong></p>
</dd>
<dt class="hdlist1">stallWarnings</dt>
<dd>
<p>set to true to enable stall warnings <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">track</dt>
<dd>
<p>comma delimited set of terms to include in the stream <strong>(String, default: ``)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Note: The options available are pretty much the same as those listed in the <a href="https://dev.twitter.com/docs/streaming-apis/parameters">Twitter API docs</a> and unless otherwise stated, the accepted formats are the same.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Both <code>twittersearch</code> and <code>twitterstream</code> emit JSON in the <a href="https://dev.twitter.com/docs/platform-objects/tweets">native Twitter format</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="gemfire-source">GemFire Source</h3>
<div class="paragraph">
<p>This source configures a client cache and client region, along with the necessary subscriptions enabled, in the XD container process along with a Spring Integration GemFire inbound channel adapter, backed by a CacheListener that outputs messages triggered by an external entry event on the region. By default the payload contains the updated entry value, but may be controlled by passing in a SpEL expression that uses the <a href="http://www.vmware.com/support/developer/vfabric-gemfire/700-api/com/gemstone/gemfire/cache/EntryEvent.html">EntryEvent</a> as the evaluation context.</p>
</div>
<div class="sect3">
<h4 id="_options">Options</h4>
<div class="paragraph">
<p>The <strong>gemfire</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">cacheEventExpression</dt>
<dd>
<p>an optional SpEL expression referencing the event <strong>(String, default: <code>newValue</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>host name of the cache server or locator (if useLocator=true) <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>port of the cache server or locator (if useLocator=true) <strong>(int, default: <code>40404</code>)</strong></p>
</dd>
<dt class="hdlist1">regionName</dt>
<dd>
<p>the name of the region for which events are to be monitored <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">useLocator</dt>
<dd>
<p>set to true if using a locator <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_example">Example</h4>
<div class="paragraph">
<p>Use of the gemfire source requires an external process (or a separate stream) that creates or updates entries in a GemFire region configured for a cache server. Such events may feed an XD stream. To enable such a stream, the XD container must join a GemFire distributed client-server system as a client, creating a client region corresponding to an existing region on a cache server. The client region registers a cache listener via the Spring Integration GemFire inbound channel adapter. The client region and pool are configured for a subscription on all keys in the region.</p>
</div>
<div class="paragraph">
<p>The following example creates two streams: One to write http messages to a Gemfire region named <em>Stocks</em>, and another to listen for cache events and record the updates to a file. This works with the Cache Server and sample configuration included with the Spring XD distribution:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name gftest --definition "gemfire --regionName="Stocks" | file" --deploy
xd:&gt; stream create --name stocks --definition "http --port=9090 | gemfire-json-server --regionName=Stocks --keyExpression=payload.getField('symbol')" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now send some messages to the stocks stream.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data {"symbol":"FAKE","price":73}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"FAKE","price":78}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"FAKE","price":80}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Avoid spaces in the JSON when using the shell to post data
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As updates are posted to the cache you should see them captured in the output file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/gftest.out

{"symbol":"FAKE","price":73}
{"symbol":"FAKE","price":78}
{"symbol":"FAKE","price":80}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_launching_the_xd_gemfire_server">Launching the XD GemFire Server</h4>
<div class="paragraph">
<p>This source requires a cache server to be running in a separate process and its host and port, or a locator host and port must be configured. The XD distribution includes a GemFire server executable suitable for development and test purposes. This is a Java main class that runs with a Spring configured cache server. The configuration is passed as a command line argument to the server&#8217;s main method. The configuration includes a cache server port and one or more configured region. XD includes a sample cache configuration called  <a href="https://github.com/SpringSource/spring-xd/blob/master/spring-xd-gemfire-server/config/cq-demo.xml">cq-demo</a>. This starts a server on port 40404 and creates a region named <em>Stocks</em>. A Logging cache listener is configured  for the region to log region events.</p>
</div>
<div class="paragraph">
<p>Run Gemfire cache server by changing to the gemfire/bin directory and execute</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ ./gemfire-server ../config/cq-demo.xml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gemfire-continuous-query">GemFire Continuous Query</h3>
<div class="paragraph">
<p>Continuous query allows client applications to create a GemFire query using Object Query Language(OQL) and register a CQ listener which subscribes to the query and is notified every time the query 's result set changes. The <em>gemfire_cq</em> source registers a CQ which will post CQEvent messages to the stream.</p>
</div>
<div class="sect3">
<h4 id="_options_2">Options</h4>
<div class="paragraph">
<p>The <strong>gemfire-cq</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">host</dt>
<dd>
<p>the host on which the GemFire server is running <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port on which the GemFire server is running <strong>(int, default: <code>40404</code>)</strong></p>
</dd>
<dt class="hdlist1">query</dt>
<dd>
<p>the query string in Object Query Language (OQL) <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">useLocator</dt>
<dd>
<p>set to true if using a locator <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The example is similar to that presented for the <a href="#gemfire-source">gemfire source</a> above, and requires an external cache server as described in the above section. In this case the query provides a finer filter on data events. In the example below, the <code>cqtest</code> stream will only receive events matching a single ticker symbol, whereas the <code>gftest</code> stream example above will receive updates to every entry in the region.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name stocks --definition "http --port=9090 | gemfire-json-server --regionName=Stocks --keyExpression=payload.getField('symbol')" --deploy
xd:&gt; stream create --name cqtest --definition "gemfire-cq --query='Select * from /Stocks where symbol=''FAKE''' | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now send some messages to the stocks stream.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data {"symbol":"FAKE","price":73}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"FAKE","price":78}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"FAKE","price":80}</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>cqtest</em> stream is now listening for any stock quote updates for the ticker symbol <code>FAKE</code>. As updates are posted to the cache you should see them captured in the output file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/cqtest.out

{"symbol":"FAKE","price":73}
{"symbol":"FAKE","price":78}
{"symbol":"FAKE","price":80}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="syslog">Syslog</h3>
<div class="paragraph">
<p>Three syslog sources are provided: <code>reactor-syslog</code>, <code>syslog-udp</code>, and <code>syslog-tcp</code>. The reactor-syslog adapter uses tcp and builds upon the functionality available in the <a href="https://github.com/reactor/reactor">Reactor</a> project and provides improved throughput over the syslog-tcp adapter.</p>
</div>
<div class="paragraph">
<p>The <strong>reactor-syslog</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">port</dt>
<dd>
<p>the port on which the system will listen for syslog messages <strong>(int, default: <code>5140</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <strong>syslog-udp</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">port</dt>
<dd>
<p>the port on which the system will listen for syslog messages <strong>(int, default: <code>5140</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <strong>syslog-tcp</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">port</dt>
<dd>
<p>the port on which the system will listen for syslog messages <strong>(int, default: <code>5140</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To create a stream definition (using shell command)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name syslogtest --definition "reactor-syslog --port=5140 | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name syslogtest --definition "syslog-udp --port=5140 | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name syslogtest --definition "syslog-tcp --port=5140 | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>(<code>--port</code> is not required when using the default <code>5140</code>)</p>
</div>
<div class="paragraph">
<p>Send a test message to the syslog</p>
</div>
<div class="literalblock">
<div class="content">
<pre>logger -p local3.info -t TESTING "Test Syslog Message"</pre>
</div>
</div>
<div class="paragraph">
<p>See if the data ended up in the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/syslogtest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to your syslog documentation to configure the syslog daemon to forward syslog messages to the stream; some examples are:</p>
</div>
<div class="paragraph">
<p>UDP - Mac OSX (syslog.conf) and Ubuntu (rsyslog.conf)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>*.*    @localhost:5140</pre>
</div>
</div>
<div class="paragraph">
<p>TCP - Ubuntu (rsyslog.conf)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ModLoad omfwd
*.*    @@localhost:5140</pre>
</div>
</div>
<div class="paragraph">
<p>Restart the syslog daemon after reconfiguring.</p>
</div>
</div>
<div class="sect2">
<h3 id="tcp">TCP</h3>
<div class="paragraph">
<p>The <code>tcp</code> source acts as a server and allows a remote party to connect to XD and submit data over a raw tcp socket.</p>
</div>
<div class="paragraph">
<p>To create a stream definition in the server, use the following XD shell command</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tcptest --definition "tcp | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This will create the default TCP source and send data read from it to the <code>tcptest</code> file.</p>
</div>
<div class="paragraph">
<p>TCP is a streaming protocol and some mechanism is needed to frame messages on the wire. A number of decoders are available, the default being <em>CRLF</em> which is compatible with Telnet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ telnet localhost 1234
Trying ::1...
Connected to localhost.
Escape character is '^]'.
foo
^]

telnet&gt; quit
Connection closed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>See if the data ended up in the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the TCP module will emit a <code>byte[]</code>; to convert to a String, add <code>--outputType=text/plain</code> to the module definition.</p>
</div>
<div class="sect3">
<h4 id="_tcp_with_options">TCP with options</h4>
<div class="paragraph">
<p>The <strong>tcp</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">bufferSize</dt>
<dd>
<p>the size of the buffer (bytes) to use when encoding/decoding <strong>(int, default: <code>2048</code>)</strong></p>
</dd>
<dt class="hdlist1">charset</dt>
<dd>
<p>the charset used when converting from bytes to String <strong>(String, default: <code>UTF-8</code>)</strong></p>
</dd>
<dt class="hdlist1">decoder</dt>
<dd>
<p>the decoder to use when receiving messages <strong>(Encoding, default: <code>CRLF</code>, possible values: <code>CRLF,LF,NULL,STXETX,RAW,L1,L2,L4</code>)</strong></p>
</dd>
<dt class="hdlist1">nio</dt>
<dd>
<p>whether or not to use NIO <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port on which to listen <strong>(int, default: <code>1234</code>)</strong></p>
</dd>
<dt class="hdlist1">reverseLookup</dt>
<dd>
<p>perform a reverse DNS lookup on the remote IP Address <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">socketTimeout</dt>
<dd>
<p>the timeout (ms) before closing the socket when no data is received <strong>(int, default: <code>120000</code>)</strong></p>
</dd>
<dt class="hdlist1">useDirectBuffers</dt>
<dd>
<p>whether or not to use direct buffers <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_available_decoders">Available Decoders</h4>
<div class="dlist">
<div class="title">Text Data</div>
<dl>
<dt class="hdlist1">CRLF (default)</dt>
<dd>
<p>text terminated by carriage return (0x0d) followed by line feed (0x0a)</p>
</dd>
<dt class="hdlist1">LF</dt>
<dd>
<p>text terminated by line feed (0x0a)</p>
</dd>
<dt class="hdlist1">NULL</dt>
<dd>
<p>text terminated by a null byte (0x00)</p>
</dd>
<dt class="hdlist1">STXETX</dt>
<dd>
<p>text preceded by an STX (0x02) and terminated by an ETX (0x03)</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Text and Binary Data</div>
<dl>
<dt class="hdlist1">RAW</dt>
<dd>
<p>no structure - the client indicates a complete message by closing the socket</p>
</dd>
<dt class="hdlist1">L1</dt>
<dd>
<p>data preceded by a one byte (unsigned) length field (supports up to 255 bytes)</p>
</dd>
<dt class="hdlist1">L2</dt>
<dd>
<p>data preceded by a two byte (unsigned) length field (up to 2<sup>16</sup>-1 bytes)</p>
</dd>
<dt class="hdlist1">L4</dt>
<dd>
<p>data preceded by a four byte (signed) length field (up to 2<sup>31</sup>-1 bytes)</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_examples">Examples</h4>
<div class="paragraph">
<p>The following examples all use <code>echo</code> to send data to <code>netcat</code> which sends the data to the source.</p>
</div>
<div class="paragraph">
<p>The echo options <code>-en</code> allows echo to interpret escape sequences and not send a newline.</p>
</div>
<div class="literalblock">
<div class="title">CRLF Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest --definition "tcp | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This uses the default (CRLF) decoder and port 1234; send some data</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en 'foobar\r\n' | netcat localhost 1234</code></pre>
</div>
</div>
<div class="paragraph">
<p>See if the data ended up in the file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">LF Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest2 --definition "tcp --decoder=LF --port=1235 | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en 'foobar\n' | netcat localhost 1235</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest2</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">NULL Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest3 --definition "tcp --decoder=NULL --port=1236 | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en 'foobar\x00' | netcat localhost 1236</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest3</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">STXETX Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest4 --definition "tcp --decoder=STXETX --port=1237 | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en '\x02foobar\x03' | netcat localhost 1237</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest4</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">RAW Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest5 --definition "tcp --decoder=RAW --port=1238 | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -n 'foobar' | netcat localhost 1238</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest5</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">L1 Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest6 --definition "tcp --decoder=L1 --port=1239 | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en '\x06foobar' | netcat localhost 1239</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest6</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">L2 Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest7 --definition "tcp --decoder=L2 --port=1240 | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en '\x00\x06foobar' | netcat localhost 1240</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest7</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">L4 Decoder</div>
<div class="content">
<pre>xd:&gt; stream create --name tcptest8 --definition "tcp --decoder=L4 --port=1241 | file" --deploy</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en '\x00\x00\x00\x06foobar' | netcat localhost 1241</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat /tmp/xd/output/tcptest8</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_binary_data_example">Binary Data Example</h4>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tcptest9 --definition "tcp --decoder=L1 --port=1242 | file --binary=true" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Note that we configure the <code>file</code> sink with <code>binary=true</code> so that a newline is not appended.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ echo -en '\x08foo\x00bar\x0b' | netcat localhost 1242</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ hexdump -C /tmp/xd/output/tcptest9
00000000  66 6f 6f 00 62 61 72 0b                           |foo.bar.|
00000008</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tcp-client">TCP Client</h3>
<div class="paragraph">
<p>The <code>tcp-client</code> source module uses raw tcp sockets, as does the <code>tcp</code> module but contrary to the <code>tcp</code> module, acts as a client. Whereas the <code>tcp</code> module will open a listening socket and wait for connections from a remote party, the <code>tcp-client</code> will initiate the connection to a remote server and emit as messages what that remote server sends over the wire. As an optional feature, the <code>tcp-client</code> can itself emit messages to the remote server, so that a simple conversation can take place.</p>
</div>
<div class="sect3">
<h4 id="_tcp_client_options">TCP Client options</h4>
<div class="paragraph">
<p>The <strong>tcp-client</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">bufferSize</dt>
<dd>
<p>the size of the buffer (bytes) to use when encoding/decoding <strong>(int, default: <code>2048</code>)</strong></p>
</dd>
<dt class="hdlist1">charset</dt>
<dd>
<p>the charset used when converting from bytes to String <strong>(String, default: <code>UTF-8</code>)</strong></p>
</dd>
<dt class="hdlist1">close</dt>
<dd>
<p>whether to close the socket after each message <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">decoder</dt>
<dd>
<p>the decoder to use when receiving messages <strong>(Encoding, default: <code>CRLF</code>, possible values: <code>CRLF,LF,NULL,STXETX,RAW,L1,L2,L4</code>)</strong></p>
</dd>
<dt class="hdlist1">encoder</dt>
<dd>
<p>the encoder to use when sending messages <strong>(Encoding, default: <code>CRLF</code>, possible values: <code>CRLF,LF,NULL,STXETX,RAW,L1,L2,L4</code>)</strong></p>
</dd>
<dt class="hdlist1">expression</dt>
<dd>
<p>a SpEL expression used to transform messages <strong>(String, default: <code>payload.toString()</code>)</strong></p>
</dd>
<dt class="hdlist1">fixedDelay</dt>
<dd>
<p>the rate at which stimulus messages will be emitted (seconds) <strong>(int, default: <code>5</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>the remote host to connect to <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">nio</dt>
<dd>
<p>whether or not to use NIO <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port on the remote host to connect to <strong>(int, default: <code>1234</code>)</strong></p>
</dd>
<dt class="hdlist1">reverseLookup</dt>
<dd>
<p>perform a reverse DNS lookup on the remote IP Address <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">script</dt>
<dd>
<p>reference to a script used to transform messages <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">socketTimeout</dt>
<dd>
<p>the timeout (ms) before closing the socket when no data is received <strong>(int, default: <code>120000</code>)</strong></p>
</dd>
<dt class="hdlist1">useDirectBuffers</dt>
<dd>
<p>whether or not to use direct buffers <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_a_simple_conversation">Implementing a simple conversation</h4>
<div class="paragraph">
<p>That "stimulus" counter concept bears some explanation. By default, the module will emit (at interval set by <code>fixedDelay</code>) an incrementing number, starting at 1. Given that the default is to use an <code>expression</code> of <code>payload.toString()</code>, this results in the module sending <code>1, 2, 3, ...</code> to the remote server.</p>
</div>
<div class="paragraph">
<p>By using another expression, or more certainly a <code>script</code>, one can implement a simple conversation, assuming it is time based. As an example, let&#8217;s assume we want to join some kind of chat server where one first needs to authenticate, then specify which rooms to join. Lastly, all clients are supposed to send some keepalive commands to make sure that the connection is open.</p>
</div>
<div class="paragraph">
<p>The following groovy script could be used to that effect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">def commands = ['', // index 0 is not used
'LOGIN user=johndoe', // first command sent
'JOIN weather',
'JOIN news',
'JOIN gossip'
]


// payload will contain an incrementing counter, starting at 1
if (commands.size &gt; payload)
  return commands[payload] + "\n"
else
  return "PING\n"  // send keep alive after 4th 'real' command
</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reactor-ip">Reactor IP</h3>
<div class="paragraph">
<p>The <code>reactor-ip</code> source acts as a server and allows a remote party to connect to XD and submit data over a raw TCP or UDP socket.  The reactor-ip source differs from the standard tcp source in that it is based on the <a href="https://github.com/reactor/reactor">Reactor Project</a> and can be configured to use the <a href="http://martinfowler.com/articles/lmax.html">LMAX Disruptor RingBuffer</a> library allowing for extremely high ingestion rates, e.g. ~ 1M/sec.</p>
</div>
<div class="paragraph">
<p>To create a stream definition use the following XD shell command</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tcpReactor --definition "reactor-ip | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This will create the reactor TCP source and send data read from it to the file named tcpReactor.</p>
</div>
<div class="paragraph">
<p>The <strong>reactor-ip</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">codec</dt>
<dd>
<p>codec used to transcode data <strong>(String, default: <code>string</code>)</strong></p>
</dd>
<dt class="hdlist1">dispatcher</dt>
<dd>
<p>type of Reactor Dispatcher to use <strong>(String, default: <code>ringBuffer</code>)</strong></p>
</dd>
<dt class="hdlist1">framing</dt>
<dd>
<p>method of framing the data <strong>(String, default: <code>linefeed</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>host to bind the server to <strong>(String, default: <code>0.0.0.0</code>)</strong></p>
</dd>
<dt class="hdlist1">lengthFieldLength</dt>
<dd>
<p>byte precision of the number used in the length field <strong>(int, default: <code>4</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>port to bind the server to <strong>(int, default: <code>3000</code>)</strong></p>
</dd>
<dt class="hdlist1">transport</dt>
<dd>
<p>whether to use TCP or UDP as a transport <strong>(String, default: <code>tcp</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="rabbit">RabbitMQ</h3>
<div class="paragraph">
<p>The "rabbit" source enables receiving messages from RabbitMQ.</p>
</div>
<div class="paragraph">
<p>The following example shows the default settings.</p>
</div>
<div class="paragraph">
<p>Configure a stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name rabbittest --definition "rabbit | file --binary=true" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This receives messages from a queue named <code>rabbittest</code> and writes them to the default file sink (<code>/tmp/xd/output/rabbittest.out</code>). It uses the default RabbitMQ broker running on localhost, port 5672.</p>
</div>
<div class="paragraph">
<p>The queue(s) must exist before the stream is deployed. We do not create the queue(s) automatically. However, you can easily create a Queue using the RabbitMQ web UI. Then, using that same UI, you can navigate to the "rabbittest" Queue and publish test messages to it.</p>
</div>
<div class="paragraph">
<p>Notice that the <code>file</code> sink has <code>--binary=true</code>; this is because, by default, the data emitted by the source will be bytes. This can be modified by setting the <code>content_type</code> property on messages to <code>text/plain</code>. In that case, the source will convert the message to a <code>String</code>; you can then omit the <code>--binary=true</code> and the file sink will then append a newline after each message.</p>
</div>
<div class="paragraph">
<p>To destroy the stream, enter the following at the shell prompt:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream destroy --name rabbittest</pre>
</div>
</div>
<div class="sect3">
<h4 id="_rabbitmq_with_options">RabbitMQ with Options</h4>
<div class="paragraph">
<p>The <strong>rabbit</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ackMode</dt>
<dd>
<p>the acknowledge mode (AUTO, NONE, MANUAL) <strong>(String, default: <code>AUTO</code>)</strong></p>
</dd>
<dt class="hdlist1">addresses</dt>
<dd>
<p>a comma separated list of <em>host[:port]</em> addresses <strong>(String, default: <code>${spring.rabbitmq.addresses}</code>)</strong></p>
</dd>
<dt class="hdlist1">concurrency</dt>
<dd>
<p>the minimum number of consumers <strong>(int, default: <code>1</code>)</strong></p>
</dd>
<dt class="hdlist1">converterClass</dt>
<dd>
<p>the class name of the message converter <strong>(String, default: <code>org.springframework.amqp.support.converter.SimpleMessageConverter</code>)</strong></p>
</dd>
<dt class="hdlist1">mappedRequestHeaders</dt>
<dd>
<p>request message header names to be propagated to/from the adpater/gateway <strong>(String, default: <code>STANDARD_REQUEST_HEADERS</code>)</strong></p>
</dd>
<dt class="hdlist1">maxConcurrency</dt>
<dd>
<p>the maximum number of consumers <strong>(int, default: <code>1</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password to use to connect to the broker <strong>(String, default: <code>${spring.rabbitmq.password}</code>)</strong></p>
</dd>
<dt class="hdlist1">prefetch</dt>
<dd>
<p>the prefetch size <strong>(int, default: <code>1</code>)</strong></p>
</dd>
<dt class="hdlist1">queues</dt>
<dd>
<p>the queue(s) from which messages will be received <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">requeue</dt>
<dd>
<p>whether rejected messages will be requeued by default <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">sslPropertiesLocation</dt>
<dd>
<p>resource containing SSL properties <strong>(String, default: <code>${spring.rabbitmq.sslProperties}</code>)</strong></p>
</dd>
<dt class="hdlist1">transacted</dt>
<dd>
<p>true if the channel is to be transacted <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">txSize</dt>
<dd>
<p>the number of messages to process before acking <strong>(int, default: <code>1</code>)</strong></p>
</dd>
<dt class="hdlist1">useSSL</dt>
<dd>
<p>true if SSL should be used for the connection <strong>(String, default: <code>${spring.rabbitmq.useSSL}</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username to use to connect to the broker <strong>(String, default: <code>${spring.rabbitmq.username}</code>)</strong></p>
</dd>
<dt class="hdlist1">vhost</dt>
<dd>
<p>the RabbitMQ virtual host to use <strong>(String, default: <code>${spring.rabbitmq.virtual_host}</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See the <a href="#rabbitssl">RabbitMQ MessageBus Documentation</a> for more information about SSL configuration.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jms">JMS</h3>
<div class="paragraph">
<p>The "jms" source enables receiving messages from JMS.</p>
</div>
<div class="paragraph">
<p>The following example shows the default settings.</p>
</div>
<div class="paragraph">
<p>Configure a stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name jmstest --definition "jms | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This receives messages from a queue named <code>jmstest</code> and writes them to the default file sink (<code>/tmp/xd/output/jmstest</code>). It uses the default ActiveMQ broker running on localhost, port 61616.</p>
</div>
<div class="paragraph">
<p>To destroy the stream, enter the following at the shell prompt:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream destroy --name jmstest</pre>
</div>
</div>
<div class="paragraph">
<p>To test the above stream, you can use something like the following&#8230;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public class Broker {

	public static void main(String[] args) throws Exception {
		BrokerService broker = new BrokerService();
		broker.setBrokerName("broker");
		String brokerURL = "tcp://localhost:61616";
		broker.addConnector(brokerURL);
		broker.start();
		ConnectionFactory cf = new ActiveMQConnectionFactory(brokerURL);
		JmsTemplate template = new JmsTemplate(cf);
		while (System.in.read() &gt;= 0) {
			template.convertAndSend("jmstest", "testFoo");
		}
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>tail -f /tmp/xd/output/jmstest</code></p>
</div>
<div class="paragraph">
<p>Run this as a Java application; each time you hit &lt;enter&gt; in the console, it will send a message to queue <code>jmstest</code>.</p>
</div>
<div class="paragraph">
<p>The out of the box configuration is setup to use ActiveMQ.  To use another JMS provider you will need to update a few files in the XD distribution.  There are sample files for HornetMQ in the distribution as an example for you to follow.  You will also need to add the appropriate libraries for your provider in the JMS module lib directory or in the main XD lib directory.</p>
</div>
<div class="sect3">
<h4 id="_jms_with_options">JMS with Options</h4>
<div class="paragraph">
<p>The <strong>jms</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">clientId</dt>
<dd>
<p>an identifier for the client, to be associated with a durable topic subscription <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">destination</dt>
<dd>
<p>the destination name from which messages will be received <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">durableSubscription</dt>
<dd>
<p>when true, indicates the subscription to a topic is durable <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">provider</dt>
<dd>
<p>the JMS provider <strong>(String, default: <code>activemq</code>)</strong></p>
</dd>
<dt class="hdlist1">pubSub</dt>
<dd>
<p>when true, indicates that the destination is a topic <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">subscriptionName</dt>
<dd>
<p>a name that will be assigned to the topic subscription <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the selected broker requires an infrastructure configuration file <code>jms-&lt;provider&gt;-infrastructure-context.xml</code> in <code>modules/common</code>. This is used to declare any infrastructure beans needed by the provider. See the default (<code>jms-activemq-infrastructure-context.xml</code>) for an example. Typically, all that is required is a <code>ConnectionFactory</code>. The activemq provider uses a properties file <code>jms-activemq.properties</code> which can be found in the <code>config</code> directory. This contains the broker URL.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="time">Time</h3>
<div class="paragraph">
<p>The time source will simply emit a String with the current time every so often.</p>
</div>
<div class="paragraph">
<p>The <strong>time</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">fixedDelay</dt>
<dd>
<p>how often to emit a message, expressed in seconds <strong>(int, default: <code>1</code>)</strong></p>
</dd>
<dt class="hdlist1">format</dt>
<dd>
<p>how to render the current time, using SimpleDateFormat <strong>(String, default: <code>yyyy-MM-dd HH:mm:ss</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="mqtt">MQTT</h3>
<div class="paragraph">
<p>The mqtt source connects to an mqtt server and receives telemetry messages.</p>
</div>
<div class="paragraph">
<p>Configure a stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create tcptest --definition "mqtt --url='tcp://localhost:1883' --topics='xd.mqtt.test' | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to use the MQTT Source defaults you can execute the command as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create tcptest --definition "mqtt | log" --deploy</pre>
</div>
</div>
<div class="sect3">
<h4 id="_options_3">Options</h4>
<div class="paragraph">
<p>The <strong>mqtt</strong> source has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">clientId</dt>
<dd>
<p>identifies the client <strong>(String, default: <code>xd.mqtt.client.id.src</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password to use when connecting to the broker <strong>(String, default: <code>guest</code>)</strong></p>
</dd>
<dt class="hdlist1">topics</dt>
<dd>
<p>the topic(s) to which the source will subscribe <strong>(String, default: <code>xd.mqtt.test</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>location of the mqtt broker <strong>(String, default: <code>tcp://localhost:1883</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username to use when connecting to the broker <strong>(String, default: <code>guest</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The defaults are set up to connect to the RabbitMQ MQTT adapter on localhost.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stdout">Stdout Capture</h3>
<div class="paragraph">
<p>There isn&#8217;t actually a source named "stdin" but it is easy to capture stdin by redirecting it to a <code>tcp</code> source. For example if you wanted to capture the output of a command, you would first create the <code>tcp</code> stream, as above, using the appropriate sink for your requirements:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create tcpforstdout --definition "tcp --decoder=LF | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>You can then capture the output from commands using the <code>netcat</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cat mylog.txt | netcat localhost 1234</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="processors">Processors</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_13">Introduction</h3>
<div class="paragraph">
<p>This section will cover the processors available out-of-the-box with Spring XD.  As a prerequisite, start the XD Container
as instructed in the <a href="#getting-started">Getting Started</a> page.</p>
</div>
<div class="paragraph">
<p>The Processors covered are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#filter">Filter</a></p>
</li>
<li>
<p><a href="#transform">Transform</a></p>
</li>
<li>
<p><a href="#script">Script</a></p>
</li>
<li>
<p><a href="#splitter">Splitter</a></p>
</li>
<li>
<p><a href="#aggregator">Aggregator</a></p>
</li>
<li>
<p><a href="#http-clent">HTTP Client</a></p>
</li>
<li>
<p><a href="#json-to-tuple">JSON to Tuple</a></p>
</li>
<li>
<p><a href="#object-to-json">Object to JSON</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the section <a href="#creating-a-processor-module">Creating a Processor Module</a> for information on how to create custom processor modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="filter">Filter</h3>
<div class="paragraph">
<p>Use the filter module in a <a href="#streams">stream</a> to determine whether a Message should be passed to the output channel.</p>
</div>
<div class="paragraph">
<p>The <strong>filter</strong> processor has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">expression</dt>
<dd>
<p>a SpEL expression to evaluate as a predicate <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">script</dt>
<dd>
<p>location of a groovy script to use as a predicate to the filter <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_filter_with_spel_expression">Filter with SpEL expression</h4>
<div class="paragraph">
<p>The simplest way to use the filter processor is to pass a SpEL expression when creating the stream. The expression should evaluate the message and return true or false.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name filtertest --definition "http | filter --expression=payload=='good' | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This filter will only pass Messages to the log sink if the payload is the word "good". Try sending "good" to the HTTP endpoint and you should see it in the XD log:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9000 --data "good"</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you send the word "bad" (or anything else), you shouldn&#8217;t see the log entry.</p>
</div>
</div>
<div class="sect3">
<h4 id="_filter_using_jsonpath_evaluation">Filter using jsonPath evaluation</h4>
<div class="paragraph">
<p>As part of the SpEL expression you can make use of the pre-registered JSON Path function.</p>
</div>
<div class="paragraph">
<p>This filter example shows to pass messages to the output channel if they contain a specific JSON field matching a specific value.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name jsonfiltertest --definition "http --port=9002 | filter --expression=#jsonPath(payload,'$.firstName').contains('John') | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> There is no space between payload JSON and the jsonPath in the expression</p>
</div>
<div class="paragraph">
<p>This filter will only pass Messages to the log sink if the JSON payload contains the <em>firstName</em> "John". Try sending this payload to the HTTP endpoint and you should see it in the XD log:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9002 --data "{\"firstName\":\"John\", \"lastName\":\"Smith\"}"</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you send a different <em>firstName</em>, you shouldn&#8217;t see the log entry.</p>
</div>
<div class="paragraph">
<p>Here is another example usage of filter</p>
</div>
<div class="literalblock">
<div class="content">
<pre>filter --expression=#jsonPath(payload,'$.entities.hashtags[*].text').contains('obama')</pre>
</div>
</div>
<div class="paragraph">
<p>This is an example that is operating on a JSON payload of tweets as consumed from the twitter search module.</p>
</div>
</div>
<div class="sect3">
<h4 id="_filter_with_groovy_script">Filter with Groovy Script</h4>
<div class="paragraph">
<p>For more complex filtering, you can pass the location of a Groovy script using the <em>script</em> attribute. If you want to pass variable values to your script, you can optionally pass the path to a properties file using the <em>properties-location</em> attribute. All properties in the file will be made available to the script as variables.</p>
</div>
<div class="paragraph">
<p>Note that an implicit variable named <em>payload</em> is available to give you access to the data contained in a message.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name groovyfiltertest --definition "http --port=9001 | filter --script=custom-filter.groovy --properties-location=custom-filter.properties | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>By default, Spring XD will search the classpath for <em>custom-filter.groovy</em> and <em>custom-filter.properties</em>. You can place the script in <em>${xd.home}/modules/processor/scripts</em> and the properties file in <em>${xd.home}/config</em> to make them available on the classpath.  Alternatively, you can prefix the <em>script</em> and <em>properties-location</em> values with <em>file:</em> to load from the file system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transform">Transform</h3>
<div class="paragraph">
<p>Use the transform module in a <a href="#streams">stream</a> to convert a Message&#8217;s content or structure.</p>
</div>
<div class="paragraph">
<p>The <strong>transform</strong> processor has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">expression</dt>
<dd>
<p>a SpEL expression used to transform messages <strong>(String, default: <code>payload.toString()</code>)</strong></p>
</dd>
<dt class="hdlist1">script</dt>
<dd>
<p>reference to a script used to transform messages <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_transform_with_spel_expression">Transform with SpEL expression</h4>
<div class="paragraph">
<p>The simplest way to use the transform processor is to pass a SpEL expression when creating the stream. The expression should return the modified message or payload.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name transformtest --definition "http --port=9003 | transform --expression='FOO' | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This transform will convert all message payloads to the word "FOO". Try sending something to the HTTP endpoint and you should see "FOO" in the XD log:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9003 --data "some message"</pre>
</div>
</div>
<div class="paragraph">
<p>As part of the SpEL expression you can make use of the pre-registered JSON Path function.  The syntax is #jsonPath(payload,<em>&lt;json path expression&gt;</em>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_transform_with_groovy_script">Transform with Groovy Script</h4>
<div class="paragraph">
<p>For more complex transformations, you can pass the location of a Groovy script using the <em>script</em> attribute. If you want to pass variable values to your script, you can optionally pass the path to a properties file using the <em>properties-location</em> attribute. All properties in the file will be made available to the script as variables.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name groovytransformtest --definition "http --port=9004 | transform --script=custom-transform.groovy --properties-location=custom-transform.properties | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>By default, Spring XD will search the classpath for <em>custom-transform.groovy</em> and <em>custom-transform.properties</em>. You can place the script in <em>${xd.home}/modules/processor/scripts</em> and the properties file in <em>${xd.home}/config</em> to make them available on the classpath.  Alternatively, you can prefix the <em>script</em> and <em>properties-location</em> values with <em>file:</em> to load from the file system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="script">Script</h3>
<div class="paragraph">
<p>The script processor contains a <em>Service Activator</em> that invokes a specified Groovy script. This is a slightly more generic way to accomplish processing logic, as the provided script may simply terminate the stream as well as transform or filter Messages.</p>
</div>
<div class="paragraph">
<p>To use the module, pass the location of a Groovy script using the <em>location</em> attribute. If you want to pass variable values to your script, you can optionally pass the path to a properties file using the <em>properties-location</em> attribute. All properties in the file will be made available to the script as variables.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name groovyprocessortest --definition "http --port=9006 | script --location=custom-processor.groovy --properties-location=custom-processor.properties | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>By default, Spring XD will search the classpath for <em>custom-processor.groovy</em> and <em>custom-processor.properties</em>. You can place the script in <em>${xd.home}/modules/processor/scripts</em> and the properties file in <em>${xd.home}/config</em> to make them available on the classpath.  Alternatively, you can prefix the <em>location</em> and <em>properties-location</em> values with <em>file:</em> to load from the file system.</p>
</div>
<div class="paragraph">
<p>The <strong>script</strong> processor has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">location</dt>
<dd>
<p>the script to use (Spring resource, uses classpath: when no scheme given) <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="splitter">Splitter</h3>
<div class="paragraph">
<p>The splitter module builds upon the concept of the same name in Spring Integration and allows the splitting of a single message into several distinct messages.</p>
</div>
<div class="paragraph">
<p>The <strong>splitter</strong> processor has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">expression</dt>
<dd>
<p>a SpEL expression which would typically evaluate to an array or collection <strong>(String, default: <code>payload</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The default value for <code>expression</code> is <code>payload</code>, which actually does not split, unless the message is already a collection.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As part of the SpEL expression you can make use of the pre-registered JSON Path function. The syntax is #jsonPath(payload,<em>&lt;json path expression&gt;</em>)</p>
</div>
<div class="sect3">
<h4 id="_extract_the_value_of_a_specific_field">Extract the value of a specific field</h4>
<div class="paragraph">
<p>This splitter converts a JSON message payload to the value of a specific JSON field.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name jsontransformtest --definition "http --port=9005 | splitter --expression=#jsonPath(payload,'$.firstName') | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Try sending this payload to the HTTP endpoint and you should see just the value "John" in the XD log:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9005 --data '{"firstName":"John", "lastName":"Smith"}'</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aggregator">Aggregator</h3>
<div class="paragraph">
<p>The aggregator module does the opposite of the splitter, and builds upon the concept of the same name found in Spring Integration. By default, it will consider all incoming messages from a stream to belong to the same group:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name aggregates --definition "http | aggregator --count=3 --aggregation=T(org.springframework.util.StringUtils).collectionToDelimitedString(#this.![payload],' ') | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This uses a SpEL expression that will basically concatenate all payloads together, inserting a space character in between. As such,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --data Hello
xd:&gt; http post --data World
xd:&gt; http post --data !</pre>
</div>
</div>
<div class="paragraph">
<p>would emit a single message whose contents is "Hello World !". This is because we set the aggregator release strategy to accumulate 3 messages.</p>
</div>
<div class="paragraph">
<p>The <strong>aggregator</strong> processor has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">aggregation</dt>
<dd>
<p>how to construct the aggregated message (SpEL expression against a collection of messages) <strong>(String, default: <code>#this.![payload]</code>)</strong></p>
</dd>
<dt class="hdlist1">correlation</dt>
<dd>
<p>how to correlate messages (SpEL expression against each message) <strong>(String, default: <code>'&lt;stream name&gt;'</code>)</strong></p>
</dd>
<dt class="hdlist1">count</dt>
<dd>
<p>the number of messages to group together before emitting a group <strong>(int, default: <code>50</code>)</strong></p>
</dd>
<dt class="hdlist1">dbkind</dt>
<dd>
<p>which flavor of init scripts to use for the jdbc store (blank to attempt autodetection) <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">driverClassName</dt>
<dd>
<p>the jdbc driver to use when using the jdbc store <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">hostname</dt>
<dd>
<p>hostname of the redis instance to use as a store <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">initializeDatabase</dt>
<dd>
<p>whether to auto-create the database tables for the jdbc store <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password to use when using the jdbc or redis store <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>port of the redis instance to use as a store <strong>(int, default: <code>6379</code>)</strong></p>
</dd>
<dt class="hdlist1">release</dt>
<dd>
<p>when to release messages (SpEL expression against a collection of messages accumulated so far) <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">store</dt>
<dd>
<p>the kind of store to use to retain messages <strong>(StoreKind, default: <code>memory</code>, possible values: <code>memory,jdbc,redis</code>)</strong></p>
</dd>
<dt class="hdlist1">timeout</dt>
<dd>
<p>the delay (ms) after which messages should be released, even if the completion criteria is not met <strong>(int, default: <code>50000</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>the jdbc url to connect to when using the jdbc store <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username to use when using the jdbc store <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Some of the options are only relevant when using a particular <code>store</code></p>
</li>
<li>
<p>The default <code>correlation</code> of <code>'&lt;stream name&gt;'</code> actually considers all messages to be correlated, since they all belong to the same stream.</p>
</li>
<li>
<p>Using the <code>release</code> option overrides the <code>count</code> option (which is a simpler approach)</p>
</li>
<li>
<p>The default for <code>aggregation</code> creates a new collection made of the payloads of the accumulated messages</p>
</li>
<li>
<p>About the <code>timeout</code> option: due to the way it is implemented (see MessageGroupStoreReaper in the Spring Integration documentation), the actual observed delay may vary between <code>timeout</code> and <code>2xtimeout</code>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="http-client">HTTP Client</h3>
<div class="paragraph">
<p>The <code>http-client</code> processor acts as a client that issues HTTP requests to a remote server, submitting the message payload it receices to that server and in turn emitting the response it receives to the next module down the line.</p>
</div>
<div class="paragraph">
<p>For example, the following command will result in an immediate fetching of earthquake data and it being logged in the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create earthquakes --definition "trigger | http-client --url='''http://earthquake.usgs.gov/earthquakes/feed/geojson/all/day''' --httpMethod=GET | log" --deploy</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Please be aware that the <code>url</code> option above is actually a SpEL expression, hence the triple quotes. If you&#8217;d like to learn more about quotes, please read <a href="#dsl-quotes-escaping">the relevant documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>http-client</strong> processor has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">charset</dt>
<dd>
<p>the charset to use when in the Content-Type header when emitting Strings <strong>(String, default: <code>UTF-8</code>)</strong></p>
</dd>
<dt class="hdlist1">httpMethod</dt>
<dd>
<p>the http method to use when performing the request <strong>(HttpMethod, default: <code>POST</code>, possible values: <code>OPTIONS,GET,HEAD,POST,PUT,PATCH,DELETE,TRACE,CONNECT</code>)</strong></p>
</dd>
<dt class="hdlist1">mappedRequestHeaders</dt>
<dd>
<p>request message header names to be propagated to/from the adpater/gateway <strong>(String, default: <code>HTTP_REQUEST_HEADERS</code>)</strong></p>
</dd>
<dt class="hdlist1">mappedResponseHeaders</dt>
<dd>
<p>response message header names to be propagated from the adpater/gateway <strong>(String, default: <code>HTTP_RESPONSE_HEADERS</code>)</strong></p>
</dd>
<dt class="hdlist1">replyTimeout</dt>
<dd>
<p>the amount of time to wait (ms) for a response from the remote server <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>the url to perform an http request on <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="json-to-tuple">JSON to Tuple</h3>
<div class="paragraph">
<p>The <code>json-to-tuple</code> processor is able to transform a String representation of some JSON map into a <a href="#tuples">Tuple</a>.</p>
</div>
<div class="paragraph">
<p>Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create tuples --definition "http | json-to-tuple | transform --expression='payload.firstName + payload.lastName' | log" --deploy

xd:&gt;http post --data '{"firstName": "Spring", "lastName": "XD"}'</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Transformation to Tuple can be used as an alternative or in addition of <a href="#type-conversion">Type Conversion</a>, depending on your usecase.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>json-to-tuple</strong> processor has no particular option (in addition to options shared by all modules)</p>
</div>
</div>
<div class="sect2">
<h3 id="object-to-json">Object to JSON</h3>
<div class="paragraph">
<p>The <code>object-to-json</code> processor can be used to convert any java Objec to a JSON String.</p>
</div>
<div class="paragraph">
<p>In the following example, notice how the collection of three elements is transformed to JSON (in particular, the three Strings are surrounded by quotes):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create json --deploy --definition "http | aggregator --count | abject-to-json | log"

xd:&gt;http post --data hello
xd:&gt;http post --data world
xd:&gt;http post --data !</pre>
</div>
</div>
<div class="paragraph">
<p>results in <code>["hello", "world", "!"]</code> appearing in the log.</p>
</div>
<div class="paragraph">
<p>The <strong>object-to-json</strong> processor has no particular option (in addition to options shared by all modules)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sinks">Sinks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_14">Introduction</h3>
<div class="paragraph">
<p>In this section we will show some variations on output sinks.  As a prerequisite start the XD Container
as instructed in the <a href="#getting-started">Getting Started</a> page.</p>
</div>
<div class="paragraph">
<p>The Sinks covered are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#log">Log</a></p>
</li>
<li>
<p><a href="#file-sink">File</a></p>
</li>
<li>
<p><a href="#hadoop-hdfs">HDFS</a></p>
</li>
<li>
<p><a href="#hdfs-dataset-avroparquet">HDFS Dataset</a></p>
</li>
<li>
<p><a href="#jdbc">JDBC</a></p>
</li>
<li>
<p><a href="#tcp-sink">TCP</a></p>
</li>
<li>
<p><a href="#mongo">Mongo</a></p>
</li>
<li>
<p><a href="#mail">Mail</a></p>
</li>
<li>
<p><a href="#rabbitmq">RabbitMQ</a></p>
</li>
<li>
<p><a href="#gemfire-server">GemFire Server</a></p>
</li>
<li>
<p><a href="#splunk-server">Splunk Server</a></p>
</li>
<li>
<p><a href="#mqtt-sink">MQTT</a></p>
</li>
<li>
<p><a href="#dynamic-router">Dynamic Router</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the section <a href="#creating-a-sink-module">Creating a Sink Module</a> for information on how to create sink modules using other Spring Integration Adapters.</p>
</div>
</div>
<div class="sect2">
<h3 id="log">Log</h3>
<div class="paragraph">
<p>Probably the simplest option for a sink is just to log the data. The <code>log</code> sink uses the application logger to output the data for inspection. The log level is set to <code>WARN</code> and the logger name is created from the stream name. To create a stream using a <code>log</code> sink you would use a command like</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name mylogstream --definition "http --port=8000 | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>You can then try adding some data. We&#8217;ve used the <code>http</code> source on port 8000 here, so run the following command to send a message</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:8000 --data "hello"</pre>
</div>
</div>
<div class="paragraph">
<p>and you should see the following output in the XD container console.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>13/06/07 16:12:18 INFO sink.mylogstream: hello</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>log</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">expression</dt>
<dd>
<p>the expression to be evaluated for the log content; use <em>#root</em> to log the full message <strong>(String, default: <code>payload</code>)</strong></p>
</dd>
<dt class="hdlist1">level</dt>
<dd>
<p>the log level <strong>(String, default: <code>INFO</code>)</strong></p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>the name of the log category to log to (will be prefixed by <em>xd.sink.</em>) <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here are some examples explaining the above options:</p>
</div>
<div class="paragraph">
<p>The logger name is the sink name prefixed with the string <code>xd.sink.</code>. The sink name is the same as the stream name by default, but you can set it by passing the <code>--name</code> parameter</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name myotherlogstream --definition "http --port=8001 | log --name=mylogger" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>The log level is <code>INFO</code> by default; this can be changed with the <code>--level</code> property (<code>FATAL</code>, <code>ERROR</code>, <code>WARN</code>, <code>INFO</code>, <code>DEBUG</code>, or <code>TRACE</code>)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name mylogstream --definition "http --port=8001 | log --level=WARN" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>By default, the message payload is logged; this can be changed with the <code>--expression</code> property (e.g. <code>payload.foo</code> to log some property <code>foo</code> of the payload, or <code>#root</code> to log the entire message)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name mylogstream --definition "http --port=8001 | log --expression=#root" --deploy</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="file-sink">File Sink</h3>
<div class="paragraph">
<p>Another simple option is to stream data to a file on the host OS. This can be done using the <code>file</code> sink module to create a <a href="#streams">stream</a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name myfilestream --definition "http --port=8000 | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve used the <code>http</code> source again, so run the following command to send a message</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:8000 --data "hello"</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>file</code> sink uses the stream name as the default name for the file it creates, and places the file in the <code>/tmp/xd/output/</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ less /tmp/xd/output/myfilestream
hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can cutomize the behavior and specify the <code>name</code> and <code>dir</code> options of the output file. For example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name otherfilestream --definition "http --port=8000 | file --name=myfile --dir=/some/custom/directory" --deploy</pre>
</div>
</div>
<div class="sect3">
<h4 id="_file_with_options_2">File with Options</h4>
<div class="paragraph">
<p>The <strong>file</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">binary</dt>
<dd>
<p>if false, will append a newline character at the end of each line <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">charset</dt>
<dd>
<p>the charset to use when writing a String payload <strong>(String, default: <code>UTF-8</code>)</strong></p>
</dd>
<dt class="hdlist1">dir</dt>
<dd>
<p>the directory in which files will be created <strong>(String, default: <code>/tmp/xd/output/</code>)</strong></p>
</dd>
<dt class="hdlist1">mode</dt>
<dd>
<p>what to do if the file already exists <strong>(Mode, default: <code>APPEND</code>, possible values: <code>APPEND,REPLACE,FAIL,IGNORE</code>)</strong></p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>filename pattern to use <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">suffix</dt>
<dd>
<p>filename extension to use <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hadoop-hdfs">Hadoop (HDFS)</h3>
<div class="paragraph">
<p>If you do not have Hadoop installed, you can install Hadoop as described in our <a href="#installing-hadoop">separate guide</a>. Spring XD supports 4 Hadoop distributions, see <a href="#using-hadoop">using Hadoop</a> for more information on how to start Spring XD to target a specific distribution.</p>
</div>
<div class="paragraph">
<p>Once Hadoop is up and running, you can then use the <code>hdfs</code> sink when creating a <a href="#streams">stream</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name myhdfsstream1 --definition "time | hdfs" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, we&#8217;ve scheduled <code>time</code> source to automatically send ticks to <code>hdfs</code> once in every second. If you wait a little while for data to accumuluate you can then list can then list the files in the hadoop filesystem using the shell&#8217;s built in hadoop fs commands.  Before making any access to HDFS in the shell you first need to configure the shell to point to your name node.  This is done using the <code>hadoop config</code> command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop config fs --namenode hdfs://localhost:8020</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the hdfs protocol is used but you may also use the webhdfs protocol.  Listing the contents in the output directory (named by default after the stream name) is done by issuing the following command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop fs ls /xd/myhdfsstream1
Found 1 items
-rw-r--r--   3 jvalkealahti supergroup          0 2013-12-18 18:10 /xd/myhdfsstream1/myhdfsstream1-0.txt.tmp</pre>
</div>
</div>
<div class="paragraph">
<p>While the file is being written to it will have the <code>tmp</code> suffix.  When the data written exceeds the rollover size (default 1GB) it will be renamed to remove the <code>tmp</code> suffix.  There are several options to control the in use file file naming options.  These are <code>--inUsePrefix</code> and <code>--inUseSuffix</code> set the file name prefix and suffix respectfully.</p>
</div>
<div class="paragraph">
<p>When you destroy a stream</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream destroy --name myhdfsstream1</pre>
</div>
</div>
<div class="paragraph">
<p>and list the stream directory again, in use file suffix doesn&#8217;t exist anymore.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop fs ls /xd/myhdfsstream1
Found 1 items
-rw-r--r--   3 jvalkealahti supergroup        380 2013-12-18 18:10 /xd/myhdfsstream1/myhdfsstream1-0.txt</pre>
</div>
</div>
<div class="paragraph">
<p>To list the list the contents of a file directly from a shell execute the hadoop cat command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; hadoop fs cat /xd/myhdfsstream1/myhdfsstream1-0.txt
2013-12-18 18:10:07
2013-12-18 18:10:08
2013-12-18 18:10:09
...</pre>
</div>
</div>
<div class="paragraph">
<p>In the above examples we didn&#8217;t yet go through why the file was written in a specific directory and why it was named in this specific way. Default location of a file is defined as <code>/xd/&lt;stream name&gt;/&lt;stream name&gt;-&lt;rolling part&gt;.txt</code>. These can be changed using options <code>--directory</code> and <code>--fileName</code> respectively. Example is shown below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name myhdfsstream2 --definition "time | hdfs --directory=/xd/tmp --fileName=data" --deploy
xd:&gt;stream destroy --name myhdfsstream2
xd:&gt;hadoop fs ls /xd/tmp
Found 1 items
-rw-r--r--   3 jvalkealahti supergroup        120 2013-12-18 18:31 /xd/tmp/data-0.txt</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to control the size of a files written into HDFS. The <code>--rollover</code> option can be used to control when file currently being written is rolled over and a new file opened by providing the rollover size in bytes, kilobytes, megatypes, gigabytes, and terabytes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name myhdfsstream3 --definition "time | hdfs --rollover=100" --deploy
xd:&gt;stream destroy --name myhdfsstream3
xd:&gt;hadoop fs ls /xd/myhdfsstream3
Found 3 items
-rw-r--r--   3 jvalkealahti supergroup        100 2013-12-18 18:41 /xd/myhdfsstream3/myhdfsstream3-0.txt
-rw-r--r--   3 jvalkealahti supergroup        100 2013-12-18 18:41 /xd/myhdfsstream3/myhdfsstream3-1.txt
-rw-r--r--   3 jvalkealahti supergroup        100 2013-12-18 18:41 /xd/myhdfsstream3/myhdfsstream3-2.txt</pre>
</div>
</div>
<div class="paragraph">
<p>Shortcuts to specify sizes other than bytes are written as <code>--rollover=64M</code>, <code>--rollover=512G</code> or <code>--rollover=1T</code>.</p>
</div>
<div class="paragraph">
<p>The stream can also be compressed during the write operation. Example of this is shown below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name myhdfsstream4 --definition "time | hdfs --codec=gzip" --deploy
xd:&gt;stream destroy --name myhdfsstream4
xd:&gt;hadoop fs ls /xd/myhdfsstream4
Found 1 items
-rw-r--r--   3 jvalkealahti supergroup         80 2013-12-18 18:48 /xd/myhdfsstream4/myhdfsstream4-0.txt.gzip</pre>
</div>
</div>
<div class="paragraph">
<p>From a native os shell we can use hadoop&#8217;s fs commands and pipe data into gunzip.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># bin/hadoop fs -cat /xd/myhdfsstream4/myhdfsstream4-0.txt.gzip | gunzip
2013-12-18 18:48:10
2013-12-18 18:48:11
...</pre>
</div>
</div>
<div class="paragraph">
<p>Often a stream of data may not have a high enough rate to roll over files frequently, leaving the file in an opened state.  This prevents users from reading a consistent set of data when running mapreduce jobs.  While one can alleviate this problem by using a small rollover value, a better way is to use the <code>idleTimeout</code>  option that will automatically close the file if there was no writes during the specified period of time.   This feature is also useful in cases where burst of data is written into a stream and you&#8217;d like that data to become visible in HDFS.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name myhdfsstream5 --definition "http --port=8000 | hdfs --rollover=20 --idleTimeout=10000" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example we changed a source to <code>http</code> order to control what we write into a <code>hdfs</code> sink. We defined a small rollover size and a timeout of 10 seconds. Now we can simply post data into this stream via source end point using a below command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:8000 --data "hello"</pre>
</div>
</div>
<div class="paragraph">
<p>If we repeat the command very quickly and then wait for the timeout we should be able to see that some files are closed before rollover size was met and some were simply rolled because of a rollover size.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop fs ls /xd/myhdfsstream5
Found 4 items
-rw-r--r--   3 jvalkealahti supergroup         12 2013-12-18 19:02 /xd/myhdfsstream5/myhdfsstream5-0.txt
-rw-r--r--   3 jvalkealahti supergroup         24 2013-12-18 19:03 /xd/myhdfsstream5/myhdfsstream5-1.txt
-rw-r--r--   3 jvalkealahti supergroup         24 2013-12-18 19:03 /xd/myhdfsstream5/myhdfsstream5-2.txt
-rw-r--r--   3 jvalkealahti supergroup         18 2013-12-18 19:03 /xd/myhdfsstream5/myhdfsstream5-3.txt</pre>
</div>
</div>
<div class="paragraph">
<p>Files can be automatically partitioned using a <code>partitionPath</code> expression. If we create a stream with <code>idleTimeout</code> and <code>partitionPath</code> with simple format <code>yyyy/MM/dd/HH/mm</code> we should see writes ending into its own files within every minute boundary.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name myhdfsstream6 --definition "time|hdfs --idleTimeout=10000 --partitionPath=dateFormat('yyyy/MM/dd/HH/mm')" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Let a stream run for a short period of time and list files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop fs ls --recursive true --dir /xd/myhdfsstream6
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 09:42 /xd/myhdfsstream6/2014
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 09:42 /xd/myhdfsstream6/2014/05
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 09:42 /xd/myhdfsstream6/2014/05/28
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 09:45 /xd/myhdfsstream6/2014/05/28/09
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 09:43 /xd/myhdfsstream6/2014/05/28/09/42
-rw-r--r--   3 jvalkealahti supergroup        140 2014-05-28 09:43 /xd/myhdfsstream6/2014/05/28/09/42/myhdfsstream6-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 09:44 /xd/myhdfsstream6/2014/05/28/09/43
-rw-r--r--   3 jvalkealahti supergroup       1200 2014-05-28 09:44 /xd/myhdfsstream6/2014/05/28/09/43/myhdfsstream6-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 09:45 /xd/myhdfsstream6/2014/05/28/09/44
-rw-r--r--   3 jvalkealahti supergroup       1200 2014-05-28 09:45 /xd/myhdfsstream6/2014/05/28/09/44/myhdfsstream6-0.txt</pre>
</div>
</div>
<div class="paragraph">
<p>Partitioning can also be based on defined lists. In a below example we simulate feeding data by using a <code>time</code> and a <code>transform</code> elements. Data passed to <code>hdfs</code> sink has a content <code>APP0:foobar</code>, <code>APP1:foobar</code>, <code>APP2:foobar</code> or <code>APP3:foobar</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name myhdfsstream7 --definition "time | transform --expression=\"'APP'+T(Math).round(T(Math).random()*3)+':foobar'\" | hdfs --idleTimeout=10000 --partitionPath=path(dateFormat('yyyy/MM/dd/HH'),list(payload.split(':')[0],{{'0TO1','APP0','APP1'},{'2TO3','APP2','APP3'}}))" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Let the stream run few seconds, destroy it and check what got written in those partitioned files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream destroy --name myhdfsstream7
Destroyed stream 'myhdfsstream7'
xd:&gt;hadoop fs ls --recursive true --dir /xd
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:24 /xd/myhdfsstream7
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:24 /xd/myhdfsstream7/2014
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:24 /xd/myhdfsstream7/2014/05
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:24 /xd/myhdfsstream7/2014/05/28
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:24 /xd/myhdfsstream7/2014/05/28/19
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:24 /xd/myhdfsstream7/2014/05/28/19/0TO1_list
-rw-r--r--   3 jvalkealahti supergroup        108 2014-05-28 19:24 /xd/myhdfsstream7/2014/05/28/19/0TO1_list/myhdfsstream7-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:24 /xd/myhdfsstream7/2014/05/28/19/2TO3_list
-rw-r--r--   3 jvalkealahti supergroup        180 2014-05-28 19:24 /xd/myhdfsstream7/2014/05/28/19/2TO3_list/myhdfsstream7-0.txt
xd:&gt;hadoop fs cat /xd/myhdfsstream7/2014/05/28/19/0TO1_list/myhdfsstream7-0.txt
APP1:foobar
APP1:foobar
APP0:foobar
APP0:foobar
APP1:foobar</pre>
</div>
</div>
<div class="paragraph">
<p>Partitioning can also be based on defined ranges. In a below example we simulate feeding data by using a <code>time</code> and a <code>transform</code> elements. Data passed to <code>hdfs</code> sink has a content ranging from <code>APP0</code> to <code>APP15</code>. We simple parse the number part and use it to do a partition with ranges <code>{3,5,10}</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name myhdfsstream8 --definition "time | transform --expression=\"'APP'+T(Math).round(T(Math).random()*15)\" | hdfs --idleTimeout=10000 --partitionPath=path(dateFormat('yyyy/MM/dd/HH'),range(T(Integer).parseInt(payload.substring(3)),{3,5,10}))" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Let the stream run few seconds, destroy it and check what got written in those partitioned files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream destroy --name myhdfsstream8
Destroyed stream 'myhdfsstream8'
xd:&gt;hadoop fs ls --recursive true --dir /xd
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8/2014
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8/2014/05
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28/19
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28/19/10_range
-rw-r--r--   3 jvalkealahti supergroup         16 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28/19/10_range/myhdfsstream8-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28/19/3_range
-rw-r--r--   3 jvalkealahti supergroup         35 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28/19/3_range/myhdfsstream8-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28/19/5_range
-rw-r--r--   3 jvalkealahti supergroup          5 2014-05-28 19:34 /xd/myhdfsstream8/2014/05/28/19/5_range/myhdfsstream8-0.txt
xd:&gt;hadoop fs cat /xd/myhdfsstream8/2014/05/28/19/3_range/myhdfsstream8-0.txt
APP3
APP3
APP1
APP0
APP1
xd:&gt;hadoop fs cat /xd/myhdfsstream8/2014/05/28/19/5_range/myhdfsstream8-0.txt
APP4
xd:&gt;hadoop fs cat /xd/myhdfsstream8/2014/05/28/19/10_range/myhdfsstream8-0.txt
APP6
APP15
APP7</pre>
</div>
</div>
<div class="paragraph">
<p>Partition using a <code>dateFormat</code> can be based on content itself. This is a good use case if old log files needs to be processed where partitioning should happen based on timestamp of a log entry. We create a fake log data with a simple date string ranging from <code>1970-01-10</code> to <code>1970-01-13</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name myhdfsstream9 --definition "time | transform --expression=\"'1970-01-'+1+T(Math).round(T(Math).random()*3)\" | hdfs --idleTimeout=10000 --partitionPath=path(dateFormat('yyyy/MM/dd/HH',payload,'yyyy-MM-DD'))" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Let the stream run few seconds, destroy it and check what got written in those partitioned files. If you see the partition paths, those are based on year 1970, not present year.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream destroy --name myhdfsstream9
Destroyed stream 'myhdfsstream9'
xd:&gt;hadoop fs ls --recursive true --dir /xd
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:56 /xd/myhdfsstream9
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:56 /xd/myhdfsstream9/1970
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:56 /xd/myhdfsstream9/1970/01
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:56 /xd/myhdfsstream9/1970/01/10
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/10/00
-rw-r--r--   3 jvalkealahti supergroup         44 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/10/00/myhdfsstream9-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:56 /xd/myhdfsstream9/1970/01/11
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/11/00
-rw-r--r--   3 jvalkealahti supergroup         99 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/11/00/myhdfsstream9-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:56 /xd/myhdfsstream9/1970/01/12
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/12/00
-rw-r--r--   3 jvalkealahti supergroup         44 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/12/00/myhdfsstream9-0.txt
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:56 /xd/myhdfsstream9/1970/01/13
drwxr-xr-x   - jvalkealahti supergroup          0 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/13/00
-rw-r--r--   3 jvalkealahti supergroup         55 2014-05-28 19:57 /xd/myhdfsstream9/1970/01/13/00/myhdfsstream9-0.txt
xd:&gt;hadoop fs cat /xd/myhdfsstream9/1970/01/10/00/myhdfsstream9-0.txt
1970-01-10
1970-01-10
1970-01-10
1970-01-10</pre>
</div>
</div>
<div class="sect3">
<h4 id="_hdfs_with_options">HDFS with Options</h4>
<div class="paragraph">
<p>The <strong>hdfs</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">codec</dt>
<dd>
<p>compression codec alias name (gzip, snappy, bzip2, lzo, or slzo) <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">directory</dt>
<dd>
<p>where to output the files in the Hadoop FileSystem <strong>(String, default: <code>/xd/&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">fileExtension</dt>
<dd>
<p>the base filename extension to use for the created files <strong>(String, default: <code>txt</code>)</strong></p>
</dd>
<dt class="hdlist1">fileName</dt>
<dd>
<p>the base filename to use for the created files <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">fileOpenAttempts</dt>
<dd>
<p>maximum number of file open attempts to find a path <strong>(int, default: <code>10</code>)</strong></p>
</dd>
<dt class="hdlist1">fileUuid</dt>
<dd>
<p>whether file name should contain uuid <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">fsUri</dt>
<dd>
<p>the URI to use to access the Hadoop FileSystem <strong>(String, default: <code>${spring.hadoop.fsUri}</code>)</strong></p>
</dd>
<dt class="hdlist1">idleTimeout</dt>
<dd>
<p>inactivity timeout after file will be automatically closed <strong>(long, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">inUsePrefix</dt>
<dd>
<p>prefix for files currently being written <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">inUseSuffix</dt>
<dd>
<p>suffix for files currently being written <strong>(String, default: <code>.tmp</code>)</strong></p>
</dd>
<dt class="hdlist1">overwrite</dt>
<dd>
<p>whether writer is allowed to overwrite files in Hadoop FileSystem <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">partitionPath</dt>
<dd>
<p>a SpEL expression defining the partition path <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">rollover</dt>
<dd>
<p>threshold in bytes when file will be automatically rolled over <strong>(String, default: <code>1G</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the context of the <code>fileOpenAttempts</code> option, attempt is either one rollover request or failed stream open request for a path (if another writer came up with a same path and already opened it).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_partition_path_expression">Partition Path Expression</h4>
<div class="paragraph">
<p>SpEL expression is evaluated against a Spring Messaging <code>Message</code> passed internally into a HDFS writer. This allows expression to use <code>headers</code> and <code>payload</code> from that message. While you could do a custom processing within a stream and add custom headers, <code>timestamp</code> is always going to be there. Data to be written is then available in a <code>payload</code>.</p>
</div>
<div class="sect4">
<h5 id="_accessing_properties">Accessing Properties</h5>
<div class="paragraph">
<p>Using a <code>payload</code> simply returns whatever is currently being written. Access to headers is via <code>headers</code> property. Any other property is automatically resolved from headers if found. For example <code>headers.timestamp</code> is equivalent to <code>timestamp</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_custom_methods">Custom Methods</h5>
<div class="paragraph">
<p>Addition to a normal SpEL functionality, few custom methods has been added to make it easier to build partition paths. These custom methods can be used to work with a normal partition concepts like <code>date formatting</code>, <code>lists</code>, <code>ranges</code> and <code>hashes</code>.</p>
</div>
<div class="sect5">
<h6 id="_path">path</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="text language-text">path(String... paths)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Concatenates paths together with a delimiter <code>/</code>. This method can be used to make the expression less verbose than using a native SpEL functionality to combine path parts together. To create a path <code>part1/part2</code>, expression <code>'part1' + '/' + 'part2'</code> is equivalent to <code>path('part1','part2')</code>.</p>
</div>
<div class="dlist">
<div class="title">Parameters</div>
<dl>
<dt class="hdlist1">paths</dt>
<dd>
<p>Any number of path parts</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Return Value</div>
<p>Concatenated value of paths delimited with <code>/</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_dateformat">dateFormat</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="text language-text">dateFormat(String pattern)
dateFormat(String pattern, Long epoch)
dateFormat(String pattern, Date date)
dateFormat(String pattern, String datestring)
dateFormat(String pattern, String datestring, String dateformat)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creates a path using date formatting. Internally this method delegates into <code>SimpleDateFormat</code> and needs a <code>Date</code> and a <code>pattern</code>. On default if no parameter used for conversion is given, <code>timestamp</code> is expected. Effectively <code>dateFormat('yyyy')</code> equals to <code>dateFormat('yyyy', timestamp)</code> or <code>dateFormat('yyyy', headers.timestamp)</code>.</p>
</div>
<div class="paragraph">
<p>Method signature with three parameters can be used to create a custom <code>Date</code> object which is then passed to <code>SimpleDateFormat</code> conversion using a <code>dateformat</code> pattern. This is useful in use cases where partition should be based on a date or time string found from a payload content itself. Default <code>dateformat</code> pattern if omitted is <code>yyyy-MM-dd</code>.</p>
</div>
<div class="dlist">
<div class="title">Parameters</div>
<dl>
<dt class="hdlist1">pattern</dt>
<dd>
<p>Pattern compatible with <code>SimpleDateFormat</code> to produce a final output.</p>
</dd>
<dt class="hdlist1">epoch</dt>
<dd>
<p>Timestamp as <code>Long</code> which is converted into a <code>Date</code>.</p>
</dd>
<dt class="hdlist1">date</dt>
<dd>
<p>A <code>Date</code> to be formatted.</p>
</dd>
<dt class="hdlist1">dateformat</dt>
<dd>
<p>Secondary pattern to convert <code>datestring</code> into a <code>Date</code>.</p>
</dd>
<dt class="hdlist1">datestring</dt>
<dd>
<p><code>Date</code> as a <code>String</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Return Value</div>
<p>A path part representation which can be a simple file or directory name or a directory structure.</p>
</div>
</div>
<div class="sect5">
<h6 id="_list">list</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="text language-text">list(Object source, List&lt;List&lt;Object&gt;&gt; lists)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creates a partition path part by matching a <code>source</code> against a lists denoted by <code>lists</code>.</p>
</div>
<div class="paragraph">
<p>Lets assume that data is being written and it&#8217;s possible to extrace an <code>appid</code> either from headers or payload. We can automatically do a list based partition by using a partition method <code>list(headers.appid,{{'1TO3','APP1','APP2','APP3'},{'4TO6','APP4','APP5','APP6'}})</code>. This method would create three partitions, <code>1TO3_list</code>, <code>4TO6_list</code> and <code>list</code>. Latter is used if no match is found from partition lists passed to <code>lists</code>.</p>
</div>
<div class="dlist">
<div class="title">Parameters</div>
<dl>
<dt class="hdlist1">source</dt>
<dd>
<p>An <code>Object</code> to be matched against <code>lists</code>.</p>
</dd>
<dt class="hdlist1">lists</dt>
<dd>
<p>A definition of list of lists.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Return Value</div>
<p>A path part prefixed with a matched key i.e. <code>XXX_list</code> or <code>list</code> if no match.</p>
</div>
</div>
<div class="sect5">
<h6 id="_range">range</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="text language-text">range(Object source, List&lt;Object&gt; list)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creates a partition path part by matching a <code>source</code> against a list denoted by <code>list</code> using a simple binary search.</p>
</div>
<div class="paragraph">
<p>The partition method takes a <code>source</code> as first argument and <code>list</code> as a second argument. Behind the scenes this is using jvm’s <code>binarySearch</code> which works on an <code>Object</code> level so we can pass in anything. Remember that meaningful range match only works if passed in <code>Object</code> and types in list are of same type like <code>Integer</code>. Range is defined by a binarySearch itself so mostly it is to match against an upper bound except the last range in a list. Having a list of <code>{1000,3000,5000}</code> means that everything above 3000 will be matched with 5000. If that is an issue then simply adding <code>Integer.MAX_VALUE</code> as last range would overflow everything above 5000 into a new partition. Created partitions would then be <code>1000_range</code>, <code>3000_range</code> and <code>5000_range</code>.</p>
</div>
<div class="dlist">
<div class="title">Parameters</div>
<dl>
<dt class="hdlist1">source</dt>
<dd>
<p>An <code>Object</code> to be matched against <code>list</code>.</p>
</dd>
<dt class="hdlist1">list</dt>
<dd>
<p>A definition of list.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Return Value</div>
<p>A path part prefixed with a matched key i.e. <code>XXX_range</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_hash">hash</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="text language-text">hash(Object source, int bucketcount)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creates a partition path part by calculating hashkey using <code>source`s</code> <code>hashCode</code> and <code>bucketcount</code>. Using a partition method <code>hash(timestamp,2)</code> would then create partitions named <code>0_hash</code>, <code>1_hash</code> and <code>2_hash</code>. Number suffixed with <code>_hash</code> is simply calculated using <code>Object.hashCode() % bucketcount</code>.</p>
</div>
<div class="dlist">
<div class="title">Parameters</div>
<dl>
<dt class="hdlist1">source</dt>
<dd>
<p>An <code>Object</code> which <code>hashCode</code> will be used.</p>
</dd>
<dt class="hdlist1">bucketcount</dt>
<dd>
<p>A number of buckets</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Return Value</div>
<p>A path part prefixed with a hash key i.e. <code>XXX_hash</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hdfs-dataset-avroparquet">HDFS Dataset (Avro/Parquet)</h3>
<div class="paragraph">
<p>The HDFS Dataset sink is used to store Java classes that are sent as the payload on the stream. It uses the <a href="http://kitesdk.org/">Kite SDK Data Module</a>'s Dataset implementation to store the payload data serialized in either Avro or Parquet format. The Avro schema is generated from the Java class that is persisted. For Parquet the Java object must follow JavaBean conventions with properties for any fields to be persisted. The fields can only be simple scalar values like Strings and numbers.</p>
</div>
<div class="paragraph">
<p>The HDFS Dataset sink requires that you have a Hadoop installation that is based on Hadoop v2 (Hadoop 2.2.0, Pivotal HD 1.0, Cloudera CDH4 or Hortonworks HDP 2.0), see <a href="#using-hadoop">using Hadoop</a> for more information on how to start Spring XD to target a specific distribution.</p>
</div>
<div class="paragraph">
<p>Once Hadoop is up and running, you can then use the <code>hdfs-dataset</code> sink when creating a <a href="#streams">stream</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name mydataset --definition "time | hdfs-dataset --batchSize=20" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, we&#8217;ve scheduled <code>time</code> source to automatically send ticks to the <code>hdfs-dataset</code> sink once every second. The data will be stored in a directory named <code>/xd/&lt;streamname&gt;</code> by default, so in this example it will be <code>/xd/mydataset</code>. You can change this by supplying a <code>--directory</code> parameter. The Avro format is usd by default and the data files are stored in a sub-directory named after the payload Java class. In this example the stream payload is a String so the name of the data sub-directory is <code>string</code>. If you have multiple Java classes as payloads, each class will get its own sub-directory.</p>
</div>
<div class="paragraph">
<p>Let the stream run for a minute or so. You can then list the contents of the hadoop filesystem using the shell&#8217;s built in hadoop fs commands. You will first need to configure the shell to point to your name node using the hadoop config command. We use the hdfs protocol is to access the hadoop name node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop config fs --namenode hdfs://localhost:8020</pre>
</div>
</div>
<div class="paragraph">
<p>Then list the contents of the stream&#8217;s data directory.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop fs ls /xd/mydataset/string
Found 3 items
drwxr-xr-x   - trisberg supergroup          0 2013-12-19 12:23 /xd/mydataset/string/.metadata
-rw-r--r--   3 trisberg supergroup        202 2013-12-19 12:23 /xd/mydataset/string/1387473825754-63.avro
-rw-r--r--   3 trisberg supergroup        216 2013-12-19 12:24 /xd/mydataset/string/1387473846708-80.avro</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the sink has created two files containing the first two batches of 20 stream payloads each. There is also a <code>.metadata</code> directory created that contains the metadata that the Kite SDK Dataset implementation uses as well as the generated Avro schema for the persisted type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;hadoop fs ls /xd/mydataset/string/.metadata
Found 2 items
-rw-r--r--   3 trisberg supergroup        136 2013-12-19 12:23 /xd/mydataset/string/.metadata/descriptor.properties
-rw-r--r--   3 trisberg supergroup          8 2013-12-19 12:23 /xd/mydataset/string/.metadata/schema.avsc</pre>
</div>
</div>
<div class="paragraph">
<p>Now destroy the stream.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream destroy --name mydataset</pre>
</div>
</div>
<div class="sect3">
<h4 id="_hdfs_dataset_with_options">HDFS Dataset with Options</h4>
<div class="paragraph">
<p>The HDFS Dataset Sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">batchSize</dt>
<dd>
<p>The number of payload objects that will be stored in each write operation. <strong>(default: <code>10000</code>)</strong></p>
</dd>
<dt class="hdlist1">directory</dt>
<dd>
<p>Where the files will be written in the Hadoop FileSystem <strong>(default: <code>/xd/&lt;streamname&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">idleTimeout</dt>
<dd>
<p>Idle timeout in milliseconds for when the aggregated batch of payload objects will be written even if the batchSize has not been reached. <strong>(default: <code>-1</code>, no timeout)</strong></p>
</dd>
<dt class="hdlist1">allowNullValues</dt>
<dd>
<p>Whether to allow null values in fields of the Java class to be written to the sink. If this is set to true then each field in the generated schema will use a union of <em>null</em> and the data type of the field. You can annotate fields in a POJO using Avro&#8217;s <code>org.apache.avro.reflect.Nullable</code> annotation to create a schema using a union with <em>null</em> for that field. <strong>(default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">format</dt>
<dd>
<p>The format to use when writing the dataset data. Options are <code>avro</code> and <code>parquet</code>. <strong>(default: <code>avro</code>)</strong></p>
</dd>
<dt class="hdlist1">partitionPath</dt>
<dd>
<p>This option lets you specify one or more paths that will be used to partition the files that the data is written to based on the content of the data. You can use any of the <a href="http://kitesdk.org/docs/0.11.0/apidocs/org/kitesdk/data/FieldPartitioner.html">FieldPartitioner</a>s that are available for the Kite SDK project. We simply pass in what is specified to create the corresponding partition strategy. You can separate multiple paths with a <em>/</em> character. The following partitioning functions are available:</p>
<div class="ulist">
<ul>
<li>
<p><em>year, month, day, hour, minute</em> creates partitions based on the value of a timestamp and creates directories named like "YEAR=2014" (works well with fields of datatype long)</p>
<div class="ulist">
<ul>
<li>
<p>specify function plus field name like: <code>year('timestamp')</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>dateformat</em> creates partitions based on a timestamp and a dateformat expression provided - creates directories based on the name provided (works well with fields of datatype long)</p>
<div class="ulist">
<ul>
<li>
<p>specify function plus field name, a name for the partition and the date format like: <code>dateFormat('timestamp', 'Y-M', 'yyyyMM')</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>range</em> creates partitions based on a field value and the upper bounds for each bucket that is specified (works well with fields of datatype int and string)</p>
<div class="ulist">
<ul>
<li>
<p>specify function plus field name and the upper bounds for each partition bucket like: <code>range('age',20,50,80,T(Integer).MAX_VALUE)</code> (Note that you can use SpEL expressions like we just did for the Integer.MAX_VALUE)</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>identity</em> creates partitions based on the exact value of a field (works well with fields of datatype string, long and int)</p>
<div class="ulist">
<ul>
<li>
<p>specify function plus field name, a name for the partition, the type of the field (String or Integer) and the number of values/buckets for the partition like: <code>identity('region','R',T(String),10)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>hash</em> creates partitions based on the hash calculated from the value of a field divided into a number of buckets that is specified (works well with all data types)</p>
<div class="ulist">
<ul>
<li>
<p>specify function plus field name and number of buckets like: <code>hash('lastname',10)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Multiple expressions can be specified by separating them with a <em>/</em> like: <code>identity('region','R',T(String),10)/year('timestamp')/month('timestamp')</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jdbc">JDBC</h3>
<div class="paragraph">
<p>The JDBC sink can be used to insert message payload data into a relational database table. By default it inserts the entire payload into a table named after the stream name in the HSQLDB database that XD uses to store metadata for batch jobs.  To alter this behavior, the jdbc sink accepts several options that you can pass using the <code>--foo=bar</code> notation in the stream, or <a href="#module_values">change globally</a>. There is also a <em>config/init_db.sql</em> file that contains the SQL statements used to initialize the database table. You can modify this file if you&#8217;d like to create a table with your specific layout when the sink starts. You should also change the <em>initializeDatabase</em> property to <em>true</em> to have this script execute when the sink starts up.</p>
</div>
<div class="paragraph">
<p>The payload data will be inserted as-is if the <em>names</em> option is set to <em>payload</em>. This is the default behavior.  If you specify any other column names the payload data will be assumed to be a JSON document that will be converted to a hash map. This hash map will be used to populate the data values for the SQL insert statement. A matching of column names with underscores like <em>user_name</em> will match onto camel case style keys like <em>userName</em> in the hash map.  There will be one insert statement executed for each message.</p>
</div>
<div class="paragraph">
<p>To create a stream using a <code>jdbc</code> sink relying on all defaults you would use a command like</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name mydata --definition "time | jdbc --initializeDatabase=true" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This will insert the time messages into a <em>payload</em> column in a table named <em>mydata</em>. Since the default is using the XD batch metadata HSQLDB database we can connect to this database instance from an external tool. After we let the stream run for a little while, we can connect to the database and look at the data stored in the database.</p>
</div>
<div class="paragraph">
<p>You can query the database with your favorite SQL tool using the following database URL: <code>jdbc:hsqldb:hsql://localhost:9101/xdjob</code> with <code>sa</code> as the user name and a blank password. You can also use the HSQL provided SQL Tool (download from <a href="http://hsqldb.org/">HSQLDB</a>) to run a quick query from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ java -cp ~/Downloads/hsqldb-2.3.0/hsqldb/lib/sqltool.jar org.hsqldb.cmdline.SqlTool --inlineRc url=jdbc:hsqldb:hsql://localhost:9101/xdjob,user=sa,password= --sql "select payload from mydata;"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should result in something similar to the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2014-01-06 09:33:25
2014-01-06 09:33:26
2014-01-06 09:33:27
2014-01-06 09:33:28
2014-01-06 09:33:29
2014-01-06 09:33:30
2014-01-06 09:33:31
2014-01-06 09:33:32
2014-01-06 09:33:33
2014-01-06 09:33:34
2014-01-06 09:33:35
2014-01-06 09:33:36
2014-01-06 09:33:37</pre>
</div>
</div>
<div class="paragraph">
<p>Now we can destroy the stream using:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream destroy --name mydata</pre>
</div>
</div>
<div class="sect3">
<h4 id="_jdbc_with_options">JDBC with Options</h4>
<div class="paragraph">
<p>The <strong>jdbc</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">abandonWhenPercentageFull</dt>
<dd>
<p>connections that have timed out wont get closed and reported up unless the number of connections in use are above the percentage <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">alternateUsernameAllowed</dt>
<dd>
<p>uses an alternate user name if connection fails <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">columns</dt>
<dd>
<p>the database columns to map the data to <strong>(String, default: <code>payload</code>)</strong></p>
</dd>
<dt class="hdlist1">connectionProperties</dt>
<dd>
<p>connection properties that will be sent to our JDBC driver when establishing new connections <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">driverClassName</dt>
<dd>
<p>the JDBC driver to use <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">fairQueue</dt>
<dd>
<p>set to true if you wish that calls to getConnection should be treated fairly in a true FIFO fashion <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">initSQL</dt>
<dd>
<p>custom query to be run when a connection is first created <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">initialSize</dt>
<dd>
<p>initial number of connections that are created when the pool is started <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">initializeDatabase</dt>
<dd>
<p>whether the database initialization script should be run <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">initializerScript</dt>
<dd>
<p>the name of the SQL script (in /config) to run if <em>initializeDatabase</em> is set <strong>(String, default: <code>init_db.sql</code>)</strong></p>
</dd>
<dt class="hdlist1">jdbcInterceptors</dt>
<dd>
<p>semicolon separated list of classnames extending org.apache.tomcat.jdbc.pool.JdbcInterceptor <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">jmxEnabled</dt>
<dd>
<p>register the pool with JMX or not <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">logAbandoned</dt>
<dd>
<p>flag to log stack traces for application code which abandoned a Connection <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">maxActive</dt>
<dd>
<p>maximum number of active connections that can be allocated from this pool at the same time <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxAge</dt>
<dd>
<p>time in milliseconds to keep this connection <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">maxIdle</dt>
<dd>
<p>maximum number of connections that should be kept in the pool at all times <strong>(int, default: <code>100</code>)</strong></p>
</dd>
<dt class="hdlist1">maxWait</dt>
<dd>
<p>maximum number of milliseconds that the pool will wait for a connection <strong>(int, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">minEvictableIdleTimeMillis</dt>
<dd>
<p>minimum amount of time an object may sit idle in the pool before it is eligible for eviction <strong>(int, default: <code>60000</code>)</strong></p>
</dd>
<dt class="hdlist1">minIdle</dt>
<dd>
<p>minimum number of established connections that should be kept in the pool at all times <strong>(int, default: <code>10</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the JDBC password <strong>(Password, no default)</strong></p>
</dd>
<dt class="hdlist1">removeAbandoned</dt>
<dd>
<p>flag to remove abandoned connections if they exceed the removeAbandonedTimout <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">removeAbandonedTimeout</dt>
<dd>
<p>timeout in seconds before an abandoned connection can be removed <strong>(int, default: <code>60</code>)</strong></p>
</dd>
<dt class="hdlist1">suspectTimeout</dt>
<dd>
<p>this simply logs the warning after timeout, connection remains <strong>(int, default: <code>0</code>)</strong></p>
</dd>
<dt class="hdlist1">tableName</dt>
<dd>
<p>the database table to which the data will be written <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">testOnBorrow</dt>
<dd>
<p>indication of whether objects will be validated before being borrowed from the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testOnReturn</dt>
<dd>
<p>indication of whether objects will be validated before being returned to the pool <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">testWhileIdle</dt>
<dd>
<p>indication of whether objects will be validated by the idle object evictor <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">timeBetweenEvictionRunsMillis</dt>
<dd>
<p>number of milliseconds to sleep between runs of the idle connection validation/cleaner thread <strong>(int, default: <code>5000</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>the JDBC URL for the database <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">useEquals</dt>
<dd>
<p>true if you wish the ProxyConnection class to use String.equals <strong>(boolean, default: <code>true</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the JDBC username <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validationInterval</dt>
<dd>
<p>avoid excess validation, only run validation at most at this frequency - time in milliseconds <strong>(long, default: <code>30000</code>)</strong></p>
</dd>
<dt class="hdlist1">validationQuery</dt>
<dd>
<p>sql query that will be used to validate connections from this pool <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">validatorClassName</dt>
<dd>
<p>name of a class which implements the org.apache.tomcat.jdbc.pool.Validator <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To include the whole message into a single column, use <code>payload</code> (the default) for the <code>columns</code> option
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The connection pool settings for xd are located in servers.yml (i.e. <code>spring.datasource.*</code> )
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tcp-sink">TCP Sink</h3>
<div class="paragraph">
<p>The TCP Sink provides for outbound messaging over TCP.</p>
</div>
<div class="paragraph">
<p>The following examples use <code>netcat</code> (linux) to receive the data; the equivalent on Mac OSX is <code>nc</code>.</p>
</div>
<div class="paragraph">
<p>First, start a netcat to receive the data, and background it</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ netcat -l 1234 &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, configure a stream</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tcptest --definition "time --interval=3 | tcp" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This sends the time, every 3 seconds to the default tcp Sink, which connects to port <code>1234</code> on <code>localhost</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ Thu May 30 10:28:21 EDT 2013
Thu May 30 10:28:24 EDT 2013
Thu May 30 10:28:27 EDT 2013
Thu May 30 10:28:30 EDT 2013
Thu May 30 10:28:33 EDT 2013</pre>
</div>
</div>
<div class="paragraph">
<p>TCP is a streaming protocol and some mechanism is needed to frame messages on the wire. A number of encoders are available, the default being <em>CRLF</em>.</p>
</div>
<div class="paragraph">
<p>Destroy the stream; netcat will terminate when the TCP Sink disconnects.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080&gt; stream destroy --name tcptest</pre>
</div>
</div>
<div class="sect3">
<h4 id="_tcp_with_options_2">TCP with Options</h4>
<div class="paragraph">
<p>The <strong>tcp</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">bufferSize</dt>
<dd>
<p>the size of the buffer (bytes) to use when encoding/decoding <strong>(int, default: <code>2048</code>)</strong></p>
</dd>
<dt class="hdlist1">charset</dt>
<dd>
<p>the charset used when converting from String to bytes <strong>(String, default: <code>UTF-8</code>)</strong></p>
</dd>
<dt class="hdlist1">close</dt>
<dd>
<p>whether to close the socket after each message <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">encoder</dt>
<dd>
<p>the encoder to use when sending messages <strong>(Encoding, default: <code>CRLF</code>, possible values: <code>CRLF,LF,NULL,STXETX,RAW,L1,L2,L4</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>the remote host to connect to <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">nio</dt>
<dd>
<p>whether or not to use NIO <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port on the remote host to connect to <strong>(int, default: <code>1234</code>)</strong></p>
</dd>
<dt class="hdlist1">reverseLookup</dt>
<dd>
<p>perform a reverse DNS lookup on the remote IP Address <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">socketTimeout</dt>
<dd>
<p>the timeout (ms) before closing the socket when no data is received <strong>(int, default: <code>120000</code>)</strong></p>
</dd>
<dt class="hdlist1">useDirectBuffers</dt>
<dd>
<p>whether or not to use direct buffers <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
With the default retry configuration, the attempts will be made after 0, 2, 4, 8, and 16 seconds.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_available_encoders">Available Encoders</h4>
<div class="dlist">
<div class="title">Text Data</div>
<dl>
<dt class="hdlist1">CRLF (default)</dt>
<dd>
<p>text terminated by carriage return (0x0d) followed by line feed (0x0a)</p>
</dd>
<dt class="hdlist1">LF</dt>
<dd>
<p>text terminated by line feed (0x0a)</p>
</dd>
<dt class="hdlist1">NULL</dt>
<dd>
<p>text terminated by a null byte (0x00)</p>
</dd>
<dt class="hdlist1">STXETX</dt>
<dd>
<p>text preceded by an STX (0x02) and terminated by an ETX (0x03)</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Text and Binary Data</div>
<dl>
<dt class="hdlist1">RAW</dt>
<dd>
<p>no structure - the client indicates a complete message by closing the socket</p>
</dd>
<dt class="hdlist1">L1</dt>
<dd>
<p>data preceded by a one byte (unsigned) length field (supports up to 255 bytes)</p>
</dd>
<dt class="hdlist1">L2</dt>
<dd>
<p>data preceded by a two byte (unsigned) length field (up to 2<sup>16</sup>-1 bytes)</p>
</dd>
<dt class="hdlist1">L4</dt>
<dd>
<p>data preceded by a four byte (signed) length field (up to 2<sup>31</sup>-1 bytes)</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_an_additional_example">An Additional Example</h4>
<div class="paragraph">
<p>Start netcat in the background and redirect the output to a file <code>foo</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ netcat -l 1235 &gt; foo &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the stream, using the <code>L4</code> encoder</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tcptest --definition "time --interval=3 | tcp --encoder=L4 --port=1235" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Destroy the stream</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:8080&gt; stream destroy --name tcptest</pre>
</div>
</div>
<div class="paragraph">
<p>Check the output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ hexdump -C foo
00000000  00 00 00 1c 54 68 75 20  4d 61 79 20 33 30 20 31  |....Thu May 30 1|
00000010  30 3a 34 37 3a 30 33 20  45 44 54 20 32 30 31 33  |0:47:03 EDT 2013|
00000020  00 00 00 1c 54 68 75 20  4d 61 79 20 33 30 20 31  |....Thu May 30 1|
00000030  30 3a 34 37 3a 30 36 20  45 44 54 20 32 30 31 33  |0:47:06 EDT 2013|
00000040  00 00 00 1c 54 68 75 20  4d 61 79 20 33 30 20 31  |....Thu May 30 1|
00000050  30 3a 34 37 3a 30 39 20  45 44 54 20 32 30 31 33  |0:47:09 EDT 2013|</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the 4 byte length field preceding the data generated by the <code>L4</code> encoder.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mongo">Mongo</h3>
<div class="paragraph">
<p>The Mongo sink writes into a Mongo collection. Here is a simple example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;stream create --name attendees --definition "http | mongodb --databaseName=test --collectionName=names" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Then,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt;http post --data {"firstName":"mark"}</pre>
</div>
</div>
<div class="paragraph">
<p>In the mongo console you will see the document stored</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; use test
switched to db test
&gt; show collections
names
system.indexes
&gt; db.names.find()
{ "_id" : ObjectId("53c93bc324ac76925a77b9df"), "firstName" : "mark" }</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>mongodb</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">collectionName</dt>
<dd>
<p>the MongoDB collection to store <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">databaseName</dt>
<dd>
<p>the MongoDB database name <strong>(String, default: <code>xd</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>the MongoDB host <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the MongoDB port <strong>(int, default: <code>27017</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="mail">Mail</h3>
<div class="paragraph">
<p>The "mail" sink allows sending of messages as emails, leveraging Spring Integration mail-sending channel adapter. Please refer to Spring Integration documentation for the details, but in a nutshell, the sink is able to handle String, byte[] and MimeMessage messages out of the box.</p>
</div>
<div class="paragraph">
<p>Here is a simple example of how the mail module is used:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create mystream --definition "http | mail --to='\"your.email@gmail.com\"' --host=your.imap.server --subject=payload+' world'" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Then,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --data Hello</pre>
</div>
</div>
<div class="paragraph">
<p>You would then receive an email whose body contains "Hello" and whose subject is "Hellow world". Of special attention here is the way you need to escape strings for most of the parameters, because they&#8217;re actually SpEL expressions (so here for example, we used a String literal for the <code>to</code> parameter).</p>
</div>
<div class="paragraph">
<p>The <strong>mail</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">bcc</dt>
<dd>
<p>the recipient(s) that should receive a blind carbon copy (SpEL) <strong>(String, default: <code>null</code>)</strong></p>
</dd>
<dt class="hdlist1">cc</dt>
<dd>
<p>the recipient(s) that should receive a carbon copy (SpEL) <strong>(String, default: <code>null</code>)</strong></p>
</dd>
<dt class="hdlist1">contentType</dt>
<dd>
<p>the content type to use when sending the email (SpEL) <strong>(String, default: <code>null</code>)</strong></p>
</dd>
<dt class="hdlist1">from</dt>
<dd>
<p>the primary recipient(s) of the email (SpEL) <strong>(String, default: <code>null</code>)</strong></p>
</dd>
<dt class="hdlist1">host</dt>
<dd>
<p>the hostname of the mail server <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password to use to connect to the mail server  <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the port of the mail server <strong>(int, default: <code>25</code>)</strong></p>
</dd>
<dt class="hdlist1">replyTo</dt>
<dd>
<p>the address that will become the recipient if the original recipient decides to "reply to" the email (SpEL) <strong>(String, default: <code>null</code>)</strong></p>
</dd>
<dt class="hdlist1">subject</dt>
<dd>
<p>the email subject (SpEL) <strong>(String, default: <code>null</code>)</strong></p>
</dd>
<dt class="hdlist1">to</dt>
<dd>
<p>the primary recipient(s) of the email (SpEL) <strong>(String, default: <code>null</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username to use to connect to the mail server <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="rabbitmq">RabbitMQ</h3>
<div class="paragraph">
<p>The "rabbit" sink enables outbound messaging over RabbitMQ.</p>
</div>
<div class="paragraph">
<p>The following example shows the default settings.</p>
</div>
<div class="paragraph">
<p>Configure a stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name rabbittest --definition "time --interval=3 | rabbit" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>This sends the time, every 3 seconds to the default (no-name) Exchange for a RabbitMQ broker running on localhost, port 5672.</p>
</div>
<div class="paragraph">
<p>The routing key will be the name of the stream by default; in this case: "rabbittest". Since the default Exchange is a direct-exchange to which all Queues are bound with the Queue name as the binding key, all messages sent via this sink will be passed to a Queue named "rabbittest", if one exists. We do not create that Queue automatically. However, you can easily create a Queue using the RabbitMQ web UI. Then, using that same UI, you can navigate to the "rabbittest" Queue and click the "Get Message(s)" button to pop messages off of that Queue (you can choose whether to requeue those messages).</p>
</div>
<div class="paragraph">
<p>To destroy the stream, enter the following at the shell prompt:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream destroy --name rabbittest</pre>
</div>
</div>
<div class="sect3">
<h4 id="_rabbitmq_with_options_2">RabbitMQ with Options</h4>
<div class="paragraph">
<p>The <strong>rabbit</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">addresses</dt>
<dd>
<p>a comma separated list of <em>host[:port]</em> addresses <strong>(String, default: <code>${spring.rabbitmq.addresses}</code>)</strong></p>
</dd>
<dt class="hdlist1">converterClass</dt>
<dd>
<p>the class name of the message converter <strong>(String, default: <code>org.springframework.amqp.support.converter.SimpleMessageConverter</code>)</strong></p>
</dd>
<dt class="hdlist1">deliveryMode</dt>
<dd>
<p>the delivery mode (PERSISTENT, NON_PERSISTENT) <strong>(String, default: <code>PERSISTENT</code>)</strong></p>
</dd>
<dt class="hdlist1">exchange</dt>
<dd>
<p>the Exchange on the RabbitMQ broker to which messages should be sent <strong>(String, default: ``)</strong></p>
</dd>
<dt class="hdlist1">mappedRequestHeaders</dt>
<dd>
<p>request message header names to be propagated to/from the adpater/gateway <strong>(String, default: <code>STANDARD_REQUEST_HEADERS</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password to use to connect to the broker <strong>(String, default: <code>${spring.rabbitmq.password}</code>)</strong></p>
</dd>
<dt class="hdlist1">routingKey</dt>
<dd>
<p>the routing key to be passed with the message, as a SpEL expression <strong>(String, default: <code>'&lt;stream name&gt;'</code>)</strong></p>
</dd>
<dt class="hdlist1">sslPropertiesLocation</dt>
<dd>
<p>resource containing SSL properties <strong>(String, default: <code>${spring.rabbitmq.sslProperties}</code>)</strong></p>
</dd>
<dt class="hdlist1">useSSL</dt>
<dd>
<p>true if SSL should be used for the connection <strong>(String, default: <code>${spring.rabbitmq.useSSL}</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username to use to connect to the broker <strong>(String, default: <code>${spring.rabbitmq.username}</code>)</strong></p>
</dd>
<dt class="hdlist1">vhost</dt>
<dd>
<p>the RabbitMQ virtual host to use <strong>(String, default: <code>${spring.rabbitmq.virtual_host}</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Please be aware that the <code>routingKey</code> option is actually a SpEL expression. Hence if a simple, constant, string literal is to be used, make sure to use something like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create rabbitSinkStream --definition "http | rabbit --routingKey='\"myqueue\"'" --deploy</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="#rabbitssl">RabbitMQ MessageBus Documentation</a> for more information about SSL configuration.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gemfire-server">GemFire Server</h3>
<div class="paragraph">
<p>Currently XD supports GemFire&#8217;s client-server topology. A sink that writes data to a GemFire cache requires at least one  cache server to be running in a separate process and may also be configured to use a Locator. While Gemfire configuration is outside of the scope of this document, details are covered in the <a href="http://docs.gopivotal.com/gemfire/index.html">GemFire Product documentation</a>. The XD distribution includes a standalone GemFire server executable suitable for development and test purposes and bootstrapped using a Spring configuration file provided as a command line argument. The GemFire jar is distributed freely under GemFire&#8217;s development license and is subject to the license&#8217;s terms and conditions. Sink modules provided with the XD distrubution that write data to GemFire create a client cache and client region. No data is cached on the client.</p>
</div>
<div class="sect3">
<h4 id="_launching_the_xd_gemfire_server_2">Launching the XD GemFire Server</h4>
<div class="paragraph">
<p>To start the GemFire cache server GemFire Server included in the Spring XD distribution, go to the XD install directory:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$cd gemfire/bin
$./gemfire-server ../config/cq-demo.xml</pre>
</div>
</div>
<div class="paragraph">
<p>The command line argument is the path of a Spring Data Gemfire configuration file with including a configured cache server and one or more regions. A sample cache configuration is provided <a href="https://github.com/SpringSource/spring-xd/blob/master/spring-xd-gemfire-server/config/cq-demo.xml">cq-demo.xml</a> located in the <code>config</code> directory. Note that Spring interprets the path as a relative path unless it is explicitly preceded by <code>file:</code>. The sample configuration starts a server on port 40404 and creates a region named <em>Stocks</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gemfire_sinks">Gemfire sinks</h4>
<div class="paragraph">
<p>There are 2 implementation of the gemfire sink: <em>gemfire-server</em> and <em>gemfire-json-server</em>. They are identical except the latter converts JSON string payloads to a JSON document format proprietary to GemFire and provides JSON field access and query capabilities. If you are not using JSON, the gemfire-server module will write the payload using java serialization to the configured region. Both modules accept the same options.</p>
</div>
<div class="paragraph">
<p>The <strong>gemfire-server</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">host</dt>
<dd>
<p>host name of the cache server or locator (if useLocator=true) <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">keyExpression</dt>
<dd>
<p>a SpEL expression which is evaluated to create a cache key <strong>(String, default: <code>'&lt;stream name&gt;'</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>port of the cache server or locator (if useLocator=true) <strong>(int, default: <code>40404</code>)</strong></p>
</dd>
<dt class="hdlist1">regionName</dt>
<dd>
<p>name of the region to use when storing data <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">useLocator</dt>
<dd>
<p>indicates whether a locator is used to access the cache server <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The <code>keyExpression</code>, as its name suggests, is a SpEL. Typically, the key value is derived from the payload. The default of <code>'&lt;streamname&gt;'</code> (mind the quotes), will overwrite the same entry for every message received on the stream.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The locator option is mostly intended for integration with an existing GemFire installation in which the cache servers are configured to use locators in accordance with best practice. While GemFire supports configuration of multiple locators for failover, this is currently not supported in XD. However, using a single virtual IP backed by hardware routers for failover has proven to be an effective and simpler alternative.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_example_2">Example</h4>
<div class="paragraph">
<p>Suppose we have a JSON document containing a stock price:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{"symbol":"FAKE", "price":73}</pre>
</div>
</div>
<div class="paragraph">
<p>We want this to be cached using the stock symbol as the key. The stream definition is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http | gemfire-json-server --regionName=Stocks --keyExpression=payload.getField('symbol')</pre>
</div>
</div>
<div class="paragraph">
<p>The keyExpression is a SpEL expression that depends on the payload type. In this case, <em>com.gemstone.org.json.JSONObject. JSONObject</em> which  provides the <em>getField</em> method. To run this example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name stocks --definition "http --port=9090 | gemfire-json-server --regionName=Stocks --keyExpression=payload.getField('symbol')" --deploy</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data {"symbol":"FAKE","price":73}</pre>
</div>
</div>
<div class="paragraph">
<p>This will write an entry to the GemFire <em>Stocks</em> region with the key <em>FAKE</em>.  Please do not put spaces when separating the JSON key-value pairs, only a comma.</p>
</div>
<div class="paragraph">
<p>You should see a message on STDOUT for the process running the GemFire server like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>INFO [LoggingCacheListener] - updated entry FAKE</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In order to use locators you must add the <code>use-locator</code> to the active profile via server.yml or the spring.profiles_active environment variable.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="splunk-server">Splunk Server</h3>
<div class="paragraph">
<p>A <a href="http://www.splunk.com/">Splunk</a> sink that writes data to a TCP Data Input type for Splunk.</p>
</div>
<div class="sect3">
<h4 id="_splunk_sinks">Splunk sinks</h4>
<div class="paragraph">
<p>The Splunk sink converts an object payload to a string using the object’s toString method and then converts this to a SplunkEvent that is sent via TCP to Splunk.</p>
</div>
<div class="paragraph">
<p>The <strong>splunk</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">host</dt>
<dd>
<p>the host name or IP address of the Splunk server <strong>(String, default: <code>localhost</code>)</strong></p>
</dd>
<dt class="hdlist1">owner</dt>
<dd>
<p>the owner of the tcpPort <strong>(String, default: <code>admin</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password associated with the username <strong>(String, default: <code>password</code>)</strong></p>
</dd>
<dt class="hdlist1">port</dt>
<dd>
<p>the TCP port number of the Splunk server <strong>(int, default: <code>8089</code>)</strong></p>
</dd>
<dt class="hdlist1">tcpPort</dt>
<dd>
<p>the TCP port number to where XD will send the data <strong>(int, default: <code>9500</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the login name that has rights to send data to the tcpPort <strong>(String, default: <code>admin</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_setup_splunk_for_tcp_input">How To Setup Splunk for TCP Input</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the Manager page select <code>Manage Inputs</code> link</p>
</li>
<li>
<p>Click the <code>Add data</code> Button</p>
</li>
<li>
<p>Click the <code>From a TCP port</code> link</p>
</li>
<li>
<p><code>TCP Port</code> enter the port you want Splunk to monitor</p>
</li>
<li>
<p><code>Set Source Type</code> select <code>Manual</code></p>
</li>
<li>
<p><code>Source Type</code> enter <code>tcp-raw</code></p>
</li>
<li>
<p>Click <code>Save</code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_example_3">Example</h4>
<div class="paragraph">
<p>An example stream would be to take data from a twitter search and push it through to a splunk instance.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name springone2gx --definition "twittersearch --consumerKey= --consumerSecret= --query='#LOTR' | splunk" --deploy</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mqtt-sink">MQTT Sink</h3>
<div class="paragraph">
<p>The mqtt sink connects to an mqtt server and publishes telemetry messages.</p>
</div>
<div class="sect3">
<h4 id="_options_4">Options</h4>
<div class="paragraph">
<p>The <strong>mqtt</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">clientId</dt>
<dd>
<p>identifies the client <strong>(String, default: <code>xd.mqtt.client.id.snk</code>)</strong></p>
</dd>
<dt class="hdlist1">password</dt>
<dd>
<p>the password to use when connecting to the broker <strong>(String, default: <code>guest</code>)</strong></p>
</dd>
<dt class="hdlist1">qos</dt>
<dd>
<p>the quality of service to use <strong>(int, default: <code>1</code>)</strong></p>
</dd>
<dt class="hdlist1">retained</dt>
<dd>
<p>whether to set the <em>retained</em> flag <strong>(boolean, default: <code>false</code>)</strong></p>
</dd>
<dt class="hdlist1">topic</dt>
<dd>
<p>the topic to which the sink will publish <strong>(String, default: <code>xd.mqtt.test</code>)</strong></p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>location of the mqtt broker <strong>(String, default: <code>tcp://localhost:1883</code>)</strong></p>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>the username to use when connecting to the broker <strong>(String, default: <code>guest</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The defaults are set up to connect to the RabbitMQ MQTT adapter on localhost.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-router">Dynamic Router</h3>
<div class="paragraph">
<p>The Dynamic Router support allows for routing Spring XD messages to <strong>named channels</strong> based on the evaluation of SpEL expressions or Groovy Scripts.</p>
</div>
<div class="sect3">
<h4 id="_spel_based_routing">SpEL-based Routing</h4>
<div class="paragraph">
<p>In the following example, 2 streams are created that listen for message on the <strong>foo</strong> and the <strong>bar</strong> channel. Furthermore, we create a stream that receives messages via HTTP and then delegates the received messages to a router:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create f --definition "queue:foo &gt; transform --expression=payload+'-foo' | log" --deploy
Created new stream 'f'

xd:&gt;stream create b --definition "queue:bar &gt; transform --expression=payload+'-bar' | log" --deploy
Created new stream 'b'

xd:&gt;stream create r --definition "http | router --expression=payload.contains('a')?'queue:foo':'queue:bar'" --deploy
Created new stream 'r'</pre>
</div>
</div>
<div class="paragraph">
<p>Now we make 2 requests to the HTTP source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;http post --data "a"
&gt; POST (text/plain;Charset=UTF-8) http://localhost:9000 a
&gt; 200 OK

xd:&gt;http post --data "b"
&gt; POST (text/plain;Charset=UTF-8) http://localhost:9000 b
&gt; 200 OK</pre>
</div>
</div>
<div class="paragraph">
<p>In the server log you should see the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>11:54:19,868  WARN ThreadPoolTaskScheduler-1 sink.f:145 - a-foo
11:54:25,669  WARN ThreadPoolTaskScheduler-1 sink.b:145 - b-bar</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, please also consult the Spring Integration Reference manual: <a href="http://static.springsource.org/spring-integration/reference/html/messaging-routing-chapter.html#router-namespace">http://static.springsource.org/spring-integration/reference/html/messaging-routing-chapter.html#router-namespace</a> particularly the section "Routers and the Spring Expression Language (SpEL)".</p>
</div>
</div>
<div class="sect3">
<h4 id="_groovy_based_routing">Groovy-based Routing</h4>
<div class="paragraph">
<p>Instead of SpEL expressions, Groovy scripts can also be used. Let&#8217;s create a Groovy script in the file system at "/my/path/router.groovy"</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">println("Groovy processing payload '" + payload +"'");
if (payload.contains('a')) {
	return ":foo"
}
else {
	return ":bar"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we create the following streams:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create f --definition ":foo &gt; transform --expression=payload+'-foo' | log" --deploy
Created new stream 'f'

xd:&gt;stream create b --definition ":bar &gt; transform --expression=payload+'-bar' | log" --deploy
Created new stream 'b'

xd:&gt;stream create g --definition "http | router --script='file:/my/path/router.groovy'" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now post some data to the HTTP source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;http post --data "a"
&gt; POST (text/plain;Charset=UTF-8) http://localhost:9000 a
&gt; 200 OK

xd:&gt;http post --data "b"
&gt; POST (text/plain;Charset=UTF-8) http://localhost:9000 b
&gt; 200 OK</pre>
</div>
</div>
<div class="paragraph">
<p>In the server log you should see the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Groovy processing payload 'a'
11:29:27,274  WARN ThreadPoolTaskScheduler-1 sink.f:145 - a-foo
Groovy processing payload 'b'
11:34:09,797  WARN ThreadPoolTaskScheduler-1 sink.b:145 - b-bar</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use Groovy scripts located on your classpath by specifying:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--script='org/my/package/router.groovy'</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, please also consult the Spring Integration Reference manual: "Groovy support"
<a href="http://static.springsource.org/spring-integration/reference/html/messaging-endpoints-chapter.html#groovy">http://static.springsource.org/spring-integration/reference/html/messaging-endpoints-chapter.html#groovy</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_options_5">Options</h4>
<div class="paragraph">
<p>The <strong>router</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">expression</dt>
<dd>
<p>a SpEL expression used to transform messages <strong>(String, default: <code>payload.toString()</code>)</strong></p>
</dd>
<dt class="hdlist1">script</dt>
<dd>
<p>reference to a script used to transform messages <strong>(String, no default)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If the <code>script</code> option is set, then the <code>expression</code> option will be ignored. As with other modules, the groovy script is checked for updates every 60 seconds. The script can be loaded from the classpath or from the file system <em>e.g.</em> <code>--script='org/springframework/springxd/samples/batch/router.groovy'</code> or <code>--script='file:/my/path/router.groovy'</code>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="taps">Taps</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_15">Introduction</h3>
<div class="paragraph">
<p>A Tap allows you to "listen" to data while it is processed in an existing stream and process the data in a separate stream. The original stream is unaffected by the tap and isn&#8217;t aware of its presence, similar to a phone wiretap. (<a href="http://www.enterpriseintegrationpatterns.com/WireTap.html">WireTap</a> is included in the standard catalog of EAI patterns and <a href="http://static.springsource.org/spring-integration/reference/htmlsingle/#channel-wiretap">implemented in</a> the Spring Integration EAI framework used by Spring XD).</p>
</div>
<div class="paragraph">
<p>Simply put, a Tap is a stream that uses a point in another stream as a source.</p>
</div>
<div class="sect3">
<h4 id="_example_4">Example</h4>
<div class="paragraph">
<p>The following XD shell commands create a stream <code>foo1</code> and a tap named <code>foo1tap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream create --name foo1 --definition "time | log" --deploy
xd:&gt; stream create --name foo1tap --definition "tap:stream:foo1 &gt; log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Since a tap is a type of stream, use the <code>stream create</code> command to create the tap. The tap source is specified using the <a href="#named-channels">named channel syntax</a> and always begins with <code>tap:</code>. In this case, we are tapping the stream named <code>foo1</code> specified by <code>:stream:foo1</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>stream:</code> is required in this case as it is possible to tap alternate XD targets such as jobs. This tap consumes data at the source of the target stream.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A tap can consume data from any point along the target stream&#8217;s processing pipeline. XD provides a few ways to tap a stream after a given processor has been applied:</p>
</div>
</div>
<div class="sect3">
<h4 id="_example_tap_after_a_processor_has_been_applied">Example - tap after a processor has been applied</h4>
<div class="paragraph">
<p>If the module name is unique in the target stream, use tap:stream:&lt;stream_name&gt;.&lt;module_name&gt;</p>
</div>
<div class="paragraph">
<p>If you have a stream called <code>mystream</code>, defined as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http | filter --expression=payload.startsWith('A') | transform --expression=payload.toLowerCase() | file</pre>
</div>
</div>
<div class="paragraph">
<p>Create a tap after the filter is applied using</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tap:stream:mystream.filter &gt; ....</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_using_a_label">Example - using a label</h4>
<div class="paragraph">
<p>You may also use labels to create an alias for a module and reference the label in the tap</p>
</div>
<div class="paragraph">
<p>If you have a stream called <code>mystream</code>, defined as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http | transform --expression=payload.toLowerCase() | flibble: transform --expression=payload.substring(3) | file</pre>
</div>
</div>
<div class="paragraph">
<p>Create a tap after the second transformer is applied using</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tap:stream:mystream.flibble &gt; ....</pre>
</div>
</div>
<div class="paragraph">
<p>A primary use case for a Tap is to perform realtime analytics at the same time as data is being ingested via its primary stream. For example, consider a Stream of data that is consuming Twitter search results and writing them to HDFS. A tap can be created before the data is written to HDFS, and the data piped from the tap to a counter that correspond to the number of times specific hashtags were mentioned in the tweets.</p>
</div>
<div class="paragraph">
<p>Creating a tap on a named channel, a stream whose source is a named channel, or a label is not yet supported. This is planned for a future release.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll find specific examples of creating taps on existing streams in the <a href="#analytics">Analytics</a> section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In cases where a multiple modules with the same module name, a label must be specified on the module to be tapped.  For example if you want to tap the 2nd transform:
<code>http | transform --expression=payload.toLowerCase() | tapMe: transform --expression=payload.substring(3) | file</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tap_lifecycle">Tap Lifecycle</h3>
<div class="paragraph">
<p>A side effect of a stream being unaware of any taps on its pipeline is that deleting the stream will not automatically delete the taps. The taps have to be deleted separately. However if the tapped stream is re-created, the existing tap will continue to function.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="analytics">Analytics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_16">Introduction</h3>
<div class="paragraph">
<p>Spring XD provides support for the real-time evaluation of various machine learning scoring algorithms as well simple real-time data analytics using various types of counters and gauges. The analytics functionality is provided via modules that can be added to a stream. In that sense, real-time analytics is accomplished via the same exact model as data-ingestion. It&#8217;s possible that the primary role of a stream is to perform real-time analytics, but it&#8217;s quite common to add a <a href="#taps">tap</a> to initiate a secondary stream where analytics, e.g. a field-value-counter, is applied to the same data being ingested through a primary stream. You will see both approaches in the examples below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_predictive_analytics">Predictive analytics</h3>
<div class="paragraph">
<p>Spring XD&#8217;s support for implementing predictive analytics by scoring analytical models that leverage machine learning algorithms begins with an extensible class library foundation upon which implementations can be built, such as the <a href="https://github.com/spring-projects/spring-xd-modules/tree/master/analytics-ml-pmml">PMML Module</a> that we describe here.</p>
</div>
<div class="paragraph">
<p>That module integrates with the <a href="https://github.com/jpmml/jpmml-evaluator">JPMML-Evaluator</a> library that provides support for a wide range of <a href="https://github.com/jpmml/jpmml-evaluator#features">model types</a> and is interoperable with models exported from <a href="http://www.r-project.org/">R</a>, <a href="http://rattle.togaware.com/">Rattle</a>, <a href="http://www.knime.org/">KNIME</a>, and <a href="http://rapid-i.com/content/view/181/190/">RapidMiner</a>.  For counter and gauge analytics, in-memory and <a href="http://redis.io/">Redis</a> implementations are provided.</p>
</div>
<div class="paragraph">
<p>Incorporating the evaluation of machine learning algorithms into stream processing is as easy as using any other processing module.  Here is a simple example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http --outputType=application/x-xd-tuple | analytic-pmml
     --location=/models/iris-flower-naive-bayes.pmml.xml
     --inputFieldMapping=
       'sepalLength:Sepal.Length,
        sepalWidth:Sepal.Width,
        petalLength:Petal.Length,
        petalWidth:Petal.Width'
     --outputFieldMapping='Predicted_Species:predictedSpecies' | log"</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>http</code> source converts posted data to a Tuple.  The <code>analytic-pmml</code> processor loads the model from the specifed file and creates two mappings so that fields from the Tuple can be mapped into the input and output model names.  The <code>log</code> sink writes the payload of the event message to the log file of the XD container.</p>
</div>
<div class="paragraph">
<p>Posting the following JSON data to the http source</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "sepalLength": "6.4",
  "sepalWidth":  "3.2",
  "petalLength": "4.5",
  "petalWidth":  "1.5"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will produce output in the log file as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
   "id":"1722ec00-baad-11e3-b988-005056c00008",
   "timestamp":1396473833152,
   "sepalLength":"6.4",
   "sepalWidth":"3.2",
   "petalLength":"4.5",
   "petalWidth":"1.5",
   "predictedSpecies":"versicolor"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next section on analytical models goes into more detail on the general infrastructure</p>
</div>
</div>
<div class="sect2">
<h3 id="_analytical_models">Analytical Models</h3>
<div class="paragraph">
<p>We provide some core abstractions for implementing analytical models in stream processing applications.
The main interface for integrating analytical models is <strong>Analytic</strong>. Some analytical
models need to adjust the domain input and the model output in some way, therefore we provide a special base class <strong>MappedAnalytic</strong>
which has core abstractions for implementing that mapping via <strong>InputMapper</strong> and <strong>OutputMapper</strong>.</p>
</div>
<div class="paragraph">
<p>Since <strong>Spring XD 1.0.0.M6</strong> we support the integration of analytical models, also called statistical models or mining models, that are defined via <a href="http://en.wikipedia.org/wiki/Predictive_Model_Markup_Language"><strong>PMML</strong></a>.
<strong>PMML</strong> is the abbreviation for <strong>Predictive Model Markup Language</strong> and is a standard XML representation that allows specifications of different mining models, their ensembles, and associated preprocessing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>PMML</strong> is maintained by the <strong>Data Mining Group</strong> (<strong>DMG</strong>) and supported by several state-of-the-art statistics and data mining software tools such as InfoSphere Warehouse, R / Rattle, SAS Enterprise Miner, SPSS®, and Weka.
The current version of the <strong>PMML</strong> specification is <a href="http://www.dmg.org/v4-2/GeneralStructure.html"><strong>4.2</strong></a> at the time of this writing.
Applications can produce and consume <strong>PMML</strong> models, thus allowing an analytical model created in one application to be implemented and used for scoring or prediction in another.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>PMML</strong> is just one of many other technologies that one can integrate to implement analytics with, more will follow in upcoming releases.</p>
</div>
<div class="sect3">
<h4 id="_modeling_and_evaluation">Modeling and Evaluation</h4>
<div class="paragraph">
<p>Analytical models are usually defined by a statistician <em>aka</em> data scientist or quant by using some statistical tool to analyze the data and build an appropriate model.
In order to implement those models in a business application they are usually transformed and exported in some way (<em>e.g.</em> in the form of a <strong>PMML</strong> definition).
This model is then loaded into the application which then evaluates it against a given input (event, tuple, example).</p>
</div>
</div>
<div class="sect3">
<h4 id="_modeling">Modeling</h4>
<div class="paragraph">
<p>Analytical models can be defined in various ways. For the sake of brevity we use <strong>R</strong> from the <a href="http://www.r-project.org"><strong>r-project</strong></a> to demonstrate
how easy it is to export an analytical model to <strong>PMML</strong> and use it later in stream processing.</p>
</div>
<div class="paragraph">
<p>For our example we use the <a href="http://en.wikipedia.org/wiki/Iris_flower_data_set"><strong>iris</strong></a> example dataset in <strong>R</strong> to generate a classifier for iris flower species by applying the <a href="http://en.wikipedia.org/wiki/Naive_Bayes_classifier"><strong>Naive Bayes</strong></a> algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="r language-r">library(e1071) # Load library with the naive bayes algorithm support.

library(pmml) # Load library with PMML export support.

data(iris) # Load the IRIS example dataset

#Helper function to split the given dataset into a dataset used for training (trainset) and (testset) used for evaulation.
splitDataFrame &lt;- function(dataframe, seed = NULL, n = trainSize) {

   if (!is.null(seed)){
      set.seed(seed)
   }

   index &lt;- 1:nrow(dataframe)
   trainindex &lt;- sample(index, n)
   trainset &lt;- dataframe[trainindex, ]
   testset &lt;- dataframe[-trainindex, ]

   list(trainset = trainset, testset = testset)
}

#We want to use 95% of the IRIS data as training data and 5% as test data for evaluation.
datasets &lt;- splitDataFrame(iris, seed = 1337, n= round(0.95 * nrow(iris)))

#Create a naive Bayes classifier to predict iris flower species (iris[,5]) from [,1:4] = Sepal.Length Sepal.Width Petal.Length Petal.Width
model &lt;- naiveBayes(datasets$trainset[,1:4], datasets$trainset[,5])

#The name of the model and it's externalId could be used to uniquely identify this version of the model.
modelName = "iris-flower-classifier"
externalId = 42

#Convert the given model into a PMML model definition
pmmlDefinition = pmml.naiveBayes(model,model.name=paste(modelName,externalId,sep = ";"), predictedField='Species')

#Print the PMML definition to stdout
cat(toString(pmmlDefinition))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The r script above should produce the following <strong>PMML</strong> document that contains the abstract definition of the naive bayes classifier that we derived
from the training dataset of the IRIS dataset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;PMML version="4.1" xmlns="http://www.dmg.org/PMML-4_1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.dmg.org/PMML-4_1 http://www.dmg.org/v4-1/pmml-4-1.xsd"&gt;
&lt;Header copyright="Copyright (c) 2014 tom" description="NaiveBayes Model"&gt;
 &lt;Extension name="user" value="tom" extender="Rattle/PMML"/&gt;
 &lt;Application name="Rattle/PMML" version="1.4"/&gt;
 &lt;Timestamp&gt;2014-04-02 13:22:15&lt;/Timestamp&gt;
&lt;/Header&gt;
&lt;DataDictionary numberOfFields="6"&gt;
 &lt;DataField name="Species" optype="categorical" dataType="string"&gt;
  &lt;Value value="setosa"/&gt;
  &lt;Value value="versicolor"/&gt;
  &lt;Value value="virginica"/&gt;
 &lt;/DataField&gt;
 &lt;DataField name="Sepal.Length" optype="continuous" dataType="double"/&gt;
 &lt;DataField name="Sepal.Width"  optype="continuous" dataType="double"/&gt;
 &lt;DataField name="Petal.Length" optype="continuous" dataType="double"/&gt;
 &lt;DataField name="Petal.Width"  optype="continuous" dataType="double"/&gt;
 &lt;DataField name="DiscretePlaceHolder" optype="categorical" dataType="string"&gt;
  &lt;Value value="pseudoValue"/&gt;
 &lt;/DataField&gt;
&lt;/DataDictionary&gt;
&lt;NaiveBayesModel modelName="iris-flower-classifier;42"
                 functionName="classification" threshold="0.001"&gt;
 &lt;MiningSchema&gt;
  &lt;MiningField name="Species"      usageType="predicted"/&gt;
  &lt;MiningField name="Sepal.Length" usageType="active"/&gt;
  &lt;MiningField name="Sepal.Width"  usageType="active"/&gt;
  &lt;MiningField name="Petal.Length" usageType="active"/&gt;
  &lt;MiningField name="Petal.Width"  usageType="active"/&gt;
  &lt;MiningField name="DiscretePlaceHolder" usageType="active"
               missingValueReplacement="pseudoValue"/&gt;
 &lt;/MiningSchema&gt;
 &lt;Output&gt;
  &lt;OutputField name="Predicted_Species" feature="predictedValue"/&gt;
  &lt;OutputField name="Probability_setosa" optype="continuous"
               dataType="double" feature="probability" value="setosa"/&gt;
  &lt;OutputField name="Probability_versicolor" optype="continuous"
               dataType="double" feature="probability" value="versicolor"/&gt;
  &lt;OutputField name="Probability_virginica" optype="continuous"
               dataType="double" feature="probability" value="virginica"/&gt;
 &lt;/Output&gt;
 &lt;BayesInputs&gt;
  &lt;Extension&gt;
   &lt;BayesInput fieldName="Sepal.Length"&gt;
    &lt;TargetValueStats&gt;
     &lt;TargetValueStat value="setosa"&gt;
      &lt;GaussianDistribution mean="5.006" variance="0.124248979591837"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="versicolor"&gt;
      &lt;GaussianDistribution mean="5.8953488372093" variance="0.283311184939092"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="virginica"&gt;
      &lt;GaussianDistribution mean="6.58163265306122" variance="0.410697278911565"/&gt;
     &lt;/TargetValueStat&gt;
    &lt;/TargetValueStats&gt;
   &lt;/BayesInput&gt;
  &lt;/Extension&gt;
  &lt;Extension&gt;
   &lt;BayesInput fieldName="Sepal.Width"&gt;
    &lt;TargetValueStats&gt;
     &lt;TargetValueStat value="setosa"&gt;
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">...
      &lt;GaussianDistribution mean="3.428" variance="0.143689795918367"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="versicolor"&gt;
      &lt;GaussianDistribution mean="2.76279069767442" variance="0.0966777408637874"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="virginica"&gt;
      &lt;GaussianDistribution mean="2.97142857142857" variance="0.105833333333333"/&gt;
     &lt;/TargetValueStat&gt;
    &lt;/TargetValueStats&gt;
   &lt;/BayesInput&gt;
  &lt;/Extension&gt;
  &lt;Extension&gt;
   &lt;BayesInput fieldName="Petal.Length"&gt;
    &lt;TargetValueStats&gt;
     &lt;TargetValueStat value="setosa"&gt;
      &lt;GaussianDistribution mean="1.462" variance="0.0301591836734694"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="versicolor"&gt;
      &lt;GaussianDistribution mean="4.21627906976744" variance="0.236633444075305"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="virginica"&gt;
      &lt;GaussianDistribution mean="5.55510204081633" variance="0.310442176870748"/&gt;
     &lt;/TargetValueStat&gt;
    &lt;/TargetValueStats&gt;
   &lt;/BayesInput&gt;
  &lt;/Extension&gt;
  &lt;Extension&gt;
   &lt;BayesInput fieldName="Petal.Width"&gt;
    &lt;TargetValueStats&gt;
     &lt;TargetValueStat value="setosa"&gt;
      &lt;GaussianDistribution mean="0.246" variance="0.0111061224489796"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="versicolor"&gt;
      &lt;GaussianDistribution mean="1.30697674418605" variance="0.042093023255814"/&gt;
     &lt;/TargetValueStat&gt;
     &lt;TargetValueStat value="virginica"&gt;
      &lt;GaussianDistribution mean="2.02448979591837" variance="0.0768877551020408"/&gt;
     &lt;/TargetValueStat&gt;
    &lt;/TargetValueStats&gt;
   &lt;/BayesInput&gt;
  &lt;/Extension&gt;
  &lt;BayesInput fieldName="DiscretePlaceHolder"&gt;
   &lt;PairCounts value="pseudoValue"&gt;
    &lt;TargetValueCounts&gt;
     &lt;TargetValueCount value="setosa" count="50"/&gt;
     &lt;TargetValueCount value="versicolor" count="43"/&gt;
     &lt;TargetValueCount value="virginica" count="49"/&gt;
    &lt;/TargetValueCounts&gt;
   &lt;/PairCounts&gt;
  &lt;/BayesInput&gt;
 &lt;/BayesInputs&gt;
 &lt;BayesOutput fieldName="Species"&gt;
  &lt;TargetValueCounts&gt;
   &lt;TargetValueCount value="setosa" count="50"/&gt;
   &lt;TargetValueCount value="versicolor" count="43"/&gt;
   &lt;TargetValueCount value="virginica" count="49"/&gt;
  &lt;/TargetValueCounts&gt;
 &lt;/BayesOutput&gt;
&lt;/NaiveBayesModel&gt;
&lt;/PMML&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_evaluation">Evaluation</h4>
<div class="paragraph">
<p>The above defined <strong>PMML</strong> model can be evaluated in a Spring XD stream definition by using the <strong>analytic-pmml</strong> module as a processor
in your stream definition. The actual evaluation of the <strong>PMML</strong> is performed via the <strong>PmmlAnalytic</strong> which uses the <a href="https://github.com/jpmml/jpmml-evaluator"><strong>jpmml-evaluator</strong></a> library.</p>
</div>
</div>
<div class="sect3">
<h4 id="_model_selection">Model Selection</h4>
<div class="paragraph">
<p>The PMML standard allows multiple models to be defined within a single PMML document.
The model to be used can be configured through the <strong>modelName</strong> option.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> The PMML standard also supports other ways for selection models, <em>e.g.</em> based on a predicate. This is currently not supported.</p>
</div>
<div class="paragraph">
<p>In order to perform the evaluation in Spring XD you need to save the generated PMML document to some folder, typically the with the extension "pmml.xml".
For this example we save the PMML document under the name <strong>iris-flower-classification-naive-bayes-1.pmml.xml</strong>.</p>
</div>
<div class="paragraph">
<p>In the following example we set up a stream definition with an <code>http</code> source that produces iris-flower-records
that are piped to the <code>analytic-pmml</code> module which applies our iris flower classifier to predict the species of a given flower record.
The result of that is a new record extended by a new attribute <strong>predictedSpecies</strong> which simply sent to a <code>log</code> sink.</p>
</div>
<div class="paragraph">
<p>The definition of the stream, which we call <strong>iris-flower-classification</strong>, looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create --name iris-flower-classification
  --definition "http --outputType=application/x-xd-tuple | analytic-pmml
  --location=/models/iris-flower-classification-naive-bayes-1.pmml.xml
  --inputFieldMapping='sepalLength:Sepal.Length,
                       sepalWidth:Sepal.Width,
                       petalLength:Petal.Length,
                       petalWidth:Petal.Width'
  --outputFieldMapping='Predicted_Species:predictedSpecies' | log" --deploy</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>location</strong> parameter can be used to specify the exact location of the pmml document. The value must be a valid spring <a href="http://www.springindepth.com/2.5.x/0.10/ch05.html"><strong>resource</strong></a> location</p>
</li>
<li>
<p>The <strong>inputFieldMapping</strong> parameter defines a mapping of domain input fields to model input fields. It is just a list of fields or optional field:alias mappings to control which fields and how they are going to end up in the model-input. If no inputFieldMapping is defined then all domain input fields are used as model input.<br></p>
</li>
<li>
<p>The <strong>outputFieldMapping</strong> parameter defines a mapping of model output fields to domain output fields with semantics analog to the inputFieldMapping.<br></p>
</li>
<li>
<p>The optional <strong>modelName</strong> parameter of the analytic-pmml module can be used to refer to a particular named model within the PMML definition. If modelName is not defined the first model is selected by default.<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> Some analytical models like for instance <strong>association rules</strong> require a different typ of mapping. You can implement your own custom mapping strategies by implementing a custom <strong>InputMapper</strong> and <strong>OutputMapper</strong>
and defining a new <strong>PmmlAnalytic</strong> or <strong>TuplePmmlAnalytic</strong> bean that uses your custom mappers.</p>
</div>
<div class="paragraph">
<p>After the stream has been successfully deployed to <strong>Spring XD</strong> we can eventually start to throw some data at it by issuing the following http request via the <strong>XD-Shell</strong> (or <code>curl</code>, or any other tool):</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> that our example record contains no information about which species the example belongs to - this will be added by our classifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;http post --target http://localhost:9000 --contentType application/json --data "{ \"sepalLength\": 6.4, \"sepalWidth\": 3.2, \"petalLength\":4.5, \"petalWidth\":1.5 }"</pre>
</div>
</div>
<div class="paragraph">
<p>After posting the above json document to the stream we should see the following output in the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">   {
     "id":"1722ec00-baad-11e3-b988-005056c00008"
   , "timestamp":1396473833152
   , "sepalLength":"6.4"
   , "sepalWidth":"3.2"
   , "petalLength":"4.5"
   , "petalWidth":"1.5"
   , "predictedSpecies":"versicolor"
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE</strong> the generated field <strong>predictedSpecies</strong> which now identifies our input as belonging to the iris species <strong>versicolor</strong>.</p>
</div>
<div class="paragraph">
<p>We verify that the generated <strong>PMML</strong> classifier produces the same result as <strong>R</strong> by executing the issuing the following commands in <strong>rproject</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="r language-r">datasets$testset[,1:4][1,]
# This is the first example record that we sent via the http post.
   Sepal.Length Sepal.Width Petal.Length Petal.Width
52          6.4         3.2          4.5         1.5

#Predict the class for the example record by using our naiveBayes model.
&gt; predict(model, datasets$testset[,1:4][1,])
[1] versicolor</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_counters_and_gauges">Counters and Gauges</h3>
<div class="paragraph">
<p>Counter and Gauges are analytical data structures collectively referred to as metrics.  Metrics can be used directly in place of a sink just as if you were creating any other <a href="#streams">stream</a>, but you can also analyze data from an existing stream using a <a href="#taps">tap</a>. We&#8217;ll look at some examples of using metrics with taps in the following sections. As a prerequisite start the XD Container as instructed in the <a href="#getting-started">Getting Started</a> page.</p>
</div>
<div class="paragraph">
<p>The 1.0 release provides the following types of metrics</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#counter">Counter</a></p>
</li>
<li>
<p><a href="#field-value-counter">Field Value Counter</a></p>
</li>
<li>
<p><a href="#aggregate-counter">Aggregate Counter</a></p>
</li>
<li>
<p><a href="#gauge">Gauge</a></p>
</li>
<li>
<p><a href="#rich-gauge">Rich Gauge</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring XD supports these metrics and analytical data structures as a general purpose class library that works with several backend storage technologies.  The 1.0 release provides in memory and Redis implementations.</p>
</div>
<div class="sect3">
<h4 id="counter">Counter</h4>
<div class="paragraph">
<p>A counter is a Metric that associates a unique name with a long value. It is primarily used for counting events triggered by incoming messages on a target stream. You create a counter with a unique name and optionally an initial value then set its value in response to incoming messages. The most straightforward use for counter is simply to count messages coming into the target stream. That is, its value is incremented on every message. This is exactly what the <em>counter</em> module provided by Spring XD does.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="paragraph">
<p>Start by creating a data ingestion stream. Something like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name springtweets --definition "twittersearch --consumerKey=&lt;your_key&gt; --consumerSecret=&lt;your_secret&gt; --query=spring | file --dir=/tweets/" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Next, create a tap on the <em>springtweets</em> stream that sets a message counter named <em>tweetcount</em></p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tweettap --definition "tap:stream:springtweets &gt; counter --name=tweetcount" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve the count:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;counter display tweetcount</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>counter</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>the name of the metric to contribute to (will be created if necessary) <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="field-value-counter">Field Value Counter</h4>
<div class="paragraph">
<p>A field value counter is a Metric used for counting occurrences of unique values for a named field in a message payload. XD Supports the following payload types out of the box:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POJO (Java bean)</p>
</li>
<li>
<p>Tuple</p>
</li>
<li>
<p>JSON String</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example suppose a message source produces a payload with a field named <em>user</em> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">class Foo {
   String user;
   public Foo(String user) {
       this.user = user;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the stream source produces messages with the following objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">   new Foo("fred")
   new Foo("sue")
   new Foo("dave")
   new Foo("sue")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The field value counter on the field <em>user</em> will contain:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fred:1, sue:2, dave:1</pre>
</div>
</div>
<div class="paragraph">
<p>Multi-value fields are also supported. For example, if a field contains a list, each value will be counted once:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>users:["dave","fred","sue"]
users:["sue","jon"]</pre>
</div>
</div>
<div class="paragraph">
<p>The field value counter on the field <em>users</em> will contain:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dave:1, fred:1, sue:2, jon:1</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>field-value-counter</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">fieldName</dt>
<dd>
<p>the name of the field for which values are counted <strong>(String, no default)</strong></p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>the name of the metric to contribute to (will be created if necessary) <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To try this out, create a stream to ingest twitter feeds containing the word <em>spring</em> and output to a file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name springtweets --definition "twittersearch --consumerKey=&lt;your_key&gt; --consumerSecret=&lt;your_secret&gt; --query=spring | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now create a tap for a field value counter:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name fromUserCount --definition "tap:stream:springtweets &gt; field-value-counter --fieldName=user.screen_name" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>twittersearch</em> source produces JSON strings which contain the user id of the tweeter in the <em>fromUser</em> field. The <em>field_value_counter</em> sink parses the tweet and updates a field value counter named <em>fromUserCount</em> in Redis. To view the counts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">From xd-shell,
  xd:&gt; field-value-counter display fromUserCount</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aggregate-counter">Aggregate Counter</h4>
<div class="paragraph">
<p>The aggregate counter differs from a simple counter in that it not only keeps a total value for the count, but also retains the total count values for each minute, hour day and month of the period for which it is run. The data can then be queried by supplying a start and end date and the resolution at which the data should be returned.</p>
</div>
<div class="paragraph">
<p>Creating an aggregate counter is very similar to a simple counter. For example, to obtain an aggregate count for our spring tweets stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name springtweets --definition "twittersearch --query=spring | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>you&#8217;d simply create a tap which pipes the input to <code>aggregate-counter</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name tweettap --definition "tap:stream:springtweets &gt; aggregate-counter --name=tweetcount" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>From the XD shell:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; aggregate-counter display tweettap</pre>
</div>
</div>
<div class="paragraph">
<p>Note: you can also use some criteria to filter out aggregate counter display values. Please refer to Shell documentation for aggregate counter for more details.</p>
</div>
<div class="paragraph">
<p>The <strong>aggregate-counter</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">dateFormat</dt>
<dd>
<p>a pattern (as in SimpleDateFormat) for parsing/formatting dates and timestamps <strong>(String, default: <code>yyyy-MM-dd'T'HH:mm:ss.SSS'Z'</code>)</strong></p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>the name of the metric to contribute to (will be created if necessary) <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1">timeField</dt>
<dd>
<p>name of a field in the message that contains the timestamp to contribute to <strong>(String, default: <code>null</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="gauge">Gauge</h4>
<div class="paragraph">
<p>A gauge is a Metric, similar to a counter in that it holds a single long value associated with a unique name. In this case the value can represent any numeric value defined by the application.</p>
</div>
<div class="paragraph">
<p>The <em>gauge</em> sink provided with XD stores expects a numeric value as a payload, typically this would be a decimal formatted string.</p>
</div>
<div class="paragraph">
<p>The <strong>gauge</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>the name of the metric to contribute to (will be created if necessary) <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Here is an example of creating a tap for a gauge:</p>
</div>
<div class="sect4">
<h5 id="_simple_tap_example">Simple Tap Example</h5>
<div class="paragraph">
<p>Create an ingest stream</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name test --definition "http --port=9090 | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Next create the tap:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name simplegauge --definition "tap:stream:test &gt; gauge" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now Post a message to the ingest stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data "10"</pre>
</div>
</div>
<div class="paragraph">
<p>Check the gauge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;gauge display --name simplegauge</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rich-gauge">Rich Gauge</h4>
<div class="paragraph">
<p>A rich gauge is a Metric that holds a double value associated with a unique name. In addition to the value, the rich gauge keeps a running average, along with the minimum and maximum values and the sample count.</p>
</div>
<div class="paragraph">
<p>The <em>rich-gauge</em> sink provided with XD expects a numeric value as a payload, typically this would be a decimal formatted string, and keeps its value in a store.</p>
</div>
<div class="paragraph">
<p>The <strong>rich-gauge</strong> sink has the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">alpha</dt>
<dd>
<p>smoothing constant, or -1 to use arithmetic mean <strong>(double, default: <code>-1.0</code>)</strong></p>
</dd>
<dt class="hdlist1">name</dt>
<dd>
<p>the name of the metric to contribute to (will be created if necessary) <strong>(String, default: <code>&lt;stream name&gt;</code>)</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The smoothing factor behaves as an <a href="http://en.wikipedia.org/wiki/Exponential_smoothing">exponential moving average</a>. The default value does no smoothing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here are some examples of creating a tap for a rich gauge:</p>
</div>
<div class="sect4">
<h5 id="_simple_tap_example_2">Simple Tap Example</h5>
<div class="paragraph">
<p>Create an ingest stream</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name test --definition "http --port=9090 | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Next create the tap:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name testgauge --definition "tap:stream:test &gt; rich-gauge" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now Post some messages to the ingest stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data "10"
xd:&gt; http post --target http://localhost:9090 --data "13"
xd:&gt; http post --target http://localhost:9090 --data "16"</pre>
</div>
</div>
<div class="paragraph">
<p>Check the gauge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;rich-gauge display testgauge</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_stock_price_example">Stock Price Example</h5>
<div class="paragraph">
<p>In this example, we will track stock prices, which is a more practical example. The data is ingested as JSON strings like</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{"symbol":"VMW","price":72.04}</pre>
</div>
</div>
<div class="paragraph">
<p>Create an ingest stream</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name stocks --definition "http --port=9090 | file"</pre>
</div>
</div>
<div class="paragraph">
<p>Next create the tap, using the transform module to extract the stock price from the payload:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name stockprice --definition "tap:stream:stocks &gt; transform --expression=#jsonPath(payload,'$.price') | rich-gauge"</pre>
</div>
</div>
<div class="paragraph">
<p>Now Post some messages to the ingest stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data {"symbol":"VMW","price":72.04}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"VMW","price":72.06}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"VMW","price":72.08}</pre>
</div>
</div>
<div class="paragraph">
<p>Note: JSON fields should be separated by a comma without any spaces. Alternatively, enclose the whole argument to <code>--data</code> with quotes and escape inner quotes with a backslash.</p>
</div>
<div class="paragraph">
<p>Check the gauge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;rich-gauge display stockprice</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_improved_stock_price_example">Improved Stock Price Example</h5>
<div class="paragraph">
<p>In this example, we will track stock prices for selected stocks. The data is ingested as JSON strings like</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{"symbol":"VMW","price":72.04}
{"symbol":"EMC","price":24.92}</pre>
</div>
</div>
<div class="paragraph">
<p>The previous example would feed these prices to a single gauge. What we really want is to create a separate tap for each ticker symbol in which we are interested:</p>
</div>
<div class="paragraph">
<p>Create an ingest stream</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name stocks --definition "http --port=9090 | file"</pre>
</div>
</div>
<div class="paragraph">
<p>Next create the tap, using the transform module to extract the stock price from the payload:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name vmwprice --definition "tap:stream:stocks &gt; filter --expression=#jsonPath(payload,'$.symbol')==VMW | transform --expression=#jsonPath(payload,'$.price') | rich-gauge" --deploy
xd:&gt; stream create --name emcprice --definition "tap:stream:stocks &gt; filter --expression=#jsonPath(payload,'$.symbol')==EMC | transform --expression=#jsonPath(payload,'$.price') | rich-gauge" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now Post some messages to the ingest stream:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data {"symbol":"VMW","price":72.04}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"VMW","price":72.06}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"VMW","price":72.08}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; http post --target http://localhost:9090 --data {"symbol":"EMC","price":24.92}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"EMC","price":24.90}
xd:&gt; http post --target http://localhost:9090 --data {"symbol":"EMC","price":24.96}</pre>
</div>
</div>
<div class="paragraph">
<p>Check the gauge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;rich-gauge display emcprice
xd:&gt;rich-gauge display vmwprice</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_accessing_analytics_data_over_the_restful_api">Accessing Analytics Data over the RESTful API</h4>
<div class="paragraph">
<p>Spring XD has a discoverable RESTful API based on the Spring HATEAOS library.  You can discover the resources available by making a GET request on the root resource of the Admin server.  Here is an example where navigate down to find the data for a counter named <em>httptap</em> that was created by these commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;stream create --name httpStream --definition "http | file" --deploy
xd:&gt;stream create --name httptap --definition "tap:stream:httpStream &gt; counter" --deploy
xd:&gt;http post --target http://localhost:9000 --data "helloworld"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The root resource returns</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;! wget  -q -S -O - http://localhost:9393/
{
  "links":[
    {},
    {
      "rel":"jobs",
      "href":"http://localhost:9393/jobs"
    },
    {
      "rel":"modules",
      "href":"http://localhost:9393/modules"
    },
    {
      "rel":"runtime/modules",
      "href":"http://localhost:9393/runtime/modules"
    },
    {
      "rel":"runtime/containers",
      "href":"http://localhost:9393/runtime/containers"
    },
    {
      "rel":"counters",
      "href":"http://localhost:9393/metrics/counters"
    },
    {
      "rel":"field-value-counters",
      "href":"http://localhost:9393/metrics/field-value-counters"
    },
    {
      "rel":"aggregate-counters",
      "href":"http://localhost:9393/metrics/aggregate-counters"
    },
    {
      "rel":"gauges",
      "href":"http://localhost:9393/metrics/gauges"
    },
    {
      "rel":"rich-gauges",
      "href":"http://localhost:9393/metrics/rich-gauges"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following the resource location for the counter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;! wget  -q -S -O - http://localhost:9393/metrics/counters
{
  "links":[

  ],
  "content":[
    {
      "links":[
        {
          "rel":"self",
          "href":"http://localhost:9393/metrics/counters/httptap"
        }
      ],
      "name":"httptap"
    }
  ],
  "page":{
    "size":0,
    "totalElements":1,
    "totalPages":1,
    "number":0
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then the data for the counter itself</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">xd:&gt;! wget  -q -S -O - http://localhost:9393/metrics/counters/httptap
{
  "links":[
    {
      "rel":"self",
      "href":"http://localhost:9393/metrics/counters/httptap"
    }
  ],
  "name":"httptap",
  "value":2
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tuples">Tuples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_17">Introduction</h3>
<div class="paragraph">
<p>The Tuple class is a central data structure in Spring XD.  It is an ordered list of values that can be retrieved by name or by index.  Tuples are created by a TupleBuilder and are immutable.  The values that are stored can be of any type and null values are allowed.</p>
</div>
<div class="paragraph">
<p>The underlying Message class that moves data from one processing step to the next can have an arbitrary data type as its payload.  Instead of creating a custom Java class that encapsulates the properties of what is read or set in each processing step, the Tuple class can be used instead.  Processing steps can be developed that read data from specific named values and write data to specific named values.</p>
</div>
<div class="paragraph">
<p>There are accessor methods that perform type conversion to the basic primitive types as well as BigDecimal and Date.  This avoids you from having to cast the values to specific types.  Insteam you can rely on the Tuple&#8217;s type conversion infastructure to perform the conversion.</p>
</div>
<div class="paragraph">
<p>The Tuple&#8217;s types conversion is performed by Spring&#8217;s <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/validation.html#core-convert">Type Conversion Infrastructure</a> which supports commonly encountered type conversions and is extensible.</p>
</div>
<div class="paragraph">
<p>There are several overloads for getters that let you provide default values for primitive types should the field you are looking for not be found.  Date format patterns and Locale aware NumberFormat conversion are also supported.  A best effort has been made to preserve the functionality available in Spring Batch&#8217;s <a href="http://static.springsource.org/spring-batch/2.1.x/apidocs/org/springframework/batch/item/file/transform/FieldSet.html"><code>FieldSet</code></a> class that has been extensively used for parsing String based data in files.</p>
</div>
<div class="sect3">
<h4 id="_creating_a_tuple">Creating a Tuple</h4>
<div class="paragraph">
<p>The <code>TupleBuilder</code> class is how you create new <code>Tuple</code> instances.  The most basic case is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">Tuple tuple = TupleBuilder.tuple().of("foo", "bar");</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a Tuple with a single entry, a key of <em>foo</em> with a value of <em>bar</em>.  You can also use a static import to shorten the syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">import static org.springframework.xd.tuple.TupleBuilder.tuple;

Tuple tuple = tuple().of("foo", "bar");</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>of</code> method to create a Tuple with up to 4 key-value pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">Tuple tuple2 = tuple().of("up", 1, "down", 2);
Tuple tuple3 = tuple().of("up", 1, "down", 2, "charm", 3 );
Tuple tuple4 = tuple().of("up", 1, "down", 2, "charm", 3, "strange", 4);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Tuple with more then 4 entries use the fluent API that strings together the <code>put</code> method and terminates with the <code>build</code> method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">Tuple tuple6 = tuple().put("up", 1)
      	              .put("down", 2)
		      .put("charm", 3)
		      .put("strange", 4)
		      .put("bottom", 5)
		      .put("top", 6)
		      .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To customize the underlying type conversion system you can specify the <code>DateFormat</code> to use for converting <code>String</code> to <code>Date</code> as well as the <code>NumberFormat</code> to use based on a <code>Locale</code>.  For more advanced customization of the type conversion system you can register an instance of a <code>FormattingConversionService</code>.  Use the appropriate setter methods on <code>TupleBuilder</code> to make these customizations.</p>
</div>
<div class="paragraph">
<p>You can also create a Tuple from a list of <code>String</code> field names and a List of <code>Object</code> values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">Object[] tokens = new String[] { "TestString", "true", "C", "10", "-472", "354224", "543", "124.3", "424.3", "1,3245",
				null, "2007-10-12", "12-10-2007", "" };
String[] nameArray = new String[] { "String", "Boolean", "Char", "Byte", "Short", "Integer", "Long", "Float", "Double",
				"BigDecimal", "Null", "Date", "DatePattern", "BlankInput" };

List&lt;String&gt; names = Arrays.asList(nameArray);
List&lt;Object&gt; values = Arrays.asList(tokens);
tuple = tuple().ofNamesAndValues(names, values);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getting_tuple_values">Getting Tuple values</h4>
<div class="paragraph">
<p>There are getters for all the primitive types and also for BigDecimal and Date. The primitive types are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Boolean</code></p>
</li>
<li>
<p><code>Byte</code></p>
</li>
<li>
<p><code>Char</code></p>
</li>
<li>
<p><code>Double</code></p>
</li>
<li>
<p><code>Float</code></p>
</li>
<li>
<p><code>Int</code></p>
</li>
<li>
<p><code>Long</code></p>
</li>
<li>
<p><code>Short</code></p>
</li>
<li>
<p><code>String</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each getter has an overload for providing a default value.  You can access the values either by field name or by index.</p>
</div>
<div class="paragraph">
<p>The overloaded methods for asking for a value to be converted into an integer are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>int getInt(int index)</code></p>
</li>
<li>
<p><code>int getInt(String name)</code></p>
</li>
<li>
<p><code>int getInt(int index, int defaultValue)</code></p>
</li>
<li>
<p><code>int getInt(String name, int defaultValue)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are similar methods for other primitive types.  For <code>Boolean</code> there is a special case of providing the <code>String</code> value that represents a <code>trueValue</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>boolean getBoolean(int index, String trueValue)</code></p>
</li>
<li>
<p><code>boolean getBoolean(String name, String trueValue)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the value that is stored for a given field or index is null and you ask for a primitive type, the standard Java defalt value for that type is returned.</p>
</div>
<div class="paragraph">
<p>The <code>getString</code> method will remove and leading and trailing whitespace.  If you want to get the String and preserve whitespace use the methods <code>getRawString</code></p>
</div>
<div class="paragraph">
<p>There is extra functionality for getting `Date`s.  The are overloaded getters that take a String based date format</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Date getDateWithPattern(int index, String pattern)</code></p>
</li>
<li>
<p><code>Date getDateWithPattern(int index, String pattern, Date defaultValue)</code></p>
</li>
<li>
<p><code>Date getDateWithPattern(String name, String pattern)</code></p>
</li>
<li>
<p><code>Date getDateWithPattern(String name, String pattern, Date defaultValue)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are a few other more generic methods available.  Their functionality should be obvious from their names</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>size()</code></p>
</li>
<li>
<p><code>getFieldCount()</code></p>
</li>
<li>
<p><code>getFieldNames()</code></p>
</li>
<li>
<p><code>getFieldTypes()</code></p>
</li>
<li>
<p><code>getTimestamp()</code> - the time the tuple was created - milliseconds since epoch</p>
</li>
<li>
<p><code>getId()</code> - the UUID of the tuple</p>
</li>
<li>
<p><code>Object getValue(int index)</code></p>
</li>
<li>
<p><code>Object getValue(String name)</code></p>
</li>
<li>
<p><code>T getValue(int index, Class&lt;T&gt; valueClass)</code></p>
</li>
<li>
<p><code>T getValue(String name, Class&lt;T&gt; valueClass)</code></p>
</li>
<li>
<p><code>List&lt;Object&gt; getValues()</code></p>
</li>
<li>
<p><code>List&lt;String&gt; getFieldNames()</code></p>
</li>
<li>
<p><code>boolean hasFieldName(String name)</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_using_spel_expressions_to_filter_a_tuple">Using SpEL expressions to filter a tuple</h4>
<div class="paragraph">
<p>SpEL provides support to transform a source collection into another by selecting from its entries.  We make use of this functionalty to select a elements of a the tuple into a new one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">Tuple tuple = tuple().put("red", "rot")
                     .put("brown", "braun")
		     .put("blue", "blau")
		     .put("yellow", "gelb")
		     .put("beige", "beige")
		     .build();

Tuple selectedTuple = tuple.select("?[key.startsWith('b')]");
assertThat(selectedTuple.size(), equalTo(3));</code></pre>
</div>
</div>
<div class="paragraph">
<p>To select the first match use the <code>^</code> operator</p>
</div>
<div class="listingblock">
<div class="content">
<pre>selectedTuple = tuple.select("^[key.startsWith('b')]");

assertThat(selectedTuple.size(), equalTo(1));
assertThat(selectedTuple.getFieldNames().get(0), equalTo("brown"));
assertThat(selectedTuple.getString(0), equalTo("braun"));</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gradle_dependencies">Gradle Dependencies</h4>
<div class="paragraph">
<p>If you wish to use Spring XD Tuples in you project add the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">//Add this repo to your repositories if it does not already exist.
maven { url "http://repo.spring.io/libs-snapshot"}

//Add this dependency
compile 'org.springframework.xd:spring-xd-tuple:1.0.0.RELEASE'</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="type-conversion">Type Conversion</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_18">Introduction</h3>
<div class="paragraph">
<p>Spring XD allows you to declaratively configure type conversion in stream definitions using the <em>inputType</em> and <em>outputType</em> module options. Note that general type conversion may also be accomplished easily within a transformer or a custom module. Currently, Spring XD natively supports the following type conversions commonly used in streams:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>JSON</strong> to/from <strong>POJO</strong></p>
</li>
<li>
<p><strong>JSON</strong> to/from <a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-tuple/src/main/java/org/springframework/xd/tuple/Tuple.java">org.springframework.xd.tuple.Tuple</a></p>
</li>
<li>
<p><strong>Object</strong> to/from <strong>byte[]</strong> : Either the raw bytes serialized for remote transport, bytes emitted by a module, or converted to bytes using Java serialization(requires the object to be Serializable)</p>
</li>
<li>
<p><strong>String</strong> to/from <strong>byte[]</strong></p>
</li>
<li>
<p><strong>Object</strong> to <strong>plain text</strong> (invokes the object&#8217;s <em>toString()</em> method)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <em>JSON</em> represents either a byte array or String payload containing JSON. Currently, Objects may be converted from a JSON byte array or String. Converting to JSON always produces a String. Registration of custom type converters is covered <a href="#Providing-a-New-Type-Converter">in this section</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="mime-types">MIME types</h3>
<div class="paragraph">
<p><em>inputType</em> and <em>outputType</em> values are parsed as media types, e.g., <code>application/json</code> or <code>text/plain;charset=UTF-8</code>. MIME types are especially useful for indicating how to convert to String or byte[] content. Spring XD also uses MIME type format to represent Java types, using the general type <code>application/x-java-object</code> with a <code>type</code> parameter. For example, <code>application/x-java-object;type=java.util.Map</code> or <code>application/x-java-object;type=com.bar.Foo</code> . For convenience, you can use the class name by itself and Spring XD will translate a valid class name to the corresponding MIME type. In addition, Spring XD provides custom MIME types, notably, <code>application/x-xd-tuple</code> to specify a Tuple.</p>
</div>
</div>
<div class="sect2">
<h3 id="stream-definition-examples">Stream Definition Examples</h3>

</div>
<div class="sect2">
<h3 id="_pojo_to_json">POJO to JSON</h3>
<div class="paragraph">
<p>Type conversion will likely come up when implementing a custom module which produces or consumes a custom domain object. For example, you want to create a stream that integrates with a legacy system that includes custom domain types in its API. To process custom domain types directly minimally requires these types to be defined in Spring XD&#8217;s class path. This approach will be cumbersome to maintain when the domain model changes. The recommended approach is to convert such types to JSON at the source, or back to POJO at the sink. You can do this by declaring the required conversions in the stream definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>customPojoSource --outputType=application/json |p1 | p2 | ... | customPojoSink --inputType=application/x-java-object;type=com.acme.MyDomainType</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the sink above does require the declared type to be in the module&#8217;s classpath to perform the JSON to POJO conversion. Generally, POJO to JSON does not require the Java class. Once the payload is converted to JSON, Spring XD provided transformers and filters (p1, p2, etc.) can evaluate the payload contents using <a href="http://docs.spring.io/spring-integration/reference/html/spel.html">JsonPath functions in SpEL expressions</a>. Alternately, you can convert the JSON to a Tuple, as shown in the following example.</p>
</div>
<div class="sect3">
<h4 id="_json_to_tuple">JSON to Tuple</h4>
<div class="paragraph">
<p>Sometimes it is convenient to convert JSON content to a Tuple in order to evaluate and access individual field values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; stream create tuple --definition "http | filter --inputType=application/x-xd-tuple --expression=payload.hasFieldName('hello') | transform --expression=payload.getString('hello').toUpperCase() |  log" --deploy
Created and deployed new stream 'tuple'</pre>
</div>
</div>
<div class="paragraph">
<p>Note <em>inputType=application/x-xd-tuple</em> on the filter module will cause the payload to be converted to a Tuple at the filter&#8217;s input channel. Thus, subsequent expressions are evaluated on a Tuple object. Here we invoke the Tuple methods <code>hasFieldName('hello')</code> on the filter and <code>getString('hello')</code> on the transformer. The output of the http source is expected to be JSON in this case. We set the <em>Content-Type</em> header to tell Spring XD that the payload is JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;http post --data {"hello":"world","foo":"bar"} --contentType application/json --target http://localhost:9000
&gt; POST (application/json;charset=UTF-8) http://localhost:9000 {"hello":"world","foo":"bar"}
&gt; 200 OK</pre>
</div>
</div>
<div class="paragraph">
<p>In the Spring XD console log, you should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>13:19:45,054  INFO pool-42-thread-4 sink.tuple - WORLD</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_java_serialization">Java Serialization</h4>
<div class="paragraph">
<p>The following serializes a java.io.Serializable object to a file.  Presumably the <em>foo</em> module outputs a Serializable type. If not, this will result in an exception. If remote transport is configured, the output of <em>foo</em> will be marshalled using Spring XD&#8217;s internal serialization. The object will be unmarshalled in the <em>file</em> module and then converted to a byte array using Java serialization.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo  | --inputType=application/x-java-serialized-object file</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mime-types-and-java-types">MIME types and Java types</h3>
<div class="paragraph">
<p>Internally, Spring XD implements type conversion using Spring Integration&#8217;s <a href="http://docs.spring.io/spring-integration/docs/latest-ga/reference/htmlsingle/#channel-configuration">data type channels</a>. The data type channel converts payloads to the configured data type using Spring&#8217;s <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/converter/MessageConverter.html">MessageConverter</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The use of <em>MessageCoverter</em> for data type channels was introduced in Spring Integration 4 to pass the Message to the converter method to allow it to access the Message&#8217;s <em>content-type</em> header. This provides greater flexibility. For example, it is now possible to support multiple strategies for converting a String or byte array to a POJO, based on the content-type header.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When Spring XD deploys a module with a declared type conversion, it modifies the module&#8217;s input and/or output channel definition to set the required Java type and registers MessageConverters associated with the target MIME type and Java type to the channel. The type conversions Spring XD provides out of the box are summarized in the following table:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;">
<col style="width:20%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Source Payload</th>
<th class="tableblock halign-left valign-top">Target Payload</th>
<th class="tableblock halign-left valign-top">content-type header</th>
<th class="tableblock halign-left valign-top">outputType/inputType</th>
<th class="tableblock halign-left valign-top">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tuple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON is tailored for Tuple</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String (toString())</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/plain, java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[] (java.io serialized)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-java-serialized-object</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON byte[] or String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POJO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json (or none)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-java-object</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[] or String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-java-serialized-object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-java-object</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON byte[] or String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tuple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json (or none)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-xd-tuple</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/plain, java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">will apply any Charset specified in the content-type header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/octet-stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">will apply any Charset specified in the content-type header</p></td>
</tr>
</tbody>
</table>

<div class="sect3">
<h4 id="Caveats">Caveats</h4>
<div class="paragraph">
<p>Note that that inputType and outputType parameters only apply to payloads that require type conversion. For example, if a module produces an XML string with outputType=application/json, the payload will not be converted from XML to JSON. This is because the payload at the module&#8217;s output channel is already a String so no conversion will be applied at runtime.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="developing-modules-and-extensions" class="sect0">Developing Modules and Extensions</h1>
<div class="sect1">
<h2 id="creating-a-source-module">Creating a Source Module</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_19">Introduction</h3>
<div class="paragraph">
<p>As outlined in the <a href="#modules">modules</a> document, XD currently supports 4 types of modules: source, sink, and processor for stream processing and job for batch processing.  This document walks through creation of a custom source module.</p>
</div>
<div class="paragraph">
<p>The first module in a <a href="#streams">stream</a> is always a source. Source modules are built with Spring Integration and are typically very fine-grained. A module of type <em>source</em> is responsible for placing a message on a channel named <em>output</em>. This message can then be consumed by the other processor and sink modules in the stream. A source module is typically fed data by an inbound channel adapter, configured with a poller.</p>
</div>
<div class="paragraph">
<p>Spring Integration provides a number of adapters out of the box to support various transports, such as JMS, File, HTTP, Web Services, Mail, and more. You can typically create a source module that uses these inbound channel adapters by writing just a single Spring application context file.</p>
</div>
<div class="paragraph">
<p>These steps will demonstrate how to create and deploy a source module using the <a href="http://docs.spring.io/spring-integration/reference/html/feed.html#feed-inbound-channel-adapter">Spring Integration Feed Inbound Channel Adapter</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_module_application_context_file">Create the module Application Context file</h3>
<div class="paragraph">
<p>Create the Inbound Channel Adapter in a file called <em>feed.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:int-feed="http://www.springframework.org/schema/integration/feed"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/integration
		http://www.springframework.org/schema/integration/spring-integration.xsd
		http://www.springframework.org/schema/integration/feed
		http://www.springframework.org/schema/integration/feed/spring-integration-feed.xsd"&gt;

	&lt;int-feed:inbound-channel-adapter id="xdFeed" channel="output" url="http://feeds.bbci.co.uk/news/rss.xml"&gt;
		&lt;int:poller fixed-rate="5000" max-messages-per-poll="100" /&gt;
	&lt;/int-feed:inbound-channel-adapter&gt;

	&lt;int:channel id="output"/&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapter is configured to poll the BBC News Feed every 5 seconds.  Once an item is found, it will create a message with a SyndEntryImpl domain object payload and write it to a message channel called <em>output</em>. The name <em>output</em> should be used by convention so that your source module can easily be combined with any processor and sink module in a stream.</p>
</div>
<div class="sect3">
<h4 id="_make_the_module_configurable">Make the module configurable</h4>
<div class="paragraph">
<p>Users may want to pull data from feeds other than BBC News. Spring XD will automatically make a PropertyPlaceholderConfigurer available to your application context. You can simply reference property names and users can then pass in values when creating a <a href="#streams">stream</a> using the DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;int-feed:inbound-channel-adapter  id="xdFeed" channel="output" url="${url:http://feeds.bbci.co.uk/news/rss.xml}"&gt;
  &lt;int:poller fixed-rate="5000" max-messages-per-poll="100" /&gt;
&lt;/int-feed:inbound-channel-adapter&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now users can optionally pass a <em>url</em> property value on stream creation. If not present, the specified default will be used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_module_locally">Test the module locally</h3>
<div class="paragraph">
<p>This section covers setup of a local project containing some code for testing outside of an XD container. This step can be skipped if you prefer to test the module by <a href="#deploy-module-source">deploying to Spring XD</a>.</p>
</div>
<div class="sect3">
<h4 id="_create_a_project">Create a project</h4>
<div class="paragraph">
<p>The module can be tested by writing a Spring integration test to load the context file and validate that news items are received. In order to write the test, you will need to create a project in an IDE such as STS, Eclipse, or IDEA. Eclipse will be used for this example.</p>
</div>
<div class="paragraph">
<p>Create a <em>feed</em> directory and add <em>feed.xml</em> to <em>src/main/resources</em>. Add the following <em>build.gradle</em> (or an equivalent <em>pom.xml</em>) to the root directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">description = 'Feed Source Module'
group = 'org.springframework.xd.samples'

repositories {
  maven { url "http://repo.spring.io/libs-snapshot" }
  maven { url "http://repo.spring.io/plugins-release" }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'

ext {
    junitVersion = '4.11'
    springVersion = '4.0.3.RELEASE'
    springIntegrationVersion = '4.0.0.M4'
}

dependencies {
    compile("org.springframework:spring-core:$springVersion")
    compile "org.springframework:spring-context-support:$springVersion"
    compile "org.springframework.integration:spring-integration-feed:$springIntegrationVersion"

    // Testing
    testCompile "junit:junit:$junitVersion"
    testCompile "org.springframework:spring-test:$springVersion"
}

defaultTasks 'build'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <em>gradle eclipse</em> to generate the Eclipse project. Import the project into Eclipse.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_spring_integration_test">Create the Spring integration test</h4>
<div class="paragraph">
<p>The main objective of the test is to ensure that news items are received once the module&#8217;s Application Context is loaded. This can be tested by adding an Outbound Channel Adapter that will direct items to a POJO that can store them for validation.</p>
</div>
<div class="paragraph">
<p>Add the following <em>src/test/resources/org/springframework/xd/samples/test-context.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/integration
		http://www.springframework.org/schema/integration/spring-integration.xsd"&gt;

	&lt;context:property-placeholder/&gt;

	&lt;int:outbound-channel-adapter channel="output" ref="target" method="add" /&gt;

	&lt;bean id="target" class="org.springframework.xd.samples.FeedCache" /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This context creates an Outbound Channel Adapter that will subscribe to all messages on the <em>output</em> channel and pass the message payload to the <em>add</em> method of a <em>FeedCache</em> object. The context also creates the PropertyPlaceholderConfigurer that is ordinarily provided by the XD container.</p>
</div>
<div class="paragraph">
<p>Create the <em>src/test/java/org/springframework/xd/samples/FeedCache</em> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">package org.springframework.xd.samples;
import ...

public class FeedCache {

	final BlockingDeque&lt;SyndEntry&gt; entries = new LinkedBlockingDeque&lt;SyndEntry&gt;(99);

	public void add(SyndEntry entry) {
		entries.add(entry);
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>FeedCache</em> places all received SyndEntry objects on a <em>BlockingDeque</em> that our test can use to validate successful routing of messages.</p>
</div>
<div class="paragraph">
<p>Lastly, create and run the <em>src/test/java/org/springframework/xd/samples/FeedSourceModuleTest</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">package org.springframework.xd.samples;
import ...

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations={"classpath:feed.xml", "test-context.xml"})
public class FeedSourceModuleTest extends TestCase {

	@Autowired
	FeedCache feedCache;

	@Test
	public void testFeedPolling() throws Exception {
		assertNotNull(feedCache.entries.poll(5, TimeUnit.SECONDS));
	}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test will load an Application Context using our feed and test context files. It will fail if a item is not placed into the FeedCache within 5 seconds.</p>
</div>
<div class="paragraph">
<p>You now have a way to build and test your new module independently. Time to deploy to Spring XD!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-module-source">Installing the module</h3>
<div class="paragraph">
<p>Spring XD looks for modules in the ${xd.home}/modules directory. The modules directory organizes module types in sub-directories. So you will see something like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>modules/processor
modules/sink
modules/source</pre>
</div>
</div>
<div class="paragraph">
<p>Simply drop <em>feed.xml</em> into the <em>modules/source</em> directory and add the dependencies to the lib directory by copying the following jars from your gradle cache to <code>${xd.home}/lib</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>spring-integration-feed-4.0.0.M4.jar
jdom-1.0.jar
rome-1.0.0.jar
rome-fetcher-1.0.0.jar</pre>
</div>
</div>
<div class="paragraph">
<p>Now fire up the server. See <a href="#getting-started">Getting Started</a> to learn how to start the Spring XD server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_deployed_module">Test the deployed module</h3>
<div class="paragraph">
<p>Once the XD server is running, create a stream to test it out. This stream will write SyndEntry objects to the XD log:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name feedtest --definition "feed | log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>You should start seeing messages like the following in the container console window:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   WARN logger.feedtest: SyndEntryImpl.contributors=[]
SyndEntryImpl.contents=[]
SyndEntryImpl.updatedDate=null
SyndEntryImpl.link=http://www.bbc.co.uk/news/uk-22850006#sa-ns_mchannel=rss&amp;ns_source=PublicRSS20-sa
SyndEntryImpl.titleEx.value=VIDEO: Queen visits Prince Philip in hospital
...</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <em>SyndEntryImpl</em> toString is fairly verbose. To make the output more concise, create a <a href="#creating-a-processor-module">processor</a> module to further transform the SyndEntry or consider converting the entry to JSON and using the <a href="#json-field-extractor">JSON Field Extractor</a> to send a single attribute value to the output channel.</p>
</div>
</div>
<div class="sect2">
<h3 id="install-module-source-subdir">Installing the module in a sub-directory</h3>
<div class="paragraph">
<p>Modules can also reside in a sub-directory named after the module itself, e.g. <code>modules/source/feed</code>.  This sub-directory in turn contains <code>config</code> and <code>lib</code> sub-directories.  If you install a module following this convention then the module will run in an isolated classpath, a child of the parent classpath created from the contents of <code>xd/lib</code>. See <a href="https://github.com/spring-projects/spring-xd/wiki/Modules#modules-with-isolated-classpath">Modules with isolated classpath</a> for more information.</p>
</div>
<div class="paragraph">
<p>[NOTE] To help you better package up a module for installation in a sub-directory the <a href="https://github.com/spring-projects/spring-xd-modules/blob/master/analytics-ml-pmml/build.gradle">sample build file</a> form the JPMML module can be used as a starting point.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-processor-module">Creating a Processor Module</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_20">Introduction</h3>
<div class="paragraph">
<p>As outlined in the <a href="#modules">modules</a> document, XD currently supports 4 types of modules: source, sink, and processor for stream processing and job for batch processing.  This document walks through creation of a custom processor module.</p>
</div>
<div class="paragraph">
<p>One or more processors can be included in a <a href="#streams">stream</a> definition to modify the data as it passes between the initial source and the destination sink. The <a href="#architecture">architecture</a> section covers the basics of processors modules provided out of the box are covered in the <a href="#processors">processors</a> section.</p>
</div>
<div class="paragraph">
<p>Here we&#8217;ll look at how to create and deploy a custom processor module to transform the input from an incoming <code>twittersearch</code>. The steps are essentially the same for any source though. Rather than using built-in functionality, we&#8217;ll write a custom processor implementation class and wire it up using Spring Integration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_write_the_transformer_code">Write the Transformer Code</h3>
<div class="paragraph">
<p>The tweet messages from <code>twittersearch</code> contain quite a lot of data (id, author, time and so on). The transformer we&#8217;ll write will discard everything but the text content and output this as a string. The output messages from the <code>twittersearch</code> source are also strings, containing the tweet data as JSON. We first parse this into a map using Jackson library code, then extract the "text" field from the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">
package custom;

import java.io.IOException;
import java.util.Map;

import org.codehaus.jackson.map.ObjectMapper;
import org.codehaus.jackson.type.TypeReference;
import org.springframework.integration.transformer.MessageTransformationException;

public class TweetTransformer {
  private ObjectMapper mapper = new ObjectMapper();

  public String transform(String payload) {
    try {
      Map&lt;String, Object&gt; tweet = mapper.readValue(payload, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {});
      return tweet.get("text").toString();
    } catch (IOException e) {
      throw new MessageTransformationException("Unable to transform tweet: " + e.getMessage(), e);
    }
  }
}
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_module_application_context_file_2">Create the module Application Context File</h3>
<div class="paragraph">
<p>Create the following file as <em>tweettransformer.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;beans:beans xmlns="http://www.springframework.org/schema/integration"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:beans="http://www.springframework.org/schema/beans"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/integration
    http://www.springframework.org/schema/integration/spring-integration.xsd"&gt;
  &lt;channel id="input"/&gt;

  &lt;transformer input-channel="input" output-channel="output"&gt;
    &lt;beans:bean class="custom.TweetTransformer" /&gt;
  &lt;/transformer&gt;

  &lt;channel id="output"/&gt;
&lt;/beans:beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_the_module">Install the Module</h3>
<div class="paragraph">
<p>To deploy the module, you need to copy the <em>tweettransformer.xml</em> file to the <code>${xd.home}/modules/processors</code> directory. We also need to make the custom module code available. Spring XD looks for code in the jars it finds in the <code>${xd.home}/lib</code> directory. So create a jar with the <code>TweetTransformer</code> class in it (and the correct package structure) and drop it into <code>lib</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_deployed_module_2">Test the deployed module</h3>
<div class="paragraph">
<p>Start the XD server and try creating a stream to test your processor:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name javatweets --definition "twittersearch --query=java --consumerKey=&lt;your_key&gt; --consumerSecret=&lt;your_secret&gt; | tweettransformer | file" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>If you haven&#8217;t already used <code>twittersearch</code>, read the <a href="#sources">sources</a> section for more details. This command should stream tweets to the file <code>/tmp/xd/output/javatweets</code> but, unlike the normal <code>twittersearch</code> output, you should just see the plain tweet text there, rather than the full JSON data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_module_in_a_sub_directory">Installing the module in a sub-directory</h3>
<div class="paragraph">
<p>Modules can also reside in a sub-directory named after the module itself, e.g. <code>modules/sink/tweettransform</code>.  This sub-directory in turn contains <code>config</code> and <code>lib</code> sub-directories.  If you install a module following this convention then the module will run in an isolated classpath, a child of the parent classpath created from the contents of <code>xd/lib</code>. See <a href="https://github.com/spring-projects/spring-xd/wiki/Modules#modules-with-isolated-classpath">Modules with isolated classpath</a> for more information.</p>
</div>
<div class="paragraph">
<p>[NOTE] To help you better package up a module for installation in a sub-directory the <a href="https://github.com/spring-projects/spring-xd-modules/blob/master/analytics-ml-pmml/build.gradle">sample build file</a> form the JPMML module can be used as a starting point.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-sink-module">Creating a Sink Module</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_21">Introduction</h3>
<div class="paragraph">
<p>As outlined in the <a href="#modules">modules</a> document, XD currently supports 4 types of modules: source, sink, and processor for stream processing and job for batch procesing.  This document walks through creation of a custom sink module.</p>
</div>
<div class="paragraph">
<p>The last module in a <a href="#streams">stream</a> is always a sink. Sink modules are built with Spring Integration and are typically very fine-grained.  A module of type <em>sink</em> listens on a channel named <em>input</em> and is responsible for outputting received messages to an external resource to terminate the stream.</p>
</div>
<div class="paragraph">
<p>Spring Integration provides a number of adapters out of the box to support various transports, such as JMS, File, HTTP, Web Services, Mail, and more. You can typically create a sink module that uses these outbound channel adapters by writing just a single Spring application context file.</p>
</div>
<div class="paragraph">
<p>These steps will demonstrate how to create and deploy a sink module using the <a href="http://docs.spring.io/spring-integration/reference/html/redis.html#redis-store-outbound-channel-adapter">Spring Integration RedisStore Outbound Channel Adapter</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_module_application_context_file_3">Create the module Application Context file</h3>
<div class="paragraph">
<p>Create the Outbound Channel Adapter in a file called <em>redis-store.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:int-redis="http://www.springframework.org/schema/integration/redis"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/integration
		http://www.springframework.org/schema/integration/spring-integration.xsd
		http://www.springframework.org/schema/integration/redis
		http://www.springframework.org/schema/integration/redis/spring-integration-redis.xsd"&gt;

	&lt;int:channel id="input" /&gt;

	&lt;int-redis:store-outbound-channel-adapter
		id="redisListAdapter" collection-type="LIST" channel="input" key="myCollection" /&gt;

	&lt;bean id="redisConnectionFactory"
		class="org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory"&gt;
		&lt;constructor-arg index="0" value="${localhost}" /&gt;
		&lt;constructor-arg index="1" value="${6379}" /&gt;
	&lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The adapter is configured to listen on a channel named <em>input</em>. The name <em>input</em> should be used by convention so that your sink module will receive all messages sent in the stream. Once a message is received, it will write the payload to a Redis list with key <em>myCollection</em>.  By default, the RedisStore Outbound Channel Adapter uses a bean named <em>redisConnectionFactory</em> to connect to the Redis server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, the adapter uses a <em>StringRedisTemplate</em>. Therefore, this module will store all payloads directly as Strings. Create a custom <em>RedisTemplate</em> with different value Serializers to serialize other forms of data like Java objects to the Redis collection.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_make_the_module_configurable_2">Make the module configurable</h3>
<div class="paragraph">
<p>Users may want to specify a different Redis server or key to use for storing data. Spring XD will automatically make a PropertyPlaceholderConfigurer available to your application context. You can simply reference property names and users can then pass in values when creating a <a href="#streams">stream</a> using the DSL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;int-redis:store-outbound-channel-adapter id="redisListAdapter"
  collection-type="LIST" channel="input" key="${key:myCollection}" /&gt;

&lt;bean id="redisConnectionFactory"
  class="org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory"&gt;
  &lt;constructor-arg index="0" value="${hostname:localhost}" /&gt;
  &lt;constructor-arg index="1" value="${port:6379}" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now users can optionally pass <em>key</em>, <em>hostname</em>, and <em>port</em> property values on stream creation. If not present, the specified defaults will be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_module_locally_2">Test the module locally</h3>
<div class="paragraph">
<p>This section covers setup of a local project containing some code for testing outside of an XD container. This step can be skipped if you prefer to test the module by <a href="#deploy-module-sink">deploying to Spring XD</a>.</p>
</div>
<div class="sect3">
<h4 id="_create_a_project_2">Create a project</h4>
<div class="paragraph">
<p>The module can be tested by writing a Spring integration test to load the context file and validate that messages are stored in Redis. In order to write the test, you will need to create a project in an IDE such as STS, Eclipse, or IDEA. Eclipse will be used for this example.</p>
</div>
<div class="paragraph">
<p>Create a <em>redis-store</em> directory and add <em>redis-store.xml</em> to <em>src/main/resources</em>. Add the following <em>build.gradle</em> (or an equivalent <em>pom.xml</em>) to the root directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">description = 'Redis Store Sink Module'
group = 'org.springframework.xd.samples'

repositories {
  maven { url "http://repo.spring.io/libs-snapshot" }
  maven { url "http://repo.spring.io/plugins-release" }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'

ext {
    junitVersion = '4.11'
    lettuceVersion = '2.3.3'
    springVersion = '4.0.3.RELEASE'
    springIntegrationVersion = '4.0.0.M4'
    springDataRedisVersion = '1.1.1.RELEASE'
}

dependencies {
    compile("org.springframework:spring-core:$springVersion")
    compile "org.springframework:spring-context-support:$springVersion"
    compile "org.springframework.integration:spring-integration-core:$springIntegrationVersion"
    compile "org.springframework.integration:spring-integration-redis:$springIntegrationVersion"
    compile "org.springframework.data:spring-data-redis:$springDataRedisVersion"

    // Testing
    testCompile "junit:junit:$junitVersion"
    testCompile "org.springframework:spring-test:$springVersion"
    testCompile "com.lambdaworks:lettuce:$lettuceVersion"
}

defaultTasks 'build'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <em>gradle eclipse</em> to generate the Eclipse project. Import the project into Eclipse.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_spring_integration_test_2">Create the Spring integration test</h4>
<div class="paragraph">
<p>The main objective of the test is to ensure that messages are stored in a Redis list once the module&#8217;s Application Context is loaded. This can be tested by adding an Inbound Channel Adapter that will direct test messages to the <em>input</em> channel.</p>
</div>
<div class="paragraph">
<p>Add the following <em>src/test/resources/org/springframework/xd/samples/test-context.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
		http://www.springframework.org/schema/context/spring-context.xsd
		http://www.springframework.org/schema/integration
		http://www.springframework.org/schema/integration/spring-integration.xsd"&gt;

	&lt;context:property-placeholder /&gt;

	&lt;int:inbound-channel-adapter channel="input" expression="'TESTING'"&gt;
		&lt;int:poller fixed-rate="1000" /&gt;
	&lt;/int:inbound-channel-adapter&gt;

	&lt;bean id="redisTemplate" class="org.springframework.data.redis.core.StringRedisTemplate"&gt;
		&lt;property name="connectionFactory" ref="redisConnectionFactory" /&gt;
	&lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This context creates an Inbound Channel Adapter that will generate messages with the payload "TESTING". The context also creates the PropertyPlaceholderConfigurer that is ordinarily provided by the XD container. The <em>redisTemplate</em> is configured for use by the test to verify that data is placed in Redis.</p>
</div>
<div class="paragraph">
<p>Lastly, create and run the <em>src/test/java/org/springframework/xd/samples/RedisStoreSinkModuleTest</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">package org.springframework.xd.samples;
import ...

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations={"classpath:redis-store.xml", "test-context.xml"})
public class RedisStoreSinkModuleTest {

	@Autowired
	RedisTemplate&lt;String,String&gt; redisTemplate;

	@Test
	public void testTweetSearch() throws Exception {
	     assertNotNull(redisTemplate.boundListOps("myCollection").leftPop(5, TimeUnit.SECONDS));
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test will load an Application Context using our redis-store and test context files. It will fail if an item is not placed in the Redis list within 5 seconds.</p>
</div>
</div>
<div class="sect3">
<h4 id="_run_the_test">Run the test</h4>
<div class="paragraph">
<p>The test requires a running Redis server. See <a href="#getting-started">Getting Started</a> for information on installing and starting Redis.</p>
</div>
<div class="paragraph">
<p>You now have a way to build and test your new module independently. Time to deploy to Spring XD!</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-module-sink">Install the module</h3>
<div class="paragraph">
<p>Spring XD looks for modules in the ${xd.home}/modules directory. The modules directory organizes module types in sub-directories. So you will see something like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>modules/processor
modules/sink
modules/source</pre>
</div>
</div>
<div class="paragraph">
<p>Simply drop <em>redis-store.xml</em> into the <em>modules/sink</em> directory and fire up the server. See <a href="#getting-started">Getting Started</a> to learn how to start the Spring XD server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_deployed_module_3">Test the deployed module</h3>
<div class="paragraph">
<p>Once the XD server is running, create a stream to test it out. This stream will write tweets containing the word "java" to Redis as a JSON string:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --name javasearch --definition "twittersearch --consumerKey=&lt;your_key&gt; --consumerSecret=&lt;your_secret&gt; --query=java | redis-store --key=javatweets" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Note that you need to have a consumer key and secret to use the <code>twittersearch</code> module. See the description in the <a href="#streams">streams</a> section for more information.</p>
</div>
<div class="paragraph">
<p>Fire up the redis-cli and verify that tweets are being stored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ redis-cli
redis 127.0.0.1:6379&gt; lrange javatweets 0 -1
1) {\"id\":342386150738120704,\"text\":\"Now Hiring: Senior Java Developer\",\"createdAt\":1370466194000,\"fromUser\":\"jencompgeek\",...\"}"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_module_in_a_sub_directory_2">Installing the module in a sub-directory</h3>
<div class="paragraph">
<p>Modules can also reside in a sub-directory named after the module itself, e.g. <code>modules/sink/redis</code>.  This sub-directory in turn contains <code>config</code> and <code>lib</code> sub-directories.  If you install a module following this convention then the module will run in an isolated classpath, a child of the parent classpath created from the contents of <code>xd/lib</code>. See <a href="https://github.com/spring-projects/spring-xd/wiki/Modules#modules-with-isolated-classpath">Modules with isolated classpath</a> for more information.</p>
</div>
<div class="paragraph">
<p>[NOTE] To help you better package up a module for installation in a sub-directory the <a href="https://github.com/spring-projects/spring-xd-modules/blob/master/analytics-ml-pmml/build.gradle">sample build file</a> form the JPMML module can be used as a starting point.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-job-module">Creating a Job Module</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_22">Introduction</h3>
<div class="paragraph">
<p>As outlined in the <a href="#modules">modules</a> document, XD currently supports 4 types of modules: source, sink, and processor for stream processing and job for batch procesing.  This document walks through creation of a custom job module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_developing_your_job">Developing your Job</h3>
<div class="paragraph">
<p>The Job definitions provided as part of the Spring XD distribution as well as those included in the <a href="https://github.com/spring-projects/spring-xd-samples">Spring XD Samples</a> repository can be used a basis for building your own custom Jobs.  The development of a Job largely follows the development of a Spring Batch job, for which there are several references.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://projects.spring.io/spring-batch/">Spring Batch home page</a></p>
</li>
<li>
<p><a href="http://www.manning.com/templier/">Spring Batch In Action - Manning</a></p>
</li>
<li>
<p><a href="http://www.apress.com/9781430234524">Pro Spring Batch - APress</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For help developing Job steps specific to Hadoop, e.g. HDFS, Pig, Hive, the <a href="https://github.com/spring-projects/spring-xd-samples">Spring XD Samples</a> is useful as well as the following resources</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://projects.spring.io/spring-hadoop/">Spring for Apache Hadoop home page</a></p>
</li>
<li>
<p><a href="http://shop.oreilly.com/product/0636920024767.do">Spring Data - O&#8217;Reilly - Chapter 13</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once your Jobs have been developed and unit tested, they are integrated into Spring XD by copying the resulting .jar file and Job XML definition to $XD_HOME/lib and $XD_HOME/modules/jobs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_simple_job">Creating a Simple Job</h3>
<div class="paragraph">
<p>To describe the creation of a job we will use the job definition that is part of the <a href="https://github.com/spring-projects/spring-xd-samples/tree/master/batch-simple">batch-simple example</a>.</p>
</div>
<div class="paragraph">
<p>To create a job in the XD shell, execute the job create command composed of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name - the "name" that will be associated with the Job</p>
</li>
<li>
<p>definition - the name of the context file that describes the tasklet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The job defintion file <em>myjob.xml</em> is directory $XD_HOME/modules/jobs/myjob/myjob.xml and looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:batch="http://www.springframework.org/schema/batch"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
			   http://www.springframework.org/schema/beans/spring-beans.xsd
			   http://www.springframework.org/schema/batch
			   http://www.springframework.org/schema/batch/spring-batch.xsd"&gt;

	&lt;batch:job id="job"&gt;
		&lt;batch:step id="helloSpringXDStep"&gt;
			&lt;batch:tasklet ref="helloSpringXDTasklet" /&gt;
		&lt;/batch:step&gt;
	&lt;/batch:job&gt;

	&lt;bean id="helloSpringXDTasklet"
		class="org.springframework.springxd.samples.batch.HelloSpringXDTasklet" /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <em>Tasklet</em> is the extension point to handle processing in a batch processing step.  In this example there is only one step and it simply prints out the job parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; job create --name helloSpringXD --definition "myjob" --deploy
xd:&gt; job launch helloSpringXD --params {"myStringParameter":"foobar","-secondParam(long)":"123456"}
</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> by default, deploy is set to <em>false</em>. "--deploy" or "--deploy true" will deploy the job along with job creation.</p>
</div>
<div class="paragraph">
<p>In the logging output of the XDContainer you should see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello Spring XD!
The following 3 Job Parameter(s) is/are present:
Parameter name: secondParam; isIdentifying: false; type: LONG; value: 123456
Parameter name: myStringParameter; isIdentifying: true; type: STRING; value: foobar
Parameter name: random; isIdentifying: true; type: STRING; value: 0.06893349621991496</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_read_write_processing_job">Creating a read-write processing Job</h3>
<div class="paragraph">
<p>Often a batch job will involve reading batches of data from a source, tranforming or processing that data and then wrting the batch of data to a destination.  This flow is encapsulated in the <em>ChunkOrientedTasklet</em> that is represented in the job configuration using the <code>&lt;chunk/&gt;</code> element that has <code>reader</code>, <code>writer</code> and optional <code>processor</code> elements.  Other attributes define the size of the chunck and various policies for handling failure cases.</p>
</div>
<div class="paragraph">
<p>You will usually be able to reuse existing <a href="http://docs.spring.io/spring-batch/trunk/apidocs/org/springframework/batch/item/ItemReader.html">reader</a> and <a href="http://docs.spring.io/spring-batch/trunk/apidocs/org/springframework/batch/item/ItemWriter.html">writer</a> implementations.  The <a href="https://github.com/spring-projects/spring-xd/blob/master/modules/job/filejdbc/config/filejdbc.xml">filejdbc job</a> provided in the distribution shows an example of this using the standard File reader and JDBC writer.</p>
</div>
<div class="paragraph">
<p>The processor is based on the ItemProcessor interface.  It has a generic signature that lets you operate on a record at at time. The batch of records is handled as a collection in reader and writer implementations.  In the <code>filejdbc</code> job, the reader converts input records into a <a href="Tuples">Spring XD Tuple</a>.  The tuple serves as a generic data structure but you can also use or write another converter to convert the input record to your own custom POJO object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_orchestrating_hadoop_jobs">Orchestrating Hadoop Jobs</h3>
<div class="paragraph">
<p>There are several tasklet implementation that will run various types of Hadoop Jobs</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.spring.io/spring-hadoop/docs/2.0.2.RELEASE/reference/html/hadoop.html#hadoop:tasklet">MapReduce Job</a></p>
</li>
<li>
<p><a href="http://docs.spring.io/spring-hadoop/docs/2.0.2.RELEASE/reference/html/fs.html#scripting-tasklet">HDFS Scripts</a></p>
</li>
<li>
<p><a href="http://docs.spring.io/spring-hadoop/docs/2.0.2.RELEASE/reference/html/hive.html#hive:tasklet">Hive Scripts</a></p>
</li>
<li>
<p><a href="http://docs.spring.io/spring-hadoop/docs/2.0.2.RELEASE/reference/html/pig.html#pig:tasklet">Pig Scripts</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/spring-projects/spring-hadoop-samples">Spring Hadoop Samples</a> project provides examples of how to create batch jobs that orchestate various hadoop jobs at each step.  You can also mix and match steps related to work that is executed on the Hadoop cluster and work that is executed on the Spring XD cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_module_in_a_sub_directory_3">Installing the module in a sub-directory</h3>
<div class="paragraph">
<p>Modules can also reside in a sub-directory named after the module itself, e.g. <code>modules/job/myjob</code>.  This sub-directory in turn contains <code>config</code> and <code>lib</code> sub-directories.  If you install a module following this convention then the module will run in an isolated classpath, a child of the parent classpath created from the contents of <code>xd/lib</code>. See <a href="https://github.com/spring-projects/spring-xd/wiki/Modules#modules-with-isolated-classpath">Modules with isolated classpath</a> for more information.</p>
</div>
<div class="paragraph">
<p>[NOTE] To help you better package up a module for installation in a sub-directory the <a href="https://github.com/spring-projects/spring-xd-modules/blob/master/analytics-ml-pmml/build.gradle">sample build file</a> form the JPMML module can be used as a starting point.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-options-metadata">Providing Module Options Metadata</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_23">Introduction</h3>
<div class="paragraph">
<p>Each available module can expose metadata about the options it accepts. This is useful to enhance the user experience, and is the foundation to advanced features like contextual help and code completion.
the
For example, provided that the file source module has been enriched with options metadata (and it has), one can use the <code>module info</code> command in the shell to get information about the module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt; module info source:file
Information about source module 'file':

  Option Name        Description                                                                  Default  Type
  -----------------  ---------------------------------------------------------------------------  -------  ---------
  dir                the absolute path to the directory to monitor for files                      &lt;none&gt;   String
  pattern            a filter expression (Ant style) to accept only files that match the pattern  *        String
  outputType         how this module should emit messages it produces                             &lt;none&gt;   MediaType
  preventDuplicates  whether to prevent the same file from being processed twice                  true     boolean
  ref                set to true to output the File object itself                                 false    boolean
  fixedDelay         the fixed delay polling interval specified in seconds                        5        int</pre>
</div>
</div>
<div class="paragraph">
<p>For this to be available, module authors have to provide a little bit of extra information, known as "Module Options Metadata". That metadata can take two forms, depending on the needs of the module: one can either use the "simple" approach, or the "POJO" approach. If one does not need advanced features like profile activation, validation or options encapsulation, then the "simple" approach is sufficient.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_simple_approach">Using the "Simple" approach</h3>
<div class="paragraph">
<p>To use the simple approach, simply create a file named <code>&lt;module&gt;.properties</code> right next to the <code>&lt;module&gt;.xml</code> file for your module.</p>
</div>
<div class="sect3">
<h4 id="_declaring_and_documenting_an_option">Declaring and documenting an option</h4>
<div class="paragraph">
<p>In that file, each option <code>&lt;option&gt;</code> is declared by adding a line of the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options.&lt;option&gt;.description = the description</pre>
</div>
</div>
<div class="paragraph">
<p>The description for the option is the only required part, and is a very important piece of information for the end user, so pay special attention to it (see also <a href="#options_metadata_style">Style remarks</a>)</p>
</div>
<div class="paragraph">
<p>That sole line in the properties file makes a <code>--&lt;option&gt;=</code> construct available in the definition of a stream using your module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">About plugin provided options metadata</div>
<div class="paragraph">
<p>Some options are automatically added to a module, depending on its type. For example, every source module automatically inherits a <code>outputType</code> option, that controls the <a href="Type-Conversion">type conversion</a> feature between modules. You don&#8217;t have to do anything for that to happen.</p>
</div>
<div class="paragraph">
<p>Similarly, every job module benefits from a handful of <a href="#job_options">job specific options</a>.</p>
</div>
<div class="paragraph">
<p>Here is a recap of those automatically provided options:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module Type</th>
<th class="tableblock halign-left valign-top">Options</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputType</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputType, inputType</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inputType</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">makeUnique, numberFormat, dateFormat</p></td>
</tr>
</tbody>
</table>

</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_advertising_default_values">Advertising default values</h4>
<div class="paragraph">
<p>In addition to this, one can also provide a default value for the option, using</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options.&lt;option&gt;.default = SomeDefault</pre>
</div>
</div>
<div class="paragraph">
<p>Doing this, the default value should <strong>not</strong> be used in the placeholder syntax in the xml file. Assuming this is the contents of <code>foo.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options.bar.description = a very useful option
options.bar.default = 5</pre>
</div>
</div>
<div class="paragraph">
<p>then in <code>foo.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;!-- this is correct --&gt;
&lt;feature the-bar="${bar}"" /&gt;

&lt;!-- this is incorrect/not needed --&gt;
&lt;feature the-bar="${bar:5}" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exposing_the_option_type">Exposing the option type</h4>
<div class="paragraph">
<p>Lastly, one can document the option type using a construct like</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options.&lt;option&gt;.type = fully.qualified.class.Name</pre>
</div>
</div>
<div class="paragraph">
<p>For simple "primitive" types, one can use short names, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options.&lt;option&gt;.type = String
or
options.&lt;option&gt;.type = boolean
or
options.&lt;option&gt;.type = Integer</pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is support for both wrapper types (<em>e.g.</em> Integer) and primitive types (<em>e.g.</em> int). Although this is used for documentation purposes only, the primitive type would typically be used to indicate a <strong>required</strong> option (<code>null</code> being prohibited).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_pojo_approach">Using the "POJO" approach</h3>
<div class="paragraph">
<p>To use advanced features such as profile activation driven by the values provided by the end user, one would need to leverage the "POJO" approach.</p>
</div>
<div class="paragraph">
<p>Instead of writing a properties file, you will need to write a custom java class that will hold the values at runtime. That class is also introspected to derive metadata about your module.</p>
</div>
<div class="sect3">
<h4 id="_declaring_options_to_the_module">Declaring options to the module</h4>
<div class="paragraph">
<p>For the simplest cases, the class you need to write does not need to implement or inherit from anything. The only thing you need to do is to reference it in a properties file named after your module (the same file location you would have used had you been leveraging the "simple" approach):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>options_class = fully.qualified.name.of.your.Pojo</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> that the key is <code>options_class</code>, with an <em>s</em> and an underscore (not to be confused with <code>option.&lt;optionname&gt;</code> that is used in the "simple" approach)</p>
</div>
<div class="paragraph">
<p>For each option you want available using the <code>--&lt;option&gt;=</code> syntax, you must write a public setter annotated with <code>@ModuleOption</code>, providing the option description in the annotation.</p>
</div>
<div class="paragraph">
<p>The type accepted by that setter will be used as the documented type.</p>
</div>
<div class="paragraph">
<p>That setter will typically be used to store the value in a private field. How the module application can get ahold of the value is the topic of the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exposing_values_to_the_context">Exposing values to the context</h4>
<div class="paragraph">
<p>For a provided value to be used in the module definition (using the <code>${foo}</code> syntax), your POJO class needs to expose a <code>getFoo()</code> getter.</p>
</div>
<div class="paragraph">
<p>At runtime, an instance of the POJO class will be created (it requires a no-arg constructor, by the way) and values given by the user will be bound (using setters). The POJO class thus acts as an intermediate <code>PropertySource</code> to provide values to <code>${foo}</code> constructs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_providing_defaults">Providing defaults</h4>
<div class="paragraph">
<p>To provide default values, one would most certainly simply store a default value in the backing field of a getter/setter pair. That value (actually, the result of invoking the matching getter to a setter on a newly instanciated object) is what is advertised as the default.</p>
</div>
</div>
<div class="sect3">
<h4 id="_encapsulating_options">Encapsulating options</h4>
<div class="paragraph">
<p>Although one would typically use the combination of a <code>foo</code> field and a <code>getFoo(), setFoo(x)</code> pair, one does not have to.</p>
</div>
<div class="paragraph">
<p>In particular, if your module definition requires some "complex" (all things being relative here) value to be computed from "simpler" ones (<em>e.g.</em> a <em>suffix</em> value would be computed from an <em>extension</em> option, that would take care of adding a dot, depending on whether it is blank or not), then you&#8217;d simply do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public class MyOptions {
	private String extension;

	@ModuleOption("the file extension to use")
	public void setExtension(String extension) {
	    this.extension = extension;
	}

	public String getSuffix() {
	    return extension == null ? null : "." + extension;
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would expose a <code>--extension=</code> option, being surfaced as a <code>${suffix}</code> placeholder construct.</p>
</div>
<div class="paragraph">
<p>The astute reader will have realized that the default can not be computed then, because there is no <code>getExtension()</code> (and there should not be, as this could be mistakenly used in <code>${extension}</code>). To provide the default value, you should use the <code>defaultValue</code> attribute of the <code>@ModuleOption</code> annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_profiles">Using profiles</h4>
<div class="paragraph">
<p>The real benefit of using a POJO class for options metadata comes with advanced features though, one of which is dynamic profile activation.</p>
</div>
<div class="paragraph">
<p>If the set of beans (or xml namespaced elements) you would define in the module definition file depends on the value that the user provided for one or several options, then you can make your POJO class implement <code>ProfileNamesProvider</code>. That interface brings one contract method, <code>profilesToActivate()</code> that you must implement, returning the names of the profiles you want to use (this method is invoked <strong>after</strong> user option values have been bound, so you can use any logic involving those to compute the list of profile names).</p>
</div>
<div class="paragraph">
<p>As an example of this feature, see <em>e.g.</em> <code>TriggerSourceOptionsMetadata</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_validation">Using validation</h4>
<div class="paragraph">
<p>Your POJO class can optionally bear JSR303 annotations. If it does, then validation will occur after values have been successfully bound (understand that injection can fail early due to type incoherence by the way. This comes for free and does not require JSR303 annotations).</p>
</div>
<div class="paragraph">
<p>This can be used to validate a set of options passed in (some are often mutually exclusive) or to catch misconfiguration earlier than deployment time (<em>e.g.</em> a port number cannot be negative).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="options_metadata_style">Metadata style remarks</h3>
<div class="paragraph">
<p>To provide a uniform user experience, it is better if your options metadata information adheres to the following style:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>option names should follow the <code>camelCase</code> syntax, as this is easier with the POJO approach. If we later decide to switch to a more <code>unix-style</code>, this will be taken care of by XD itself, with no change to the metadata artifacts described here</p>
</li>
<li>
<p>description sentences should be concise</p>
</li>
<li>
<p>descriptions should start with a <strong>lowercase</strong> letter and should <strong>not</strong> end with a dot</p>
</li>
<li>
<p>use primitive types for required numbers</p>
</li>
<li>
<p>descriptions should mention the unit for numbers (<em>e.g</em> ms)</p>
</li>
<li>
<p>descriptions should <strong>not</strong> describe the default value, to the best extent possible (this is surfaced thru the actual <em>default</em> metadata awareness)</p>
</li>
<li>
<p>options metadata should know about the default, rather than relying on the <code>${foo:default}</code> construct</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extending-xd">Extending Spring XD</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_24">Introduction</h3>
<div class="paragraph">
<p>This document describes how to customize or extend the Spring XD Container. Spring XD is a distributed runtime platform delivered as executable components including XD Admin, XD Container, and XD Shell. The XD Container is a Spring application combining XML resources, Java @Configuration classes, and Spring Boot auto configuration for its internal configuration, initialized via the Spring Boot <a href="http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/builder/SpringApplicationBuilder.html">SpringApplicationBuilder</a>. Since Spring XD is open source, the curious user can see exactly how it is configured. However, all Spring XD&#8217;s configuration is bundled in jar files and therefore not directly accessible to end users. Most users do not need to customize or extend the XD Container. For those that do, Spring XD provides hooks to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide additional bean definitions</p>
</li>
<li>
<p>Override selected bean definitions with custom implementations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Customization scenarios might include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a <a href="#Adding-a-New-Data-Transport">new data transport</a></p>
</li>
<li>
<p>Add a Spring XD <a href="#Plugin-Architecture">plugin</a> to configure modules</p>
</li>
<li>
<p>Embed a <a href="#How-to-Add-a-Spring-Bean-to-the-XD-Container">shared component</a> used by user provided Plugin, such as a GemFire cache or a data source</p>
</li>
<li>
<p><a href="#Providing-a-New-Type-Converter">Providing additional</a> <a href="Type-conversion">type converters</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This following sections provide an overview of XD Container internals and explain how to extend Spring XD for each of these scenarios. The reader is expected to have a working knowledge of both the Spring Framework and Spring Integration.</p>
</div>
</div>
<div class="sect2">
<h3 id="XD-Spring-Application-Contexts">Spring XD Application Contexts</h3>
<div class="paragraph">
<p>The diagram below shows how Spring XD is organized into several Spring application contexts. Some understanding of the Spring XD application context hierarchy is necessary for extending XD. In the diagram, solid arrows indicate a parent-child relationship. As with any Spring application a child application context may reference beans defined in its parent application context, but the parent context cannot access beans defined in the child context. It is important to keep in mind that a bean definition registered in a child context with the same id as a bean in the parent context will create a separate instance in the child context. Similarly, any bean definition will override an earlier bean definition in the same application context registered with the same id (Sometimes referred to as "last one wins").</p>
</div>
<div class="paragraph">
<p>Spring XD&#8217;s primary extension mechanism targets the <em>Plugin Context</em> highlighted in the diagram. Using a separate convention, it is also possible to register an alternate MessageBus implementation in the <em>Shared Server Context</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/xd-extensions-contexts.png" alt="Extension contexts" width="500">
</div>
<div class="title">Figure 27. The Spring XD Application Context Hierarchy</div>
</div>
<div class="paragraph">
<p>While this arrangement of application contexts is more complex than the typical Spring application, XD is designed this way for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bean isolation</strong> - Some beans are "global" in that they are shared by all XD runtime components: Admin, Container, and Modules. Those allocated to the <em>Shared Server Context</em> are shared only by Admin and Container. Some beans must be available to <a href="#Plugin-Architecture">Plugins</a> ,used to configure <em>Modules</em>. However Plugins and Modules should be isolated from  critical internal components. While complete isolation has proven difficult to achieve, the intention is to minimize any undesirable side effects when introducing extensions.</p>
</li>
<li>
<p><strong>Bean scoping</strong> - To ensure that single node and distributed configurations of the Spring XD runtime are logically equivalent, the Spring configuration is identical in both cases, avoiding unnecessary duplication of bean definitions.</p>
</li>
<li>
<p><strong>Lifecycle management</strong> - Plugins and other beans used to configure these application contexts are also Spring beans which Spring XD dynamically "discovers" during initialization. Such components must be fully instantiated prior to the creation of the application context to which they are targeted. To ensure initialization happens in the desired order, such beans may be either defined in an isolated application context (i.e., not part of the hierarchy) or in a parent context which Spring  initializes before any of its descendants.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Plugin-Architecture">Plugin Architecture</h3>
<div class="paragraph">
<p>The XD Container at its core is simply a runtime environment for hosting and managing micro Spring applications called <em>Modules</em>. Each module runs in its own application context (<em>Module Context</em>). The Module Context is a child of <em>Global Context</em>, as modules share some bean definitions, but otherwise is logically isolated from beans defined in the XD Container.  The <em>Module Context</em> is fundamental to the Spring XD design. In fact, this is what allows each module to define its own <em>input</em> and <em>output</em> channels, and in general, enables beans be uniquely configured via property placeholders evaluated for each deployed instance of a Module. The <a href="http://docs.spring.io/spring-xd/docs/1.0.0.RELEASE/api/org/springframework/xd/module/core/Module.html">Module</a> interface and its default implementation provide a thin wrapper around a Spring Application Context for which properties are bound, profiles activated, and beans added or enhanced in order to "plug" the module into the XD Container.</p>
</div>
<div class="paragraph">
<p>The <em>ModuleDeployer</em>, shown in the diagram, is a core component of the Container Context, responsible for initializing modules during deployment, and shutting them down during undeployment. The ModuleDeployer sees the module as a "black box", unaware of its purpose or runtime requirements. Binding a module&#8217;s channels to XD&#8217;s data transport, for instance, is the responsibility of the <a href="http://docs.spring.io/spring-xd/docs/1.0.0.RELEASE/api/org/springframework/integration/x/bus/MessageBus.html">MessageBus</a> implementation configured for the transport. The MessageBus binding methods are actually invoked by the <em>StreamPlugin</em> during the initialization of a stream module. To support jobs, XD provides a <em>JobPlugin</em> to wire the Spring Batch components defined in the module during deployment.  The JobPlugin also invokes the MessageBus to support communications between XD and job modules. These, and other functions critical to Spring XD are performed by classes that implement the <a href="http://docs.spring.io/spring-xd/docs/1.0.0.RELEASE/api/org/springframework/xd/module/core/Plugin.html">Plugin</a> interface. A Plugin operates on every deployed Module which it is implemented to support. Thus the ModuleDeployer simply invokes the deployment life cycle methods provided by every Plugin registered in the Plugin Context.</p>
</div>
<div class="paragraph">
<p>The ModuleDeployer discovers registered Plugins by calling <code>getBeansOfType(Plugin.class)</code> for the <em>Plugin Context</em> (its parent context). This means that adding your own Plugin requires these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the <a href="http://docs.spring.io/spring-xd/docs/1.0.0.RELEASE/api/org/springframework/xd/module/core/Plugin.html">Plugin</a> interface</p>
</li>
<li>
<p>Add your Plugin implementation and any dependent classes to Spring XD&#8217;s class path</p>
</li>
<li>
<p>Follow conventions that Spring XD uses to register Plugins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next section covers these steps in more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="How-to-Add-a-Spring-Bean-to-the-XD-Container">How to Add a Spring bean to the XD Container</h3>
<div class="paragraph">
<p>This section applies to adding a <em>Plugin</em>, which is generally useful since a Plugin has access to every module as it is being deployed (see the previous section on Plugin Architecture). Furthermore, this section describes a generic mechanism for adding any bean definition to the <em>Plugin Context</em>.  Spring XD uses both Spring Framework&#8217;s class path component scanning and resource resolution to find any components that you add to specified locations in the class path. This means you may provide Java @Configuration and/or any classes annotated with the @Component stereotype in a configured base package in addition to bean definitions defined in any XML or Groovy resource placed under a configured resource location. These locations are given by the properties <code>xd.extensions.locations</code> and <code>xd.extensions.basepackages</code>, optionally configured in <code>servers.yml</code> down at the bottom:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># User Extensions: Where XD scans the class path to discover extended container configuration to adds beans to the Plugins context.
# Each property may be a comma delimited string. 'basepackages' refers to package names used for
# annotated component (@Configuration or @Component stereotypes) scanning. 'locations' is a list of root resource directories containing XML or Groovy configuration.
# XD prepends classpath:* if no prefix included and appends **/*.* to each location
#xd:
#  extensions:
#      basepackages: com.acme.xd.extensions
#      locations: META-INF/spring-xd/ext</pre>
</div>
</div>
<div class="paragraph">
<p>As the pluralization of these property names suggests, you may represent multiple values as a comma delimited string. Also note that there is no default for <code>xd.extensions.basepackages</code>. So if you want to use annotation based configuration, you must first set up one or more base package locations. The resource location(s) define the root locations where any XML or Groovy Spring bean definition file found in the given root or any of its subdirectories will be loaded. The root location  defaults to <code>META-INF/spring-xd/ext</code></p>
</div>
<div class="paragraph">
<p>The Container loads any bean definitions found in these configured locations on the class path and adds them to the Plugin Context. This is the appropriate application context since in order to apply custom logic to modules, you will most likely need to provide a custom Plugin.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The extension mechanism is very flexible. In theory, one can define BeanPostProcessors, BeanFactoryPostProcessors, or ApplicationListeners to manipulate Spring XD application contexts. Do so at your own risk as the Spring XD initialization process is fairly complex, and not all beans are intended to be extensible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Extensions are packaged in a jar file which must be added to Spring XD&#8217;s class path. Currently, you must manually copy the jar to <code>$XD_HOME/lib</code> for each container instance. To implement a Plugin, you will need to include a compile time dependency on <code>spring-xd-module</code> in your build. To access other container classes and to test your code in a container you will also require <code>spring-xd-dirt</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Providing-a-New-Type-Converter">Providing A new Type Converter</h3>
<div class="paragraph">
<p>Spring XD supports <a href="Type-conversion">automatic type conversion</a> to convert payloads declaratively. For example, to convert an object to JSON, you provide the module option <code>--outputType=application/json</code> to a module used in a stream definition. The conversion is enabled by a <em>Plugin</em> that binds a Spring <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/converter/MessageConverter.html">MessageConverter</a> to a media type. The default type converters are currently configured in <a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/resources/META-INF/spring-xd/plugins/streams.xml">streams.xml</a>, packaged in <code>spring-xd-dirt-&lt;version&gt;.jar</code>. If you look at that file, you can see an empty list registered as <code>customMessageConverters</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;!-- Users can override this to add converters.--&gt;
	&lt;util:list id="customMessageConverters"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>So registering new type converters is a matter of registering an alternate list as <code>customMessageConverters</code> to the application context. Spring XD will replace the default empty list with yours. <code>xd.messageConverters</code> and <code>customMessageConverters</code> are two lists injected into the <em>ModuleTypeConversionPlugin</em> to build an instance of <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/converter/CompositeMessageConverter.html">CompositeMessageConverter</a> which delegates to the first converter in list order that is able to perform the necessary conversion. The Plugin injects the CompositeMessageConverter into the module&#8217;s <em>input</em> or <em>output</em> the <a href="http://docs.spring.io/spring-integration/docs/4.0.0.RC1/api/org/springframework/integration/channel/AbstractMessageChannel.html">MessageChannel</a>, corresponding to the <code>inputType</code> or <code>outputType</code> options declared for any module in the stream definition (or defined as the module&#8217;s default <code>inputType</code>).</p>
</div>
<div class="paragraph">
<p>The CompositeMessageConverter is desirable because a module does not generally know what payload type it will get from its predecessor. For example, the converters that Spring XD provides out of the box can convert any Java object, including a <a href="http://docs.spring.io/spring-xd/docs/1.0.0.RELEASE/api/org/springframework/xd/tuple/Tuple.html">Tuple</a> and a byte array to a JSON String. However the methods for converting a byte array or a Tuple are each optimized for the respective type. The CompositeMessageConverter for --outputType=application/json must provide all three methods and the Data Type channel chooses the first converter that applies to both the incoming payload type and the media type (e.g., application/json). Note that the order that the converters appear in the list is significant. In general, converters for specific payload types precede more general converters for the same media type. The <code>customMessageConverters</code> are added after the standard converters in the order defined. So it is generally easier to add converters for new media types than to replace existing converters.</p>
</div>
<div class="paragraph">
<p>For example, a member of the Spring XD community inquired about Spring XD&#8217;s support for <a href="https://developers.google.com/protocol-buffers/">Google protocol buffers</a>. This user was interested in integrating Spring XD with an existing messaging system that uses GPB heavily and needed a way to convert incoming and outgoing GPB payloads to interoperate with XD streams. This could be accomplished by providing a <code>customMessageConverters</code> bean containing a list of required message converters. Writing a custom converter to work with XD requires extending <a href="http://docs.spring.io/spring-xd/docs/1.0.0.RELEASE/api/org/springframework/integration/x/bus/converter/AbstractFromMessageConverter.html">AbstractFromMessageConverter</a> provided by <code>spring-xd-dirt</code>. It is recommended to review the existing implementations listed in <a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/resources/META-INF/spring-xd/plugins/streams.xml">streams.xml</a> to get a feel for how to do this. In addition, you would likely define a custom <a href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/MimeType.html">MimeType</a> such as <code>application/gpb</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is worth mentioning that GPB is commonly used for marshaling objects over the network. In the context of Spring XD marshaling is treated as a separate concern from payload conversion. In Spring XD, marshaling happens at the "pipe" indicated by the <em>|</em> symbol using a different serialization mechanism, described below. In this case, the GPB payloads are produced and consumed by systems external to Spring XD and need to be converted in order that a GPB payload can work with XD streams. In this scenario, if the GPB is represented as a byte array, the bytes are transmitted over the network directly and marshaling is unnecessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an illustration, suppose this user has developed a source module that emits GPB payloads from a legacy service. Spring XD provides transform and filter modules that accept SpEL expressions to perform their respective tasks. These modules are useful in many situations but the SpEL expressions generally require a POJO representing a domain type, or a JSON string. In this case it would be convenient to support stream definitions such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpb-source --outputType=application/x-java-object | transform --expression=...</pre>
</div>
</div>
<div class="paragraph">
<p>where <em>gpb-source</em> represents a custom module that emits a GPB payload and <em>expression</em> references some specific object property. The media type application/x-java-object is a convention used by XD to indicate that the payload should be converted to a Java type embedded in the serialized representation (GPB in this example). Alternately, converting to JSON could be performed if the stream definition were:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpb-source --outputType=application/json | transform --expression=...</pre>
</div>
</div>
<div class="paragraph">
<p>To convert an XD stream result to GPB to be consumed by an external service might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>source | P1 ... | Pn | gpb-sink --inputType=application/gpb</pre>
</div>
</div>
<div class="paragraph">
<p>These examples would require registering custom MessageConverters to handle the indicated conversions.
Alternately, this may be accomplished by writing custom processor modules to perform the required conversion. The above examples would then have stream definitions that look more like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpb-source | gpb-to-pojo | transform --expression=...
source | P1 ... | Pn | json-to-gpb | gpb-sink</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
While custom processor modules are easier to implement, they add unnecessary complexity to stream definitions that use them. If such conversions are required everywhere, enabling automatic conversion may be worth the effort. Also, note that using a separate module generally requires additional network hops (at each pipe). If a processor module is necessary only to perform a common payload conversion, it is more efficient to install a custom converter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Adding-a-New-Data-Transport">Adding a New Data Transport</h3>
<div class="paragraph">
<p>Spring XD offers Redis and Rabbit MQ for data transport out of the box. Transport is configured simply by setting the property <code>xd.transport</code> to <code>redis</code> or <code>rabbit</code>. In addition xd-singlenode supports a <code>--transport</code> command line option that can accept <em>local</em>(the single node default) in addition. This simple configuration mechanism is supported internally by an import declaration that binds the transport implementation to a name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;import resource="classpath*:/META-INF/spring-xd/transports/${XD_TRANSPORT}-bus.xml"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above snippet is from an internal Spring configuration file loaded into the <em>Shared Server Context</em>. Spring XD provides MessageBus implementations in <code>META-INF/spring-xd/transports/redis-bus.xml</code> and <code>META-INF/spring-xd/transports/rabbit-bus.xml</code></p>
</div>
<div class="paragraph">
<p>This makes it relatively simple for Spring XD developers and advanced users to provide alternate MessageBus implementations to enable a new transport and activate that transport by setting the <code>xd.transport</code> property. For example, to implement a JMS MessageBus you would add a jar containing <code>/META-INF/spring-xd/transports/jms-bus.xml</code> in the class path. This file must register a bean of type <em>MessageBus</em> with the ID <code>messageBus</code>. A jar providing the above configuration file along with the MessageBus implementation and any dependencies must be installed <code>$XD_HOME/lib</code>.</p>
</div>
<div class="paragraph">
<p>When implementing a MessageBus, it is advisable to review and understand the existing implementations which extend <a href="http://docs.spring.io/spring-xd/docs/1.0.0.RELEASE/api/org/springframework/integration/x/bus/MessageBusSupport.html">MessageBusSupport</a>. This base class performs some common tasks including payload marshaling. Spring XD uses the term <em>codec</em> to connote a component that performs both serialization and deserialization and provides a bean with the same name. In the example above, the JMS MessageBus configuration`/META-INF/spring-xd/transports/jms-bus.xml` might look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;bean id="messageBus" class="my.example.JmsMessageBus"&gt;
	&lt;constructor-arg ref="jmsConnectionFactory" /&gt;
	&lt;constructor-arg ref="codec"/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where JmsMessageBus extends MessageBusSupport and the developer is responsible for configuring any dependent JMS resources appropriately.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="samples">Samples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have a number of sample projects in the <a href="https://github.com/spring-projects/spring-xd-samples">Spring XD Samples GitHub repository</a>. Below are some additional examples for ingesting syslog data to HDFS.</p>
</div>
<div class="sect2">
<h3 id="_syslog_ingestion_into_hdfs">Syslog ingestion into HDFS</h3>
<div class="paragraph">
<p>In this section we will show a simple example on how to setup syslog ingestion from multiple hosts into HDFS.</p>
</div>
<div class="paragraph">
<p>Create the streams with syslog as source and HDFS as sink (Please refer to <a href="#sources">source</a> and <a href="#sinks">sink</a>)</p>
</div>
<div class="paragraph">
<p>If you&#8217;re using syslog over TCP and need the highest throughput, use the Reactor-backed syslog module.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --definition "reactor-syslog --port=&lt;tcp-port&gt; | hdfs" --name &lt;stream-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>reactor-syslog</code> module doesn&#8217;t yet support UDP (though it soon will), so if you&#8217;re using syslog over UDP you&#8217;ll want to use the standard syslog module.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --definition "syslog-udp --port=&lt;udp-port&gt; | hdfs" --name &lt;stream-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>xd:&gt; stream create --definition "syslog-tcp --port=&lt;tcp-port&gt; | hdfs" --name &lt;stream-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Please note for hdfs sink, set <code>rollover</code> parameter to a smaller value to avoid buffering and to see the data has made to HDFS (incase of smaller volume of log).</p>
</div>
<div class="paragraph">
<p>Configure the external hosts’ syslog daemons forward their messages to the xd-container host’s UDP/TCP port (where the syslog-udp/syslog-tcp source module is deployed).</p>
</div>
<div class="sect3">
<h4 id="_a_sample_configuration_using_syslog_ng">A sample configuration using syslog-ng</h4>
<div class="paragraph">
<p>Edit syslog-ng configuration (for example: /etc/syslog-ng/syslog-ng.conf):</p>
</div>
<div class="paragraph">
<p>1) Add destination</p>
</div>
<div class="literalblock">
<div class="content">
<pre>destination &lt;destinationName&gt; {
      tcp("&lt;host&gt;" port("&lt;tcp-port&gt;"));
};</pre>
</div>
</div>
<div class="paragraph">
<p>or,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>destination &lt;destinationName&gt; {
      udp("&lt;host&gt;" port("&lt;udp-port&gt;"));
};</pre>
</div>
</div>
<div class="paragraph">
<p>where "host" is the container(launcher) host where the syslog module is deployed.</p>
</div>
<div class="paragraph">
<p>2) Add log rule to log message sources:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>log {
  source(&lt;message_source&gt;); destination(&lt;destinationName&gt;);
};</pre>
</div>
</div>
<div class="paragraph">
<p>3) Make sure to restart the service after the change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo service syslog-ng restart</pre>
</div>
</div>
<div class="paragraph">
<p>Now, the syslog messages from the syslog message sources are written into HDFS /xd/&lt;stream-name&gt;/</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="configuration-guidelines" class="sect0">Configuration Guidelines</h1>
<div class="sect1">
<h2 id="_overview_2">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When running a distributed Spring XD runtime, there are a number of considerations related to performance and reliability. In most cases, these involve settings that have tradeoffs, but in this section we provide some background so you know what the options are and how to configure them.</p>
</div>
<div class="paragraph">
<p>In the <a href="#Introduction">Deployment</a> section that follows, we provide detailed information about various properties that can be passed along with the <code>stream deploy</code> command. That section also describes a scenario that is common for minimizing network hops, where direct binding can occur between modules rather than having each pipe within a stream correspond to a send and receive over the Message Bus. For more detail see the <a href="#direct-binding">Direct Binding</a> subsection.</p>
</div>
<div class="paragraph">
<p>Another relevant topic for minimizing network hops is the ability to <em>compose</em> modules. That is a useful technique where a subset of the stream&#8217;s contiguous modules can be grouped together as if a single module. All of the pipes within the composed module will rely upon a local transport rather than sending and receiving via the Message Bus. For more detail read the <a href="#composing-modules">Composing Modules</a> section.</p>
</div>
<div class="paragraph">
<p>For production use, high availability will typically be a requirement for the data transport. Therefore, we recommend using Spring XD&#8217;s RabbitMQ-based Message Bus. In the <a href="#introduction">Message Bus Configuration</a> section below, we provide details on the relevant <a href="#rabbit-message-bus-high-availability-ha-configuration">HA configuration</a> settings as well as other reliability settings, security settings (including <a href="#rabbit-message-bus-secure-sockets-layer-ssl">enabling SSL</a>), and <a href="#error-handling-message-delivery-failures">error-handling</a> capabilities.</p>
</div>
<div class="paragraph">
<p>When configuring a RabbitMQ Message Bus, you will also want to consider several performance settings. For example, unless strict sequential ordering is required, the <em>prefetch</em> and <em>concurrency</em> values should be overridden (the default for each is 1). That can lead to a significant performance improvement. In the less likely case that performance concerns completely outweigh reliability, you can disable acknowledgements and even disable the persistence of messages. For a listing of these settings and more, refer to the <a href="#rabbitmq">RabbitMQ Configuration</a> section. Several performance related configuration settings exist on the broker itself, and those are well-documented in the <a href="http://www.rabbitmq.com/admin-guide.html">RabbitMQ Admin Guide</a>. For example, the <em>vm_memory_high_watermark</em> and <em>vm_memory_high_watermark_paging_ratio</em> are both explained within the <a href="http://www.rabbitmq.com/memory.html">Flow Control</a> subsection of the guide.</p>
</div>
<div class="paragraph">
<p>If you are using the HTTP source module in a stream and want to scale, you can deploy multiple instances by specifying the <em>module.http.count</em> property as described in the <a href="#deployment-properties">Deployment Properties</a> section. Keep in mind that each instance will share the same port value. The default is 9000, but that can be overridden, for all instances, by including <em>--port</em> as an option for the HTTP module in the stream definition. That means you would want to ensure that each container that may be a candidate for deploying one of the HTTP module instances (taking into account the <em>criteria</em> deployment property if provided), is running on a different host, either physically or on separate virtual machines. Of course, in a production environment, you would likely want to add a load balancer in front of those HTTP endpoints.</p>
</div>
<div class="paragraph">
<p>Also when using the HTTP source module, you may want to consider enabling support for HTTPS. An example is provided in the documentation for that module&#8217;s <a href="#http-with-options">options</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deployment">Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_25">Introduction</h3>
<div class="paragraph">
<p>This section covers topics related to deployment, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#deployment-manifest">The Deployment Manifest</a></p>
</li>
<li>
<p><a href="#deployment-states">Deployment States</a></p>
</li>
<li>
<p><a href="#container-attributes">Container Attributes</a></p>
</li>
<li>
<p><a href="#stream-partitioning">Stream Partitioning</a></p>
</li>
<li>
<p><a href="#direct-binding">Direct Binding</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you deploy a <a href="Streams">Stream</a> or <a href="Jobs">Job</a>, the Spring XD Runtime performs the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>parse the stream or job definition (<a href="#dsl-reference">DSL Guide</a>) to resolve each Module reference along with its options</p>
</li>
<li>
<p>set option values assigned to each component <a href="Modules">Module</a></p>
</li>
<li>
<p>parse and store the deployment request including the <a href="#deployment-manifest">Deployment Manifest</a></p>
</li>
<li>
<p>allocate each Module to an available Container instance in accordance with the Deployment Manifest</p>
</li>
<li>
<p>binding Module channel(s), either to the <a href="MessageBus">MessageBus</a> or directly using <a href="#direct-binding">Direct Binding</a></p>
</li>
<li>
<p>track the state of each deployed module</p>
</li>
<li>
<p>track the overall stream or job&#8217;s <a href="#deployment-states">Deployment State</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deployment-manifest">Deployment Manifest</h3>
<div class="paragraph">
<p>A stream is composed of modules. Each module is deployed to one or more Container instance(s). In this way, stream processing is distributed among multiple containers. By default, deploying a stream to a distributed runtime configuration uses simple round robin logic. For example if there are three containers and three modules in a stream definition,  <code>s1= m1 | m2 | m3</code>, then Spring XD will attempt to distribute the work load evenly among each container. This is a very simplistic strategy and does not take into account things like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>server load - how many modules are already deployed to a container? What is the current memory and CPU utilization?</p>
</li>
<li>
<p>server affinity - some containers may have external software installed and specific modules will benefit from co-location. For example, an hdfs sink might be deployed only to hosts running Hadoop. Or perhaps a file sink should be deployed to hosts configured with extra disk space.</p>
</li>
<li>
<p>scalability - Suppose the stream s1, above, can achieve higher throughput with multiple instances of m2 running, so we want to deploy m2 to every available container.</p>
</li>
<li>
<p>fault tolerance - the ability to target physical servers on redundant networks, routers, racks, etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Generally, more complex deployment strategies are needed to tune and operate XD. Additionally, we must consider various features and constraints when deploying to a PaaS, Yarn or some other cluster manager. Additionally, Spring XD allows supports <a href="#stream-partitioning">Stream Partitioning</a> and <a href="#direct-binding">Direct Binding</a>.</p>
</div>
<div class="paragraph">
<p>To address such deployment concerns, Spring XD provides a <em>Deployment Manifest</em> which is submitted with the deployment request, in the form of in-line deployment properties (or potentially a reference to a separate document containing deployment properties).</p>
</div>
<div class="sect3">
<h4 id="_deployment_properties">Deployment Properties</h4>
<div class="paragraph">
<p>When you execute the <code>stream deploy</code> shell command, you can optionally provide a <code>properties</code> parameter which is a comma delimited list of key=value pairs. Examples for the key include <strong>module.[modulename].count</strong> and <strong>module.[modulename].criteria</strong> (for a full list of properties, see below). The value for the count is a positive integer, and the value for criteria is a valid SpEL expression. The Spring XD runtime matches an  available container for each module according to the deployment manifest.</p>
</div>
<div class="paragraph">
<p>The deployment properties allow you to specify deployment instructions for each module. Currently this includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The number of module instances</p>
</li>
<li>
<p>A target server or server group</p>
</li>
<li>
<p>MessageBus attributes required for a specific module</p>
</li>
<li>
<p>Stream Partitioning</p>
</li>
<li>
<p>Direct Binding</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_general_properties">General Properties</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can apply criteria to all modules in the stream by using the wildcard <em>*</em> for [modulename]
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">module.[modulename].count</dt>
<dd>
<p>The number of module instances (see above).</p>
</dd>
<dt class="hdlist1">module.[modulename].criteria</dt>
<dd>
<p>A boolean SpEL expression using the <a href="#container-attributes">Container Attributes</a> as an evaluation context.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream deploy --name test1 --properties "module.transform.count=3,module.log.criteria=groups.contains('group1')"</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bus_properties">Bus Properties</h5>
<div class="sect5">
<h6 id="_common_bus_properties">Common Bus Properties</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The following properties are only allowed when using a <em>RabbitMessageBus</em> or a <em>RedisMessageBus</em>; the <em>LocalMessageBus</em> does not support properties.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">module.[modulename].consumer.backOffInitialInterval</dt>
<dd>
<p>The number of milliseconds to wait for the first delivery retry <strong>(default 1000)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.backOffMaxInterval</dt>
<dd>
<p>The maximum number of milliseconds to wait between retries <strong>(default 10000)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.backOffMultiplier</dt>
<dd>
<p>The previous retry interval is multiplied by this to determine the current interval (but see <em>backOffMaxInterval</em>) <strong>(default 2.0)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.concurrency</dt>
<dd>
<p>The number of concurrent consumers for the module <strong>(default 1)</strong>.</p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.maxAttempts</dt>
<dd>
<p>The maximum number of attempts to make a delivery when a failure occurs <strong>(default 3)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="_rabbitmq_bus_properties">RabbitMQ Bus Properties</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The following properties are only allowed when using a <em>RabbitMessageBus</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the Spring AMQP reference documentation for information about the RabbitMQ-specific attributes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">module.[modulename].consumer.ackMode</dt>
<dd>
<p>Controls message acknowledgements <strong>(default AUTO)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.maxConcurrency</dt>
<dd>
<p>The maximum number of concurrent consumers for the module <strong>(default 1)</strong>.</p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.prefetch</dt>
<dd>
<p>The number of messages prefetched from the RabbitMQ broker <strong>(default 1)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.prefix</dt>
<dd>
<p>A prefix applied to all queues/exchanges that are declared by the bus - allows policies to be applied <strong>(default <em>xdbus.</em>)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.requestHeaderPatterns</dt>
<dd>
<p>Controls which message headers are passed between modules <strong>(default <em>STANDARD_REQUEST_HEADERS,*</em>)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.replyHeaderPatterns</dt>
<dd>
<p>Controls which message headers are passed between modules (only used in partitioned jobs) <strong>(default <em>STANDARD_REPLY_HEADERS,*</em>)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.requeue</dt>
<dd>
<p>Whether messages will be requeued (and retried) on failure <strong>(default true)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.transacted</dt>
<dd>
<p>Whether consumers use transacted channels <strong>(default false)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].consumer.txSize</dt>
<dd>
<p>The number of delivered messages between acknowledgements (when <em>ackMode=AUTO</em>) <strong>(default 1)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].producer.deliveryMode</dt>
<dd>
<p>THe delivery mode of messages sent to RabbitMQ (<em>PERSISTENT</em> or <em>NON_PERSISTENT</em>) <strong>(default PERSISTENT)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].producer.requestHeaderPatterns</dt>
<dd>
<p>Controls which message headers are passed between modules <strong>(default <em>STANDARD_REQUEST_HEADERS,*</em>)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].producer.replyHeaderPatterns</dt>
<dd>
<p>Controls which message headers are passed between modules (only used in partitioned jobs) <strong>(default <em>STANDARD_REPLY_HEADERS,*</em>)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="stream-partitioning">Stream Partitioning</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Partitioning is only allowed when using a <em>RabbitMessageBus</em> or a <em>RedisMessageBus</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A common pattern in stream processing is to partition the data as it is streamed. This entails deploying multiple instances of a message consuming module and using content-based routing so that messages containing the identical data value(s) are always routed to the same module instance. You can use the Deployment Manifest to declaratively configure a partitioning strategy to route each message to a specific consumer instance.</p>
</div>
<div class="sect5">
<h6 id="partition-properties">Partition Properties</h6>
<div class="paragraph">
<p>See below for examples of deploying <a href="#partitioned-stream-deployment-examples">partitioned streams</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">module.[modulename].producer.partitionKeyExtractorClass</dt>
<dd>
<p>The class name of a <em>PartitionKeyExtractorStrategy</em> <strong>(default null)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].producer.partitionKeyExpression</dt>
<dd>
<p>A <em>SpEL</em> expression, evaluated against the message, to determine the partition key; only applies if <em>partitionKeyExtractorClass</em> is null. If both are null, the module is not partitioned <strong>(default null)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].producer.partitionSelectorClass</dt>
<dd>
<p>The class name of a <em>PartitionSelectorStrategy</em> <strong>(default null)</strong></p>
</dd>
<dt class="hdlist1">module.[modulename].producer.partitionSelectorExpression</dt>
<dd>
<p>A <em>SpEL</em> expression, evaluated against the partition key, to determine the partition index to which the message will be routed. The final partition index will be the return value (an integer) modulo <em>[nextModule].count</em> If both the class and expression are null, the bus&#8217;s default <em>PartitionSelectorStrategy</em> will be applied to the key <strong>(default null)</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In summary, a module is partitioned if its <em>count</em> is &gt; 1 and the previous module has a <em>partitionKeyExtractorClass</em> or <em>partitionKeyExpression</em> (class takes precedence). When a partition key is extracted, the partitioned module instance is determined by invoking the <em>partitionSelectorClass</em>, if present, or the <em>partitionSelectorExpression % count</em>. If neither is present the result is <em>key.hashCode() % count</em>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="direct-binding">Direct Binding</h5>
<div class="paragraph">
<p>Sometimes it is desirable to allow co-located, contiguous modules to communicate directly, rather than using the configured remote transport, to eliminate network latency. Spring XD creates direct bindings by default only in cases where every "pair" of producer and consumer (modules bound on either side of a pipe) are guaranteed to be co-located.</p>
</div>
<div class="paragraph">
<p>Currently Spring XD implements no conditional logic to force modules to be co-located. The only way to guarantee that every producer-consumer pair is co-located is to specify that the pair be deployed to every available container instance, in other words, the module counts must be 0. The figure below illustrates this concept. In the first hypothetical case, we deploy one instance (the default)of producer m1, and two instances of the consumer m2. In this case, enabling direct binding would isolate one of the consumer instances. Spring XD will not create direct bindings in this case. The second case guarantees co-location of the pairs and will result in direct binding.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/direct-binding.png" alt="Direct Binding" width="500">
</div>
</div>
<div class="paragraph">
<p>In addition, direct binding requires that the producer is not configured for <a href="#partition-properties">partitioning</a> since partitioning is <strong>implemented</strong> by the Message Bus.</p>
</div>
<div class="paragraph">
<p>Using <em>module.*.count=0</em> is the most straightforward way to enable direct binding. Direct binding may be disabled for the stream using <em>module.*.producer.directBindingAllowed=false</em>. Additional <a href="#direct-binding-deployment-examples">direct binding deployment examples</a> are shown below.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deployment-states">Deployment States</h3>
<div class="paragraph">
<p>The ability to specify criteria to match container instances and deploy multiple instances for each module leads to one of several possible deployment states for the stream as a whole. Consider a stream in an initial <em>undeployed</em> state.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/deploy_states.png" alt="Deploy States" width="500">
</div>
</div>
<div class="paragraph">
<p>After executing the stream deployment request, the stream will be one of the following states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Deployed</strong> - All modules deployed successfully as specified in the deployment manifest.</p>
</li>
<li>
<p><strong>Incomplete</strong> - One of the requested module instances could not be deployed, but at least one instance of each module definition was successfully deployed. The stream is operational and can process messages end-to-end but the deployment manifest was not completely satisfied.</p>
</li>
<li>
<p><strong>Failed</strong> - At least one of the module definitions was not deployed. The stream is not operational.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The state diagram above represents these states as final. This is an over-simplification since these states are affected by container arrivals and departures that occur during or after the execution of a deployment request. Such transitions have been omitted intentionally but are worth considering. Also, there is an analogous state machine for undeploying a stream, initially in any of these states, which is left as an exercise for the reader.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_example_5">Example</h4>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create test1 --definition "http | transform --expression=payload.toUpperCase() | log"
Created new stream 'test1'</pre>
</div>
</div>
<div class="paragraph">
<p>Next, deploy it requesting three transformer instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream deploy --name test1 --properties "module.transform.count=3"
Deployed stream 'test1'

xd:&gt;stream list
  Stream Name  Stream Definition                                          Status
  -----------  ---------------------------------------------------------  ----------
  test1        http | transform --expression=payload.toUpperCase() | log  incomplete</pre>
</div>
</div>
<div class="paragraph">
<p>If there are only two container instances available, only two instances of <em>transform</em> will be deployed. The stream deployment state is <em>incomplete</em> and the stream is functional. However the unfulfilled deployment request remains active and the third instance will be deployed if a new container comes on line that matches the criteria.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="container-attributes">Container Attributes</h3>
<div class="paragraph">
<p>The SpEL context (root object) for module.[modulename].criteria is ContainerAtrtributes, basically a map derivative that contains some standard attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>id</strong> - the generated container ID</p>
</li>
<li>
<p><strong>pid</strong> - the process ID of the container instance</p>
</li>
<li>
<p><strong>host</strong> - the host name of the machine running the container instance</p>
</li>
<li>
<p><strong>ip</strong>&#8201;&#8212;&#8201;the IP address of the machine running the container instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ContainerAttributes also includes any user-defined attribute values configured for the container. These attributes are configured by editing <em>xd/config/servers.yml</em> the file included in the XD distribution contains some commented out sections as examples. In this case, the container attributes configuration looks something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">xd:
  container:
      groups: group2
      color: red</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Groups may also be assigned to a container via the optional command line argument <em>--groups</em> or by setting the environment variable <em>XD_CONTAINER_GROUPS</em>. As the property name suggests, a container may belong to more than one group, represented as comma-delimited string. The concept of server groups is considered an especially useful convention for targeting groups of servers for deployment to support many common scenarios, so it enjoys special status. Internally, <em>groups</em> is simply a user defined attribute.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_stream_deployment_examples">Stream Deployment Examples</h3>
<div class="paragraph">
<p>To Illustrate how to use the Deployment Manifest, We will use a runtime configuration with 3 container instances, as displayed in the XD shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;runtime containers
  Container Id                          Host              IP Address     PID   Groups  Custom Attributes
  ------------------------------------  ----------------  -------------  ----  ------  -----------------
  bc624816-f8a8-4f35-83f6-a125ed147b7c  ip-10-110-18-10   10.110.18.10   1708  group2  {color=red}
  018b7c8d-6fa9-4759-8471-76899766f892  ip-10-139-36-168  10.139.36.168  1852  group2  {color=blue}
  afc3741c-217a-415a-9d86-a1f62de03613  ip-10-139-17-116  10.139.17.116  1861  group1  {color=green}</pre>
</div>
</div>
<div class="paragraph">
<p>Each of the three containers is running on a different host and has configured Groups and Custom Attributes as shown.</p>
</div>
<div class="paragraph">
<p>First, create a stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create test1 --definition "http | transform --expression=payload.toUpperCase() | log"
Created new stream 'test1'</pre>
</div>
</div>
<div class="paragraph">
<p>Next, deploy it using a manifest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream deploy --name test1 --properties "module.transform.count=3,module.log.criteria=groups.contains('group1')"
Deployed stream 'test1'</pre>
</div>
</div>
<div class="paragraph">
<p>Verify the deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;runtime modules
  Module                       Container Id                          Options                                         Deployment Properties
  ---------------------------  ------------------------------------  ----------------------------------------------  ---------------------------------------------------------
  test1.processor.transform.1  bc624816-f8a8-4f35-83f6-a125ed147b7c  {valid=true, expression=payload.toUpperCase()}  {count=3, sequence=1}
  test1.processor.transform.2  018b7c8d-6fa9-4759-8471-76899766f892  {valid=true, expression=payload.toUpperCase()}  {count=3, sequence=2}
  test1.processor.transform.3  afc3741c-217a-415a-9d86-a1f62de03613  {valid=true, expression=payload.toUpperCase()}  {count=3, sequence=3}
  test1.sink.log.1             afc3741c-217a-415a-9d86-a1f62de03613  {name=test1, expression=payload, level=INFO}    {count=1, sequence=1, criteria=groups.contains('group1')}
  test1.source.http.1          bc624816-f8a8-4f35-83f6-a125ed147b7c  {port=9000}                                     {count=1, sequence=1}</pre>
</div>
</div>
<div class="paragraph">
<p>We can see that three instances of the <em>transform</em> processor have been deployed, one to each container instance. Also the log module has been deployed to the container assigned to <em>group1</em>. Now we can undeploy and deploy the stream using a different manifest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream undeploy test1
Un-deployed stream 'test1'
xd:&gt;runtime modules
  Module  Container Id  Properties
  ------  ------------  ----------

xd:&gt;stream deploy --name test1 --properties "module.log.count=3,module.log.criteria=!groups.contains('group1')"
Deployed stream 'test1'

xd:&gt;stream list
  Stream Name  Stream Definition                                          Status
  -----------  ---------------------------------------------------------  ----------
  test1        http | transform --expression=payload.toUpperCase() | log  incomplete

xd:&gt;runtime modules
  Module                       Container Id                          Options                                         Deployment Properties
  ---------------------------  ------------------------------------  ----------------------------------------------  ----------------------------------------------------------
  test1.processor.transform.1  018b7c8d-6fa9-4759-8471-76899766f892  {valid=true, expression=payload.toUpperCase()}  {count=1, sequence=1}
  test1.sink.log.1             bc624816-f8a8-4f35-83f6-a125ed147b7c  {name=test1, expression=payload, level=INFO}    {count=3, sequence=1, criteria=!groups.contains('group1')}
  test1.sink.log.2             018b7c8d-6fa9-4759-8471-76899766f892  {name=test1, expression=payload, level=INFO}    {count=3, sequence=2, criteria=!groups.contains('group1')}
  test1.source.http.1          afc3741c-217a-415a-9d86-a1f62de03613  {port=9000}                                     {count=1, sequence=1}

</pre>
</div>
</div>
<div class="paragraph">
<p>Now there are only two instances of the <em>log</em> module deployed. We asked for three however the deployment criteria specifies only containers not in <em>group1</em> are eligible. The <em>log</em> module is deployed only to the two containers matching the criteria. The deployment status of stream <em>test1</em> is shown as <em>incomplete</em>. The stream is functional even though the deployment manifest is not completely satisfied. If we fire up a new container not in <em>group1</em>, the DeploymentSupervisor will handle any outstanding deployment requests by comparing <em>xd/deployments/modules/requested</em> to <em>xd/deployments/modules/allocated</em>, and will deploy the third <em>log</em> instance and update the stream state to <em>deployed</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="partitioned-stream-deployment-examples">Partitioned Stream Deployment Examples</h3>
<div class="sect3">
<h4 id="_using_spel_expressions">Using SpEL Expressions</h4>
<div class="paragraph">
<p>First, create a stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create --name partitioned --definition "jms | transform --expression=#expensiveTransformation(payload) | log"

Created new stream 'partitioned'</pre>
</div>
</div>
<div class="paragraph">
<p>The hypothetical SpEL function <em>expensiveTransformation</em> represents a resource intensive processor which we want to load balance by running on multiple containers. In this case, we also want to partition the stream so that payloads containing the same <em>customerId</em> are always routed to the same processor instance. Perhaps the processor aggregates data by customerId and this step needs to run using co-located resources.</p>
</div>
<div class="paragraph">
<p>Next, deploy it using a manifest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream deploy --name partitioned --properties "module.jms.producer.partitionKeyExpression=payload.customerId,module.transform.count=3"

Deployed stream 'partitioned'</pre>
</div>
</div>
<div class="paragraph">
<p>In this example three instances of the transformer will be created (with partition index of 0, 1, and 2). When the jms module sends a message it will take the <em>customerId</em> property on the message payload, invoke its <em>hashCode()</em> method and apply the modulo function with the divisor being the <em>transform.count</em> property to determine which instance of the transform will process the message (<strong>payload.getCustomerId().hashCode() % 3</strong>). Messages with the same <em>customerId</em> will always be processed by the same instance.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="direct-binding-deployment-examples">Direct Binding Deployment Examples</h3>
<div class="paragraph">
<p>In the simplest case, we enforce direct binding by setting the instance count to 0 for all modules in the stream. A count of 0 means deploy the module to all available containers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;runtime containers
  Container Id                          Host            IP Address    PID    Groups  Custom Attributes
  ------------------------------------  --------------  ------------  -----  ------  -----------------
  8e814924-15de-4ca1-82d3-ddfe851668ab  ultrafox.local  192.168.1.18  81532
  a2b89274-2d40-46e4-afc5-4988bea28a16  ultrafox.local  192.168.1.9   4605   group1</pre>
</div>
</div>
<div class="paragraph">
<p>We start with two container instances. One belongs to the group <em>group1</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream create direct --definition "time | log"
Created new stream 'direct'
xd:&gt;stream deploy direct --properties module.*.count=0
Deployed stream 'direct'
xd:&gt;runtime modules
  Module                Container Id                          Options                                        Deployment Properties
  --------------------  ------------------------------------  ---------------------------------------------  ---------------------------------------------------------
  direct.sink.log.0     a2b89274-2d40-46e4-afc5-4988bea28a16  {name=direct, expression=payload, level=INFO}  {count=0, sequence=0}
  direct.sink.log.0     8e814924-15de-4ca1-82d3-ddfe851668ab  {name=direct, expression=payload, level=INFO}  {count=0, sequence=0}
  direct.source.time.0  a2b89274-2d40-46e4-afc5-4988bea28a16  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}     {producer.directBindingAllowed=true, count=0, sequence=0}
  direct.source.time.0  8e814924-15de-4ca1-82d3-ddfe851668ab  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}     {producer.directBindingAllowed=true, count=0, sequence=0}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that we have two containers and two instances of each module deployed to each. Spring XD automatically sets the bus properties needed to allow direct binding, <em>producer.directBindingAllowed=true</em> on the <em>time</em> module.</p>
</div>
<div class="paragraph">
<p>Suppose we only want one instance of this stream and we want it to use direct binding. Here we can add deployment criteria to restrict the available containers to <em>group1</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream undeploy direct
Un-deployed stream 'direct'
xd:&gt;stream deploy direct --properties "module.*.count=0, module.*.criteria=groups.contains('group1')"
Deployed stream 'direct'
xd:&gt;runtime modules
  Module                Container Id                          Options                                        Deployment Properties
  --------------------  ------------------------------------  ---------------------------------------------  ---------------------------------------------------------------------------------------------
  direct.sink.log.0     a2b89274-2d40-46e4-afc5-4988bea28a16  {name=direct, expression=payload, level=INFO}  {count=0, sequence=0, criteria=groups.contains('group1')}
  direct.source.time.0  a2b89274-2d40-46e4-afc5-4988bea28a16  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}     {producer.directBindingAllowed=true, count=0, sequence=0, criteria=groups.contains('group1')}</pre>
</div>
</div>
<div class="paragraph">
<p>Direct binding eliminates latency between modules but sacrifices some of the resiliency provided by the messaging middleware. In the scenario above, if we lose one of the containers, we lose messages. To disable direct binding when module counts are set to 0, set <em>module.*.producer.directBindingAllowed=false</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xd:&gt;stream undeploy direct
Un-deployed stream 'direct'
xd:&gt;stream deploy direct --properties "module.*.count=0, module.*.producer.directBindingAllowed=false"
Deployed stream 'direct'
xd:&gt;runtime modules
  Module                Container Id                          Options                                        Deployment Properties
  --------------------  ------------------------------------  ---------------------------------------------  ----------------------------------------------------------
  direct.sink.log.0     a2b89274-2d40-46e4-afc5-4988bea28a16  {name=direct, expression=payload, level=INFO}  {producer.directBindingAllowed=false, count=0, sequence=0}
  direct.sink.log.0     8e814924-15de-4ca1-82d3-ddfe851668ab  {name=direct, expression=payload, level=INFO}  {producer.directBindingAllowed=false, count=0, sequence=0}
  direct.source.time.0  a2b89274-2d40-46e4-afc5-4988bea28a16  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}     {producer.directBindingAllowed=false, count=0, sequence=0}
  direct.source.time.0  8e814924-15de-4ca1-82d3-ddfe851668ab  {fixedDelay=1, format=yyyy-MM-dd HH:mm:ss}     {producer.directBindingAllowed=false, count=0, sequence=0}</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can still have the best of both worlds by enabling guaranteed delivery at one point in the stream, usually the source. If the tail of the stream is co-located and the source uses the message bus, the message bus may be configured so that if a container instance goes down, any unacknowledged messages will be retried until the container comes back or its modules are redeployed.</p>
</div>
<div class="paragraph">
<p>TDB: A realistic example</p>
</div>
<div class="paragraph">
<p>An alternate scenario with similar characteristics would be if the stream uses a <em>rabbit</em> or <em>jms</em> source. In this case, guaranteed delivery would be configured in the external messaging system instead of the Spring XD transport.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="messagebus">Message Bus Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_26">Introduction</h3>
<div class="paragraph">
<p>This section contains additional information about configuring the Message Bus, including High Availability, SSL, and Error handling.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rabbit_message_bus_high_availability_ha_configuration">Rabbit Message Bus High Availability (HA) Configuration</h3>
<div class="paragraph">
<p>The <code>RabbitMessageBus</code> allows for HA configuration using normal <a href="https://www.rabbitmq.com/ha.html">RabbitMQ HA Configuration</a>.</p>
</div>
<div class="paragraph">
<p>First, use the <code>addresses</code> property in <code>servers.yml</code> to include the host/port for each server in the cluster. See <a href="#rabbitConfig">Application Configuration</a>.</p>
</div>
<div class="paragraph">
<p>By default, queues and exchanges declared by the bus are prefixed with <code>xdbus.</code> (this prefix can be changed as described in <a href="#rabbitBusProps">Application Configuration</a>).</p>
</div>
<div class="paragraph">
<p>To configure the entire bus for HA, create a policy:</p>
</div>
<div class="paragraph">
<p><code>rabbitmqctl set_policy ha-xdbus "^xdbus\." '{"ha-mode":"all"}'</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_error_handling_message_delivery_failures">Error Handling (Message Delivery Failures)</h3>
<div class="sect3">
<h4 id="_rabbitmq_message_bus">RabbitMQ Message Bus</h4>
<div class="paragraph">
<p>Note: the following applies to normally deployed streams. When direct binding between modules is being used, exceptions thrown by the consumer are thrown back to the producer.</p>
</div>
<div class="paragraph">
<p>When a consuming module (processor, sink) fails to handle a message, the bus will retry delivery based on the module (or default bus) retry configuration. The default configuration will make 3 attempts to deliver the message. The retry configuration can be modified at the bus level (in servers.yml), or for an individual stream/module using the deployment manifest.</p>
</div>
<div class="paragraph">
<p>When retries are exhausted, by default, messages are discarded. However, using RabbitMQ, you can configure such messages to be routed to a dead-letter exchange/dead letter queue. See the <a href="https://www.rabbitmq.com/dlx.html">RabbitMQ Documentation</a> for more information.</p>
</div>
<div class="paragraph">
<p>Consider a stream: <code>stream create foo --definition "source | processor | sink"</code></p>
</div>
<div class="paragraph">
<p>The first <em>pipe</em> (by default) will be backed by a queue named <code>xdbus.foo.0</code>, the second by <code>xdbus.foo.1</code>. Messages are routed to these queues using the default exchange (with routing keys equal to the queue names).</p>
</div>
<div class="paragraph">
<p>To enable dead lettering just for this stream, first configure a policy:</p>
</div>
<div class="paragraph">
<p><code>rabbitmqctl set_policy foo.DLX "^xdbus\.foo\..*" '{"dead-letter-exchange":"foo.dlx"}' --apply-to queues</code></p>
</div>
<div class="paragraph">
<p>To configure dead-lettering for all streams:</p>
</div>
<div class="paragraph">
<p><code>rabbitmqctl set_policy DLX "^xdbus\..*" '{"dead-letter-exchange":"dlx"}' --apply-to queues</code></p>
</div>
<div class="paragraph">
<p>The next step is to declare the dead letter exchange, and bind dead letter queues with the appropriate routing keys.</p>
</div>
<div class="paragraph">
<p>For example, for the second "pipe" in the stream above we might bind a queue <code>foo.sink.dlq</code> to exchange <code>foo.dlx</code> with a routing key <code>xdbus.foo.1</code> (remember, the original routing key was the queue name).</p>
</div>
<div class="paragraph">
<p>Now, when the sink fails to handle a message, after the configured retries are exhausted, the failed message will be routed to <code>foo.sink.dlq</code>.</p>
</div>
<div class="paragraph">
<p>There is no automated mechanism provided to move dead lettered messages back to the bus queue.</p>
</div>
</div>
<div class="sect3">
<h4 id="_redis_message_bus">Redis Message Bus</h4>
<div class="paragraph">
<p>When Redis is the transport, the failed messages (after retries are exhausted) are <code>LPUSH+ed to a +LIST ERRORS:&lt;stream&gt;.n</code> (e.g. <code>ERRORS:foo.1</code> in the above example in the <em>RabbitMQ Message Bus</em> section).</p>
</div>
<div class="paragraph">
<p>This is unconditional; the data in the <code>ERRORS LIST</code> is in "bus" format; again, some external mechanism would be needed to move the data from the ERRORS LIST back to the bus&#8217;s foo.1 LIST.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rabbitssl">Rabbit Message Bus Secure Sockets Layer (SSL)</h3>
<div class="paragraph">
<p>If you wish to use SSL for communications with the RabbitMQ server, consult the <a href="https://www.rabbitmq.com/ssl.html">RabbitMQ SSL Support Documentation</a>.</p>
</div>
<div class="paragraph">
<p>First configure the broker as described there. The message bus is a client of the broker and supports both of the described configurations for connecting clients (SSL <em>without certificate validation</em> and <em>with certficate validation</em>).</p>
</div>
<div class="paragraph">
<p>To use SSL without certificate validation, simply set</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  rabbitmq:
    useSSL: true</pre>
</div>
</div>
<div class="paragraph">
<p>In <code>application.yml</code> (and set the port(s) in the <code>addresses</code> property appropriately).</p>
</div>
<div class="paragraph">
<p>To use SSL with certificate validation, set</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  rabbitmq:
    useSSL: true
    sslProperties: file:path/to/secret/ssl.properties</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>sslProperties</code> property is a Spring resource (<code>file:</code>, <code>classpath:</code> etc) that points to a properties file, Typically, this file would be secured by the operating system (and readable by the XD container) because it contains security information. Specifically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>keyStore=file:/secret/client/keycert.p12
trustStore=file:/secret/trustStore
keyStore.passPhrase=secret
trustStore.passPhrase=secret</pre>
</div>
</div>
<div class="paragraph">
<p>Where the <code>pkcs12</code> keystore contains the client certificate and the truststore contains the server&#8217;s certificate as described in the rabbit documentation. The key/trust store properties are Spring resources.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, the <code>rabbit</code> source and sink modules inherit their default configuration from the container, but it can be overridden, either using <code>modules.yml</code> or with specific module definitions.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<h1 id="_administration" class="sect0">Administration</h1>
<div class="sect1">
<h2 id="monitoring-management">Monitoring and Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring XD uses Spring Boot&#8217;s monitoring and management support over <a href="http://docs.spring.io/spring-boot/docs/1.0.1.RELEASE/reference/htmlsingle/#production-ready-monitoring">HTTP</a> and <a href="http://docs.spring.io/spring-boot/docs/1.0.1.RELEASE/reference/htmlsingle/#production-ready-jmx">JMX</a> along with Spring Integration&#8217;s <a href="http://docs.spring.io/spring-integration/docs/4.0.0.M4/reference/htmlsingle/#jmx-mbean-exporter">MBean Exporters</a></p>
</div>
<div class="sect2">
<h3 id="_monitoring_xd_admin_container_and_single_node_servers">Monitoring XD Admin, Container and Single-node servers</h3>
<div class="paragraph">
<p>Following are available by <strong>default</strong></p>
</div>
<div class="paragraph">
<p>JMX is enabled <code>XD_JMX_ENABLED=true</code></p>
</div>
<div class="paragraph">
<p>The spring boot management endpoints are exposed over <code>HTTP</code> and since JMX is enabled these endpoints are exposed over <code>JMX</code></p>
</div>
<div class="paragraph">
<p>Spring integration components are exposed over <code>JMX</code> using <code>IntegrationMBeanExporter</code></p>
</div>
<div class="paragraph">
<p>All the availble MBeans can be accessed over <code>HTTP</code> using <code>Jolokia</code></p>
</div>
<div class="sect3">
<h4 id="_to_enable_boot_provided_management_endpoints_over_http">To enable boot provided management endpoints over HTTP</h4>
<div class="paragraph">
<p>By <strong>default</strong> <code>management.port</code> is set to use admin/container server port and all the exposed endpoints can be accessed from the root context of admin and container servers.</p>
</div>
<div class="paragraph">
<p>When starting admin, container or singlenode server, the command-line option <code>--mgmtPort</code> can be specified to use an explicit port for management server. With the given valid management port, the management endpoints can be accessed from that port. Please refer Spring Boot document <a href="http://docs.spring.io/spring-boot/docs/1.0.1.RELEASE/reference/htmlsingle/#production-ready-endpoints">here</a> for more details on the endpoints.</p>
</div>
<div class="paragraph">
<p>For instance, once XD admin is started on localhost and the management port set to use the admin port (9393)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:9393/management/health
http://localhost:9393/management/env
http://localhost:9393/management/beans

etc..</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_to_disable_boot_endpoints_over_http">To disable boot endpoints over HTTP</h3>
<div class="paragraph">
<p>Set <code>management.port=-1</code> for both default and container profiles in config/servers.yml</p>
</div>
</div>
<div class="sect2">
<h3 id="_management_over_jmx">Management over JMX</h3>
<div class="paragraph">
<p>All the boot endpoints are exposed over JMX with the domain name <code>org.springframework.boot</code>
The MBeans that are exposed within XD admin, container server level are available with the domain names <code>xd.admin</code> (for XD admin), <code>xd.container</code> (for XD container),  <code>xd.shared.server</code> and <code>xd.parent</code> representing the application contexts common to both XD admin and container. Singlenode server will have all these domain names exposed.
When the stream/job gets deployed into the XD container, the stream/job MBeans are exposed with specific domain/object naming strategy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_to_disable_management_over_jmx">To disable management over JMX</h3>
<div class="paragraph">
<p>Set <code>XD_JMX_ENABLED=false</code> in config/servers.yml or set it as an environment variable to disable the management over JMX</p>
</div>
</div>
<div class="sect2">
<h3 id="_monitoring_deployed_modules_in_xd_container">Monitoring deployed modules in XD container</h3>
<div class="paragraph">
<p>When a module is deployed (with JMX is enabled on the XD container), the <strong>IntegrationMBeanExporter</strong> is injected into module&#8217;s context via MBeanExportingPlugin and this exposes all the spring integration components inside the module. For the given module, the IntegrationMBeanExporter uses a specific object naming strategy that assigns domain name as <code>xd.&lt;stream/job name&gt;</code> and, object name as <code>&lt;module name&gt;.&lt;module index&gt;</code>.</p>
</div>
<div class="sect3">
<h4 id="_streams_2">Streams</h4>
<div class="paragraph">
<p>For a stream name <code>mystream</code> with DSL <code>http | log</code> will have</p>
</div>
<div class="paragraph">
<p>MBeans with domain name <code>xd.mystream</code> with two objects <code>http.0</code> and <code>log.1</code></p>
</div>
<div class="paragraph">
<p>Source, processor, and sink modules will generally have the following attributes and operations</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width:50%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module Type</th>
<th class="tableblock halign-left valign-top">Attributes and Operations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.spring.io/spring-integration/docs/4.0.0.RC1/api/org/springframework/integration/monitor/LifecycleMessageSourceMetrics.html">MessageSourceMetrics</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor,Sink</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.spring.io/spring-integration/docs/4.0.0.RC1/api/org/springframework/integration/monitor/LifecycleMessageHandlerMetrics.html">MessageHandlerMetrics</a></p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>In addition, each module has channel attributes and operations defined by <a href="http://docs.spring.io/spring-integration/docs/4.0.0.RC1/api/org/springframework/integration/monitor/MessageChannelMetrics.html">MessageChannelMetrics</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jobs_3">Jobs</h4>
<div class="paragraph">
<p>For a job name <code>myjob</code> with DSL <code>jdbchdfs</code> will have</p>
</div>
<div class="paragraph">
<p>MBeans with domain name <code>xd.myjob</code> with an object <code>jdbchdfs.0</code></p>
</div>
<div class="paragraph">
<p>You can also obtain monitoring information for Jobs using the UI or accessing the Job management REST API.  Documentation for the Job Management REST API is forthcoming, but until then please reference the request mappings in <a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/java/org/springframework/xd/dirt/rest/BatchJobsController.java">BatchJobsController</a>,
<a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/java/org/springframework/xd/dirt/rest/BatchJobExecutionsController.java">BatchJobExecutionsController</a>,
<a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/java/org/springframework/xd/dirt/rest/BatchStepExecutionsController.java">BatchStepExecutionsController</a>, and
<a href="https://github.com/spring-projects/spring-xd/blob/master/spring-xd-dirt/src/main/java/org/springframework/xd/dirt/rest/BatchJobInstancesController.java">BatchJobInstancesController</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_jolokia_to_access_jmx_over_http">Using Jolokia to access JMX over http</h3>
<div class="paragraph">
<p>When JMX is enabled (which is <strong>default</strong> via <code>XD_JMX_ENABLED</code> property), Jolokia is auto-configured to expose the XD admin, container and singenode server MBeans.</p>
</div>
<div class="paragraph">
<p>For example, with XD singlenode running management port 9080</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http://localhost:9080/management/jolokia/search/xd.*:type=*,*</pre>
</div>
</div>
<div class="paragraph">
<p>will list all the MBeans exposed in XD admin/container servers and the deployed modules. Apart from this, other available domain and types can be accessed via Jolokia.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="REST-API">REST API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_27">Introduction</h3>
<div class="paragraph">
<p>The Spring XD Administrator process (Admin) provides a REST API to access various Spring XD resources such as streams, jobs, metrics, modules, Spring batch resources, and container runtime information. The REST API is used internally by the XD Shell and Admin UI and can support any custom client application that requires interaction with XD.</p>
</div>
<div class="paragraph">
<p>The HTTP port is configurable and may be set as a command line argument when starting the Admin server, or set in $XD_HOME/config/servers.yml. The default port is 9393:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; $XD_HOME/bin/xd-admin --httpPort &lt;port&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The Admin server also exposes runtime management resources enabled by Spring Boot under the <code>/management</code> context path, e.g., <a href="http://localhost:9393/management/metrics">http://localhost:9393/management/metrics</a>. These resources are covered in the <a href="http://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready-monitoring">Spring Boot</a> documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is also a <code>mgmtPort</code> command line argument which assigns a separate port for management services. Normally the same port is used for everything.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_xd_resources">XD Resources</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 1. Table XD REST endpoints</caption>
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stream definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#stream-definitions">/streams/definitions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stream deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#stream-deployments">/streams/deployments</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#job-definitions">/jobs/definitions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#job-deployments">/jobs/deployments</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batch job configurations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#batch-jobs">/jobs/configurations</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batch job executions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#batch-executions">/jobs/executions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">batch job instances</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#job-instances">/jobs/instances</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">module definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#module-definitions">/modules</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployed modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#runtime-modules">/runtime/modules</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#runtime-containers">/runtime/containers</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">counters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#counters">/metrics/counters</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">field value counters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#field-value-counters">/metrics/field-value-counters</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aggregate counters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#aggregate-counters">/metrics/aggregate-counters</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gauges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#gauges">/metrics/gauges</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rich-gauges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#rich-gauges">/metrics/rich-gauges</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">completions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#completions">/completions</a></p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="stream-definitions">Stream Definitions</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 2. Table Stream Definitions</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list defined streams along with deployment state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete all stream definitions, undeploying deployed streams</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/definitions/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get a stream definition (currently no deployment information is included)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create a new stream, optionally deploying it if <code>deploy=true</code>(default). The request body is application/x-www-form-urlencoded and requires two parameters, <code>name</code> and <code>definition</code> (DSL)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/definitions/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete a stream, undeploying if deployed.</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="stream-deployments">Stream Deployments</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 3. Table Stream Deployments</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/deployments/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get detailed deployment state for all streams (TBD)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">undeploy all streams</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/deployments/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get detailed deployment state for a stream (TBD)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/deployments/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploy a stream, where the request body contains the deployment properties application/x-www-form-urlencoded</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/streams/deployments/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">undeploy a stream</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="job-definitions">Job Definitions</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 4. Table Job Definitions</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list defined jobs along with deployment state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete all job definitions, undeploying deployed jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/definitions/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get a job definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/definitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create a new job, where the The request body is application/x-www-form-urlencoded and requires two parameters, <code>name</code> and <code>definition</code> (DSL)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/definitions/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete a job, undeploying if deployed</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="job-deployments">Job Deployments</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 5. Table Job Deployments</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/deployments/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get detailed deployment state for all jobs (TBD)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/deployments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">undeploy all jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/deployments/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get detailed deployment state for a job (TBD. Probably not in 1.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/deployments/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploy a job, where the request body contains the deployment properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/deployments/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">undeploy a job</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="batch-jobs">Batch Job Configurations</h3>
<div class="paragraph">
<p>Spring Batch configured jobs stored in the Spring Batch Repository</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 6. Table Batch Jobs</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/configurations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get configuration information about all batch jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/configurations/{jobName}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get configuration information about a batch job</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="batch-executions">Batch Job Executions</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 7. Table Batch Executions</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all job executions
(Only <em>application/json</em> mediatype supported)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions?stop=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop all jobs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions?jobname={jobName}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get information about all executions of a job
(Only <em>application/json</em> accept header is supported)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions?jobname={jobName}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request the launch of a job</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions/{jobExecutionId}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get information about a particular execution of a job</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions/{jobExecutionId}?restart=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">restart a job</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions/{jobExecutionId}?stop=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop a job</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions/{jobExecutionId}/steps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list the steps for a job execution
(Only <em>application/json</em> accept header is supported)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions/{jobExecutionId}/steps/{stepExecutionId}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get a step execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/executions/{jobExecutionId}/steps/{stepExecutionId}/progress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get the step execution progress</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="job-instances">Batch Job Instances</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 8. Table Batch Job Instances</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/instances?jobname={jobName}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get information about all instances of a job</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jobs/instances/{instanceId}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get information about a batch job instance</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>For both the GET endpoints <strong>only</strong> <em>application/json</em> accept header is supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="module-definitions">Module Definitions</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 9. Table Module Definitions</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all registered modules</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create a composite module, where The request body is application/x-www-form-urlencoded and requires two parameters, <code>name</code> and <code>definition</code> (DSL)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/modules/{type}/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list a module along with options metadata, where type is <code>source</code>,<code>processor</code>,<code>sink</code>, or <code>job</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/modules/{type}/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete a composed module</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/modules/{type}/{name}/definition</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">display the module bean definition file (NOTE: currently only XML response supported)</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="runtime-modules">Runtime Modules</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 10. Table Runtime Modules</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/runtime/modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">display runtime module option values and deployment information for deployed modules, optional parameters are <code>moduleId</code> (&lt;stream&gt;.&lt;type&gt;.&lt;moduleName&gt;,<code>containerId</code>,<code>jobname</code></p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="runtime-containers">Runtime Containers</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 11. Table Runtime Containers</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/runtime/containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">display all available containers along with runtime and user-defined container attributes</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="counters">Counters</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 12. Table Counters</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/counters/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all the known counters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/counters/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get the current metric value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/counters/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete the metric</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="field-value-counters">Field Value Counters</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 13. Table Field Value Counters</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/field-value-counters/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all the known field value counters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/field-value-counters/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get the current metric values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/field-value-counters/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete the metric</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="aggregate-counters">Aggregate Counters</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 14. Table Aggregate Counters</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/aggregate-counters/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all the known aggregate counters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/aggregate-counters/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get the current metric values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/aggregate-counters/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete the metric</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="gauges">Gauges</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 15. Table Gauges</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/gauges/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all the known gauges</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/gauges/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get the current metric values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/gauges/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete the metric</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="rich-gauges">Rich Gauges</h3>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 16. Table Rich Gauges</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/rich-gauges/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all the known rich gauges</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/rich-gauges/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get the current metric values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/metrics/rich-gauges/{name}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete the metric</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="completions">Tab Completions</h3>
<div class="paragraph">
<p>Used to support DSL tab completion for the XD Shell. All requests require the <code>start</code> parameter which contains the incomplete definition.</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<caption class="title">Table 17. Table Tab Completions</caption>
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource URL</th>
<th class="tableblock halign-left valign-top">Request Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/completions/stream?start={start}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retrieve valid choices to complete a stream definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/completions/job?start={start}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retrieve valid choices to complete a job definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/completions/module?start={start}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retrieve valid choices to complete a module definition</p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<h1 id="_appendices" class="sect0">Appendices</h1>
<div class="sect1">
<h2 id="installing-hadoop">Appendix A: Installing Hadoop</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installing_hadoop">Installing Hadoop</h3>
<div class="paragraph">
<p>If you don&#8217;t have a local <em>Hadoop</em> cluster available already, you can do a local <a href="http://hadoop.apache.org/docs/r2.2.0/hadoop-project-dist/hadoop-common/SingleCluster.html">single node installation (v2.2.0)</a> and use that to try out <em>Hadoop</em> with <em>Spring XD</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
This guide is intended to serve as a quick guide to get you started in the context of <em>Spring XD</em>. For more complete documentation please refer back to the documentation provided by your respective <em>Hadoop</em> distribution.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_download">Download</h4>
<div class="paragraph">
<p>First, <a href="http://archive.apache.org/dist/hadoop/common/hadoop-2.2.0/">download an installation archive</a> (hadoop-2.2.0.tar.gz) and unpack it locally. Linux users can also install <em>Hadoop</em> through the system package manager and on Mac OS X, you can use <a href="http://brew.sh/">Homebrew</a>. However, the manual installation is self-contained and it&#8217;s easier to see what&#8217;s going on if you just unpack it to a known location.</p>
</div>
<div class="paragraph">
<p>If you have <code>wget</code> available on your system, you can also execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ wget http://archive.apache.org/dist/hadoop/common/hadoop-2.2.0/hadoop-2.2.0.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unpack the distribution with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ tar xzf hadoop-2.2.0.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Change into the directory and have a look around</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ cd hadoop-2.2.0
$ ls
$ bin/hadoop
Usage: hadoop [--config confdir] COMMAND
       where COMMAND is one of:
  fs                   run a generic filesystem user client
  version              print the version
  jar &lt;jar&gt;            run a jar file
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>bin</code> directory contains the start and stop scripts as well as the <code>hadoop</code> and <code>hdfs</code> scripts which allow us to interact with <em>Hadoop</em> from the command line.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_setup">Java Setup</h4>
<div class="paragraph">
<p>Make sure that you set <code>JAVA_HOME</code> in the <code>etc/hadoop/hadoop-env.sh</code> script, or you will get an error when you start <em>Hadoop</em>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash"># The java implementation to use.  Required.
# export JAVA_HOME=/usr/lib/j2sdk1.5-sun
export JAVA_HOME=/usr/lib/jdk1.6.0_45</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When using <em>Mac OS X</em> you can determine the <em>Java</em> home directory by executing <code>$ /usr/libexec/java_home -v 1.6</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When using <em>Ubuntu</em> you can determine the <em>Java</em> home directory by executing <code>$ sudo update-java-alternatives -l</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When using <em>MAC OS X</em> (Other systems possible also) you may still encounter <code>Unable to load realm info from SCDynamicStore</code> (For details see <a href="https://issues.apache.org/jira/browse/HADOOP-7489">Hadoop Jira HADOOP-7489</a>). In that case, please also add to <code>conf/hadoop-env.sh</code> the following line: <code>export HADOOP_OPTS="-Djava.security.krb5.realm= -Djava.security.krb5.kdc="</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_setup_ssh">Setup SSH</h4>
<div class="paragraph">
<p>As described in the installation guide, you also need to set up <a href="http://en.wikipedia.org/wiki/Secure_Shell">SSH</a> login to <code>localhost</code> without a passphrase. On Linux, you may need to install the <code>ssh</code> package and ensure the <code>sshd</code> daemon is running. On Mac OS X, ssh is already installed but the <code>sshd</code> daemon isn&#8217;t usually running. To start it, you need to enable "Remote Login" in the "Sharing" section of the control panel. Then you can carry on and setup SSH keys as described in the installation guide:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ ssh-keygen -t dsa -P '' -f ~/.ssh/id_dsa
$ cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure you can log in at the command line using <code>ssh localhost</code> and <code>ssh 0.0.0.0</code> before trying to start <em>Hadoop</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ ssh localhost
Last login: Thu May  1 15:02:32 2014 from localhost
...
$ ssh 0.0.0.0
Last login: Thu May  1 15:06:02 2014 from localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also need to decide where in your local filesystem you want <em>Hadoop</em> to store its data. Let&#8217;s say you decide to use <code>/data</code>.</p>
</div>
<div class="paragraph">
<p>First create the directory and make sure it is writeable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ mkdir /data
$ chmod 777 /data</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now edit <code>etc/hadoop/core-site.xml</code> and add the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;property&gt;
    &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
    &lt;value&gt;/data&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;re then ready to format the filesystem for use by HDFS</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ bin/hadoop namenode -format</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_the_namenode_port">Setting the Namenode Port</h4>
<div class="paragraph">
<p>By default Spring XD will use a <em>Namenode</em> setting of <code>hdfs://localhost:8020</code> which can be overridden in <code>${xd.home}/config/server.yml</code>, depending on the used <em>Hadoop</em> distribution and version the by-default-defined port <code>8020</code> may be different, e.g. port <code>9000</code>. Therefore, please ensure you have the following property setting in <code>etc/hadoop/core-site.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;property&gt;
    &lt;name&gt;fs.defaultFS&lt;/name&gt;
    &lt;value&gt;hdfs://localhost:8020&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_further_configuration_file_changes">Further Configuration File Changes</h4>
<div class="paragraph">
<p>In <code>etc/hadoop/hdfs-site.xml</code> add the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;property&gt;
    &lt;name&gt;dfs.replication&lt;/name&gt;
    &lt;value&gt;1&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.support.append&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>etc/hadoop/mapred-site.xml</code> and add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;?xml version="1.0"?&gt;
&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;

&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
        &lt;value&gt;yarn&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>etc/hadoop/yarn-site.xml</code> add these properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;property&gt;
    &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
    &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;yarn.nodemanager.aux-services.mapreduce.shuffle.class&lt;/name&gt;
    &lt;value&gt;org.apache.hadoop.mapred.ShuffleHandler&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_hadoop">Running Hadoop</h3>
<div class="paragraph">
<p>First we need to set up the environment settings. It&#8217;s convenient to add these to a file that you can source when you want to work with Hadoop. We create a file called <code>hadoop-env</code> and add the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash"># The directory of the unpacked distribution
export HADOOP_INSTALL="$HOME/Downloads/hadoop-2.2.0"

# The JAVE_HOME (see above how to determine this)
export JAVA_HOME=/usr/lib/jdk1.6.0_45

# Some HOME settings
export HADOOP_MAPRED_HOME=$HADOOP_INSTALL
export HADOOP_YARN_HOME=$HADOOP_INSTALL
export HADOOP_COMMON_HOME=$HADOOP_INSTALL

# Add Hadoop scripts to the PATH
export PATH=$HADOOP_INSTALL/bin:$HADOOP_INSTALL/sbin:$PATH</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use these settings we need to source this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ source hadoop-env</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should now finally be ready to run <em>Hadoop</em>. Run the following commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ start-dfs.sh
$ start-yarn.sh
$ mr-jobhistory-daemon.sh start historyserver</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see six Hadoop Java processes running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ jps
  21636 NameNode
  22004 SecondaryNameNode
  22360 NodeManager
  22425 JobHistoryServer
  21808 DataNode
  22159 ResourceManager
  22471 Jps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Try a few commands with <code>hdfs dfs</code> to make sure the basic system works</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">$ hdfs dfs -ls /
Found 1 items
drwxrwx---   - trisberg supergroup          0 2014-05-01 15:31 /tmp

$ hdfs dfs -mkdir /xd
$ bin/hadoop dfs -ls /
Found 2 items
drwxrwx---   - trisberg supergroup          0 2014-05-01 15:31 /tmp
drwxr-xr-x   - trisberg supergroup          0 2014-05-01 15:34 /xd</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, you can also browse the web interface for <em>NameNode</em> and <em>ResourceManager</em> at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NameNode: <a href="http://localhost:50070/">http://localhost:50070/</a></p>
</li>
<li>
<p>ResourceManager: <a href="http://localhost:8088/">http://localhost:8088/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point you should be good to create a <em>Spring XD</em> <a href="#streams">stream</a> using a <em>Hadoop</em> <a href="#sinks">sink</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-spring-xd">Appendix B: Building Spring XD</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_instructions">Instructions</h3>
<div class="paragraph">
<p>Here are some useful steps to build and run Spring XD.</p>
</div>
<div class="paragraph">
<p>To build all sub-projects and run tests for Spring XD (please note tests require a running <a href="http://redis.io/">Redis</a> instance):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew build</pre>
</div>
</div>
<div class="paragraph">
<p>To build and bundle the distribution of Spring XD</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew dist</pre>
</div>
</div>
<div class="paragraph">
<p>The above gradle task creates spring-xd-&lt;version&gt;.zip binary distribution archive and spring-xd-&lt;version&gt;-docs.zip documentation archive files under <em>build/distributions</em>. This will also create a <em>build/dist/spring-xd</em> directory which is the expanded version of the binary distribution archive.</p>
</div>
<div class="paragraph">
<p>To just create the Spring XD expanded binary distribution directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew copyInstall</pre>
</div>
</div>
<div class="paragraph">
<p>The above gradle task creates the distribution directory under <em>build/dist/spring-xd</em>.</p>
</div>
<div class="paragraph">
<p>Once the binary distribution directory is created, please refer to <a href="https://github.com/SpringSource/spring-xd/wiki/Getting-Started">Getting Started</a> on how to run Spring XD.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ide_support">IDE support</h3>
<div class="paragraph">
<p>If you would like to work with the Spring XD code in your IDE, please use the following project generation depending on the IDE you use:</p>
</div>
<div class="paragraph">
<p>For Eclipse/Spring Tool Suite</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew eclipse</pre>
</div>
</div>
<div class="paragraph">
<p>For IntelliJ IDEA</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./gradlew idea</pre>
</div>
</div>
<div class="paragraph">
<p>Then just import the project as an existing project.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_script_tests">Running script tests</h3>
<div class="paragraph">
<p>Apart from the unit and integration tests, the directory <code>src/test/scripts</code> contains set of scripts that run end-to-end tests on XD runtime. Please see the instructions to setup and run:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Once XD is built (with copyInstall), from the distribution directory: <code>build/dist/spring-xd/xd/bin/xd/bin/xd-singlenode(.bat)</code></p>
</li>
<li>
<p>Setup XD_HOME environment variable that points to <code>build/dist/spring-xd/xd</code></p>
</li>
<li>
<p>From the directory <code>src/test/scripts</code>, run <code>basic_stream_tests</code></p>
</li>
<li>
<p>For the <code>jdbc_tests</code>, we need to run <code>install_sqlite_jar</code> first that installs sqlite jar into <code>$XD_HOME/lib</code></p>
</li>
<li>
<p>For the <code>hdfs_import_export_tests</code>, make sure you have setup hadoop environment and have the <code>xd-singlenode</code> started with appropriate hadoopDistro option and hadoop lib jars for the version chosen</p>
</li>
<li>
<p>For <code>tweet_tests</code>, make sure you have the twitter properties updated before running the tests</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_mqtt_modules">Appendix C: Using MQTT Modules</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_28">Introduction</h3>
<div class="paragraph">
<p>MQTT(MQ for telemetry transport) is a machine to machine connectivity protocol. It is a lightweight pub/sub protocol for devices where bandwidth and battery power are at a premium.  This purpose of this document is to show you how to: enable the RabbitMQ MQTT plugin, setup a Spring XD MQTT source and Spring MQTT sink.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This document assumes that you have a RabbitMQ installed and running.  If you don’t have RabbitMQ available already you can download it from <a href="http://www.rabbitmq.com/download.html">http://www.rabbitmq.com/download.html</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_setting_up_mqtt_on_rabbitmq">Setting up MQTT on RabbitMQ</h4>
<div class="paragraph">
<p>If you are using RabbitMQ 3.3.4 or above then the MQTT plugin is already included with your deployment, however it is inactive.
To Activate:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Shutdown the Rabbit MQ instance</p>
</li>
<li>
<p>$RABBIT_HOME/sbin/rabbitmq-plugins list</p>
<div class="literalblock">
<div class="content">
<pre>...
[ ] rabbitmq_federation_management    3.3.4
[E] rabbitmq_management               3.3.4
[e] rabbitmq_management_agent         3.3.4
[ ] rabbitmq_management_visualiser    3.3.4
[ ] rabbitmq_mqtt                     3.3.4
[ ] rabbitmq_shovel                   3.3.4
[ ] rabbitmq_shovel_management        3.3.4
…</pre>
</div>
</div>
</li>
<li>
<p>We see that the rabitt_mqtt does not have a [E] denoted next to it.  Thus it is not enabled.
Note: if you do see the [E] next to the rabbitmq_mqtt then your plugin is enabled and all you need to do is restart your RabbitMQ.</p>
</li>
<li>
<p>Now enable rabbit_mqtt plugin</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Run: $RABBIT_HOME/sbin/rabbitmq-plugins enable rabbitmq_mqtt</p>
</li>
<li>
<p>Run: $RABBIT_HOME/sbin/rabbitmq-plugins list</p>
<div class="literalblock">
<div class="content">
<pre>...
[ ] rabbitmq_federation_management    3.3.4
[E] rabbitmq_management               3.3.4
[e] rabbitmq_management_agent         3.3.4
[ ] rabbitmq_management_visualiser    3.3.4
[E] rabbitmq_mqtt                     3.3.4
[ ] rabbitmq_shovel                   3.3.4
[ ] rabbitmq_shovel_management        3.3.4
...</pre>
</div>
</div>
</li>
<li>
<p>Now we see that the rabbitmq_mqtt plugin is now active.</p>
</li>
<li>
<p>Restart your RabbitMQ.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_rabbit_mqtt_plugin_settings">Rabbit MQTT Plugin settings</h4>
<div class="paragraph">
<p>The MQTT plugin can be can be configured via the rabbitmq.config file and this is covered here: <a href="http://www.rabbitmq.com/mqtt.html">http://www.rabbitmq.com/mqtt.html</a>.
The settings for the MQTT plugin that Spring XD are concerned about are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>allow_anonymous  Determines if the user must supply a user name or password.  If true then the plugin will use the default_user and default password enumerated below.  If false the Spring XD source or sink must provide the username and password  Default: true</p>
</li>
<li>
<p>default_user  If allow_anonymous is set to true then this will set the user for anonymous clients.  Default: guest</p>
</li>
<li>
<p>default_password If allow_anonymous is set to true then this will set the password for anonymous clients.  Default: guest</p>
</li>
<li>
<p>exchange - The name of the exchange that will route all MQTT messages to a the  queues. Default: amq.topic</p>
</li>
<li>
<p>tcp_listeners - host and port that rabbit will monitor for MQTT messages. Default: 1883</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Out of the box the Spring XD MQTT source and sink currently works with the MQTT plugin defaults without any configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mqtt_source">MQTT Source</h4>
<div class="paragraph">
<p>When Spring XD deploys the  MQTT source module, a message queue is created along with the necessary binding on RabbitMQ.  The message queue that is created will have the name structure <code>[mqtt-subscription-][client_id][srcqos1]</code>.
* mqtt-subscription- Queues created for MQTT subscribers will have names starting with mqtt-subscription.
* client-id is the client-id specified by the MQTT source module, the default is <code>xd.mqtt.client.id</code>
* srcqos1 - The QoS level for the queue.</p>
</div>
<div class="paragraph">
<p>The MQTT source module also generates the binding from the amq.topic to the message queue via the routing key (topic).  The default topic for the MQTT source module is <code>xd.mqtt.test</code>.</p>
</div>
<div class="sect4">
<h5 id="_example_1_using_defaults">Example 1: Using defaults</h5>
<div class="paragraph">
<p>To show this in detail let us create the following stream: <code>stream create mqtt-in --definition “mqtt|log” --deploy</code>.  In this example the stream will retrieve MQTT messages from RabbitMQ and write the content to Spring XD’s log.  So on RabbitMQ a message queue named <code>mqtt-subscription-xd.mqtt.client.id.srcqos1</code> and a binding for the topic (routing key) <code>xd.mqtt.test</code> will be created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/mqtt_samp_1.png" alt="MQTT Sample 1" width="500">
</div>
</div>
<div class="paragraph">
<p>Thus any message published with the topic, <code>xd.mqtt.test</code> will be sent to the <code>mqtt-subscription-xd.mqtt.client.id.srcqos1</code> message queue and thus picked up by the Spring XD MQTT module and then written to log.
So to exercise the stream created we can write the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>stream create --name rabbittest --definition "http|rabbit --exchange='amq.topic' --routingKey='''xd.mqtt.test'''" --deploy
http post --data 'hello world'</pre>
</div>
</div>
<div class="paragraph">
<p>In the log you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">09:53:34,487  INFO MQTT Call: xd.mqtt.client.id.src sink.mqtt-in - hello world</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_2_monitoring_different_topics">Example 2: Monitoring different topics.</h5>
<div class="paragraph">
<p>In this scenario we want to setup a MQTT Source Module to retrieve messages that may come in from different topics.  So lets pretend that we want to monitor all the infusion machines at a medical facility.  Our monitor wants to log all messages that notify us that a machine has completed its task or if a machine in need of  maintenance.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/mqtt_samp_2.png" alt="MQTT Sample 2" width="500">
</div>
</div>
<div class="paragraph">
<p>In this case it would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Create a simulated device that will dispatch a patient alert message
stream create --name patientAlert --definition "http|rabbit --exchange='amq.topic' --routingKey='''patient.alert'''" --deploy
#Create a simulated device that will dispatch a patient notification message
stream create --name patientNotification --definition "http --port=9005|rabbit --exchange='amq.topic' --routingKey='''patient.notification'''" --deploy
# create our monitor that will capture the mqtt traffic.
stream create --name patientMonitor --definition "mqtt --topics=patient.alert,patient.notification |log" --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Now lets dispatch messages to both topics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http post --target http://localhost:9005  --data 'infusion complete'
http post --data 'pump failure'</pre>
</div>
</div>
<div class="paragraph">
<p>In the log you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">10:25:21,403  INFO MQTT Call: xd.mqtt.client.id.src sink.patientMonitor - infusion complete
10:25:46,226  INFO MQTT Call: xd.mqtt.client.id.src sink.patientMonitor - pump failure</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mqtt_sink">MQTT Sink</h4>
<div class="paragraph">
<p>The MQTT sink module will publish messages for a topic to the broker for a specific topic.</p>
</div>
<div class="sect4">
<h5 id="_example_1_using_defaults_2">Example 1: Using defaults</h5>
<div class="paragraph">
<p>In this example we will create a stream that will publish a message to topic using the defaults:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>stream create mqtt-out --definition “http|mqtt” --deploy
stream create mqtt-in --definition”mqtt|log”</pre>
</div>
</div>
<div class="paragraph">
<p>This mqtt-out stream will receive http messages to port 9000 on localhost and then the mqtt will publish the information to a rabbit instance on the localhost.  The message will be routed to the queue (mqtt-subscription-xd.mqtt.client.id.srcqos1) that was created by MQTT source module and then, the message will be delivered to the MQTT source module.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/images/mqtt_samp_3.png" alt="MQTT Sample 3" width="500">
</div>
</div>
<div class="paragraph">
<p>So the output will look something like this, if you execute a <code>http post --data ‘hello world’</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">14:03:57,340  INFO MQTT Call: xd.mqtt.client.id.src sink.mqtt-in - hello world</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="shell-command-reference">Appendix D: XD Shell Command Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below is a reference list of all Spring XD specific commands you can use in the <a href="#interactive-shell">XD Shell</a>.</p>
</div>
<div class="sect2">
<h3 id="_configuration_commands">Configuration Commands</h3>
<div class="sect3">
<h4 id="_admin_config_server">admin config server</h4>
<div class="paragraph">
<p>Configure the XD admin server to use.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>admin config server [[--uri] &lt;uri&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>uri</strong></dt>
<dd>
<p>the location of the XD Admin REST endpoint. <strong>(default: <code>http://localhost:9393/</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_admin_config_timezone_set">admin config timezone set</h4>
<div class="paragraph">
<p>Set the timezone of the Spring XD Shell (Not persisted).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>admin config timezone set [--timeZone] &lt;timeZone&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>timeZone</strong></dt>
<dd>
<p>the id of the timezone, You can obtain a list of timezone ids using <em>admin config timezone list</em>, If an invalid timezone id is provided, then <em>Greenwich Mean Time</em> is being used. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_admin_config_info">admin config info</h4>
<div class="paragraph">
<p>Show the XD admin server being used.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>admin config info</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_admin_config_timezone_list">admin config timezone list</h4>
<div class="paragraph">
<p>List all timezones.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>admin config timezone list</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_commands">Runtime Commands</h3>
<div class="sect3">
<h4 id="_runtime_containers">runtime containers</h4>
<div class="paragraph">
<p>List runtime containers.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>runtime containers</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_runtime_modules">runtime modules</h4>
<div class="paragraph">
<p>List runtime modules.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>runtime modules [--containerId &lt;containerId&gt;] [--moduleId &lt;moduleId&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>containerId</strong></dt>
<dd>
<p>to filter by container id.</p>
</dd>
<dt class="hdlist1"><strong>moduleId</strong></dt>
<dd>
<p>to filter by module id.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stream_commands">Stream Commands</h3>
<div class="sect3">
<h4 id="_stream_create">stream create</h4>
<div class="paragraph">
<p>Create a new stream definition.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream create [--name] &lt;name&gt; --definition &lt;definition&gt; [--deploy [&lt;deploy&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name to give to the stream. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>definition</strong></dt>
<dd>
<p>a stream definition, using XD DSL (e.g. "http --port=9000 | hdfs"). <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>deploy</strong></dt>
<dd>
<p>whether to deploy the stream immediately. <strong>(default: <code>false</code>, or <code>true</code> if <code>--deploy</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_stream_destroy">stream destroy</h4>
<div class="paragraph">
<p>Destroy an existing stream.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream destroy [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the stream to destroy. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_stream_all_destroy">stream all destroy</h4>
<div class="paragraph">
<p>Destroy all existing streams.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream all destroy [--force [&lt;force&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>force</strong></dt>
<dd>
<p>bypass confirmation prompt. <strong>(default: <code>false</code>, or <code>true</code> if <code>--force</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_stream_deploy">stream deploy</h4>
<div class="paragraph">
<p>Deploy a previously created stream.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream deploy [--name] &lt;name&gt; [--properties &lt;properties&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the stream to deploy. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>properties</strong></dt>
<dd>
<p>the properties for this deployment.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_stream_undeploy">stream undeploy</h4>
<div class="paragraph">
<p>Un-deploy a previously deployed stream.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream undeploy [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the stream to un-deploy. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_stream_all_undeploy">stream all undeploy</h4>
<div class="paragraph">
<p>Un-deploy all previously deployed stream.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream all undeploy [--force [&lt;force&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>force</strong></dt>
<dd>
<p>bypass confirmation prompt. <strong>(default: <code>false</code>, or <code>true</code> if <code>--force</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_stream_list">stream list</h4>
<div class="paragraph">
<p>List created streams.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stream list</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_job_commands">Job Commands</h3>
<div class="sect3">
<h4 id="_job_create">job create</h4>
<div class="paragraph">
<p>Create a job.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job create [--name] &lt;name&gt; --definition &lt;definition&gt; [--deploy [&lt;deploy&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name to give to the job. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>definition</strong></dt>
<dd>
<p>job definition using xd dsl . <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>deploy</strong></dt>
<dd>
<p>whether to deploy the job immediately. <strong>(default: <code>false</code>, or <code>true</code> if <code>--deploy</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_list">job list</h4>
<div class="paragraph">
<p>List all jobs.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_list">job execution list</h4>
<div class="paragraph">
<p>List all job executions.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_step_list">job execution step list</h4>
<div class="paragraph">
<p>List all step executions for the provided job execution id.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution step list [--id] &lt;id&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>id</strong></dt>
<dd>
<p>the id of the job execution. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_step_progress">job execution step progress</h4>
<div class="paragraph">
<p>Get the progress info for the given step execution.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution step progress [--id] &lt;id&gt; --jobExecutionId &lt;jobExecutionId&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>id</strong></dt>
<dd>
<p>the id of the step execution. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>jobExecutionId</strong></dt>
<dd>
<p>the job execution id. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_step_display">job execution step display</h4>
<div class="paragraph">
<p>Display the details of a Step Execution.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution step display [--id] &lt;id&gt; --jobExecutionId &lt;jobExecutionId&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>id</strong></dt>
<dd>
<p>the id of the step execution. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>jobExecutionId</strong></dt>
<dd>
<p>the job execution id. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_display">job execution display</h4>
<div class="paragraph">
<p>Display the details of a Job Execution.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution display [--id] &lt;id&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>id</strong></dt>
<dd>
<p>the id of the job execution. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_all_stop">job execution all stop</h4>
<div class="paragraph">
<p>Stop all the job executions that are running.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution all stop [--force [&lt;force&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>force</strong></dt>
<dd>
<p>bypass confirmation prompt. <strong>(default: <code>false</code>, or <code>true</code> if <code>--force</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_stop">job execution stop</h4>
<div class="paragraph">
<p>Stop a job execution that is running.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution stop [--id] &lt;id&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>id</strong></dt>
<dd>
<p>the id of the job execution. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_execution_restart">job execution restart</h4>
<div class="paragraph">
<p>Restart a job that failed or interrupted previously.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job execution restart [--id] &lt;id&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>id</strong></dt>
<dd>
<p>the id of the job execution that failed or interrupted. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_deploy">job deploy</h4>
<div class="paragraph">
<p>Deploy a previously created job.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job deploy [--name] &lt;name&gt; [--properties &lt;properties&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the job to deploy. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>properties</strong></dt>
<dd>
<p>the properties for this deployment.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_launch">job launch</h4>
<div class="paragraph">
<p>Launch previously deployed job.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job launch [[--name] &lt;name&gt;] [--params &lt;params&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the job to deploy.</p>
</dd>
<dt class="hdlist1"><strong>params</strong></dt>
<dd>
<p>the parameters for the job. <strong>(default: ``)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_undeploy">job undeploy</h4>
<div class="paragraph">
<p>Un-deploy an existing job.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job undeploy [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the job to un-deploy. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_all_undeploy">job all undeploy</h4>
<div class="paragraph">
<p>Un-deploy all existing jobs.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job all undeploy [--force [&lt;force&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>force</strong></dt>
<dd>
<p>bypass confirmation prompt. <strong>(default: <code>false</code>, or <code>true</code> if <code>--force</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_instance_display">job instance display</h4>
<div class="paragraph">
<p>Display information about a given job instance.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job instance display [[--id] &lt;id&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>id</strong></dt>
<dd>
<p>the id of the job instance to retrieve.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_destroy">job destroy</h4>
<div class="paragraph">
<p>Destroy an existing job.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job destroy [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the job to destroy. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_job_all_destroy">job all destroy</h4>
<div class="paragraph">
<p>Destroy all existing jobs.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>job all destroy [--force [&lt;force&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>force</strong></dt>
<dd>
<p>bypass confirmation prompt. <strong>(default: <code>false</code>, or <code>true</code> if <code>--force</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_module_commands">Module Commands</h3>
<div class="sect3">
<h4 id="_module_info">module info</h4>
<div class="paragraph">
<p>Get information about a module.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>module info [--name] &lt;name&gt; [--hidden [&lt;hidden&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>name of the module to query, in the form <em>type:name</em>. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>hidden</strong></dt>
<dd>
<p>whether to show <em>hidden</em> options. <strong>(default: <code>false</code>, or <code>true</code> if <code>--hidden</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_module_compose">module compose</h4>
<div class="paragraph">
<p>Create a virtual module.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>module compose [--name] &lt;name&gt; --definition &lt;definition&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name to give to the module. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>definition</strong></dt>
<dd>
<p>module definition using xd dsl. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_module_delete">module delete</h4>
<div class="paragraph">
<p>Delete a virtual module.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>module delete [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>name of the module to delete, in the form <em>type:name</em>. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_module_list">module list</h4>
<div class="paragraph">
<p>List all modules.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>module list</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metrics_commands">Metrics Commands</h3>
<div class="sect3">
<h4 id="_counter_list">counter list</h4>
<div class="paragraph">
<p>List all available counter names.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>counter list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_counter_delete">counter delete</h4>
<div class="paragraph">
<p>Delete the counter with the given name.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>counter delete [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the counter to delete. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_counter_display">counter display</h4>
<div class="paragraph">
<p>Display the value of a counter.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>counter display [--name] &lt;name&gt; [--pattern &lt;pattern&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the counter to display. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>pattern</strong></dt>
<dd>
<p>the pattern used to format the value (see DecimalFormat). <strong>(default: <code>&lt;use platform locale&gt;</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_field_value_counter_list">field-value-counter list</h4>
<div class="paragraph">
<p>List all available field-value-counter names.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>field-value-counter list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_field_value_counter_delete">field-value-counter delete</h4>
<div class="paragraph">
<p>Delete the field-value-counter with the given name.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>field-value-counter delete [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the field-value-counter to delete. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_field_value_counter_display">field-value-counter display</h4>
<div class="paragraph">
<p>Display the value of a field-value-counter.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>field-value-counter display [--name] &lt;name&gt; [--pattern &lt;pattern&gt;] [--size &lt;size&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the field-value-counter to display. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>pattern</strong></dt>
<dd>
<p>the pattern used to format the field-value-counter&#8217;s field count (see DecimalFormat). <strong>(default: <code>&lt;use platform locale&gt;</code>)</strong></p>
</dd>
<dt class="hdlist1"><strong>size</strong></dt>
<dd>
<p>the number of values to display. <strong>(default: <code>25</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_aggregate_counter_list">aggregate-counter list</h4>
<div class="paragraph">
<p>List all available aggregate counter names.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aggregate-counter list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_aggregate_counter_delete">aggregate-counter delete</h4>
<div class="paragraph">
<p>Delete an aggregate counter.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aggregate-counter delete [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the aggregate counter to delete. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_aggregate_counter_display">aggregate-counter display</h4>
<div class="paragraph">
<p>Display aggregate counter values by chosen interval and resolution(minute, hour).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aggregate-counter display [--name] &lt;name&gt; [--from &lt;from&gt;] [--to &lt;to&gt;] [--lastHours &lt;lastHours&gt;] [--lastDays &lt;lastDays&gt;] [--resolution &lt;resolution&gt;] [--pattern &lt;pattern&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the aggregate counter to display. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>start-time for the interval. format: <em>yyyy-MM-dd HH:mm:ss</em>.</p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>end-time for the interval. format: <em>yyyy-MM-dd HH:mm:ss</em>. defaults to now.</p>
</dd>
<dt class="hdlist1"><strong>lastHours</strong></dt>
<dd>
<p>set the interval to last <em>n</em> hours.</p>
</dd>
<dt class="hdlist1"><strong>lastDays</strong></dt>
<dd>
<p>set the interval to last <em>n</em> days.</p>
</dd>
<dt class="hdlist1"><strong>resolution</strong></dt>
<dd>
<p>the size of the bucket to aggregate (minute, hour, day, month). <strong>(default: <code>hour</code>)</strong></p>
</dd>
<dt class="hdlist1"><strong>pattern</strong></dt>
<dd>
<p>the pattern used to format the count values (see DecimalFormat). <strong>(default: <code>&lt;use platform locale&gt;</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_gauge_list">gauge list</h4>
<div class="paragraph">
<p>List all available gauge names.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gauge list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gauge_delete">gauge delete</h4>
<div class="paragraph">
<p>Delete a gauge.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gauge delete [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the gauge to delete. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_gauge_display">gauge display</h4>
<div class="paragraph">
<p>Display the value of a gauge.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gauge display [--name] &lt;name&gt; [--pattern &lt;pattern&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the gauge to display. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>pattern</strong></dt>
<dd>
<p>the pattern used to format the value (see DecimalFormat). <strong>(default: <code>&lt;use platform locale&gt;</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rich_gauge_list">rich-gauge list</h4>
<div class="paragraph">
<p>List all available richgauge names.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>rich-gauge list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rich_gauge_delete">rich-gauge delete</h4>
<div class="paragraph">
<p>Delete the richgauge.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>rich-gauge delete [--name] &lt;name&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the richgauge to delete. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rich_gauge_display">rich-gauge display</h4>
<div class="paragraph">
<p>Display Rich Gauge value.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>rich-gauge display [--name] &lt;name&gt; [--pattern &lt;pattern&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>name</strong></dt>
<dd>
<p>the name of the richgauge to display value. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>pattern</strong></dt>
<dd>
<p>the pattern used to format the richgauge value (see DecimalFormat). <strong>(default: <code>&lt;use platform locale&gt;</code>)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_commands">Http Commands</h3>
<div class="sect3">
<h4 id="_http_post">http post</h4>
<div class="paragraph">
<p>POST data to http endpoint.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http post [[--target] &lt;target&gt;] [--data &lt;data&gt;] [--file &lt;file&gt;] [--contentType &lt;contentType&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>target</strong></dt>
<dd>
<p>the location to post to. <strong>(default: <code>http://localhost:9000</code>)</strong></p>
</dd>
<dt class="hdlist1"><strong>data</strong></dt>
<dd>
<p>the text payload to post. exclusive with file. embedded double quotes are not supported if next to a space character.</p>
</dd>
<dt class="hdlist1"><strong>file</strong></dt>
<dd>
<p>filename to read data from. exclusive with data.</p>
</dd>
<dt class="hdlist1"><strong>contentType</strong></dt>
<dd>
<p>the content-type to use. file is also read using the specified charset. <strong>(default: <code>text/plain; Charset=UTF-8</code>)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_http_get">http get</h4>
<div class="paragraph">
<p>Make GET request to http endpoint.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http get [[--target] &lt;target&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>target</strong></dt>
<dd>
<p>the URL to make the request to. <strong>(default: <code>http://localhost:9393</code>)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hadoop_configuration_commands">Hadoop Configuration Commands</h3>
<div class="sect3">
<h4 id="_hadoop_config_props_set">hadoop config props set</h4>
<div class="paragraph">
<p>Sets the value for the given Hadoop property.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop config props set [--property] &lt;property&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>property</strong></dt>
<dd>
<p>what to set, in the form &lt;name=value&gt;. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_config_props_get">hadoop config props get</h4>
<div class="paragraph">
<p>Returns the value of the given Hadoop property.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop config props get [--key] &lt;key&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>key</strong></dt>
<dd>
<p>property name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_config_info">hadoop config info</h4>
<div class="paragraph">
<p>Returns basic info about the Hadoop configuration.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop config info</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_config_load">hadoop config load</h4>
<div class="paragraph">
<p>Loads the Hadoop configuration from the given resource.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop config load [--location] &lt;location&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>location</strong></dt>
<dd>
<p>configuration location (can be a URL). <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_config_props_list">hadoop config props list</h4>
<div class="paragraph">
<p>Returns (all) the Hadoop properties.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop config props list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_config_fs">hadoop config fs</h4>
<div class="paragraph">
<p>Sets the Hadoop namenode.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop config fs [--namenode] &lt;namenode&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>namenode</strong></dt>
<dd>
<p>namenode URL - can be file:///|hdfs://&lt;namenode&gt;:&lt;port&gt;|webhdfs://&lt;namenode&gt;:&lt;port&gt;. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hadoop_filesystem_commands">Hadoop FileSystem Commands</h3>
<div class="sect3">
<h4 id="_hadoop_fs_get">hadoop fs get</h4>
<div class="paragraph">
<p>Copy files to the local file system.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs get --from &lt;from&gt; --to &lt;to&gt; [--ignoreCrc [&lt;ignoreCrc&gt;]] [--crc [&lt;crc&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>ignoreCrc</strong></dt>
<dd>
<p>whether ignore CRC. <strong>(default: <code>false</code>, or <code>true</code> if <code>--ignoreCrc</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>crc</strong></dt>
<dd>
<p>whether copy CRC. <strong>(default: <code>false</code>, or <code>true</code> if <code>--crc</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_put">hadoop fs put</h4>
<div class="paragraph">
<p>Copy single src, or multiple srcs from local file system to the destination file system.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs put --from &lt;from&gt; --to &lt;to&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_count">hadoop fs count</h4>
<div class="paragraph">
<p>Count the number of directories, files, bytes, quota, and remaining quota.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs count [--quota [&lt;quota&gt;]] --path &lt;path&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>quota</strong></dt>
<dd>
<p>whether with quta information. <strong>(default: <code>false</code>, or <code>true</code> if <code>--quota</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>path</strong></dt>
<dd>
<p>path name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_mkdir">hadoop fs mkdir</h4>
<div class="paragraph">
<p>Create a new directory.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs mkdir [--dir] &lt;dir&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>dir</strong></dt>
<dd>
<p>directory name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_tail">hadoop fs tail</h4>
<div class="paragraph">
<p>Display last kilobyte of the file to stdout.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs tail [--file] &lt;file&gt; [--follow [&lt;follow&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>file</strong></dt>
<dd>
<p>file to be tailed. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>follow</strong></dt>
<dd>
<p>whether show content while file grow. <strong>(default: <code>false</code>, or <code>true</code> if <code>--follow</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_ls">hadoop fs ls</h4>
<div class="paragraph">
<p>List files in the directory.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs ls [[--dir] &lt;dir&gt;] [--recursive [&lt;recursive&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>dir</strong></dt>
<dd>
<p>directory to be listed. <strong>(default: <code>.</code>)</strong></p>
</dd>
<dt class="hdlist1"><strong>recursive</strong></dt>
<dd>
<p>whether with recursion. <strong>(default: <code>false</code>, or <code>true</code> if <code>--recursive</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_cat">hadoop fs cat</h4>
<div class="paragraph">
<p>Copy source paths to stdout.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs cat [--path] &lt;path&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>path</strong></dt>
<dd>
<p>file name to be shown. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_chgrp">hadoop fs chgrp</h4>
<div class="paragraph">
<p>Change group association of files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs chgrp [--recursive [&lt;recursive&gt;]] --group &lt;group&gt; [--path] &lt;path&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>recursive</strong></dt>
<dd>
<p>whether with recursion. <strong>(default: <code>false</code>, or <code>true</code> if <code>--recursive</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>group</strong></dt>
<dd>
<p>group name. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>path</strong></dt>
<dd>
<p>path of the file whose group will be changed. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_chown">hadoop fs chown</h4>
<div class="paragraph">
<p>Change the owner of files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs chown [--recursive [&lt;recursive&gt;]] --owner &lt;owner&gt; [--path] &lt;path&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>recursive</strong></dt>
<dd>
<p>whether with recursion. <strong>(default: <code>false</code>, or <code>true</code> if <code>--recursive</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>owner</strong></dt>
<dd>
<p>owner name. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>path</strong></dt>
<dd>
<p>path of the file whose ownership will be changed. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_chmod">hadoop fs chmod</h4>
<div class="paragraph">
<p>Change the permissions of files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs chmod [--recursive [&lt;recursive&gt;]] --mode &lt;mode&gt; [--path] &lt;path&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>recursive</strong></dt>
<dd>
<p>whether with recursion. <strong>(default: <code>false</code>, or <code>true</code> if <code>--recursive</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>mode</strong></dt>
<dd>
<p>permission mode. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>path</strong></dt>
<dd>
<p>path of the file whose permissions will be changed. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_copyfromlocal">hadoop fs copyFromLocal</h4>
<div class="paragraph">
<p>Copy single src, or multiple srcs from local file system to the destination file system. Same as put.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs copyFromLocal --from &lt;from&gt; --to &lt;to&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_movefromlocal">hadoop fs moveFromLocal</h4>
<div class="paragraph">
<p>Similar to put command, except that the source localsrc is deleted after it&#8217;s copied.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs moveFromLocal --from &lt;from&gt; --to &lt;to&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_copytolocal">hadoop fs copyToLocal</h4>
<div class="paragraph">
<p>Copy files to the local file system. Same as get.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs copyToLocal --from &lt;from&gt; --to &lt;to&gt; [--ignoreCrc [&lt;ignoreCrc&gt;]] [--crc [&lt;crc&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>ignoreCrc</strong></dt>
<dd>
<p>whether ignore CRC. <strong>(default: <code>false</code>, or <code>true</code> if <code>--ignoreCrc</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>crc</strong></dt>
<dd>
<p>whether copy CRC. <strong>(default: <code>false</code>, or <code>true</code> if <code>--crc</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_copymergetolocal">hadoop fs copyMergeToLocal</h4>
<div class="paragraph">
<p>Takes a source directory and a destination file as input and concatenates files in src into the destination local file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs copyMergeToLocal --from &lt;from&gt; --to &lt;to&gt; [--endline [&lt;endline&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>endline</strong></dt>
<dd>
<p>whether add a newline character at the end of each file. <strong>(default: <code>false</code>, or <code>true</code> if <code>--endline</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_cp">hadoop fs cp</h4>
<div class="paragraph">
<p>Copy files from source to destination. This command allows multiple sources as well in which case the destination must be a directory.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs cp --from &lt;from&gt; --to &lt;to&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_mv">hadoop fs mv</h4>
<div class="paragraph">
<p>Move source files to destination in the HDFS.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs mv --from &lt;from&gt; --to &lt;to&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>from</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>to</strong></dt>
<dd>
<p>destination path name. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_du">hadoop fs du</h4>
<div class="paragraph">
<p>Displays sizes of files and directories contained in the given directory or the length of a file in case its just a file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs du [[--dir] &lt;dir&gt;] [--summary [&lt;summary&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>dir</strong></dt>
<dd>
<p>directory to be listed. <strong>(default: <code>.</code>)</strong></p>
</dd>
<dt class="hdlist1"><strong>summary</strong></dt>
<dd>
<p>whether with summary. <strong>(default: <code>false</code>, or <code>true</code> if <code>--summary</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_expunge">hadoop fs expunge</h4>
<div class="paragraph">
<p>Empty the trash.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs expunge</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_rm">hadoop fs rm</h4>
<div class="paragraph">
<p>Remove files in the HDFS.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs rm [[--path] &lt;path&gt;] [--skipTrash [&lt;skipTrash&gt;]] [--recursive [&lt;recursive&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>path</strong></dt>
<dd>
<p>path to be deleted. <strong>(default: <code>.</code>)</strong></p>
</dd>
<dt class="hdlist1"><strong>skipTrash</strong></dt>
<dd>
<p>whether to skip trash. <strong>(default: <code>false</code>, or <code>true</code> if <code>--skipTrash</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>recursive</strong></dt>
<dd>
<p>whether to recurse. <strong>(default: <code>false</code>, or <code>true</code> if <code>--recursive</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_setrep">hadoop fs setrep</h4>
<div class="paragraph">
<p>Change the replication factor of a file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs setrep --path &lt;path&gt; --replica &lt;replica&gt; [--recursive [&lt;recursive&gt;]] [--waiting [&lt;waiting&gt;]]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>path</strong></dt>
<dd>
<p>path name. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>replica</strong></dt>
<dd>
<p>source file names. <strong>(required)</strong></p>
</dd>
<dt class="hdlist1"><strong>recursive</strong></dt>
<dd>
<p>whether with recursion. <strong>(default: <code>false</code>, or <code>true</code> if <code>--recursive</code> is specified without a value)</strong></p>
</dd>
<dt class="hdlist1"><strong>waiting</strong></dt>
<dd>
<p>whether wait for the replic number is eqal to the number. <strong>(default: <code>false</code>, or <code>true</code> if <code>--waiting</code> is specified without a value)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_text">hadoop fs text</h4>
<div class="paragraph">
<p>Take a source file and output the file in text format.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs text [--file] &lt;file&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>file</strong></dt>
<dd>
<p>file to be shown. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_hadoop_fs_touchz">hadoop fs touchz</h4>
<div class="paragraph">
<p>Create a file of zero length.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hadoop fs touchz [--file] &lt;file&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>file</strong></dt>
<dd>
<p>file to be touched. <strong>(required)</strong></p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Using the filesystem is just one possible way of storing module defintions.  Other backends will be supported in the future, e.g. Redis.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. The server is implemented by the <code>AdminMain</code> class in the <code>spring-xd-dirt</code> subproject
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2014-07-29 17:35:43 PDT
</div>
</div>
</body>
</html>